import{Q as S,a4 as O,M as A,r as o,g as I,a2 as V,f as L,o as u,c as d,a as k,t as q,l as c,n as y,z,k as j,L as B,B as D,_ as E}from"./entry.06343418.js";import{_ as M}from"./_plugin-vue_export-helper.c27b6911.js";function $(s,v,e,p){let r,a=!1;S(()=>{r=new IntersectionObserver(async([t])=>{t.isIntersecting&&!a&&(a=!0,await v())},{threshold:0,rootMargin:"300px",...p}),s.value&&r.observe(s.value)}),O(()=>{r==null||r.disconnect(),e==null||e()})}const N=D(()=>E(()=>import("./PDFJsView.aa95665e.js"),["./PDFJsView.aa95665e.js","./entry.06343418.js","./entry.c5f8f180.css","./PDFJsView.4e9fad9f.css"],import.meta.url).then(s=>s.default||s)),J={class:"w-full"},Q={for:""},T={key:0,class:"skeleton w-full"},W={key:1,class:"w-full flex justify-center items-center flex-col"},G={key:0,class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},H={class:"image-box"},K=["src"],X=A({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1},blob_file:{type:[File,String,Boolean],required:!1,default:!1}},emits:["setFile","setPreview"],setup(s,{emit:v}){const e=s;o(!1);const p=o(null);o(null),o(null);const r=o(null),a=o(null);let t=null;const R=I("token"),{apiBase:F}=V(),f=o(),_=o(!1),m=o(!1),h=o(!0),P=l=>{const n=l.target.files;if(!n||!n.length)return;m.value=!0;const i=n[0];f.value=i,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(i),a.value=t,v("setPreview",t),v("setFile",i)},C=()=>{b(!0);const l=p.value;l&&(l.value=""),v("setFile",null),v("setPreview",null)};L(()=>e.show,l=>{b(!0),_.value=!1,m.value=!1},{immediate:!0,deep:!0}),L(()=>e.link,l=>{l&&r.value&&(h.value=!0,w())},{immediate:!0});async function w(){if(e.link&&e.link.includes("blob:http")&&(m.value=!0,a.value=e.link,f.value=e.blob_file),!e.link||a.value||e.link=="Exists"||e.link.includes("blob:http")||m.value||_.value){h.value=!1;return}try{const l=e.link.startsWith("http")?e.link:`${F}${e.link}`,n=await fetch(l,{headers:{Authorization:`Bearer ${R.value}`}});if(!n.ok){let i=p.value;i&&(i.value="");return}f.value=await n.blob(),t=URL.createObjectURL(f.value),a.value=t,_.value=!0}finally{h.value=!1}}function b(l=!1){m.value&&l==!1||_.value&&l==!1||(t&&(URL.revokeObjectURL(t),t=null),a.value=null,f.value=null)}return $(r,w,b,{rootMargin:"300px 0px",threshold:0}),O(()=>{_.value=!1}),(l,n)=>{var g,x;const i=N;return u(),d("div",{ref_key:"wrapper",ref:r,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[k("div",J,[k("label",Q,q(s.label),1)]),c(h)?(u(),d("div",T)):(u(),d("div",W,[c(a)?(u(),d("div",G,[k("div",H,[(g=c(f))!=null&&g.type.match(/image/)?(u(),d("img",{key:0,src:c(a),class:"w-full h-full object-cover"},null,8,K)):y("",!0),(x=c(f))!=null&&x.type.match(/application\/pdf/)?(u(),z(i,{key:1,pdfObjUrl:c(t)},null,8,["pdfObjUrl"])):y("",!0)])])):y("",!0),s.can_remove?j((u(),d("button",{key:1,type:"button",class:"bg-gray-600 w-36 text-white",onClick:n[0]||(n[0]=U=>C())},"Clear",512)),[[B,c(a)]]):y("",!0),s.can_remove?j((u(),d("input",{key:2,class:"w-full",onChange:n[1]||(n[1]=U=>P(U)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[B,!c(a)]]):y("",!0)]))],512)}}});const ee=M(X,[["__scopeId","data-v-9158a68c"]]);export{ee as default};
