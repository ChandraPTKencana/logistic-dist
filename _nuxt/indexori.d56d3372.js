import{_ as Le}from"./Header.dc717fd7.js";import{_ as Re}from"./Plus.8d86f50c.js";import{_ as Ke}from"./Edit.f2273434.js";import{_ as Ge}from"./Delete.a191bd91.js";import{_ as Je}from"./Signature.3ad65f73.js";import{u as qe,_ as Ze}from"./useDownload.b6e5467c.js";import{_ as Qe}from"./Cog.0abd5ae6.js";import{_ as We}from"./client-only.55cc710c.js";import{_ as Xe}from"./Search.04c895ae.js";import{_ as et,a as tt}from"./trx_absen.a8fabef1.js";import{_ as ot,a as at}from"./Check.600f96fb.js";import{_ as lt}from"./TableView.9b6484d0.js";import{_ as st}from"./PopupMini.vue.4d01eeed.js";import{_ as nt,a as rt}from"./trx_trp_validasi.e8886b7c.js";import{_ as it}from"./Times.ae080b16.js";import{r as s,f as ie,D as ut,B as dt,H as ue,I as _t,g as ct,L as pt,c as F,b as n,a as t,G as O,k as l,d as de,q as _e,t as H,w as y,h as U,j as ce,i as pe,l as ve,m as vt,E as ft,x as v,y as $,o as m,K as C,M as mt,s as bt}from"./entry.0b68283d.js";import"./useUtils.23c1533f.js";import{u as M}from"./useMyFetch.c22342b0.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.3fee3706.js";const yt={class:"w-full h-full flex flex-col"},kt={class:"w-full flex grow flex-col overflow-auto h-0"},xt={class:"w-full flex justify-between flex-wrap"},gt={class:"grow flex"},ht={class:"flex"},wt=t("span",{class:"text-xs"},"Mode",-1),Dt={action:"#",class:"w-full flex p-1"},$t=t("div",{class:"font-bold"}," Tgl Dari ",-1),Ct={class:"text-red-500"},Mt=t("div",{class:"font-bold"}," Tgl Sampai ",-1),Tt={class:"text-red-500"},At={class:"grow"},Vt=t("div",{class:"font-bold"}," Keyword ",-1),St={class:"pl-1"},Pt=t("div",{class:"font-bold"}," Sort By ",-1),Bt=mt('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),jt=[Bt],Nt={class:"pl-1"},It=t("div",{class:"font-bold"}," Sort Order ",-1),Yt=t("option",{value:"asc"},"Asc",-1),Ft=t("option",{value:"desc"},"Desc",-1),Ot=[Yt,Ft],Ht={class:"flex items-end pl-1"},Ut={class:"grow mb-5"},zt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Et={class:"relative",style:{width:"95%",height:"90%"}},Lt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Rt=["src"],Kt={key:1,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Gt={class:"relative",style:{width:"95%",height:"90%"}},Jt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},qt={class:"w-full h-full flex flex-col items-center justify-content-center bg-white"},Zt={class:"w-full p-1"},Qt={class:"w-full p-1 bg-gray-200"},Wt=t("div",{class:"w-full text-blue-600 font-bold"}," Set Date For Load Data ",-1),Xt={class:"w-full grid grid-cols-2 grid-rows-1 gap-1"},eo={class:"flex flex-col flex-wrap p-1"},to=t("label",{for:""},"From",-1),oo={class:"grow"},ao={class:"flex flex-col flex-wrap p-1"},lo=t("label",{for:""},"To",-1),so={class:"grow"},Ao={__name:"indexori",async setup(no){let S,q;const{$moment:P}=bt(),c={};c._TimeZoneOffset=new Date().getTimezoneOffset(),c.sort="tanggal:desc";const B=s({}),x=s({from:"",to:""}),h=ie("token"),fe=ie("role"),me=a=>a.includes(fe.value),{data:be}=([S,q]=ut(async()=>ft(async()=>{v().loading_full=!0;let a=[];const[e,p]=await Promise.all([M("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0})]);return e.status.value!=="error"&&(a=e.data.value.data),e.status.value==="error"?($().trigger(e.error),{trx_trps:a}):(v().loading_full=!1,{trx_trps:a})},"$GTdArkrV4K")),S=await S,q(),S),r=s(be.value.trx_trps||[]),Z=s([]),Q=s([]),W=s([]),g=s(!1),ye=async(a,e="")=>{v().loading_full=!0;let p=_.value.from?P(_.value.from).format("Y-MM-DD"):"",k=_.value.to?P(_.value.to).format("Y-MM-DD"):"";const{data:u,error:D,status:f}=await M("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{jenis:a,online_status:g.value,from:p,to:k,transition_to:e},retry:0});if(v().loading_full=!1,f.value==="error"){$().trigger(D);return}Z.value=u.value.list_cost_center,Q.value=u.value.list_ticket,W.value=u.value.list_pv},i=s(""),w=s({field:"tanggal",by:"desc"}),d=s(-1),b=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ke=()=>{c.like="",i.value!=""&&(c.like=`id:%${i.value}%,xto:%${i.value}%,jenis:%${i.value}%,pv_no:%${i.value}%,ticket_a_no:%${i.value}%,ticket_b_no:%${i.value}%,no_pol:%${i.value}%,supir:%${i.value}%,kernet:%${i.value}%,cost_center_code:%${i.value}%,cost_center_desc:%${i.value}%,pvr_id:%${i.value}%,pvr_no:%${i.value}%,tanggal:%${i.value}%,transition_to:%${i.value}%`),c.sort="",w.value.field&&(c.sort=w.value.field+":"+w.value.by),c.date_from=x.value.from?P(x.value.from).format("YYYY-MM-DD"):"",c.date_to=x.value.to?P(x.value.to).format("YYYY-MM-DD"):""},X=async()=>{v().loading_full=!0,B.value={},b.value.may_get_data=!1,c.page=b.value.page,c.page==1&&(r.value=[]),c.first_row&&delete c.first_row,c.page>1&&(c.first_row=JSON.stringify(r.value[0]));const{data:a,error:e,status:p}=await M("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:c,retry:0});if(v().loading_full=!1,b.value.may_get_data=!0,p.value==="error"){$().trigger(e,B);return}b.value.page==1?r.value=a.value.data:b.value.page>1&&(r.value=[...r.value,...a.value.data]),a.value.data.length==0&&(b.value.is_last_record=!0)},xe=()=>{b.value.page=1,b.value.is_last_record=!1,ke(),X()};dt();const j=s(!1),z=s(0),ge=()=>{z.value=0,j.value=!0},{display:T}=ue();_t(ue());const he=()=>{d.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(z.value=r.value[d.value].id,j.value=!0)},E=s(!1),ee=s(0),we=()=>{d.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(ee.value=r.value[d.value].id,E.value=!0)},L=s(!1),te=s(0),De=a=>{te.value=a,L.value=!0},R=s(!1),oe=s({}),V=s(!1),A=s(""),$e=async()=>{V.value&&(V.value=!1)},Ce=()=>{d.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(A.value="",oe.value={id:r.value[d.value].id},V.value=!0)};ct(()=>A.value,a=>{a.trim().length>0?R.value=!0:R.value=!1},{immediate:!1});const Me=async()=>{v().loading_full=!0;const a=new FormData;a.append("id",r.value[d.value].id),a.append("deleted_reason",A.value),a.append("_method","DELETE");const{data:e,error:p,status:k}=await M("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,k.value==="error"){$().trigger(p);return}r.value.splice(d.value,1),d.value=-1,V.value=!1},{downloadFile:Te,printHtml:Ae}=qe(),K=s(!1),ae=s(""),le=async()=>{if(K.value==!0){K.value=!1;return}if(d.value==-1){T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}v().loading_full=!0;const{data:a,error:e,status:p}=await M("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:r.value[d.value].id},retry:0});if(v().loading_full=!1,p.value==="error"){$().trigger(e);return}Ae(a.value.html,318)},Ve=()=>{Te(ae.value)},se=a=>a.pv_id<=0||["CPO","PK"].indexOf(a.jenis)>-1&&(a.ticket_a_id<=0||a.ticket_b_bruto<=0||a.ticket_b_tara<=0||a.ticket_b_netto<=0||a.ticket_b_in_at==""||a.ticket_b_out_at=="")||a.jenis=="TBS"&&(a.ticket_a_id<=0||a.ticket_b_id<=0)||a.jenis=="TBSK"&&a.ticket_b_id<=0?0:1,N=s(!1),_=s({from:new Date().setDate(new Date().getDate()-3),to:new Date}),ne=a=>{a=="from"?_.value.from-_.value.to>0&&(_.value.from=_.value.to):_.value.to-_.value.from<0&&(_.value.to=_.value.from)},Se=async()=>{v().loading_full=!0;const a=new FormData;a.append("id",r.value[d.value].id),a.append("online_status",g.value);const{data:e,error:p,status:k}=await M("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,k.value==="error"){$().trigger(p);return}let u=r.value[d.value];u.pvr_id=e.value.pvr_id,u.pvr_no=e.value.pvr_no,u.pvr_total=e.value.pvr_total,u.pvr_had_detail=e.value.pvr_had_detail,u.updated_at=e.value.updated_at,r.value.splice(d.value,1,{...u}),d.value=-1,T({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},Pe=async()=>{v().loading_full=!0;const a=new FormData;a.append("online_status",g.value);const{data:e,error:p,status:k}=await M("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,k.value==="error"){$().trigger(p);return}e.value.data.forEach(u=>{let D=r.value.map(f=>f.id).indexOf(u.id);if(D!==-1){let f=r.value[D];f.pv_id=u.pv_id,f.pv_no=u.pv_no,f.pv_total=u.pv_total,f.pv_datetime=u.pv_datetime,f.updated_at=u.updated_at,r.value.splice(D,1,{...f})}}),T({show:!0,status:"Success",message:"Update PV Done"})},Be=s([{key:"status",label:"Status"},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"id",label:"ID"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol"},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",dateformat:"DD-MM-Y"},{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"transition_to",label:"Peralihan"},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No"},{key:"ticket_a_bruto",label:"Bruto"},{key:"ticket_a_tara",label:"Tara"},{key:"ticket_a_netto",label:"Netto"},{key:"ticket_a_supir",label:"Supir"},{key:"ticket_a_no_pol",label:"No Pol"},{key:"ticket_a_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_a_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No"},{key:"ticket_b_bruto",label:"Bruto"},{key:"ticket_b_tara",label:"Tara"},{key:"ticket_b_netto",label:"Netto"},{key:"ticket_b_supir",label:"Supir"},{key:"ticket_b_no_pol",label:"No Pol"},{key:"ticket_b_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_b_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"}]);return(a,e)=>{const p=Le,k=Re,u=Ke,D=Ge,f=Je,je=Ze,Ne=Qe,I=pt("vue-date-picker"),Y=We,Ie=Xe,Ye=tt,G=ot,J=at,Fe=lt,Oe=st,He=nt,Ue=rt,ze=et,re=it;return m(),F("div",yt,[n(p,{title:"List Transaction"}),t("div",kt,[t("div",xt,[t("div",gt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[0]||(e[0]=o=>ge())},[n(k)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>he())},[n(u)]),me(["PabrikTransport"])?O("",!0):(m(),F("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>Ce())},[n(D)])),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>we())},[n(f)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>le())},[n(je)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>N.value=!0)},[n(Ne)])]),t("div",ht,[t("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[6]||(e[6]=o=>Se())}," Gen/Update PVR "),t("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[7]||(e[7]=o=>Pe())}," Update PV "),t("div",{class:"m-1 card-border cursor-pointer",onClick:e[8]||(e[8]=o=>g.value=!l(g))},[wt,de(" : "),t("span",{class:_e(["font-bold",l(g)?"text-green-600":"text-red-600"])},H(l(g)?"ONLINE":"OFFLINE"),3)])])]),t("form",Dt,[t("div",null,[$t,n(Y,null,{default:y(()=>[n(I,{modelValue:l(x).from,"onUpdate:modelValue":e[9]||(e[9]=o=>l(x).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",Ct,H(l(B).date_from),1)]),t("div",null,[Mt,n(Y,null,{default:y(()=>[n(I,{modelValue:l(x).to,"onUpdate:modelValue":e[10]||(e[10]=o=>l(x).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",Tt,H(l(B).date_to),1)]),t("div",At,[Vt,U(t("input",{class:"",type:"text","onUpdate:modelValue":e[11]||(e[11]=o=>pe(i)?i.value=o:null),name:"search",placeholder:"Keyword"},null,512),[[ce,l(i)]])]),t("div",St,[Pt,U(t("select",{class:"","onUpdate:modelValue":e[12]||(e[12]=o=>l(w).field=o)},jt,512),[[ve,l(w).field]])]),t("div",Nt,[It,U(t("select",{class:"","onUpdate:modelValue":e[13]||(e[13]=o=>l(w).by=o)},Ot,512),[[ve,l(w).by]])]),t("div",Ht,[t("button",{class:"",type:"submit",name:"button",onClick:e[14]||(e[14]=vt(o=>xe(),["prevent"]))},[n(Ie,{class:"text-2xl"})])])]),n(Fe,{thead:l(Be),selected:l(d),onSetSelected:e[15]||(e[15]=o=>d.value=o),tbody:l(r),fnCallData:X,scrolling:l(b),onSetScrollingPage:e[16]||(e[16]=o=>l(b).page=o)},{status:y(({item:o})=>[t("div",{class:_e(["text-white text-xs px-2 py-1 rounded-lg",se(o)?"bg-green-600":"bg-red-600"])},H(se(o)?"Done":"Not Done"),3)]),absen:y(({item:o,index:Ee})=>[o.trx_absens&&o.trx_absens.length>0?(m(),C(Ye,{key:0,class:"cursor-pointer",onClick:ro=>De(Ee)},null,8,["onClick"])):O("",!0)]),app1:y(({item:o})=>[o.val?(m(),C(J,{key:1})):(m(),C(G,{key:0}))]),app2:y(({item:o})=>[o.val1?(m(),C(J,{key:1})):(m(),C(G,{key:0}))]),pvr_completed:y(({item:o})=>[o.pvr_had_detail?(m(),C(J,{key:1})):(m(),C(G,{key:0}))]),_:2},1032,["thead","selected","tbody","scrolling"])]),n(Oe,{type:"delete",show:l(V),data:l(oe),fnClose:$e,fnConfirm:Me,enabledOk:l(R)},{footer:y(()=>[de(" Masukkan Alasan Penghapusan: "),t("div",Ut,[U(t("textarea",{"onUpdate:modelValue":e[17]||(e[17]=o=>pe(A)?A.value=o:null)},null,512),[[ce,l(A)]])])]),_:1},8,["show","data","enabledOk"]),n(He,{show:l(j),fnClose:()=>{j.value=!1},fnLoadDBData:ye,id:l(z),p_data:l(r),list_ticket:l(Q),list_pv:l(W),list_cost_center:l(Z),online_status:l(g)},null,8,["show","fnClose","id","p_data","list_ticket","list_pv","list_cost_center","online_status"]),n(Ue,{show:l(E),fnClose:()=>{E.value=!1},id:l(ee),p_data:l(r)},null,8,["show","fnClose","id","p_data"]),n(ze,{show:l(L),fnClose:()=>{L.value=!1},index:l(te),p_data:l(r)},null,8,["show","fnClose","index","p_data"]),l(K)?(m(),F("div",zt,[t("div",Et,[t("div",Lt,[n(re,{style:{color:"black",cursor:"pointer"},onClick:e[18]||(e[18]=o=>le())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(ae).dataBase64},null,8,Rt),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:e[19]||(e[19]=o=>Ve())})])])):O("",!0),l(N)?(m(),F("div",Kt,[t("div",Gt,[t("div",Jt,[n(re,{style:{color:"black",cursor:"pointer"},onClick:e[20]||(e[20]=o=>N.value=!1)})]),t("div",qt,[t("div",Zt,[t("div",Qt,[Wt,t("div",Xt,[t("div",eo,[to,t("div",oo,[n(Y,null,{default:y(()=>[n(I,{modelValue:l(_).from,"onUpdate:modelValue":e[21]||(e[21]=o=>l(_).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:e[22]||(e[22]=o=>ne("from"))},null,8,["modelValue"])]),_:1})])]),t("div",ao,[lo,t("div",so,[n(Y,null,{default:y(()=>[n(I,{modelValue:l(_).to,"onUpdate:modelValue":e[23]||(e[23]=o=>l(_).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:e[24]||(e[24]=o=>ne("to"))},null,8,["modelValue"])]),_:1})])])])])])]),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:e[25]||(e[25]=o=>N.value=!1)})])])):O("",!0)])}}};export{Ao as default};
