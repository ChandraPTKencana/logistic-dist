import{j as tt,r as A,g as et,i as $,f as st,o as E,c as D,k as v,L as y,a as t,b as C,l as o,t as n,n as O,d as x,F as P,E as q,D as F,m as lt,v as at,x as c,y as b,B as ot,_ as nt}from"./entry.f858b9d8.js";import{_ as it}from"./HeaderPopup.vue.38b2541b.js";import rt from"./Plus.cd273171.js";import ut from"./Send.31a9653d.js";import dt from"./CloudDownload.2eccb9b2.js";import ct from"./Times.863bc3d2.js";import{u as _t}from"./useUtils.49b1f2e4.js";import{u as g}from"./useMyFetch.ce86c1a9.js";import"./_plugin-vue_export-helper.c27b6911.js";const ft=ot(()=>nt(()=>import("./fin_payment_req_trx_trps.1ee84695.js"),["./fin_payment_req_trx_trps.1ee84695.js","./HeaderPopup.vue.38b2541b.js","./Times.863bc3d2.js","./_plugin-vue_export-helper.c27b6911.js","./entry.f858b9d8.js","./entry.f59c56d0.css","./useUtils.49b1f2e4.js","./useMyFetch.ce86c1a9.js"],import.meta.url).then(h=>h.default||h)),pt={class:"box-fixed"},ht={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},mt={class:"w-full flex flex-col items-center grow overflow-auto"},vt={class:"w-full flex"},xt=["disabled"],wt={class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},yt={class:"w-full",role:"sticky"},bt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},gt=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),jt={class:"sticky top-7 !z-[2]"},kt=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),Et=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),Dt=t("th",null,"No Trx",-1),Ct=t("th",null,"Tujuan",-1),St=t("th",null,"Produk",-1),Nt=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),At=t("th",null,"Jabatan",-1),$t=t("th",null,"Nama",-1),It=t("br",null,null,-1),Bt=t("br",null,null,-1),Pt=t("br",null,null,-1),Rt=t("th",null,null,-1),Tt=t("th",null,"No Rek",-1),Ot=t("th",null,"Nama Di Bank",-1),qt=t("br",null,null,-1),Ft=t("th",null,"Status ",-1),Ut=t("th",null,"Aksi ",-1),zt=t("th",null,"Alasan Gagal ",-1),Lt={ref:"to_move"},Vt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Kt={class:"w-full h-full flex items-center justify-center"},Mt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Yt={class:"w-full h-full flex items-center justify-center"},Qt={class:"cell"},Jt={class:"w-full h-full flex items-center justify-center p-2"},Gt={class:"pointer p-0 bg-red-500 text-white rounded flex items-center justify-center"},Ht={class:"px-2"},Wt={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},Xt={class:"w-full h-full flex items-center justify-center"},Zt={class:"cell"},te={class:"w-full h-full flex items-center justify-center"},ee={class:"cell"},se={class:"w-full h-full flex items-center justify-center"},le={class:"cell"},ae={class:"w-full h-full flex items-center justify-center"},oe={class:"cell"},ne={class:"w-full h-full flex items-center justify-center"},ie={class:"cell"},re={class:"w-full h-full flex items-center justify-end p-2"},ue={class:"cell"},de={class:"w-full h-full flex items-center justify-end p-2"},ce={class:"cell"},_e={class:"w-full h-full flex items-center justify-end p-2"},fe=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),pe={class:"cell"},he={class:"w-full h-full flex items-center justify-center"},me={class:"cell"},ve={class:"w-full h-full flex items-center justify-center"},xe={class:"cell"},we={class:"w-full h-full flex items-center justify-end p-1"},ye={class:"cell"},be={class:"w-full h-full flex items-center justify-end p-1"},ge={class:"cell"},je={class:"w-full h-full flex items-center justify-end p-1"},ke=["onClick"],Ee={class:"cell"},De={class:"w-full h-full flex items-center justify-end p-1"},Ce={class:"w-full flex items-center justify-end"},Se={class:"bg-white w-[250px] sm:w-1/2 md:w-1/3 lg:w-1/4 fixed z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-slate-700 shadow-2xl shadow-black p-2"},Ne=t("label",{for:""},"Select Batch No",-1),Ae=["value"],$e={class:"flex justify-end pt-2"},ze={__name:"fin_payment_req",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(h){const p=h,{pointFormat:m}=_t(),{display:S}=tt(),R={id:0,batch_no:0,details:[]},a=A({...R}),w=et("token"),U=$(()=>{let s=0;return a.value.details.forEach(e=>{s+=parseInt(e.nominal)}),s}),z=$(()=>{let s=0;return a.value.details.forEach(e=>{s+=parseInt(e.potongan_trx_ttl)}),s}),L=$(()=>{let s=0;return a.value.details.forEach(e=>{s+=parseInt(e.extra_money_trx_ttl)}),s}),V=$(()=>{let s=0;return a.value.details.forEach(e=>{s+=parseInt(e.jumlah)}),s}),j=$(()=>{let s=0;return a.value.details.every(e=>e.status=="READY"?(s=1,!1):e.status=="INQUIRY_PROCESS"?(s=2,!1):e.status=="INQUIRY_FAILED"?(s=3,!1):e.status=="TRANSFER_PROCESS"?(s=4,!1):e.status=="DONE"?(s=5,!1):!0),s}),K=async()=>{c().loading_full=!0;const{data:s,error:e,status:r}=await g("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:p.id},retry:0});if(c().loading_full=!1,r.value==="error"){b().trigger(e);return}a.value=s.value.data,p.is_copy&&(a.value.val=0,a.value.val1=0)},f=A({}),M=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",a.value.id),s.append("_method","PUT");let e="post";const{data:r,error:_,status:u}=await g("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}S({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),a.value.details.forEach(i=>{i.status="INQUIRY_PROCESS"})},Y=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",a.value.id),s.append("_method","PUT");let e="post";const{data:r,error:_,status:u}=await g("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}S({show:!0,status:"Success",message:"Update Data Berhasil"}),r.value.details.forEach(i=>{let d=a.value.details.map(N=>N.id).indexOf(i.id);d>-1&&(a.value.details[d].status=i.status,a.value.details[d].failed_reason=i.failed_reason)})},Q=async(s,e)=>{c().loading_full=!0,f.value={};const r=new FormData;r.append("detail_id",s),r.append("_method","PUT");let _="post";const{data:u,error:i,status:d}=await g("/fin_payment_req_dtl/renew_data",{method:_,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:r,retry:0});if(c().loading_full=!1,d.value==="error"){b().trigger(i,f);return}a.value.details[e].rek_no=u.value.employee_rek_no,a.value.details[e].rek_name=u.value.employee_rek_name,a.value.details[e].bank_code=u.value.employee_bank_code,a.value.details[e].status=u.value.status,a.value.details[e].failed_reason=u.value.failed_reason,S({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"})};st(()=>p.show,(s,e)=>{s==!0&&(p.id==0&&(a.value={...R}),p.id!=0&&K())},{immediate:!0});const B=A(!1),J=()=>{B.value=!0},G=async(s,e)=>{c().loading_full=!0,f.value={};const r=new FormData;r.append("trx_trp_id",e),r.append("_method","DELETE");let _="post";const{data:u,error:i,status:d}=await g("/fin_payment_req_dtl/delete_data",{method:_,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:r,retry:0});if(c().loading_full=!1,d.value==="error"){b().trigger(i,f);return}a.value.details=a.value.details.filter(N=>N.trx_trp_id!=e)},I=A(!1),k=A(0),H=()=>{I.value=!0,k.value=a.value.batch_no},W=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",a.value.id),s.append("batch_no",k.value),s.append("_method","PUT");let e="post";const{data:r,error:_,status:u}=await g("/fin_payment_req/set_batch_no",{method:e,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}a.value.batch_no=k.value;let i=p.p_data.map(d=>d.id).indexOf(a.value.id);i>-1&&p.p_data.splice(i,1,{...a.value}),I.value=!1,S({show:!0,status:"Success",message:"No Batch Berhasil Diperbaharui"})},X=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",a.value.id),s.append("_method","PUT");let e="post";const{data:r,error:_,status:u}=await g("/fin_payment_req/set_paid_done",{method:e,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}a.value.status="CLOSE",a.value.details.forEach(d=>{d.status="DONE"});let i=p.p_data.map(d=>d.id).indexOf(a.value.id);i>-1&&p.p_data.splice(i,1,{...a.value}),S({show:!0,status:"Success",message:"PAID IS DONE"})};return(s,e)=>{const r=it,_=rt,u=ut,i=dt,d=ct,N=ft;return E(),D(P,null,[v(t("section",pt,[t("div",null,[C(r,{title:"Finance Payment Request",fn:h.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",ht,[t("div",mt,[t("div",vt,[v(t("button",{type:"button",name:"button",class:"m-1",disabled:o(a).status=="CLOSE",onClick:e[0]||(e[0]=l=>H())}," Batch No : "+n(o(a).batch_no),9,xt),[[y,[4].indexOf(o(j))>-1]]),v(t("button",{type:"button",name:"button",class:"m-1 bg-violet-600 text-white",onClick:e[1]||(e[1]=l=>X())}," Set Paid Done ",512),[[y,[4].indexOf(o(j))>-1]]),[0,1,3].indexOf(o(j))>-1?(E(),D("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=l=>J())},[C(_)])):O("",!0),v(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=l=>M())},[C(u)],512),[[y,[1].indexOf(o(j))>-1]]),v(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=l=>Y())},[C(i)],512),[[y,[2].indexOf(o(j))>-1]])]),t("div",wt,[t("div",yt,[t("table",bt,[t("thead",null,[gt,t("tr",jt,[kt,Et,Dt,Ct,St,Nt,At,$t,t("th",null,[x("Jumlah "),It,x(" ("+n(o(m)(o(U)||0))+") ",1)]),t("th",null,[x("Potongan "),Bt,x(" ("+n(o(m)(o(z)))+")",1)]),t("th",null,[x("ExtraMoney "),Pt,x(" ("+n(o(m)(o(L)))+")",1)]),Rt,Tt,Ot,t("th",null,[x("Nominal Transfer "),qt,x(" ("+n(o(m)(o(V)||0))+")",1)]),Ft,Ut,zt])]),t("tbody",Lt,[(E(!0),D(P,null,q(o(a).details,(l,T)=>(E(),D("tr",{key:T},[t("td",Vt,[t("div",Kt,n(l.no),1)]),t("td",Mt,[t("div",Yt,n(l.id),1)]),t("td",Qt,[t("div",Jt,[t("div",Gt,[t("span",Ht,n(l.trx_trp_id),1),v(C(d,{onClick:F(Z=>G(l.id,l.trx_trp_id),["prevent"]),class:"cursor-pointer text-3xl font-bold p-0 border-l-2 border-red-300"},null,8,["onClick"]),[[y,[0,1,3].indexOf(o(j))>-1]])])])]),t("td",Wt,[t("div",Xt,n(l.jabatan!="KERNET"?l.tujuan:""),1)]),t("td",Zt,[t("div",te,n(l.jabatan!="KERNET"?l.produk:""),1)]),t("td",ee,[t("div",se,n(l.jabatan!="KERNET"?l.no_pol:""),1)]),t("td",le,[t("div",ae,n(l.jabatan),1)]),t("td",oe,[t("div",ne,n(l.nama),1)]),t("td",ie,[t("div",re,n(o(m)(l.jumlah||0)),1)]),t("td",ue,[t("div",de,n(o(m)(l.potongan_trx_ttl)),1)]),t("td",ce,[t("div",_e,n(o(m)(l.extra_money_trx_ttl)),1)]),fe,t("td",pe,[t("div",he,n(l.rek_no),1)]),t("td",me,[t("div",ve,n(l.rek_name),1)]),t("td",xe,[t("div",we,n(o(m)(l.jumlah||0)),1)]),t("td",ye,[t("div",be,n(l.status),1)]),t("td",ge,[t("div",je,[l.status=="INQUIRY_FAILED"?(E(),D("button",{key:0,class:"bg-yellow-400 rounded",onClick:F(Z=>Q(l.id,T),["prevent"])}," Renew Data ",8,ke)):O("",!0)])]),t("td",Ee,[t("div",De,n(l.failed_reason),1)])]))),128))],512)])])])]),t("div",Ce,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[5]||(e[5]=l=>h.fnClose())}," Cancel ")])])])],512),[[y,h.show]]),C(N,{show:o(B),fnClose:()=>{B.value=!1},id:o(a).id,onSetKData:e[6]||(e[6]=l=>a.value=l),onSetIsNew:e[7]||(e[7]=l=>{l&&h.p_data.push(o(a))})},null,8,["show","fnClose","id"]),v(t("div",Se,[Ne,v(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>lt(k)?k.value=l:null)},[(E(),D(P,null,q(5,l=>t("option",{value:l-1},n(l-1),9,Ae)),64))],512),[[at,o(k)]]),t("div",$e,[t("button",{type:"button",class:"bg-blue-500 text-white",onClick:e[9]||(e[9]=l=>W())},"Save"),t("button",{type:"button",class:"bg-yellow-500 text-white ml-2",onClick:e[10]||(e[10]=l=>I.value=!1)},"Cancel")])],512),[[y,o(I)]])],64)}}};export{ze as default};
