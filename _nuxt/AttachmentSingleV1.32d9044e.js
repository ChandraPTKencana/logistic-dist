import{Q as A,a4 as O,M as I,r as o,g as S,a2 as V,f as L,o as u,c as f,a as b,t as z,l as c,n as m,z as D,k as j,L as B,B as q,_ as M}from"./entry.aab07f9f.js";import{_ as $}from"./_plugin-vue_export-helper.c27b6911.js";function E(n,d,l,p){let r,a=!1;A(()=>{r=new IntersectionObserver(async([t])=>{t.isIntersecting&&!a&&(a=!0,await d())},{threshold:0,rootMargin:"300px",...p}),n.value&&r.observe(n.value)}),O(()=>{r==null||r.disconnect(),l==null||l()})}const N=q(()=>M(()=>import("./PDFJsView.47424be4.js"),["./PDFJsView.47424be4.js","./entry.aab07f9f.js","./entry.c5f8f180.css","./PDFJsView.4e9fad9f.css"],import.meta.url).then(n=>n.default||n)),J={class:"w-full"},Q={for:""},T={key:0,class:"skeleton w-full"},W={key:1,class:"w-full flex justify-center items-center flex-col"},G={key:0,class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},H={class:"image-box"},K=["src"],X=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(n,{emit:d}){const l=n;o(!1);const p=o(null);o(null),o(null);const r=o(null),a=o(null);let t=null;const R=S("token"),{apiBase:P}=V(),v=o(),_=o(!1),y=o(!1),h=o(!0),C=e=>{const s=e.target.files;if(!s||!s.length)return;y.value=!0;const i=s[0];v.value=i,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(i),a.value=t,d("setPreview","exist"),d("setFile",i)},F=()=>{k(!0);const e=p.value;e&&(e.value=""),d("setFile",null),d("setPreview",null)};L(()=>l.show,e=>{k(!0),_.value=!1,y.value=!1},{immediate:!0,deep:!0}),L(()=>l.link,e=>{e&&r.value&&(h.value=!0,w())},{immediate:!0});async function w(){if(!l.link||a.value||l.link=="exist"||y.value||_.value){h.value=!1;return}try{const e=l.link.startsWith("http")?l.link:`${P}${l.link}`,s=await fetch(e,{headers:{Authorization:`Bearer ${R.value}`}});if(!s.ok){let i=p.value;i&&(i.value="");return}v.value=await s.blob(),t=URL.createObjectURL(v.value),a.value=t,_.value=!0}finally{h.value=!1}}function k(e=!1){y.value&&e==!1||_.value&&e==!1||(t&&(URL.revokeObjectURL(t),t=null),a.value=null,v.value=null)}return E(r,w,k,{rootMargin:"300px 0px",threshold:0}),O(()=>{_.value=!1}),(e,s)=>{var g,x;const i=N;return u(),f("div",{ref_key:"wrapper",ref:r,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[b("div",J,[b("label",Q,z(n.label),1)]),c(h)?(u(),f("div",T)):(u(),f("div",W,[c(a)?(u(),f("div",G,[b("div",H,[(g=c(v))!=null&&g.type.match(/image/)?(u(),f("img",{key:0,src:c(a),class:"w-full h-full object-cover"},null,8,K)):m("",!0),(x=c(v))!=null&&x.type.match(/application\/pdf/)?(u(),D(i,{key:1,pdfObjUrl:c(t)},null,8,["pdfObjUrl"])):m("",!0)])])):m("",!0),n.can_remove?j((u(),f("button",{key:1,type:"button",class:"bg-gray-600 w-36 text-white",onClick:s[0]||(s[0]=U=>F())},"Clear",512)),[[B,c(a)]]):m("",!0),n.can_remove?j((u(),f("input",{key:2,class:"w-full",onChange:s[1]||(s[1]=U=>C(U)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[B,!c(a)]]):m("",!0)]))],512)}}});const ee=$(X,[["__scopeId","data-v-d84deade"]]);export{ee as default};
