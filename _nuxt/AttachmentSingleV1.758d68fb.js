import S from"./PDFJsView.6df9fc93.js";import{Q as I,a4 as O,M as V,r as n,g as $,a2 as q,f as j,o as i,c as f,a as b,t as A,l as u,n as m,z as D,k as L,L as B}from"./entry.85d1860e.js";import{_ as M}from"./_plugin-vue_export-helper.c27b6911.js";function z(c,d,l,p){let r,a=!1;I(()=>{r=new IntersectionObserver(async([t])=>{t.isIntersecting&&!a&&(a=!0,await d())},{threshold:0,rootMargin:"300px",...p}),c.value&&r.observe(c.value)}),O(()=>{r==null||r.disconnect(),l==null||l()})}const N={class:"w-full"},E={for:""},J={key:0,class:"skeleton w-full"},Q={key:1,class:"w-full flex justify-center items-center flex-col"},W={key:0,class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},G={class:"image-box"},H=["src"],K=V({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(c,{emit:d}){const l=c;n(!1);const p=n(null);n(null),n(null);const r=n(null),a=n(null);let t=null;const R=$("token"),{apiBase:F}=q(),v=n(),_=n(!1),h=n(!1),y=n(!0),C=e=>{const s=e.target.files;if(!s||!s.length)return;h.value=!0;const o=s[0];v.value=o,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(o),a.value=t,d("setPreview","exist"),d("setFile",o)},P=()=>{k(!0);const e=p.value;e&&(e.value=""),d("setFile",null),d("setPreview",null)};j(()=>l.show,e=>{k(!0),_.value=!1,h.value=!1},{immediate:!0,deep:!0}),j(()=>l.link,e=>{e&&r.value&&(y.value=!0,w())},{immediate:!0});async function w(){if(!l.link||a.value||l.link=="exist"||h.value||_.value){y.value=!1;return}try{const e=l.link.startsWith("http")?l.link:`${F}${l.link}`,s=await fetch(e,{headers:{Authorization:`Bearer ${R.value}`}});if(!s.ok){let o=p.value;o&&(o.value="");return}v.value=await s.blob(),t=URL.createObjectURL(v.value),a.value=t,_.value=!0}finally{y.value=!1}}function k(e=!1){h.value&&e==!1||_.value&&e==!1||(t&&(URL.revokeObjectURL(t),t=null),a.value=null,v.value=null)}return z(r,w,k,{rootMargin:"300px 0px",threshold:0}),O(()=>{_.value=!1}),(e,s)=>{var g,x;const o=S;return i(),f("div",{ref_key:"wrapper",ref:r,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[b("div",N,[b("label",E,A(c.label),1)]),u(y)?(i(),f("div",J)):(i(),f("div",Q,[u(a)?(i(),f("div",W,[b("div",G,[(g=u(v))!=null&&g.type.match(/image/)?(i(),f("img",{key:0,src:u(a),class:"w-full h-full object-cover"},null,8,H)):m("",!0),(x=u(v))!=null&&x.type.match(/application\/pdf/)?(i(),D(o,{key:1,pdfObjUrl:u(t)},null,8,["pdfObjUrl"])):m("",!0)])])):m("",!0),c.can_remove?L((i(),f("button",{key:1,type:"button",class:"bg-gray-600 w-36 text-white",onClick:s[0]||(s[0]=U=>P())},"Clear",512)),[[B,u(a)]]):m("",!0),c.can_remove?L((i(),f("input",{key:2,class:"w-full",onChange:s[1]||(s[1]=U=>C(U)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[B,!u(a)]]):m("",!0)]))],512)}}});const Z=M(K,[["__scopeId","data-v-06669d87"]]);export{Z as default};
