import{_ as Y}from"./HeaderPopup.vue.a23d4aa3.js";import{_ as W}from"./client-only.9cf9a7f5.js";import{_ as G}from"./WidthMiniList.vue.19ee4937.js";import K from"./AttachmentSingleV1.c9c53ad6.js";import{r as v,g as Q,i as C,f as X,J as Z,k as h,L as ee,o as c,c as f,a as l,b as x,l as a,A,t as _,w as te,F as $,E as U,v as ae,z as j,D as oe,H as le,x as y,y as M}from"./entry.450f3054.js";import{u as ne}from"./useUtils.f22d17c7.js";import{u as V}from"./useMyFetch.e6f412ed.js";import"./Times.db8d9a46.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.81270f82.js";import"./PDFJsView.2f32e4c3.js";const se={class:"box-fixed"},re={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ie={class:"w-full flex flex-col items-center grow overflow-auto"},de={class:"w-full flex flex-row flex-wrap"},_e={class:"w-full sm:w-3/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},me=l("label",{for:""},"Trx Trp #ID",-1),pe=["disabled"],ue={class:"text-red-500"},ce={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ve=l("label",{for:""},"Tanggal",-1),fe={class:"grow"},we={key:0,class:"card-border"},ye={key:1},he={class:"text-red-500"},xe={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ge=l("label",{for:""},"Payment Method",-1),ke=["disabled"],be=["value"],Se={class:"text-red-500"},Ne={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Oe=l("label",{for:""},"No Pol",-1),Je=["disabled"],De={id:"vehicle"},Ce=["value"],Ae={class:"text-red-500"},Me={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ve=l("label",{for:""},"Pekerja",-1),Be={class:"text-red-500"},Fe={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Te=l("label",{for:""},"Uang Tambahan",-1),Ie={class:"text-red-500"},Pe={class:"w-full flex flex-col flex-wrap p-1"},$e=l("label",{for:""},"Note For Remarks",-1),Ue=["disabled"],je={class:"text-red-500"},Ee={class:"p-1 w-full sm:w-full md:w-1/2 md:overflow-auto max-h-full"},Le={class:"text-red-500"},qe={class:"p-1 w-full sm:w-full md:w-1/2 md:overflow-auto max-h-full"},ze={class:"text-red-500"},Re={class:"w-full flex items-center justify-end"},ot={__name:"extra_money_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(w){const m=w,{$moment:B}=le(),{pointFormat:g}=ne(),F={id:-1,tanggal:new Date,employee:{id:0},extra_money:{id:0},pv_id:-1,pv_no:"",pv_total:0,no_pol:"",note_for_remarks:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_complete:"",payment_method_id:2,payment_method:{id:0,name:""},prev_trx_trp_id:"",attachment_1:"",attachment_1_preview:"",attachment_2:"",attachment_2_preview:""},o=v({...F}),k=v([]),J=Q("token"),d=v({}),E=async()=>{y().loading_full=!0,d.value={};const s=new FormData;s.append("tanggal",B(o.value.tanggal).format("Y-MM-DD")),s.append("no_pol",o.value.no_pol),s.append("prev_trx_trp_id",o.value.prev_trx_trp_id),s.append("note_for_remarks",o.value.note_for_remarks),s.append("employee_id",r.value.id),s.append("extra_money_id",i.value.id),s.append("payment_method_id",o.value.payment_method_id),s.append("attachment_1",o.value.attachment_1),s.append("attachment_1_preview",o.value.attachment_1_preview),s.append("attachment_2",o.value.attachment_2),s.append("attachment_2_preview",o.value.attachment_2_preview);let e="post",p=m.id;p==0||(s.append("id",p),s.append("_method","PUT"));const{data:t,error:D,status:N}=await V("/extra_money_trx",{method:e,headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},body:s,retry:0});if(y().loading_full=!1,N.value==="error"){M().trigger(D,d);return}o.value.employee=JSON.parse(JSON.stringify(r.value._raw)),o.value.extra_money=JSON.parse(JSON.stringify(i.value._raw));let O=k.value.map(n=>n.id).indexOf(o.value.payment_method_id);if(o.value.payment_method={...k.value[O]},o.value.updated_at=t.value.updated_at,m.id<=0)o.value.id=t.value.id,o.value.created_at=t.value.created_at,m.p_data.unshift(o.value);else{let n=m.p_data.map(H=>H.id).indexOf(m.id);n>-1&&m.p_data.splice(n,1,{...o.value})}m.fnClose()},b={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},xto:{tcon:"IconsLocationOn",text:"Tujuan",val:""},description:{tcon:"",text:"Deskripsi",val:""},total:{tcon:"",text:"Total",val:""}},id:"",name:"",title:"",note:""},S={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},r=v(JSON.parse(JSON.stringify(S))),i=v(JSON.parse(JSON.stringify(b))),L=C(()=>{let s=[];return I.value.forEach((e,p)=>{let t=JSON.parse(JSON.stringify(S));t._.id.val=e.id,t._.name.val=e.name,t._.rek_no.val=e.rek_no,t._.rek_name.val=e.rek_name,t.id=e.id,t.name=e.name,t.title=(e.rek_no||"")+" "+(e.rek_name||""),t._raw=e,s.push(JSON.parse(JSON.stringify(t)))}),s}),q=C(()=>{let s=[];return P.value.forEach((e,p)=>{let t=JSON.parse(JSON.stringify(b));t._.id.val=e.id,t._.xto.val=e.xto,t._.description.val=e.description,t._.total.val=g(e.total),t.id=e.id,t.name=e.xto,t.title=(g(e.total)||"")+" "+(e.description||""),t._raw=e,s.push(JSON.parse(JSON.stringify(t)))}),s}),u=C(()=>!!o.value.val1),z=async()=>{y().loading_full=!0;const{data:s,error:e,status:p}=await V("/extra_money_trx",{method:"get",headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},params:{id:m.id},retry:0});if(y().loading_full=!1,p.value==="error"){M().trigger(e);return}let t=s.value.data;o.value=t,{...t},r.value._raw=t.employee,r.value._.id.val=t.employee.id,r.value._.name.val=t.employee.name,r.value._.rek_no.val=t.employee_rek_no,r.value._.rek_name.val=t.employee_rek_name,r.value.id=t.employee.id,r.value.name=t.employee.name,r.value.rek_no=(t.employee_rek_no||"")+" "+(t.employee_rek_name||""),i.value._raw=t.extra_money,i.value._.id.val=t.extra_money.id,i.value._.xto.val=t.extra_money.xto,i.value._.description.val=t.extra_money.description,i.value._.total.val=g(t.extra_money.total),i.value.id=t.extra_money.id,i.value.name=t.extra_money.xto,i.value.title=(g(t.extra_money.total)||"")+" "+(t.extra_money.description||"")},T=v([]),I=v([]),P=v([]),R=async()=>{y().loading_full=!0;const{data:s,error:e,status:p}=await V("/extra_money_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},retry:0});if(y().loading_full=!1,p.value==="error"){M().trigger(e);return}T.value=s.value.list_vehicle,I.value=s.value.list_employee,P.value=s.value.list_extra_money,k.value=s.value.list_payment_methods};return X(()=>m.show,async(s,e)=>{s==!0&&(await R(),o.value={...F},r.value=JSON.parse(JSON.stringify(S)),i.value=JSON.parse(JSON.stringify(b)),d.value={},m.id!=0&&z())},{immediate:!0}),(s,e)=>{const p=Y,t=Z("vue-date-picker"),D=W,N=G,O=K;return h((c(),f("section",se,[l("div",null,[x(p,{title:"Form Transaction",fn:w.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),l("form",re,[l("div",ie,[l("div",de,[l("div",_e,[me,h(l("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a(o).prev_trx_trp_id=n),disabled:a(u)},null,8,pe),[[A,a(o).prev_trx_trp_id]]),l("p",ue,_(a(d).prev_trx_trp_id),1)]),l("div",ce,[ve,l("div",fe,[a(u)?(c(),f("div",we,_(a(B)(a(o).tanggal).format("DD-MM-Y")),1)):(c(),f("div",ye,[x(D,null,{default:te(()=>[x(t,{modelValue:a(o).tanggal,"onUpdate:modelValue":e[1]||(e[1]=n=>a(o).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})]))]),l("p",he,_(a(d).tanggal),1)]),l("div",xe,[ge,h(l("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>a(o).payment_method_id=n),disabled:a(u)},[(c(!0),f($,null,U(a(k),n=>(c(),f("option",{value:n.id},_(n.name),9,be))),256))],8,ke),[[ae,a(o).payment_method_id]]),l("p",Se,_(a(d).payment_method_id),1)]),l("div",Ne,[Oe,h(l("input",{type:"text",list:"vehicle","onUpdate:modelValue":e[3]||(e[3]=n=>a(o).no_pol=n),disabled:a(u)},null,8,Je),[[A,a(o).no_pol]]),l("datalist",De,[(c(!0),f($,null,U(a(T),n=>(c(),f("option",{value:n.no_pol},_(n.no_pol),9,Ce))),256))]),l("p",Ae,_(a(d).no_pol),1)]),l("div",Me,[Ve,x(N,{arr:a(L),selected:a(r),pure:S,onSetSelected:e[4]||(e[4]=n=>r.value=n),disabled:a(u)},null,8,["arr","selected","disabled"]),l("p",Be,_(a(d).employee_id),1)]),l("div",Fe,[Te,x(N,{arr:a(q),selected:a(i),pure:b,onSetSelected:e[5]||(e[5]=n=>i.value=n),disabled:a(u)},null,8,["arr","selected","disabled"]),l("p",Ie,_(a(d).extra_money_id),1)]),l("div",Pe,[$e,h(l("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>a(o).note_for_remarks=n),disabled:a(u)},null,8,Ue),[[A,a(o).note_for_remarks]]),l("p",je,_(a(d).note_for_remarks),1)]),l("div",Ee,[(c(),j(O,{label:"Attachment",link:a(o).attachment_1_preview,onSetFile:e[7]||(e[7]=n=>a(o).attachment_1=n),key:a(o).id,show:w.show,onSetPreview:e[8]||(e[8]=n=>a(o).attachment_1_preview=n),can_remove:!a(u),disabled:a(u)},null,8,["link","show","can_remove","disabled"])),l("p",Le,_(a(d).attachment_1),1)]),l("div",qe,[(c(),j(O,{label:"Attachment",link:a(o).attachment_2_preview,onSetFile:e[9]||(e[9]=n=>a(o).attachment_2=n),key:a(o).id,show:w.show,onSetPreview:e[10]||(e[10]=n=>a(o).attachment_2_preview=n),can_remove:!0},null,8,["link","show"])),l("p",ze,_(a(d).attachment_2),1)])])]),l("div",Re,[l("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[11]||(e[11]=n=>w.fnClose())}," Cancel "),l("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:e[12]||(e[12]=oe(n=>E(),["prevent"]))}," Save ")])])])],512)),[[ee,w.show]])}}};export{ot as default};
