import{_ as I}from"./HeaderPopup.vue.43d28a32.js";import{_ as K}from"./client-only.933662da.js";import{r as x,g as Q,i as m,f as W,I as X,k as N,J as Z,o as d,c as i,a as e,b as C,l as t,t as n,w as ee,v as te,m as ae,A as se,n as k,d as y,F as G,D as le,C as oe,G as ne,x as g,y as L}from"./entry.5a25f549.js";import{u as S}from"./useUtils.ded49b58.js";import{u as J}from"./useMyFetch.a2e0c68e.js";import"./Times.497f0045.js";import"./_plugin-vue_export-helper.c27b6911.js";const re={class:"box-fixed"},de={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ie={class:"w-full flex flex-col items-center grow overflow-auto"},ue={class:"w-full flex flex-row flex-wrap"},_e={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ce=e("label",{for:""},"Period End",-1),pe={key:0,class:"card-border"},me={key:1},fe={class:"text-red-500"},ve={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},he=e("label",{for:""},"Period Part",-1),ye={key:0,class:"card-border"},we={key:1},be=e("option",{value:"1"},"1",-1),xe=e("option",{value:"2"},"2",-1),ke=[be,xe],ge={class:"text-red-500"},Fe={key:0,class:"w-full p-1"},Ne=e("div",{class:"font-bold"}," Filter Nama ",-1),Ce={key:1,class:"w-full flex p-1 justify-between flex-wrap"},Se={class:"w-full",role:"sticky"},Be={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Me=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"12",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),je={class:"sticky top-7 !z-[2]"},Pe=e("th",null,"No",-1),Ve=e("th",null,"Jabatan",-1),qe=e("th",null,"Nama Pekerja",-1),Ae=e("th",null,"No KTP",-1),De=e("th",null,"Rek No",-1),Ee=e("th",null,"Rek Nama",-1),$e=e("th",null,"Bank Name",-1),Te={class:"text-sm"},Ue={class:"text-sm"},ze={class:"text-sm"},Re={class:"text-sm"},Ge={class:"text-sm"},Le={ref:"to_move"},Je=["data-index"],Oe={class:"w-full flex items-center justify-end"},Ze={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(w){const c=w,{$moment:B}=ne(),{pointFormat:u}=S(),M={id:"",period_end:new Date,period_part:1},s=x({...M}),j=Q("token"),v=x({}),r=x([]),O=async()=>{g().loading_full=!0,v.value={};const a=new FormData;a.append("period_end",s.value.period_end?B(s.value.period_end).format("Y-MM"):""),a.append("period_part",s.value.period_part);let l="post",_=s.value.id;_==""||(a.append("id",_),a.append("_method","PUT"));const{data:p,error:F,status:o}=await J("/salary_paid",{method:l,headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},body:a,retry:0});if(g().loading_full=!1,o.value==="error"){L().trigger(F,v);return}if(r.value=p.value.details,_<=0)s.value.id=p.value.id,s.value.created_at=p.value.created_at,s.value.updated_at=p.value.updated_at,c.p_data.unshift(s.value);else{s.value.updated_at=p.value.updated_at;let f=c.p_data.map(b=>b.id).indexOf(_);f>=-1&&c.p_data.splice(f,1,{...s.value})}};m(()=>{let a=0;return r.value.forEach(l=>{a+=parseFloat(l.standby_nominal)}),a});const P=m(()=>{let a=0;return r.value.forEach(l=>{a+=parseFloat(l.sb_gaji)}),a}),V=m(()=>{let a=0;return r.value.forEach(l=>{a+=parseFloat(l.sb_makan)}),a}),q=m(()=>{let a=0;return r.value.forEach(l=>{a+=parseFloat(l.sb_dinas)}),a}),A=m(()=>{let a=0;return r.value.forEach(l=>{a+=parseFloat(l.salary_bonus_nominal)}),a}),Y=m(()=>s.value.val&&s.value.val1||S().checkPermission("salary_paid.val")&&s.value.val||S().checkPermission("salary_paid.val1")&&s.value.val1),H=async()=>{g().loading_full=!0;const{data:a,error:l,status:_}=await J("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},params:{id:c.id},retry:0});if(g().loading_full=!1,_.value==="error"){L().trigger(l);return}s.value=a.value.data,c.is_copy&&(s.value.val=0,s.value.val1=0),r.value=a.value.data.details},h=x(""),D=m(()=>h.value!=""?r.value.filter(a=>a.employee.name.toLowerCase().includes(h.value.toLowerCase())):r.value);return W(()=>c.show,(a,l)=>{a==!0&&(s.value={...M},r.value=[],v.value={},c.id!=0&&H())},{immediate:!0}),(a,l)=>{const _=I,p=X("vue-date-picker"),F=K;return N((d(),i("section",re,[e("div",null,[C(_,{title:"Form Salary Paid",fn:w.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",de,[e("div",ie,[e("div",ue,[e("div",_e,[ce,t(s).id?(d(),i("div",pe,n(t(B)(t(s).period_end).format("MM-Y")),1)):(d(),i("div",me,[C(F,null,{default:ee(()=>[C(p,{modelValue:t(s).period_end,"onUpdate:modelValue":l[0]||(l[0]=o=>t(s).period_end=o),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",fe,n(t(v).period_end),1)]),e("div",ve,[he,t(s).id?(d(),i("div",ye,n(t(s).period_part),1)):(d(),i("div",we,[N(e("select",{"onUpdate:modelValue":l[1]||(l[1]=o=>t(s).period_part=o)},ke,512),[[te,t(s).period_part]])])),e("p",ge,n(t(v).period_part),1)])]),t(r).length?(d(),i("div",Fe,[Ne,N(e("input",{class:"",type:"text","onUpdate:modelValue":l[2]||(l[2]=o=>ae(h)?h.value=o:null),name:"search",placeholder:"Nama"},null,512),[[se,t(h)]])])):k("",!0),t(D).length?(d(),i("div",Ce,[e("div",Se,[e("table",Be,[e("thead",null,[Me,e("tr",je,[Pe,Ve,qe,Ae,De,Ee,$e,e("th",null,[y("SB.Gaji "),e("span",Te,"("+n(t(u)(t(P)||0))+")",1)]),e("th",null,[y("SB.Makan "),e("span",Ue,"("+n(t(u)(t(V)||0))+")",1)]),e("th",null,[y("SB.Dinas "),e("span",ze,"("+n(t(u)(t(q)||0))+")",1)]),e("th",null,[y("Nominal Bonus "),e("span",Re,"("+n(t(u)(t(A)||0))+")",1)]),e("th",null,[y("Total "),e("span",Ge,"("+n(t(u)(t(P)+t(V)+t(q)+t(A)||0))+")",1)])])]),e("tbody",Le,[(d(!0),i(G,null,le(t(D),(o,f)=>{var b,E,$,T,U,z,R;return d(),i(G,{key:f},[o.p_status!="Remove"?(d(),i("tr",{key:0,"data-index":f},[e("td",null,n(f+1)+".",1),e("td",null,n((b=o.employee)==null?void 0:b.role),1),e("td",null,n((E=o.employee)==null?void 0:E.name),1),e("td",null,n(($=o.employee)==null?void 0:$.ktp_no),1),e("td",null,n((T=o.employee)==null?void 0:T.rek_no),1),e("td",null,n((U=o.employee)==null?void 0:U.rek_name),1),e("td",null,n((R=(z=o.employee)==null?void 0:z.bank)==null?void 0:R.code),1),e("td",null,n(t(u)(o.sb_gaji)),1),e("td",null,n(t(u)(o.sb_makan)),1),e("td",null,n(t(u)(o.sb_dinas)),1),e("td",null,n(t(u)(o.salary_bonus_nominal)),1),e("td",null,n(t(u)(parseFloat(o.sb_gaji)+parseFloat(o.sb_makan)+parseFloat(o.sb_dinas)+parseFloat(o.salary_bonus_nominal))),1)],8,Je)):k("",!0)],64)}),128))],512)])])])):k("",!0)]),e("div",Oe,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[3]||(l[3]=o=>w.fnClose())}," Cancel "),t(Y)?k("",!0):(d(),i("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[4]||(l[4]=oe(o=>O(),["prevent"]))}," Generate "+n(t(s).id==""?"& Save":""),1))])])])],512)),[[Z,w.show]])}}};export{Ze as default};
