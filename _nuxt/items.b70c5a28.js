import{_ as Y}from"./HeaderPopup.vue.bd664fc0.js";import G from"./Search.b549ca21.js";import{_ as Z}from"./PopupMiniMulti.vue.8e811c33.js";import{h as Q,r as u,I as W,o as _,c as m,n as b,v as X,a as e,b as D,B as ee,q as te,m as i,C as T,s as se,G as $,F as N,D as le,E as oe,t as h,d as ae,H as ne,p as ie,e as re,x as q,y as ce}from"./entry.d33a3c69.js";import{u as ue}from"./useUtils.598397c0.js";import{u as de}from"./useMyFetch.8c87ab1f.js";import{_ as fe}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.7b5b41eb.js";const o=r=>(ie("data-v-b80382ed"),r=r(),re(),r),_e={class:"box-fixed"},me={action:"#",class:"w-full flex p-1"},pe={class:"grow"},ve=o(()=>e("div",{class:"font-bold"}," Keyword ",-1)),he={class:"pl-1"},ye=o(()=>e("div",{class:"font-bold"}," Sort By ",-1)),we=o(()=>e("option",{value:"created_at"},"Created At",-1)),xe=o(()=>e("option",{value:"id"},"ID",-1)),ge=o(()=>e("option",{value:"name"},"Nama",-1)),ke=[we,xe,ge],be={class:"pl-1"},Se=o(()=>e("div",{class:"font-bold"}," Sort Order ",-1)),Me=o(()=>e("option",{value:"asc"},"Asc",-1)),Ce=o(()=>e("option",{value:"desc"},"Desc",-1)),De=[Me,Ce],$e={class:"flex items-end pl-1"},Ae={class:"w-full flex justify-center items-center grow h-0 p-1"},Ie={key:0,class:""},Le={class:"tacky w-full"},Te={class:"sticky top-0 !z-[2]"},Ne={key:0,class:"min-w-[28px] !w-[28px] max-w-[28px]"},qe=o(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No.",-1)),Fe=o(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1)),Ve=o(()=>e("th",null,"Name",-1)),Be=o(()=>e("th",null,"Unit",-1)),He=o(()=>e("th",{class:"min-w-[170px] !w-[170px] max-w-[170px]"},"Created At",-1)),Oe=o(()=>e("th",{class:"min-w-[170px] !w-[170px] max-w-[170px]"},"Updated At",-1)),Re=["onClick"],Ue={key:0},Ke=["checked","onClick"],je={class:"bold"},ze={class:"whitespace-normal break-words"},Ee={class:"flex",style:{"justify-content":"end",padding:"5px"}},Je={key:0,class:"grow flex items-center"},Pe={__name:"items",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},fnSelectMulti:{type:Function,required:!1},enableMultiSelect:{type:Boolean,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},multi_key:{type:Array,required:!1}},setup(r){const d=r,{$moment:A}=ne(),{countClickListFn:F}=ue(),V=Q("token"),f=u([]),y=u(""),p=u({field:"created_at",by:"desc"}),x=u(-1),a=u({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),n={};n._TimeZoneOffset=new Date().getTimezoneOffset();const B=()=>{n.like="",y.value!=""&&(n.like=`id:%${y.value}%,name:%${y.value}%`),n.sort="",p.value.field&&(n.sort=p.value.field+":"+p.value.by)},g=u(null),I=async()=>{q().loading_full=!0,a.value.may_get_data=!1,n.page=a.value.page,n.page==1&&(f.value=[]),d.exclude_lists&&(n.exclude_lists=JSON.stringify(d.exclude_lists)),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(f.value[0]));const{data:t,error:s,status:v}=await de("/items",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},params:n,retry:0});if(q().loading_full=!1,a.value.may_get_data=!0,v.value==="error"){ce().trigger(s);return}a.value.page==1?(f.value=t.value.data,g.value&&(g.value.scrollTop=0)):a.value.page>1&&(f.value=[...f.value,...t.value.data]),t.value.data.length==0&&(a.value.is_last_record=!0)},H=async()=>{if(!a.value.may_get_data)return;let t=g.value;if(t.scrollLeft!=a.value.scrollLeft){a.value.scrollLeft=t.scrollLeft;return}a.value.is_last_record||!(Math.round(t.scrollTop)+t.clientHeight>=t.scrollHeight-1)||(a.value.page++,await I())},S=()=>{a.value.page=1,a.value.is_last_record=!1,B(),I()},w=u(!1),c=u([]),M=()=>{d.enableMultiSelect?(d.fnSelectMulti(c.value),w.value=!1):x.value>-1?d.fnSelect(f.value[x.value]):d.fnSelect({id:"",name:""})},O=t=>{d.enableMultiSelect||F(t,()=>{x.value=t},M)},R=t=>{c.value.splice(t,1)},U=async()=>{w.value&&(w.value=!1)},K=t=>{const s=c.value.map(v=>v.id).indexOf(t.id);s===-1?c.value.push(t):c.value.splice(s,1)},j=t=>c.value.map(v=>v.id).indexOf(t.id)!==-1,L=u(null);let C=null;const z=t=>{C&&clearTimeout(C),C=setTimeout(()=>{S()},500)};return W(()=>d.show,(t,s)=>{t==!0&&(c.value=[],S(),setTimeout(()=>{L.value.focus()},100))},{immediate:!0}),(t,s)=>{const v=Y,E=G,J=Z;return _(),m(N,null,[b(e("section",_e,[e("div",null,[D(v,{title:"Search And Select Item",fn:r.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",me,[e("div",pe,[ve,b(e("input",{ref_key:"ref_keyword",ref:L,class:"",type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>ee(y)?y.value=l:null),name:"search",placeholder:"Keyword",onKeyup:s[1]||(s[1]=l=>z())},null,544),[[te,i(y)]])]),e("div",he,[ye,b(e("select",{class:"","onUpdate:modelValue":s[2]||(s[2]=l=>i(p).field=l)},ke,512),[[T,i(p).field]])]),e("div",be,[Se,b(e("select",{class:"","onUpdate:modelValue":s[3]||(s[3]=l=>i(p).by=l)},De,512),[[T,i(p).by]])]),e("div",$e,[e("button",{class:"",type:"submit",name:"button",onClick:s[4]||(s[4]=se(l=>S(),["prevent"]))},[D(E,{class:"text-2xl"})])])]),e("div",Ae,[i(f).length==0?(_(),m("div",Ie," Maaf Tidak Ada Record ")):(_(),m("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:g,onScroll:H},[e("table",Le,[e("thead",null,[e("tr",Te,[r.enableMultiSelect?(_(),m("th",Ne)):$("",!0),qe,Fe,Ve,Be,He,Oe])]),e("tbody",null,[(_(!0),m(N,null,le(i(f),(l,k)=>(_(),m("tr",{key:k,onClick:P=>O(k),class:oe(i(x)==k?"active":"")},[r.enableMultiSelect?(_(),m("td",Ue,[e("input",{type:"checkbox",checked:j(l),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onClick:P=>K(l)},null,8,Ke)])):$("",!0),e("td",null,h(k+1)+".",1),e("td",je,h(l.id),1),e("td",ze,h(l.name),1),e("td",null,h(l.unit.name),1),e("td",null,h(i(A)(l.created_at).format("DD-MM-Y HH:mm:ss")),1),e("td",null,h(i(A)(l.updated_at).format("DD-MM-Y HH:mm:ss")),1)],10,Re))),128))])])],544))]),e("div",Ee,[r.enableMultiSelect?(_(),m("div",Je,[ae(" Selected Items: "+h(i(c).length)+" ",1),e("button",{type:"button",class:"ml-3",onClick:s[5]||(s[5]=l=>w.value=!0)}," View all Items ")])):$("",!0),e("button",{onClick:s[6]||(s[6]=l=>M()),class:"w-36 m-1 bg-blue-600 text-white rounded-sm"}," Select ")])])],512),[[X,r.show]]),D(J,{show:i(w),data:i(c),fnClose:U,fnConfirm:M,multi_key:r.multi_key,fnRemoveFromList:R},null,8,["show","data","multi_key"])],64)}}},st=fe(Pe,[["__scopeId","data-v-b80382ed"]]);export{st as default};
