import{_ as H}from"./HeaderPopup.vue.396fcac1.js";import{_ as I}from"./client-only.b97ccef2.js";import{r as b,f as K,G as f,j as Q,I as W,m as C,J as X,o as r,c as d,a as e,b as B,k as t,t as n,w as Z,q as ee,n as te,v as ae,l as x,d as k,F as R,y as le,x as oe,E as se,A as g,B as G}from"./entry.25e4ac22.js";import{u as S}from"./useUtils.786a5149.js";import{u as L}from"./useMyFetch.0dee4895.js";import"./Times.87d2be07.js";import"./_plugin-vue_export-helper.c27b6911.js";const ne={class:"box-fixed"},re={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},de={class:"w-full flex flex-col items-center grow overflow-auto"},ie={class:"w-full flex flex-row flex-wrap"},ue={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ce=e("label",{for:""},"Period End",-1),_e={key:0,class:"card-border"},pe={key:1},me={class:"text-red-500"},fe={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ve=e("label",{for:""},"Period Part",-1),he={key:0,class:"card-border"},ye={key:1},we=e("option",{value:"1"},"1",-1),be=e("option",{value:"2"},"2",-1),xe=[we,be],ke={class:"text-red-500"},ge={key:0,class:"w-full p-1"},Fe=e("div",{class:"font-bold"}," Filter Nama ",-1),Ne={key:1,class:"w-full flex p-1 justify-between flex-wrap"},Ce={class:"w-full",role:"sticky"},Be={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Se=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"11",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),je={class:"sticky top-7 !z-[2]"},Me=e("th",null,"No",-1),Pe=e("th",null,"Jabatan",-1),Ve=e("th",null,"Nama Pekerja",-1),qe=e("th",null,"No KTP",-1),Ae=e("th",null,"Rek No",-1),Ee=e("th",null,"Rek Nama",-1),$e=e("th",null,"Bank Name",-1),De={class:"text-sm"},Te={class:"text-sm"},Ue={class:"text-sm"},ze={class:"text-sm"},Re={ref:"to_move"},Ge=["data-index"],Le={class:"w-full flex items-center justify-end"},We={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(y){const _=y,{$moment:j}=se(),{pointFormat:u}=S(),M={id:"",period_end:new Date,period_part:1},a=b({...M}),P=K("token"),v=b({}),i=b([]),J=async()=>{g().loading_full=!0,v.value={};const l=new FormData;l.append("period_end",a.value.period_end?j(a.value.period_end).format("Y-MM"):""),l.append("period_part",a.value.period_part);let o="post",c=a.value.id;c==""||(l.append("id",c),l.append("_method","PUT"));const{data:p,error:N,status:s}=await L("/salary_paid",{method:o,headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},body:l,retry:0});if(g().loading_full=!1,s.value==="error"){G().trigger(N,v);return}if(i.value=p.value.details,c<=0)a.value.id=p.value.id,a.value.created_at=p.value.created_at,a.value.updated_at=p.value.updated_at,_.p_data.unshift(a.value);else{a.value.updated_at=p.value.updated_at;let m=_.p_data.map(w=>w.id).indexOf(c);m>=-1&&_.p_data.splice(m,1,{...a.value})}};f(()=>{let l=0;return i.value.forEach(o=>{l+=parseFloat(o.standby_nominal)}),l});const V=f(()=>{let l=0;return i.value.forEach(o=>{l+=parseFloat(o.sb_gaji)}),l}),q=f(()=>{let l=0;return i.value.forEach(o=>{l+=parseFloat(o.sb_makan)}),l}),A=f(()=>{let l=0;return i.value.forEach(o=>{l+=parseFloat(o.salary_bonus_nominal)}),l}),O=f(()=>a.value.val&&a.value.val1||S().checkPermission("salary_paid.val")&&a.value.val||S().checkPermission("salary_paid.val1")&&a.value.val1),Y=async()=>{g().loading_full=!0;const{data:l,error:o,status:c}=await L("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(g().loading_full=!1,c.value==="error"){G().trigger(o);return}a.value=l.value.data,_.is_copy&&(a.value.val=0,a.value.val1=0),i.value=l.value.data.details},h=b(""),F=f(()=>h.value!=""?i.value.filter(l=>l.employee.name.toLowerCase().includes(h.value.toLowerCase())):i.value);return Q(()=>_.show,(l,o)=>{l==!0&&(a.value={...M},i.value=[],v.value={},_.id!=0&&Y())},{immediate:!0}),(l,o)=>{const c=H,p=W("vue-date-picker"),N=I;return C((r(),d("section",ne,[e("div",null,[B(c,{title:"Form Salary Paid",fn:y.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",re,[e("div",de,[e("div",ie,[e("div",ue,[ce,t(a).id?(r(),d("div",_e,n(t(j)(t(a).period_end).format("MM-Y")),1)):(r(),d("div",pe,[B(N,null,{default:Z(()=>[B(p,{modelValue:t(a).period_end,"onUpdate:modelValue":o[0]||(o[0]=s=>t(a).period_end=s),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",me,n(t(v).period_end),1)]),e("div",fe,[ve,t(a).id?(r(),d("div",he,n(t(a).period_part),1)):(r(),d("div",ye,[C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>t(a).period_part=s)},xe,512),[[ee,t(a).period_part]])])),e("p",ke,n(t(v).period_part),1)])]),t(F).length?(r(),d("div",ge,[Fe,C(e("input",{class:"",type:"text","onUpdate:modelValue":o[2]||(o[2]=s=>te(h)?h.value=s:null),name:"search",placeholder:"Nama"},null,512),[[ae,t(h)]])])):x("",!0),t(F).length?(r(),d("div",Ne,[e("div",Ce,[e("table",Be,[e("thead",null,[Se,e("tr",je,[Me,Pe,Ve,qe,Ae,Ee,$e,e("th",null,[k("SB.Gaji "),e("span",De,"("+n(t(u)(t(V)||0))+")",1)]),e("th",null,[k("SB.Makan "),e("span",Te,"("+n(t(u)(t(q)||0))+")",1)]),e("th",null,[k("Nominal Bonus "),e("span",Ue,"("+n(t(u)(t(A)||0))+")",1)]),e("th",null,[k("Total "),e("span",ze,"("+n(t(u)(t(V)+t(q)+t(A)||0))+")",1)])])]),e("tbody",Re,[(r(!0),d(R,null,le(t(F),(s,m)=>{var w,E,$,D,T,U,z;return r(),d(R,{key:m},[s.p_status!="Remove"?(r(),d("tr",{key:0,"data-index":m},[e("td",null,n(m+1)+".",1),e("td",null,n((w=s.employee)==null?void 0:w.role),1),e("td",null,n((E=s.employee)==null?void 0:E.name),1),e("td",null,n(($=s.employee)==null?void 0:$.ktp_no),1),e("td",null,n((D=s.employee)==null?void 0:D.rek_no),1),e("td",null,n((T=s.employee)==null?void 0:T.rek_name),1),e("td",null,n((z=(U=s.employee)==null?void 0:U.bank)==null?void 0:z.code),1),e("td",null,n(t(u)(s.sb_gaji)),1),e("td",null,n(t(u)(s.sb_makan)),1),e("td",null,n(t(u)(s.salary_bonus_nominal)),1),e("td",null,n(t(u)(parseFloat(s.sb_gaji)+parseFloat(s.sb_makan)+parseFloat(s.salary_bonus_nominal))),1)],8,Ge)):x("",!0)],64)}),128))],512)])])])):x("",!0)]),e("div",Le,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:o[3]||(o[3]=s=>y.fnClose())}," Cancel "),t(O)?x("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:o[4]||(o[4]=oe(s=>J(),["prevent"]))}," Generate "+n(t(a).id==""?"& Save":""),1))])])])],512)),[[X,y.show]])}}};export{We as default};
