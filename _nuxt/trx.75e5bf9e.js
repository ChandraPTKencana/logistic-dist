import ze from"./Header.69c12260.js";import Le from"./Plus.19c0a29b.js";import Je from"./Edit.ab5f1be0.js";import Ke from"./Eyes.63415e51.js";import Ge from"./Delete.653819db.js";import Ze from"./Void.29899ee4.js";import Qe from"./Signature.0e5cafa5.js";import We from"./PrinterEye.c8d566c0.js";import Xe from"./Line.ee6c4767.js";import et from"./Check.0fb8a80a.js";import tt from"./TableView.3f2774c1.js";import{_ as at}from"./PopupMini.vue.79568b8a.js";import lt from"./standby_trx.45186081.js";import nt from"./standby_trx_validasi.7309cf57.js";import{r,j as W,f as ot,g as st,G as x,i as _e,s as rt,A as v,c as h,b as m,a as y,m as X,q as dt,k as o,n as ee,l as w,w as f,z as it,B as P,o as _,D,d as c,t as A,v as ve,H as ut,E as _t}from"./entry.d39f77bc.js";import{u as g}from"./useUtils.2969661b.js";import{u as T}from"./useMyFetch.56121f9b.js";import{u as vt}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.f6a3fcf9.js";import"./Adjust.bee9d866.js";import"./TableHeaderEye.b7db264d.js";import"./Times.1a125d80.js";import"./ClearAll.2302b9ad.js";import"./client-only.91a2ae03.js";import"./ClearEach.5c493692.js";import"./CaretLeftDoubleBold.6b574046.js";import"./CaretLeftBold.6dac7fa6.js";import"./CaretRightBold.4f44aad0.js";import"./CaretRightDoubleBold.49f7d6a3.js";import"./Exclamation.6dfed04e.js";import"./HeaderPopup.vue.9b8a5d2c.js";import"./WidthMiniList.vue.0adbf076.js";import"./WidthMiniPart.vue.97abe1d1.js";import"./Tools.48d3bdaf.js";import"./AttachmentSingle.144ef8ab.js";import"./PDFJsView.4e7dd6ae.js";import"./ToolsPopup.90bc3ffb.js";const pt={class:"w-full h-full flex flex-col"},mt={class:"w-full flex grow flex-col overflow-auto h-0"},ft={class:"w-full flex justify-between flex-wrap"},ct={class:"grow flex"},yt={class:"m-1"},bt=ut('<option value="trx_not_done">Undone</option><option value="trx_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),kt=[bt],gt={class:"grow mb-5"},ht=y("b",null,"tidak dapat dibatalkan lagi",-1),xt={class:"grow mb-5"},wt=y("b",null,"tidak dapat dibatalkan lagi",-1),ia={__name:"trx",async setup(Dt){let B,te;const{$moment:I}=_t(),{pointFormat:ae}=g(),R=e=>e.deleted==1?"!bg-red-400":e.pvr_id>0&&e.req_deleted==1?"!bg-yellow-300":e.pv_id>0?"!bg-blue-300":"",U=e=>(e.map(t=>{t.class_h=R(t)}),e),b=r("trx_not_done");W(()=>b.value,e=>{ie.value.map(t=>{let p=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?p&&(t.tbl_show=1):p&&(t.tbl_show=0),t}),oe()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const le=r({}),V=r({from:"",to:""}),S=ot("token"),{data:pe}=([B,te]=st(async()=>it(async()=>{v().loading_full=!0;let e=[];const[t,p]=await Promise.all([T("/standby_trxs",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{filter_status:b},retry:0})]);return t.status.value!=="error"&&(e=U(t.data.value.data)),t.status.value==="error"?(P().trigger(t.error),{standby_trxs:e}):(v().loading_full=!1,{standby_trxs:e})},"$rVBHTgwE0s")),B=await B,te(),B),n=r(pe.value.standby_trxs||[]),z=r({field:"tanggal",by:"desc"}),a=r(-1),d=x(()=>n.value[a.value]),k=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),me=()=>{u.like="";let e=JSON.parse(JSON.stringify(v()._tv.global_keyword));e!=""&&(u.like=`id:%${e}%,transition_target:%${e}%,transition_type:%${e}%,standby_mst_name:%${e}%,standby_mst_type:%${e}%,supir:%${e}%,kernet:%${e}%,no_pol:%${e}%,xto:%${e}%,pvr_no:%${e}%,pv_no:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%,cost_center_code:%${e}%`),u.sort="",z.value.field&&(u.sort=z.value.field+":"+z.value.by),u.date_from=V.value.from?I(V.value.from).format("YYYY-MM-DD"):"",u.date_to=V.value.to?I(V.value.to).format("YYYY-MM-DD"):"",u.filter_model=JSON.stringify(v()._tv.filter_model)},ne=async()=>{v().loading_full=!0,le.value={},k.value.may_get_data=!1,u.page=k.value.page,u.page==1&&(n.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(n.value[0])),u.filter_status=b.value;const{data:e,error:t,status:p}=await T("/standby_trxs",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:u,retry:0});if(v().loading_full=!1,k.value.may_get_data=!0,p.value==="error"){P().trigger(t,le);return}k.value.page==1?n.value=U(e.value.data):k.value.page>1&&(n.value=[...n.value,...U(e.value.data)]),e.value.data.length==0&&(k.value.is_last_record=!0),v()._tv.filter_box=!1},oe=()=>{a.value=-1,k.value.page=1,k.value.is_last_record=!1,me(),ne()},Y=r(!1),L=r(0),fe=()=>{L.value=0,Y.value=!0},{display:q}=_e();rt(_e());const ce=()=>{a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=n.value[a.value].id,Y.value=!0)},E=r(!1),J=r(0),K=r(!1),ye=()=>{a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(J.value=n.value[a.value].id,E.value=!0,K.value=!1)},be=()=>{a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(J.value=n.value[a.value].id,E.value=!0,K.value=!0)},G=r(!1),se=r({}),M=r(!1),C=r(""),ke=async()=>{M.value&&(M.value=!1)},ge=()=>{a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(C.value="",se.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},M.value=!0)};W(()=>C.value,e=>{e.trim().length>0?G.value=!0:G.value=!1},{immediate:!1});const he=async()=>{v().loading_full=!0;const e=new FormData;e.append("id",n.value[a.value].id),e.append("deleted_reason",C.value),e.append("_method","DELETE");const{data:t,error:p,status:$}=await T("/standby_trx",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:e,retry:0});if(v().loading_full=!1,$.value==="error"){P().trigger(p);return}let s={...n.value[a.value]};s.deleted=t.value.deleted,s.deleted_user=t.value.deleted_user,s.deleted_at=t.value.deleted_at,s.deleted_by=t.value.deleted_by,s.deleted_reason=t.value.deleted_reason,s.class_h=R(s),b.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...s}),a.value=-1,M.value=!1},Z=r(!1),re=r({}),N=r(!1),O=r(""),xe=async()=>{N.value&&(N.value=!1)},we=()=>{a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(O.value="",re.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},N.value=!0)},de=r({}),j=r(!1),De=r(""),qe=async()=>{j.value&&(j.value=!1)},$e=()=>{var e;a.value==-1?q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(De.value="",de.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto,permintaan:(e=n.value[a.value].approve_void_by)==null?void 0:e.username,alasan:n.value[a.value].approve_void_reason},j.value=!0)},Ae=async()=>{v().loading_full=!0;const e=new FormData;e.append("id",n.value[a.value].id),e.append("_method","DELETE");const{data:t,error:p,status:$}=await T("/standby_trx_approve_void",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:e,retry:0});if(v().loading_full=!1,$.value==="error"){P().trigger(p);return}let s={...n.value[a.value]};s.deleted=t.value.deleted,s.deleted_user=t.value.deleted_user,s.deleted_at=t.value.deleted_at,s.deleted_by=t.value.deleted_by,s.deleted_reason=t.value.deleted_reason,s.class_h=R(s),b.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...s}),a.value=-1,j.value=!1};W(()=>O.value,e=>{e.trim().length>0?Z.value=!0:Z.value=!1},{immediate:!1});const Se=async()=>{v().loading_full=!0;const e=new FormData;e.append("id",n.value[a.value].id),e.append("req_deleted_reason",O.value),e.append("_method","DELETE");const{data:t,error:p,status:$}=await T("/standby_trx_req_delete",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:e,retry:0});if(v().loading_full=!1,$.value==="error"){P().trigger(p);return}let s={...n.value[a.value]};s.req_deleted=t.value.req_deleted,s.req_deleted_user=t.value.req_deleted_user,s.req_deleted_by=t.value.req_deleted_by,s.req_deleted_at=t.value.req_deleted_at,s.req_deleted_reason=t.value.req_deleted_reason,s.class_h=R(s),b.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...s}),a.value=-1,N.value=!1},{printHtml:Ce}=vt(),Oe=async()=>{if(a.value==-1){q({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}v().loading_full=!0;const{data:e,error:t,status:p}=await T("/standby_trx_preview_file",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{id:n.value[a.value].id},retry:0});if(v().loading_full=!1,p.value==="error"){P().trigger(t);return}Ce(e.value.html,318)},ie=r([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"detail_dates",label:"Detail Dates",type:"string"},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"standby_mst_name",label:"Nama Standby",filter_on:1,type:"string"},{key:"standby_mst_type",label:"Tipe Standby",filter_on:1,type:"string"},{key:"standby_mst_amount",label:"Nilai SB",class:" justify-end",type:"number"},{key:"details_count",label:"Jlh SB",class:" justify-end",type:"number"},{key:"sb_total",label:"Total SB",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Note untuk Remarks"},{key:"ref",label:"Ref"},{key:"transition_target",label:"Pengalihan",filter_on:1,type:"select",select_item:v().list_pabrik},{key:"transition_type",label:"Tipe Pengalihan",type:"select",select_item:[{k:"From",v:"Dari"},{k:"To",v:"Ke"}]},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),Pe=x(()=>["trx_not_done","all"].indexOf(b.value)>-1&&g().checkPermission("standby_trx.create")),Te=x(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&[void 0,0].indexOf(d.value.req_deleted)>-1&&[void 0,0].indexOf(d.value.val)>-1&&[void 0,""].indexOf(d.value.pvr_id)>-1&&g().checkPermission("standby_trx.modify")),Me=x(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&[void 0,0].indexOf(d.value.req_deleted)>-1&&([void 0,""].indexOf(d.value.pvr_id)>-1&&(g().checkPermission("standby_trx.val")&&[void 0,0].indexOf(d.value.val)>-1||g().checkPermission("standby_trx.val1")&&[void 0,0].indexOf(d.value.val1)>-1)||d.value.pvr_id>-1&&g().checkPermission("standby_trx.val2")&&[void 0,0].indexOf(d.value.val2)>-1)),Ne=x(()=>g().checkPermission("standby_trx.remove")&&a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&[void 0,0].indexOf(d.value.req_deleted)>-1&&[void 0,""].indexOf(d.value.pvr_id)>-1),je=x(()=>g().checkPermission("standby_trx.request_remove")&&a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&[void 0,0].indexOf(d.value.req_deleted)>-1&&d.value.pvr_id!=""),Be=x(()=>g().checkPermission("standby_trx.approve_request_remove")&&a.value>-1&&d.value.deleted==0&&d.value.req_deleted==1&&d.value.val2==0),Re=x(()=>g().checkPermission("standby_trx.preview_file")&&a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&[void 0,0].indexOf(d.value.req_deleted)>-1&&d.value.val==1);return(e,t)=>{const p=ze,$=Le,s=Je,Ve=Ke,Ye=Ge,ue=Ze,Ee=Qe,Fe=We,F=Xe,H=et,He=tt,Q=at,Ie=lt,Ue=nt;return _(),h("div",pt,[m(p,{title:"List Transaction"}),y("div",mt,[y("div",ft,[y("div",ct,[y("div",yt,[X(y("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=l=>ee(b)?b.value=l:null)},kt,512),[[dt,o(b)]])]),o(Pe)?(_(),h("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=l=>fe())},[m($)])):w("",!0),o(Te)?(_(),h("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=l=>ce())},[m(s)])):w("",!0),o(a)>-1?(_(),h("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=l=>be())},[m(Ve)])):w("",!0),o(Ne)?(_(),h("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=l=>ge())},[m(Ye)])):w("",!0),o(je)?(_(),h("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[5]||(t[5]=l=>we())},[m(ue)])):w("",!0),o(Be)?(_(),h("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[6]||(t[6]=l=>$e())},[m(ue)])):w("",!0),o(Me)?(_(),h("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[7]||(t[7]=l=>ye())},[m(Ee)])):w("",!0),o(Re)?(_(),h("button",{key:7,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[8]||(t[8]=l=>Oe())},[m(Fe)])):w("",!0)])]),m(He,{thead:o(ie),selected:o(a),onSetSelected:t[9]||(t[9]=l=>a.value=l),tbody:o(n),fnCallData:ne,scrolling:o(k),onSetScrollingPage:t[10]||(t[10]=l=>o(k).page=l),onDoFilter:t[11]||(t[11]=l=>oe())},{val:f(({item:l})=>[l.val?(_(),D(H,{key:1})):(_(),D(F,{key:0}))]),val1:f(({item:l})=>[l.val1?(_(),D(H,{key:1})):(_(),D(F,{key:0}))]),val2:f(({item:l})=>[l.val2?(_(),D(H,{key:1})):(_(),D(F,{key:0}))]),detail_dates:f(({item:l})=>[c(A(l.details.map(i=>o(I)(i.tanggal).format("DD-MM-YYYY")).join(" , ")),1)]),standby_mst_name:f(({item:l})=>{var i;return[c(A((i=l.standby_mst_)==null?void 0:i.name),1)]}),standby_mst_type:f(({item:l})=>{var i;return[c(A((i=l.standby_mst_)==null?void 0:i.tipe),1)]}),standby_mst_amount:f(({item:l})=>{var i;return[c(" Rp. "+A(o(ae)(((i=l.standby_mst_)==null?void 0:i.amount)||0)),1)]}),sb_total:f(({item:l})=>{var i;return[c(" Rp. "+A(o(ae)(((i=l.standby_mst_)==null?void 0:i.amount)*l.details_count||0)),1)]}),pvr_had_detail:f(({item:l})=>[l.pvr_had_detail?(_(),D(H,{key:1})):(_(),D(F,{key:0}))]),deleted_by_username:f(({item:l})=>{var i;return[c(A((i=l.deleted_by)==null?void 0:i.username),1)]}),req_deleted_by_username:f(({item:l})=>{var i;return[c(A((i=l.req_deleted_by)==null?void 0:i.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),m(Q,{type:"delete",show:o(M),data:o(se),fnClose:ke,fnConfirm:he,enabledOk:o(G)},{footer:f(()=>[c(" Masukkan Alasan Penghapusan: "),y("div",gt,[X(y("textarea",{"onUpdate:modelValue":t[12]||(t[12]=l=>ee(C)?C.value=l:null)},null,512),[[ve,o(C)]])])]),_:1},8,["show","data","enabledOk"]),m(Q,{type:"custome",show:o(N),data:o(re),fnClose:xe,fnConfirm:Se,enabledOk:o(Z)},{words:f(()=>[c(" Data akan diproses dan "),ht,c(", yakin untuk melanjutkan ? ")]),footer:f(()=>[c(" Masukkan Alasan Permintaan Penghapusan: "),y("div",xt,[X(y("textarea",{"onUpdate:modelValue":t[13]||(t[13]=l=>ee(O)?O.value=l:null)},null,512),[[ve,o(O)]])])]),_:1},8,["show","data","enabledOk"]),m(Q,{type:"custome",show:o(j),data:o(de),fnClose:qe,fnConfirm:Ae},{words:f(()=>[c(" Data akan diproses dan "),wt,c(", apakah Anda menyetujui permintaan penghapusan data berikut? ")]),_:1},8,["show","data"]),m(Ie,{show:o(Y),fnClose:()=>{Y.value=!1},id:o(L),p_data:o(n)},null,8,["show","fnClose","id","p_data"]),m(Ue,{show:o(E),fnClose:()=>{E.value=!1},id:o(J),p_data:o(n),is_view:o(K)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{ia as default};
