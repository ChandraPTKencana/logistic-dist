import{_ as it}from"./Header.b5a6ee78.js";import{_ as rt,u as ut,a as dt}from"./useDownload.604423e5.js";import{_ as ct}from"./Table2Column.6e6144c8.js";import{_ as _t}from"./client-only.f67532dc.js";import{_ as pt}from"./Search.16247b3e.js";import{_ as ft}from"./PopupMini.vue.c48936e7.js";import{_ as vt}from"./Times.92151890.js";import{r as i,f as mt,D as ht,B as gt,H as L,I as kt,J as yt,c as b,b as c,a as t,w as R,t as a,k as l,h as Y,j as bt,i as wt,l as U,m as Tt,F as xt,n as At,G as $t,E as Dt,x as p,y as D,o as w,q as Bt,O as Ct,s as Mt}from"./entry.9b3364f8.js";import{u as jt}from"./useUtils.100f5b4a.js";import{u as T}from"./useMyFetch.268c4403.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.df447137.js";import"./InputPointFormat.vue.cc6c7334.js";const Nt={class:"w-full h-full flex flex-col"},Vt={class:"w-full flex grow flex-col overflow-auto h-0"},St={class:"w-full flex"},zt={action:"#",class:"w-full flex p-1"},Pt=t("div",{class:"font-bold"}," Tgl Dari ",-1),Yt={class:"text-red-500"},Ht=t("div",{class:"font-bold"}," Tgl Sampai ",-1),Et={class:"text-red-500"},Ft={class:"grow"},Ot=t("div",{class:"font-bold"}," Keyword ",-1),It={class:"pl-1"},Lt=t("div",{class:"font-bold"}," Sort By ",-1),Rt=Ct('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option><option value="pv_no">PV No</option><option value="ticket_a_no">Ticket A No</option><option value="ticket_b_no">Ticket B No</option>',8),Ut=[Rt],Jt={class:"pl-1"},Kt=t("div",{class:"font-bold"}," Sort Order ",-1),Zt=t("option",{value:"asc"},"Asc",-1),qt=t("option",{value:"desc"},"Desc",-1),Gt=[Zt,qt],Qt={class:"flex items-end pl-1"},Wt={class:"w-full flex justify-center items-center grow h-0 p-1"},Xt={key:0,class:""},te={class:"tacky"},ee=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Jenis"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Supir"),t("th",null,"Kernet"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),le=["onClick"],oe={class:"bold"},ae={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},se={class:"relative",style:{width:"95%",height:"90%"}},ne={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},ie=["src"],xe={__name:"index",async setup(re){let B,H;const{$moment:x}=Mt(),{pointFormat:f}=jt(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="tanggal:desc";const C=i({}),y=mt("token"),v=i({from:"",to:""}),{data:M}=([B,H]=ht(async()=>Dt(async()=>{p().loading_full=!0;let s=[],o=[],d=[],g=[],$=[];const[k,m]=await Promise.all([T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},retry:0}),T("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},retry:0})]);return k.status.value!=="error"&&(s=k.data.value.data),k.status.value==="error"?(D().trigger(k.error),{trx_trps:s,list_ujalan:o,list_tipe:d,list_ticket:g,list_pv:$}):(m.status.value!=="error"&&(o=m.data.value.list_ujalan,d=m.data.value.list_tipe,g=m.data.value.list_ticket,$=m.data.value.list_pv),p().loading_full=!1,{trx_trps:s,list_ujalan:o,list_tipe:d,list_ticket:g,list_pv:$})},"$8KmJHfPiB5")),B=await B,H(),B),_=i(M.value.trx_trps||[]),J=i(M.value.list_ujalan),K=i(M.value.list_ticket),Z=i(M.value.list_pv),r=i(""),h=i({field:"tanggal",by:"desc"}),A=i(-1),u=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),S=()=>{n.like="",r.value!=""&&(n.like=`id:%${r.value}%,xto:%${r.value}%,jenis:%${r.value}%,pv_no:%${r.value}%,ticket_a_no:%${r.value}%,ticket_b_no:%${r.value}%,no_pol:%${r.value}%,supir:%${r.value}%,kernet:%${r.value}%`),n.sort="",h.value.field&&(n.sort=h.value.field+":"+h.value.by),n._TimeZoneOffset=new Date().getTimezoneOffset(),n.date_from=v.value.from?x(v.value.from).format("YYYY-MM-DD"):"",n.date_to=v.value.to?x(v.value.to).format("YYYY-MM-DD"):""},j=i(null),E=async()=>{p().loading_full=!0,C.value={},u.value.may_get_data=!1,n.page=u.value.page,n.page==1&&(_.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(_.value[0]));const{data:s,error:o,status:d}=await T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},params:n,retry:0});if(p().loading_full=!1,u.value.may_get_data=!0,d.value==="error"){D().trigger(o,C);return}u.value.page==1?(_.value=s.value.data,j.value&&(j.value.scrollTop=0)):u.value.page>1&&(_.value=[..._.value,...s.value.data]),s.value.data.length==0&&(u.value.is_last_record=!0)},q=async()=>{if(!u.value.may_get_data)return;let s=j.value;if(s.scrollLeft!=u.value.scrollLeft){u.value.scrollLeft=s.scrollLeft;return}u.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(u.value.page++,await E())},G=()=>{u.value.page=1,u.value.is_last_record=!1,S(),E()};gt();const F=i(!1),Q=i(0);L(),kt(L());const W=i({}),N=i(!1),X=async()=>{N.value&&(N.value=!1)},tt=async()=>{p().loading_full=!0;const s=new FormData;s.append("id",_.value[A.value].id),s.append("_method","DELETE");const{data:o,error:d,status:g}=await T("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},body:s,retry:0});if(p().loading_full=!1,g.value==="error"){D().trigger(d);return}_.value.splice(A.value,1),A.value=-1,N.value=!1},{downloadFile:O,viewFile:ue}=ut(),V=i(!1),z=i(""),I=async()=>{if(V.value==!0){V.value=!1;return}S(),p().loading_full=!0;const{data:s,error:o,status:d}=await T("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},params:n,retry:0});if(p().loading_full=!1,d.value==="error"){D().trigger(o);return}z.value=s.value,V.value=!0},et=async()=>{S(),p().loading_full=!0;const{data:s,error:o,status:d}=await T("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},params:n,retry:0});if(p().loading_full=!1,d.value==="error"){D().trigger(o);return}O(s.value)},lt=()=>{O(z.value)};return(s,o)=>{const d=it,g=dt,$=ct,k=yt("vue-date-picker"),m=_t,ot=pt,at=ft,st=rt,nt=vt;return w(),b("div",Nt,[c(d,{title:"Report Transaction"}),t("div",Vt,[t("div",St,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[0]||(o[0]=e=>I())},[c(g)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[1]||(o[1]=e=>et())},[c($)])]),t("form",zt,[t("div",null,[Pt,c(m,null,{default:R(()=>[c(k,{modelValue:l(v).from,"onUpdate:modelValue":o[2]||(o[2]=e=>l(v).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",Yt,a(l(C).date_from),1)]),t("div",null,[Ht,c(m,null,{default:R(()=>[c(k,{modelValue:l(v).to,"onUpdate:modelValue":o[3]||(o[3]=e=>l(v).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",Et,a(l(C).date_to),1)]),t("div",Ft,[Ot,Y(t("input",{class:"",type:"text","onUpdate:modelValue":o[4]||(o[4]=e=>wt(r)?r.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[bt,l(r)]])]),t("div",It,[Lt,Y(t("select",{class:"","onUpdate:modelValue":o[5]||(o[5]=e=>l(h).field=e)},Ut,512),[[U,l(h).field]])]),t("div",Jt,[Kt,Y(t("select",{class:"","onUpdate:modelValue":o[6]||(o[6]=e=>l(h).by=e)},Gt,512),[[U,l(h).by]])]),t("div",Qt,[t("button",{class:"",type:"submit",name:"button",onClick:o[7]||(o[7]=Tt(e=>G(),["prevent"]))},[c(ot,{class:"text-2xl"})])])]),t("div",Wt,[l(_).length==0?(w(),b("div",Xt," Maaf Tidak Ada Record ")):(w(),b("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:j,onScroll:q},[t("table",te,[ee,t("tbody",null,[(w(!0),b(xt,null,At(l(_),(e,P)=>(w(),b("tr",{key:P,onClick:de=>A.value=P,class:Bt(l(A)==P?"active":"")},[t("td",oe,a(e.id),1),t("td",null,a(e.tanggal?l(x)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,a(e.xto),1),t("td",null,a(e.tipe),1),t("td",null,a(e.jenis),1),t("td",null,a(l(f)(e.amount)),1),t("td",null,a(e.pv_no),1),t("td",null,a(l(f)(e.pv_total)),1),t("td",null,a(e.ticket_a_no),1),t("td",null,a(l(f)(e.ticket_a_bruto)),1),t("td",null,a(l(f)(e.ticket_a_tara)),1),t("td",null,a(l(f)(e.ticket_a_netto)),1),t("td",null,a(e.ticket_a_supir),1),t("td",null,a(e.ticket_a_no_pol),1),t("td",null,a(e.ticket_b_no),1),t("td",null,a(l(f)(e.ticket_b_bruto)),1),t("td",null,a(l(f)(e.ticket_b_tara)),1),t("td",null,a(l(f)(e.ticket_b_netto)),1),t("td",null,a(e.ticket_b_supir),1),t("td",null,a(e.ticket_b_no_pol),1),t("td",null,a(e.supir),1),t("td",null,a(e.kernet),1),t("td",null,a(e.no_pol),1),t("td",null,a(e.created_at?l(x)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,a(e.updated_at?l(x)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,le))),128))])])],544))])]),c(at,{type:"delete",show:l(N),data:l(W),fnClose:X,fnConfirm:tt},null,8,["show","data"]),c(st,{show:l(F),fnClose:()=>{F.value=!1},id:l(Q),p_data:l(_),list_ujalan:l(J),list_ticket:l(K),list_pv:l(Z)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(V)?(w(),b("div",ae,[t("div",se,[t("div",ne,[c(nt,{style:{color:"black",cursor:"pointer"},onClick:o[8]||(o[8]=e=>I())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(z).dataBase64},null,8,ie),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[9]||(o[9]=e=>lt())})])])):$t("",!0)])}}};export{xe as default};
