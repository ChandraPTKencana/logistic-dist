import se from"./Header.f4f1ee70.js";import ne from"./Plus.9f5f997b.js";import re from"./Edit.ee1f63a2.js";import ie from"./Signature.331175d9.js";import ue from"./Table2Column.f8d3ac15.js";import ce from"./TableUp.41e81d64.js";import de from"./Line.771f1e02.js";import _e from"./Check.a15db1bc.js";import{_ as fe}from"./PopupMini.vue.574bf002.js";import me from"./rpt_salary.9e2a8b21.js";import pe from"./rpt_salary_validasi.acfef0fc.js";import{g as ve,h as ye,r as s,B as he,j as z,s as ge,f as we,c as _,b as m,a as o,l as t,n as h,F as ke,D as xe,w as be,q as Ce,x as f,y as g,o as i,E as Ae,z as I,t as A,d as De,k as $e,A as Me,m as Te,G as Se}from"./entry.aa3fda92.js";import{u as P}from"./useUtils.647d3ea4.js";import{u as w}from"./useMyFetch.9afcdb0b.js";import{u as Be}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Times.29115eb5.js";import"./Exclamation.e8cb86dc.js";import"./HeaderPopup.vue.232e2279.js";import"./client-only.ce07a1c2.js";const Pe={class:"w-full h-full flex flex-col"},Ee={class:"w-full flex grow flex-col overflow-auto h-0"},Fe={class:"w-full flex"},Le={class:"w-full flex justify-center items-center grow h-0 p-1"},Ue={key:0,class:""},ze={class:"tacky"},Ie=o("thead",null,[o("tr",{class:"sticky top-0 !z-[2]"},[o("th",null,"Logistik"),o("th",null,"ID"),o("th",null,"Period End"),o("th",null,"Created At"),o("th",null,"Updated At")])],-1),je=["onClick"],Re={class:"flex items-center justify-center"},He={class:"bold"},Ne={class:"grow mb-5"},_t={__name:"rpt",async setup(Oe){let k,E;const{$moment:D}=Se(),d={};d._TimeZoneOffset=new Date().getTimezoneOffset(),d.sort="created_at:desc";const p=ve("token"),{data:j}=([k,E]=ye(async()=>Ce(async()=>{let e=[];f().loading_full=!0;const{data:a,error:c,status:y}=await w("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:d,retry:0});return f().loading_full=!1,y.value==="error"?(g().trigger(c),{rpt_salarys:e}):(e=a.value.data,{rpt_salarys:e})},"$fWJlXxIgiP")),k=await k,E(),k),l=s(j.value.rpt_salarys);s(""),s({field:"created_at",by:"desc"});const n=s(-1),u=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),x=s(null),R=async()=>{f().loading_full=!0,u.value.may_get_data=!1,d.page=u.value.page,d.page==1&&(l.value=[]),d.first_row&&delete d.first_row,d.page>1&&(d.first_row=JSON.stringify(l.value[0]));const{data:e,error:a,status:c}=await w("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:d,retry:0});if(f().loading_full=!1,u.value.may_get_data=!0,c.value==="error"){g().trigger(a);return}u.value.page==1?(l.value=e.value.data,x.value&&(x.value.scrollTop=0)):u.value.page>1&&(l.value=[...l.value,...e.value.data]),e.value.data.length==0&&(u.value.is_last_record=!0)},H=async()=>{if(!u.value.may_get_data)return;let e=x.value;if(e.scrollLeft!=u.value.scrollLeft){u.value.scrollLeft=e.scrollLeft;return}u.value.is_last_record||!(Math.round(e.scrollTop)+e.clientHeight>=e.scrollHeight-1)||(u.value.page++,await R())};he();const b=s(!1),$=s(0),M=s(0),N=()=>{$.value=0,b.value=!0,M.value=!1},{display:F}=z();ge(z());const O=()=>{n.value==-1?F({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):($.value=l.value[n.value].id,b.value=!0,M.value=!1)},T=s(!1),L=s(0),V=()=>{n.value==-1?F({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=l.value[n.value].id,T.value=!0)},S=s(!1),Y=s({}),C=s(!1),v=s(""),J=async()=>{C.value&&(C.value=!1)};we(()=>v.value,e=>{e.trim().length>0?S.value=!0:S.value=!1},{immediate:!1});const q=async()=>{f().loading_full=!0;const e=new FormData;e.append("id",l.value[n.value].id),e.append("deleted_reason",v.value),e.append("_method","DELETE");const{data:a,error:c,status:y}=await w("/rpt_salary",{method:"post",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},body:e,retry:0});if(f().loading_full=!1,y.value==="error"){g().trigger(c);return}l.value.splice(n.value,1),n.value=-1,C.value=!1},{downloadFile:U,viewFile:Ve}=Be();s(!1),s({});const G=async()=>{f().loading_full=!0;const{data:e,error:a,status:c}=await w("/rpt_salary/excel_download",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:l.value[n.value].id},retry:0});if(f().loading_full=!1,c.value==="error"){g().trigger(a);return}U(e.value)},W=async()=>{f().loading_full=!0;const{data:e,error:a,status:c}=await w("/rpt_salary/excel_download2",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:l.value[n.value].id},retry:0});if(f().loading_full=!1,c.value==="error"){g().trigger(a);return}U(e.value)};return(e,a)=>{const c=se,y=ne,X=re,Z=ie,K=ue,Q=ce,ee=de,te=_e,ae=fe,oe=me,le=pe;return i(),_("div",Pe,[m(c,{title:"List Salary Paid"}),o("div",Ee,[o("div",Fe,[("useUtils"in e?e.useUtils:t(P))().checkPermission("rpt_salary.create")?(i(),_("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=r=>N())},[m(y)])):h("",!0),("useUtils"in e?e.useUtils:t(P))().checkPermissions(["rpt_salary.modify"])?(i(),_("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=r=>O())},[m(X)])):h("",!0),("useUtils"in e?e.useUtils:t(P))().checkPermissions(["rpt_salary.val1","rpt_salary.val2","rpt_salary.val3"])?(i(),_("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=r=>V())},[m(Z)])):h("",!0),t(n)>-1&&t(l)[t(n)].val1==1?(i(),_("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=r=>G())},[m(K)])):h("",!0),t(n)>-1&&t(l)[t(n)].val1==1?(i(),_("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[4]||(a[4]=r=>W())},[m(Q)])):h("",!0)]),o("div",Le,[t(l).length==0?(i(),_("div",Ue," Maaf Tidak Ada Record ")):(i(),_("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:x,onScroll:H},[o("table",ze,[Ie,o("tbody",null,[(i(!0),_(ke,null,xe(t(l),(r,B)=>(i(),_("tr",{key:B,onClick:Ye=>n.value=B,class:Ae(t(n)==B?"active":"")},[o("td",null,[o("div",Re,[r.val1?(i(),I(te,{key:1})):(i(),I(ee,{key:0}))])]),o("td",He,A(r.id),1),o("td",null,A(r.period_end?t(D)(r.period_end).format("MM-Y"):""),1),o("td",null,A(r.created_at?t(D)(r.created_at).format("DD-MM-Y HH:mm:ss"):""),1),o("td",null,A(r.updated_at?t(D)(r.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,je))),128))])])],544))])]),m(ae,{type:"delete",show:t(C),data:t(Y),fnClose:J,fnConfirm:q,enabledOk:t(S)},{footer:be(()=>[De(" Masukkan Alasan Penghapusan: "),o("div",Ne,[$e(o("textarea",{"onUpdate:modelValue":a[5]||(a[5]=r=>Te(v)?v.value=r:null)},null,512),[[Me,t(v)]])])]),_:1},8,["show","data","enabledOk"]),m(oe,{show:t(b),fnClose:()=>{b.value=!1},id:t($),p_data:t(l),is_copy:t(M)},null,8,["show","fnClose","id","p_data","is_copy"]),m(le,{show:t(T),fnClose:()=>{T.value=!1},id:t(L),p_data:t(l)},null,8,["show","fnClose","id","p_data"])])}}};export{_t as default};
