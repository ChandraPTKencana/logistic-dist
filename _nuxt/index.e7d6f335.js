import Ke from"./Header.3ab42273.js";import Je from"./Plus.c5a011d1.js";import Ge from"./Edit.6bb58c2c.js";import Ze from"./Eyes.bdec411f.js";import Qe from"./Delete.eaa72127.js";import We from"./Void.7fc02845.js";import Xe from"./Signature.5bcc6b57.js";import et from"./PrinterEye.c7b84f68.js";import tt from"./Image.c04f2196.js";import at from"./Line.b90ad97d.js";import lt from"./Check.46e2e4fc.js";import ot from"./TableView.f2cffed9.js";import{_ as nt}from"./PopupMini.vue.66ad9cdd.js";import rt from"./trx_trp.62c036fc.js";import st from"./trx_trp_validasi.aad28d1a.js";import it from"./trx_absen.2ca74956.js";import{r as s,j as X,f as dt,g as ut,G as $,i as _t,c as q,b as f,a as c,m as ee,q as pt,k as o,n as te,l as C,d as O,C as vt,t as Y,w as y,z as ct,A as _,B as P,o as i,D as m,v as ve,H as mt,E as ft}from"./entry.b8f45e1d.js";import{u as S}from"./useMyFetch.882d4718.js";import{u as yt}from"./useDownload.737fa5e3.js";import{u as N}from"./useUtils.02680300.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.790ff312.js";import"./Adjust.b1b721c6.js";import"./TableHeaderEye.a25c1b14.js";import"./Times.eee7fe9a.js";import"./ClearAll.41992ba3.js";import"./client-only.3a98aa86.js";import"./ClearEach.3c8eef6d.js";import"./CaretLeftDoubleBold.16e047a2.js";import"./CaretLeftBold.97bbbe70.js";import"./CaretRightBold.78879e2d.js";import"./CaretRightDoubleBold.7292ebfd.js";import"./Exclamation.19df92dd.js";import"./HeaderPopup.vue.e89b6351.js";import"./WidthMiniList.vue.4d71c993.js";import"./WidthMiniPart.vue.5f50fb99.js";const bt={class:"w-full h-full flex flex-col"},kt={class:"w-full flex grow flex-col overflow-auto h-0"},xt={class:"w-full flex justify-between flex-wrap"},gt={class:"grow flex"},ht={class:"m-1"},wt=mt('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Dt=[wt],At={class:"flex"},$t=c("span",{class:"text-xs"},"Mode",-1),qt={class:"grow mb-5"},Ct=c("b",null,"tidak dapat dibatalkan lagi",-1),Ot={class:"grow mb-5"},ca={__name:"index",async setup(Pt){let U,ae;const{$moment:le}=ft(),z=e=>e.deleted==1?"!bg-red-400":e.pvr_id>0&&e.req_deleted==1?"!bg-yellow-300":e.pv_id>0?"!bg-blue-300":"",H=e=>(e.map(t=>{t.class_h=z(t)}),e),x=s("pv_not_done");X(()=>x.value,e=>{_e.value.map(t=>{let d=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?d&&(t.tbl_show=1):d&&(t.tbl_show=0),t}),se()},{immediate:!1});const p={};p._TimeZoneOffset=new Date().getTimezoneOffset(),p.sort="tanggal:desc";const oe=s({}),R=s({from:"",to:""}),w=dt("token"),{data:ce}=([U,ae]=ut(async()=>ct(async()=>{_().loading_full=!0;let e=[];const[t,d]=await Promise.all([S("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{filter_status:x},retry:0})]);return t.status.value!=="error"&&(e=H(t.data.value.data)),t.status.value==="error"?(P().trigger(t.error),{trx_trps:e}):(_().loading_full=!1,{trx_trps:e})},"$pFLmKcrKj9")),U=await U,ae(),U),n=s(ce.value.trx_trps||[]),ne=s([]),D=s(!1),me=async()=>{_().loading_full=!0;const{data:e,error:t,status:d}=await S("/trx_load_cost_center",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{online_status:D.value},retry:0});if(_().loading_full=!1,d.value==="error"){P().trigger(t);return}ne.value=e.value.list_cost_center},L=s({field:"tanggal",by:"desc"}),l=s(-1),v=$(()=>n.value[l.value]),b=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),fe=()=>{p.like="";let e=JSON.parse(JSON.stringify(_()._tv.global_keyword));e!=""&&(p.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),p.sort="",L.value.field&&(p.sort=L.value.field+":"+L.value.by),p.date_from=R.value.from?le(R.value.from).format("YYYY-MM-DD"):"",p.date_to=R.value.to?le(R.value.to).format("YYYY-MM-DD"):"",p.filter_model=JSON.stringify(_()._tv.filter_model)},re=async()=>{_().loading_full=!0,oe.value={},b.value.may_get_data=!1,p.page=b.value.page,p.page==1&&(n.value=[]),p.first_row&&delete p.first_row,p.page>1&&(p.first_row=JSON.stringify(n.value[0])),p.filter_status=x.value;const{data:e,error:t,status:d}=await S("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:p,retry:0});if(_().loading_full=!1,b.value.may_get_data=!0,d.value==="error"){P().trigger(t,oe);return}b.value.page==1?n.value=H(e.value.data):b.value.page>1&&(n.value=[...n.value,...H(e.value.data)]),e.value.data.length==0&&(b.value.is_last_record=!0),_()._tv.filter_box=!1},se=()=>{l.value=-1,b.value.page=1,b.value.is_last_record=!1,fe(),re()},E=s(!1),K=s(0),ye=()=>{K.value=0,E.value=!0},{display:A}=_t(),be=()=>{l.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(K.value=n.value[l.value].id,E.value=!0)},I=s(!1),J=s(0),G=s(!1),ke=()=>{l.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(J.value=n.value[l.value].id,I.value=!0,G.value=!1)},xe=()=>{l.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(J.value=n.value[l.value].id,I.value=!0,G.value=!0)},Z=s(!1),ie=s(0),ge=e=>{ie.value=e,Z.value=!0},Q=s(!1),de=s({}),V=s(!1),B=s(""),he=async()=>{V.value&&(V.value=!1)},we=()=>{l.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(B.value="",de.value={id:n.value[l.value].id,"no pol":n.value[l.value].no_pol,tujuan:n.value[l.value].xto},V.value=!0)};X(()=>B.value,e=>{e.trim().length>0?Q.value=!0:Q.value=!1},{immediate:!1});const De=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",n.value[l.value].id),e.append("deleted_reason",B.value),e.append("_method","DELETE");const{data:t,error:d,status:g}=await S("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,g.value==="error"){P().trigger(d);return}let r={...n.value[l.value]};r.deleted=t.value.deleted,r.deleted_user=t.value.deleted_user,r.deleted_at=t.value.deleted_at,r.deleted_by=t.value.deleted_by,r.deleted_reason=t.value.deleted_reason,r.class_h=z(r),x.value!="all"?n.value.splice(l.value,1):n.value.splice(l.value,1,{...r}),l.value=-1,V.value=!1},W=s(!1),ue=s({}),F=s(!1),j=s(""),Ae=async()=>{F.value&&(F.value=!1)},$e=()=>{l.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value="",ue.value={id:n.value[l.value].id,"no pol":n.value[l.value].no_pol,tujuan:n.value[l.value].xto},F.value=!0)};X(()=>j.value,e=>{e.trim().length>0?W.value=!0:W.value=!1},{immediate:!1});const qe=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",n.value[l.value].id),e.append("req_deleted_reason",j.value),e.append("_method","DELETE");const{data:t,error:d,status:g}=await S("/trx_trp_req_delete",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,g.value==="error"){P().trigger(d);return}let r={...n.value[l.value]};r.req_deleted=t.value.req_deleted,r.req_deleted_user=t.value.req_deleted_user,r.req_deleted_by=t.value.req_deleted_by,r.req_deleted_at=t.value.req_deleted_at,r.req_deleted_reason=t.value.req_deleted_reason,r.class_h=z(r),x.value!="all"?n.value.splice(l.value,1):n.value.splice(l.value,1,{...r}),l.value=-1,F.value=!1},{printHtml:Ce}=yt(),Oe=async()=>{if(l.value==-1){A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}_().loading_full=!0;const{data:e,error:t,status:d}=await S("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:n.value[l.value].id},retry:0});if(_().loading_full=!1,d.value==="error"){P().trigger(t);return}Ce(e.value.html,318)},Pe=async()=>{_().loading_full=!0;const e=new FormData;e.append("online_status",D.value);const{data:t,error:d,status:g}=await S("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,g.value==="error"){P().trigger(d);return}t.value.forEach(r=>{let h=n.value.map(u=>u.id).indexOf(r.id);if(h!==-1){let u=n.value[h];u.pvr_id=r.pvr_id,u.pvr_no=r.pvr_no,u.pvr_total=r.pvr_total,u.pvr_had_detail=r.pvr_had_detail,u.updated_at=r.updated_at,n.value.splice(h,1,{...u})}}),A({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},Se=async()=>{_().loading_full=!0;const e=new FormData;e.append("online_status",D.value);const{data:t,error:d,status:g}=await S("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,g.value==="error"){P().trigger(d);return}t.value.data.forEach(r=>{let h=n.value.map(u=>u.id).indexOf(r.id);if(h!==-1){let u=n.value[h];u.pv_id=r.pv_id,u.pv_no=r.pv_no,u.pv_total=r.pv_total,u.pv_datetime=r.pv_datetime,u.updated_at=r.updated_at,n.value.splice(h,1,{...u})}}),A({show:!0,status:"Success",message:"Update PV Done"})},_e=s([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val3",label:"App 4",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val4",label:"App 5",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val5",label:"App 6",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"payment_method_name",label:"Payment Method Name",type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),Te=$(()=>["pv_not_done","all"].indexOf(x.value)>-1&&N().checkPermission("trp_trx.create")),Me=$(()=>l.value>-1&&N().checkPermission("trp_trx.view")),Ne=$(()=>l.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,0].indexOf(v.value.val1)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1&&N().checkPermission("trp_trx.modify")),Be=$(()=>l.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1&&N().checkPermissions(["trp_trx.val","trp_trx.val1","trp_trx.val2","trp_trx.val3","trp_trx.val4","trp_trx.val5"])),je=$(()=>l.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1&&N().checkPermission("trp_trx.remove")),Ve=$(()=>l.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&v.value.pvr_id!=""&&N().checkPermission("trp_trx.request_remove")),Fe=$(()=>l.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&v.value.val1==1&&N().checkPermission("trp_trx.preview_file"));return(e,t)=>{const d=Ke,g=Je,r=Ge,h=Ze,u=Qe,Ue=We,Re=Xe,Ee=et,Ie=tt,T=at,M=lt,Ye=ot,pe=nt,ze=rt,He=st,Le=it;return i(),q("div",bt,[f(d,{title:"List Transaction"}),c("div",kt,[c("div",xt,[c("div",gt,[c("div",ht,[ee(c("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=a=>te(x)?x.value=a:null)},Dt,512),[[pt,o(x)]])]),o(Te)?(i(),q("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>ye())},[f(g)])):C("",!0),o(Ne)?(i(),q("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>be())},[f(r)])):C("",!0),o(Me)?(i(),q("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>xe())},[f(h)])):C("",!0),o(je)?(i(),q("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=a=>we())},[f(u)])):C("",!0),o(Ve)?(i(),q("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[5]||(t[5]=a=>$e())},[f(Ue)])):C("",!0),o(Be)?(i(),q("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[6]||(t[6]=a=>ke())},[f(Re)])):C("",!0),o(Fe)?(i(),q("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[7]||(t[7]=a=>Oe())},[f(Ee)])):C("",!0)]),c("div",At,[c("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[8]||(t[8]=a=>Pe())}," Gen/Update PVR "),c("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[9]||(t[9]=a=>Se())}," Update PV "),c("div",{class:"m-1 card-border cursor-pointer",onClick:t[10]||(t[10]=a=>D.value=!o(D))},[$t,O(" : "),c("span",{class:vt(["font-bold",o(D)?"text-green-600":"text-red-600"])},Y(o(D)?"ONLINE":"OFFLINE"),3)])])]),f(Ye,{thead:o(_e),selected:o(l),onSetSelected:t[11]||(t[11]=a=>l.value=a),tbody:o(n),fnCallData:re,scrolling:o(b),onSetScrollingPage:t[12]||(t[12]=a=>o(b).page=a),onDoFilter:t[13]||(t[13]=a=>se())},{absen:y(({item:a,index:k})=>[a.trx_absens&&a.trx_absens.length>0?(i(),m(Ie,{key:0,class:"cursor-pointer",onClick:St=>ge(k)},null,8,["onClick"])):C("",!0)]),val:y(({item:a})=>[a.val?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),val1:y(({item:a})=>[a.val1?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),val2:y(({item:a})=>[a.val2?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),val3:y(({item:a})=>[a.val3?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),val4:y(({item:a})=>[a.val4?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),val5:y(({item:a})=>[a.val5?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),payment_method_name:y(({item:a})=>{var k;return[O(Y((k=a.payment_method)==null?void 0:k.name),1)]}),pvr_had_detail:y(({item:a})=>[a.pvr_had_detail?(i(),m(M,{key:1})):(i(),m(T,{key:0}))]),deleted_by_username:y(({item:a})=>{var k;return[O(Y((k=a.deleted_by)==null?void 0:k.username),1)]}),req_deleted_by_username:y(({item:a})=>{var k;return[O(Y((k=a.req_deleted_by)==null?void 0:k.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),f(pe,{type:"delete",show:o(V),data:o(de),fnClose:he,fnConfirm:De,enabledOk:o(Q)},{footer:y(()=>[O(" Masukkan Alasan Penghapusan: "),c("div",qt,[ee(c("textarea",{"onUpdate:modelValue":t[14]||(t[14]=a=>te(B)?B.value=a:null)},null,512),[[ve,o(B)]])])]),_:1},8,["show","data","enabledOk"]),f(pe,{type:"custome",show:o(F),data:o(ue),fnClose:Ae,fnConfirm:qe,enabledOk:o(W)},{words:y(()=>[O(" Data akan diproses dan "),Ct,O(", yakin untuk melanjutkan ? ")]),footer:y(()=>[O(" Masukkan Alasan Permintaan Penghapusan: "),c("div",Ot,[ee(c("textarea",{"onUpdate:modelValue":t[15]||(t[15]=a=>te(j)?j.value=a:null)},null,512),[[ve,o(j)]])])]),_:1},8,["show","data","enabledOk"]),f(ze,{show:o(E),fnClose:()=>{E.value=!1},fnLoadDBData:me,id:o(K),p_data:o(n),list_cost_center:o(ne),online_status:o(D)},null,8,["show","fnClose","id","p_data","list_cost_center","online_status"]),f(He,{show:o(I),fnClose:()=>{I.value=!1},id:o(J),p_data:o(n),is_view:o(G)},null,8,["show","fnClose","id","p_data","is_view"]),f(Le,{show:o(Z),fnClose:()=>{Z.value=!1},index:o(ie),p_data:o(n)},null,8,["show","fnClose","index","p_data"])])}}};export{ca as default};
