import ie from"./Plus.08b342b1.js";import re from"./Edit.c447dd4f.js";import ue from"./Delete.5a3ea32d.js";import de from"./Signature.5d967ac4.js";import ce from"./Calculator.4d34b1a5.js";import me from"./Search.1bcd5643.js";import _e from"./Line.eb51489f.js";import fe from"./Check.40802612.js";import pe from"./trx.eafd7361.js";import ve from"./trx_validasi.1d950a38.js";import{g as he,r as o,j as ge,f as H,o as r,c as _,a as e,l as a,b as p,n as x,k as ye,A as ke,m as be,D as we,F as xe,E as Ce,G as d,t as f,z as C,H as De,x as D,y as L}from"./entry.27484c53.js";import{u as g}from"./useUtils.9a198e32.js";import{u as z}from"./useMyFetch.4ff341b8.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.698224b7.js";import"./Times.8d12f8af.js";import"./client-only.caedcc29.js";import"./InputPointFormat.vue.58dc0d49.js";const $e={class:"w-full h-full flex flex-col bg-white"},Pe={class:"w-full flex grow flex-col"},Te={class:"w-full flex"},Ae={action:"#",class:"w-full flex p-1"},Ue={class:"grow"},Ne=e("div",{class:"font-bold"}," Keyword ",-1),Se={class:"flex items-end pl-1"},Fe={class:"w-full flex justify-center items-center grow p-1"},Ie={key:0,class:""},Me={class:"tacky"},Re=e("thead",null,[e("tr",{class:"sticky top-0 !z-[2]"},[e("th",null,"No"),e("th",null,"App 1"),e("th",null,"App 2"),e("th",null,"ID"),e("th",null,"ID Trx Trp"),e("th",null,"Nominal Potong"),e("th",null,"Note"),e("th",null,"PVR No"),e("th",null,"PV No"),e("th",null,"Created At"),e("th",null,"Updated At")])],-1),je=["onClick"],Be={class:"flex items-center justify-center"},Ve={class:"flex items-center justify-center"},He={class:"flex items-center justify-center"},nt={__name:"part",props:{show:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!1,default:0},is_view:{type:Boolean,required:!1,default:!1}},emits:["updateRemainingCut"],setup(y,{emit:E}){const v=y,{$moment:S}=De(),{pointFormat:O}=g(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="created_at:desc";const F=he("token"),u=o([]),c=o(""),$=o({field:"created_at",by:"desc"}),m=o(-1),i=o({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),q=()=>{n.like="",c.value!=""&&(n.like=`id:%${c.value}%,employee_name:%${c.value}%,no_pol:%${c.value}%,info:%${c.value}%,status:%${c.value}%`),n.sort="",$.value.field&&(n.sort=$.value.field+":"+$.value.by)},k=o(null),P=async()=>{D().loading_full=!0,i.value.may_get_data=!1,n.page=i.value.page,n.page==1&&(u.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(u.value[0])),n.potongan_mst_id=v.id;const{data:s,error:l,status:h}=await z("/potongan_trxs",{method:"get",headers:{Authorization:`Bearer ${F.value}`,Accept:"application/json"},params:n,retry:0});if(D().loading_full=!1,i.value.may_get_data=!0,h.value==="error"){L().trigger(l);return}i.value.page==1?(u.value=s.value.data,k.value&&(k.value.scrollTop=0)):i.value.page>1&&(u.value=[...u.value,...s.value.data]),s.value.data.length==0&&(i.value.is_last_record=!0)},K=async()=>{if(!i.value.may_get_data)return;let s=k.value;if(s.scrollLeft!=i.value.scrollLeft){i.value.scrollLeft=s.scrollLeft;return}i.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(i.value.page++,await P())},Y=()=>{i.value.page=1,i.value.is_last_record=!1,q(),P()},b=o(!1),T=o(0),I=o(0),G=()=>{T.value=0,b.value=!0,I.value=!1},{display:A}=ge(),J=()=>{m.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=u.value[m.value].id,b.value=!0,I.value=!1)},U=o(!1),M=o(0),Z=()=>{m.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value=u.value[m.value].id,U.value=!0)},R=o(!1),Q=o({}),W=o(!1),j=o(""),X=()=>{m.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value="",Q.value={id:u.value[m.value].id},W.value=!0)};H(()=>j.value,s=>{s.trim().length>0?R.value=!0:R.value=!1},{immediate:!1});const ee=async()=>{D().loading_full=!0;const s=new FormData;s.append("potongan_mst_id",v.id);const{data:l,error:h,status:N}=await z("/potongan_trx_recalculate",{method:"post",headers:{Authorization:`Bearer ${F.value}`,Accept:"application/json"},body:s,retry:0});if(D().loading_full=!1,N.value==="error"){L().trigger(h);return}E("updateRemainingCut",l.value.remaining_cut)};return H(()=>v.show,async(s,l)=>{s==!0&&v.id!=0&&P()},{immediate:!0}),(s,l)=>{const h=ie,N=re,te=ue,se=de,le=ce,ae=me,B=_e,V=fe,oe=pe,ne=ve;return r(),_("div",$e,[e("div",Pe,[e("div",Te,[!y.is_view&&("useUtils"in s?s.useUtils:a(g))().checkPermission("potongan_trx.create")?(r(),_("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:l[0]||(l[0]=t=>G())},[p(h)])):x("",!0),!y.is_view&&("useUtils"in s?s.useUtils:a(g))().checkPermissions(["potongan_trx.modify"])&&a(m)>-1?(r(),_("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:l[1]||(l[1]=t=>J())},[p(N)])):x("",!0),("useUtils"in s?s.useUtils:a(g))().checkPermission("potongan_trx.remove")?(r(),_("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:l[2]||(l[2]=t=>X())},[p(te)])):x("",!0),!y.is_view&&("useUtils"in s?s.useUtils:a(g))().checkPermissions(["potongan_trx.val","potongan_trx.val1"])?(r(),_("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:l[3]||(l[3]=t=>Z())},[p(se)])):x("",!0),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:l[4]||(l[4]=t=>ee())},[p(le)])]),e("form",Ae,[e("div",Ue,[Ne,ye(e("input",{class:"",type:"text","onUpdate:modelValue":l[5]||(l[5]=t=>be(c)?c.value=t:null),name:"search",placeholder:"Keyword"},null,512),[[ke,a(c)]])]),e("div",Se,[e("button",{class:"",type:"submit",name:"button",onClick:l[6]||(l[6]=we(t=>Y(),["prevent"]))},[p(ae,{class:"text-2xl"})])])]),e("div",Fe,[a(u).length==0?(r(),_("div",Ie," Maaf Tidak Ada Record ")):(r(),_("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:k,onScroll:K},[e("table",Me,[Re,e("tbody",null,[(r(!0),_(xe,null,Ce(a(u),(t,w)=>(r(),_("tr",{key:w,onClick:Le=>m.value=w,class:d(a(m)==w?"active":"")},[e("td",null,[e("div",Be,f(w+1),1)]),e("td",{class:d(t.deleted?"!bg-red-500":"")},[e("div",Ve,[t.val?(r(),C(V,{key:1})):(r(),C(B,{key:0}))])],2),e("td",{class:d(t.deleted?"!bg-red-500":"")},[e("div",He,[t.val1?(r(),C(V,{key:1})):(r(),C(B,{key:0}))])],2),e("td",{class:d([t.deleted?"!bg-red-500":"","bold"])},f(t.id),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.trx_trp_id),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(a(O)(t.nominal_cut)),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.note),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.trx_trp?t.trx_trp.pvr_no:""),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.trx_trp?t.trx_trp.pv_no:""),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.created_at?a(S)(t.created_at).format("DD-MM-Y HH:mm:ss"):""),3),e("td",{class:d(t.deleted?"!bg-red-500":"")},f(t.updated_at?a(S)(t.updated_at).format("DD-MM-Y HH:mm:ss"):""),3)],10,je))),128))])])],544))])]),p(oe,{show:a(b),fnClose:()=>{b.value=!1},id:a(T),potongan_mst_id:v.id,p_data:a(u),onUpdateRemainingCut:l[7]||(l[7]=t=>s.$emit("updateRemainingCut",t))},null,8,["show","fnClose","id","potongan_mst_id","p_data"]),p(ne,{show:a(U),fnClose:()=>{U.value=!1},id:a(M),p_data:a(u)},null,8,["show","fnClose","id","p_data"])])}}};export{nt as default};
