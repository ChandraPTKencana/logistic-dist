import be from"./Header.ba79bea7.js";import ye from"./Edit.08f87a53.js";import xe from"./Eyes.059668f1.js";import ke from"./Signature.3c17e67c.js";import ge from"./Table2Column.df4f8b1d.js";import he from"./Line.416bf9d4.js";import we from"./Check.926dc099.js";import De from"./Times.1e49cef4.js";import Ae from"./TableView.54135b14.js";import Te from"./trx_trp_absen.ecfe229f.js";import $e from"./trx_trp_absen_validasi.0e5e549b.js";import Se from"./trx_absen.b902f498.js";import{r as s,f as Ce,g as Ne,h as qe,i as N,j as Me,c as d,b as n,a as b,k as Oe,v as Be,l,m as Pe,n as q,d as M,w as m,q as Ue,x as p,y as O,o as r,z as g,t as V,H as je,G as Ye}from"./entry.8fc474fc.js";import{u as B}from"./useMyFetch.ad39ebfd.js";import{u as J}from"./useUtils.d0710e96.js";import{u as Ie}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.b43ad76e.js";import"./Adjust.915699b2.js";import"./TableHeaderEye.0123090e.js";import"./ClearAll.0a8c647a.js";import"./client-only.78ee4df4.js";import"./ClearEach.79ee2da8.js";import"./CaretLeftDoubleBold.f14ea793.js";import"./CaretLeftBold.b35da81e.js";import"./CaretRightBold.1ce3b3da.js";import"./CaretRightDoubleBold.8c1c011d.js";import"./HeaderPopup.vue.95fbca67.js";import"./AttachmentSingle.8983173f.js";import"./PDFJsView.fa722688.js";import"./CaretTop.16a5bc39.js";import"./CaretDown.4664e9f9.js";import"./PopupMini.vue.65518e43.js";import"./Exclamation.e5fa7bef.js";const Ee={class:"w-full h-full flex flex-col"},Fe={class:"w-full flex grow flex-col overflow-auto h-0"},He={class:"w-full flex justify-between flex-wrap"},Ve={class:"grow flex"},Je={class:"m-1"},Re=je('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),ze=[Re],Ke=b("span",{class:"text-xs ml-1"}," Download ",-1),Ge={class:"flex"},Le={key:0,class:"bg-red-700 rounded-sm"},Ze={key:1,class:"bg-green-500 rounded-sm"},Qe={key:0,class:"bg-red-700 rounded-sm"},We={key:1,class:"bg-green-500 rounded-sm"},Xe={key:0,class:"bg-red-700 rounded-sm"},et={key:1,class:"bg-green-500 rounded-sm"},tt={key:0,class:"bg-red-700 rounded-sm"},at={key:1,class:"bg-green-500 rounded-sm"},It={__name:"absen",async setup(lt){let D,R;const{$moment:z}=Ye(),te=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.ritase_val2==1?"!bg-blue-300":"",P=e=>(e.map(t=>{t.class_h=te(t)}),e);let K=s({clearCheckBox:!1});const y=s("Undone");Ce(()=>y.value,e=>{ee.value.map(t=>{let u=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?u&&(t.tbl_show=1):u&&(t.tbl_show=0),t}),Q()},{immediate:!1});const o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const G=s({}),A=s({from:"",to:""}),T=Ne("token"),{data:ae}=([D,R]=qe(async()=>Ue(async()=>{p().loading_full=!0;let e=[];const[t,u]=await Promise.all([B("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return t.status.value!=="error"&&(e=P(t.data.value.data)),t.status.value==="error"?(O().trigger(t.error),{trx_trps:e}):(p().loading_full=!1,{trx_trps:e})},"$Tkqpaz2JeJ")),D=await D,R(),D),i=s(ae.value.trx_trps||[]);s([]),s(!1);const U=s({field:"tanggal",by:"desc"}),_=s(-1),h=N(()=>i.value[_.value]),c=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),L=()=>{o.like="";let e=JSON.parse(JSON.stringify(p()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%,uj_asst_opt:%${e}%`),o.sort="",U.value.field&&(o.sort=U.value.field+":"+U.value.by),o.date_from=A.value.from?z(A.value.from).format("YYYY-MM-DD"):"",o.date_to=A.value.to?z(A.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(p()._tv.filter_model)},Z=async()=>{p().loading_full=!0,G.value={},c.value.may_get_data=!1,o.page=c.value.page,o.page==1&&(i.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(i.value[0])),o.filter_status=y.value;const{data:e,error:t,status:u}=await B("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:o,retry:0});if(p().loading_full=!1,c.value.may_get_data=!0,u.value==="error"){O().trigger(t,G);return}c.value.page==1?i.value=P(e.value.data):c.value.page>1&&(i.value=[...i.value,...P(e.value.data)]),e.value.data.length==0&&(c.value.is_last_record=!0),p()._tv.filter_box=!1},Q=()=>{_.value=-1,c.value.page=1,c.value.is_last_record=!1,L(),Z()},j=s(!1),W=s(0),{display:Y}=Me(),le=()=>{_.value==-1?Y({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(W.value=i.value[_.value].id,j.value=!0)},$=s(!1),S=s(0),I=s(!1),oe=()=>{_.value==-1?Y({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=i.value[_.value].id,$.value=!0,I.value=!1)},se=()=>{_.value==-1?Y({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=i.value[_.value].id,$.value=!0,I.value=!0)},X=s(!1),re=s(0),E=s([]),ne=async()=>{p().loading_full=!0;const e=new FormData;e.append("ids",JSON.stringify(E.value)),e.append("_method","PUT");const{data:t,error:u,status:F}=await B("/trx_trp/absen/clear_valval1",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:e,retry:0});if(p().loading_full=!1,F.value==="error"){O().trigger(u);return}t.value.val_lists.forEach(x=>{let w=i.value.map(f=>f.id).indexOf(x.id);if(w>-1){let f=i.value[w];f.ritase_val=x.ritase_val,f.ritase_val1=x.ritase_val1,f.ritase_val2=x.ritase_val2,f.updated_at=x.updated_at,i.value.splice(w,1,{...f})}}),K.value.clearCheckBox=!0},ee=s([{key:"cb",label:"",checkbox:"id"},{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"ritase_leave_at",label:"B"},{key:"ritase_arrive_at",label:"T"},{key:"ritase_return_at",label:"K"},{key:"ritase_till_at",label:"S"},{key:"ritase_note",label:"Note"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"uj_asst_opt",label:"Info",filter_on:1,type:"select",select_item:["DENGAN KERNET","TANPA KERNET"]},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ie=N(()=>_.value>-1&&J().checkPermission("trp_trx.absen.view")),_e=N(()=>_.value>-1&&[void 0,0].indexOf(h.value.deleted)>-1&&[void 0,0].indexOf(h.value.req_deleted)>-1&&[void 0,0].indexOf(h.value.ritase_val)>-1&&J().checkPermission("trp_trx.absen.modify")),de=N(()=>_.value>-1&&[void 0,0].indexOf(h.value.deleted)>-1&&[void 0,0].indexOf(h.value.req_deleted)>-1&&J().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1","trp_trx.absen.val2"])),{downloadFile:ue,viewFile:ot}=Ie(),pe=async()=>{L(),p().loading_full=!0,o.filter_status=y.value;const{data:e,error:t,status:u}=await B("/trx_trp/absen/download_excel",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:o,retry:0});if(p().loading_full=!1,u.value==="error"){O().trigger(t);return}ue(e.value)};return(e,t)=>{const u=be,F=ye,x=xe,w=ke,f=ge,H=he,k=we,C=De,ce=Ae,me=Te,fe=$e,ve=Se;return r(),d("div",Ee,[n(u,{title:"List Transaction"}),b("div",Fe,[b("div",He,[b("div",Ve,[b("div",Je,[Oe(b("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=a=>Pe(y)?y.value=a:null)},ze,512),[[Be,l(y)]])]),l(_e)?(r(),d("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>le())},[n(F)])):q("",!0),l(ie)?(r(),d("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>se())},[n(x)])):q("",!0),l(de)?(r(),d("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>oe())},[n(w)])):q("",!0),b("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:t[4]||(t[4]=a=>pe())},[n(f),M(),Ke])]),b("div",Ge,[l(E).length>0?(r(),d("button",{key:0,type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[5]||(t[5]=a=>ne())}," Multi UnVal ")):q("",!0)])]),n(ce,{thead:l(ee),selected:l(_),onSetSelected:t[6]||(t[6]=a=>_.value=a),tbody:l(i),fnCallData:Z,scrolling:l(c),onSetScrollingPage:t[7]||(t[7]=a=>l(c).page=a),onDoFilter:t[8]||(t[8]=a=>Q()),onSetCheckbox:t[9]||(t[9]=a=>E.value=a),deep_state:l(K)},{ritase_val:m(({item:a})=>[a.ritase_val?(r(),g(k,{key:1})):(r(),g(H,{key:0}))]),ritase_val1:m(({item:a})=>[a.ritase_val1?(r(),g(k,{key:1})):(r(),g(H,{key:0}))]),ritase_val2:m(({item:a})=>[a.ritase_val2?(r(),g(k,{key:1})):(r(),g(H,{key:0}))]),uj_asst_opt:m(({item:a})=>{var v;return[M(V((v=a.uj)==null?void 0:v.asst_opt),1)]}),ritase_leave_at:m(({item:a})=>[a.ritase_leave_at?(r(),d("div",Ze,[n(k,{class:"text-white text-xl font-bold"})])):(r(),d("div",Le,[n(C,{class:"text-white text-xl font-bold"})]))]),ritase_arrive_at:m(({item:a})=>[a.ritase_arrive_at?(r(),d("div",We,[n(k,{class:"text-white text-xl font-bold"})])):(r(),d("div",Qe,[n(C,{class:"text-white text-xl font-bold"})]))]),ritase_return_at:m(({item:a})=>[a.ritase_return_at?(r(),d("div",et,[n(k,{class:"text-white text-xl font-bold"})])):(r(),d("div",Xe,[n(C,{class:"text-white text-xl font-bold"})]))]),ritase_till_at:m(({item:a})=>[a.ritase_till_at?(r(),d("div",at,[n(k,{class:"text-white text-xl font-bold"})])):(r(),d("div",tt,[n(C,{class:"text-white text-xl font-bold"})]))]),deleted_by_username:m(({item:a})=>{var v;return[M(V((v=a.deleted_by)==null?void 0:v.username),1)]}),req_deleted_by_username:m(({item:a})=>{var v;return[M(V((v=a.req_deleted_by)==null?void 0:v.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling","deep_state"])]),n(me,{show:l(j),fnClose:()=>{j.value=!1},id:l(W),p_data:l(i)},null,8,["show","fnClose","id","p_data"]),n(fe,{show:l($),fnClose:()=>{$.value=!1},id:l(S),p_data:l(i),is_view:l(I),onSetID:t[10]||(t[10]=a=>S.value=a),onSetIndex:t[11]||(t[11]=a=>_.value=a)},null,8,["show","fnClose","id","p_data","is_view"]),n(ve,{show:l(X),fnClose:()=>{X.value=!1},index:l(re),p_data:l(i)},null,8,["show","fnClose","index","p_data"])])}}};export{It as default};
