import{_ as P}from"./HeaderPopup.vue.a2d38707.js";import{_ as T}from"./client-only.1152cd56.js";import{_ as V}from"./WidthMiniList.vue.43ddfbc3.js";import{_ as F}from"./InputPointFormat.vue.70ec025d.js";import K from"./AttachmentSingle.5b2acc93.js";import{r as v,g as L,i as O,f as U,I as z,k,K as E,o as S,c as N,a,b as p,l as o,v as Y,t as _,w as G,A as H,C as W,G as Q,x as m,y as C}from"./entry.c2c646d2.js";import"./useUtils.6d9c04df.js";import{u as A}from"./useMyFetch.19718bbf.js";import"./Times.3ee06605.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.6478e008.js";import"./PDFJsView.dfda4943.js";const R={class:"box-fixed"},X={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Z={class:"w-full flex flex-col items-center grow overflow-auto"},ee={class:"w-full flex flex-row flex-wrap"},te={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ae=a("label",{for:""},"Tipe",-1),le=["disabled"],oe=a("option",{value:"Lainnya"},"Lainnya",-1),ne=a("option",{value:"Kerajinan"},"Kerajinan",-1),se=a("option",{value:"BonusTrip"},"BonusTrip",-1),ie=[oe,ne,se],re={class:"text-red-500"},de={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ue=a("label",{for:""},"Tanggal",-1),pe={key:0,class:"card-border"},_e={key:1},me={class:"text-red-500"},ce={class:"w-full sm:w-8/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ve=a("label",{for:""},"Pekerja",-1),fe={class:"text-red-500"},ye={class:"w-full sm:w-6/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},we=a("label",{for:""},"Nominal",-1),he={class:"text-red-500"},ge={class:"w-full sm:w-6/12 md:w-full lg:w-full flex flex-col flex-wrap p-1"},xe=a("label",{for:""},"Note",-1),be=["disabled"],ke={class:"text-red-500"},Se={class:"p-1 w-full"},Ne={class:"w-full flex items-center justify-end"},Te={__name:"salary_bonus",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(f){const d=f,{$moment:D}=Q(),M={id:"",tanggal:new Date,type:"Kerajinan",nominal:0,note:"",attachment_1:"",attachment_1_preview:"",attachment_1_type:""},t=v({...M}),h=L("token"),u=v({}),y={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},ktp_no:{tcon:"IconsNumber",text:"No KTP",val:""},sim_no:{tcon:"IconsCreditCard",text:"No SIM",val:""}},id:"",name:"",title:""},i=v(JSON.parse(JSON.stringify(y))),B=v([]),I=async()=>{m().loading_full=!0;const{data:n,error:e,status:r}=await A("/salary_bonus_load_local",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0});if(m().loading_full=!1,r.value==="error"){C().trigger(e);return}B.value=n.value.list_employee},j=O(()=>{let n=[];return B.value.forEach((e,r)=>{let l=JSON.parse(JSON.stringify(y));l._.id.val=e.id,l._.name.val=e.name,l._.ktp_no.val=e.ktp_no,l._.sim_no.val=e.sim_no,l.id=e.id,l.name=e.name,l.title=(e.ktp_no||"")+" "+(e.sim_no||""),n.push(JSON.parse(JSON.stringify(l)))}),n}),$=v([]),q=async()=>{m().loading_full=!0,u.value={};const n=new FormData;n.append("type",t.value.type),n.append("tanggal",t.value.tanggal?D(t.value.tanggal).format("Y-MM-DD"):""),n.append("employee_id",i.value.id),n.append("nominal",t.value.nominal),n.append("note",t.value.note),n.append("attachment_1",t.value.attachment_1),n.append("attachment_1_preview",t.value.attachment_1_preview);let e="post",r=t.value.id;r==""||(n.append("id",r),n.append("_method","PUT"));const{data:l,error:g,status:x}=await A("/salary_bonus",{method:e,headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:n,retry:0});if(m().loading_full=!1,x.value==="error"){C().trigger(g,u);return}if(t.value.employee={name:i.value._.name.val,ktp_no:i.value._.ktp_no.val,sim_no:i.value._.sim_no.val},t.value.attachment_1_type=l.value.attachment_1_type,$.value=l.value.details,r<=0)t.value.id=l.value.id,t.value.created_at=l.value.created_at,t.value.updated_at=l.value.updated_at,d.p_data.unshift(t.value);else{t.value.updated_at=l.value.updated_at;let w=d.p_data.map(b=>b.id).indexOf(r);w>=-1&&d.p_data.splice(w,1,{...t.value})}d.fnClose()},c=O(()=>!!t.value.val1),J=async()=>{m().loading_full=!0;const{data:n,error:e,status:r}=await A("/salary_bonus",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(m().loading_full=!1,r.value==="error"){C().trigger(e);return}d.is_copy&&(t.value.val=0,t.value.val1=0);let l=n.value.data;t.value=l,i.value._.id.val=l.employee.id,i.value._.name.val=l.employee.name,i.value._.ktp_no.val=l.employee.ktp_no,i.value._.sim_no.val=l.employee.sim_no,i.value.id=l.employee.id,i.value.name=l.employee.name,i.value.ktp_no=(l.employee.ktp_no||"")+" "+(l.employee.sim_no||"")};return U(()=>d.show,async(n,e)=>{n==!0&&(await I(),t.value={...M},i.value=JSON.parse(JSON.stringify(y)),$.value=[],u.value={},d.id!=0&&J())},{immediate:!0}),(n,e)=>{const r=P,l=z("vue-date-picker"),g=T,x=V,w=F,b=K;return k((S(),N("section",R,[a("div",null,[p(r,{title:"Form Salary Additional",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),a("form",X,[a("div",Z,[a("div",ee,[a("div",te,[ae,k(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).type=s),disabled:o(c)},ie,8,le),[[Y,o(t).type]]),a("p",re,_(o(u).type),1)]),a("div",de,[ue,o(c)?(S(),N("div",pe,_(o(D)(o(t).tanggal).format("DD-MM-Y")),1)):(S(),N("div",_e,[p(g,null,{default:G(()=>[p(l,{modelValue:o(t).tanggal,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).tanggal=s),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])),a("p",me,_(o(u).tanggal),1)]),a("div",ce,[ve,p(x,{arr:o(j),selected:o(i),pure:y,onSetSelected:e[2]||(e[2]=s=>i.value=s),disabled:o(c)},null,8,["arr","selected","disabled"]),a("p",fe,_(o(u).employee_id),1)]),a("div",ye,[we,a("div",null,[p(w,{class:"w-full h-full p-1",type:"text",value:o(t).nominal||0,onInput:e[3]||(e[3]=s=>o(t).nominal=s),disabled:o(c)},null,8,["value","disabled"])]),a("p",he,_(o(u).nominal),1)]),a("div",ge,[xe,a("div",null,[k(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).note=s),disabled:o(c)},null,8,be),[[H,o(t).note]])]),a("p",ke,_(o(u).nominal),1)]),a("div",Se,[p(b,{label:"Attachment",value:o(t).attachment_1_preview,onSetFile:e[5]||(e[5]=s=>o(t).attachment_1=s),onSetPreview:e[6]||(e[6]=s=>o(t).attachment_1_preview=s),can_remove:!0},null,8,["value"])])])]),a("div",Ne,[a("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[7]||(e[7]=s=>f.fnClose())}," Cancel "),a("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:e[8]||(e[8]=W(s=>q(),["prevent"]))}," Save ")])])])],512)),[[E,f.show]])}}};export{Te as default};
