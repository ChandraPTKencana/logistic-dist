import{_ as Be}from"./Header.65a8a512.js";import{_ as Ne}from"./Plus.75204cb7.js";import{_ as Ie}from"./Edit.cede8aa7.js";import{_ as Ye}from"./Delete.7b4c6e7a.js";import{_ as Fe}from"./Signature.a53b07e3.js";import{u as He,_ as Oe}from"./useDownload.e0194649.js";import{_ as ze}from"./Cog.d11f6a68.js";import{_ as Ue}from"./client-only.787014f9.js";import{_ as Ee}from"./useUtils.0481ddb5.js";import{_ as Le,a as Re}from"./Check.a4a4bdcf.js";import{_ as Ke}from"./TableView.210f9d3b.js";import{_ as Je}from"./PopupMini.vue.507b565a.js";import{_ as Ge,a as qe}from"./trx_trp_validasi.4b79b647.js";import{_ as Ze}from"./Times.0776e6cc.js";import{r as s,f as se,D as Qe,B as We,H as ne,I as Xe,J as et,c as Y,b as n,a as t,G as L,k as l,d as tt,q as re,t as F,w as x,h as R,j as ot,i as at,l as ie,m as lt,E as st,x as v,y as D,o as m,N as T,O as nt,s as rt}from"./entry.d372f2cd.js";import{u as $}from"./useMyFetch.00e72082.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.f79143de.js";import"./InputPointFormat.vue.ce354b1d.js";const it={class:"w-full h-full flex flex-col"},ut={class:"w-full flex grow flex-col overflow-auto h-0"},dt={class:"w-full flex justify-between"},_t={class:"grow flex"},ct={class:"flex"},pt=t("span",{class:"text-xs"},"Mode",-1),vt={action:"#",class:"w-full flex p-1"},ft=t("div",{class:"font-bold"}," Tgl Dari ",-1),mt={class:"text-red-500"},bt=t("div",{class:"font-bold"}," Tgl Sampai ",-1),yt={class:"text-red-500"},kt={class:"grow"},xt=t("div",{class:"font-bold"}," Keyword ",-1),gt={class:"pl-1"},ht=t("div",{class:"font-bold"}," Sort By ",-1),wt=nt('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Dt=[wt],$t={class:"pl-1"},Ct=t("div",{class:"font-bold"}," Sort Order ",-1),Mt=t("option",{value:"asc"},"Asc",-1),Tt=t("option",{value:"desc"},"Desc",-1),Vt=[Mt,Tt],St={class:"flex items-end pl-1"},At={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},jt={class:"relative",style:{width:"95%",height:"90%"}},Pt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Bt=["src"],Nt={key:1,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},It={class:"relative",style:{width:"95%",height:"90%"}},Yt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ft={class:"w-full h-full flex flex-col items-center justify-content-center bg-white"},Ht={class:"w-full p-1"},Ot={class:"w-full p-1 bg-gray-200"},zt=t("div",{class:"w-full text-blue-600 font-bold"}," Set Date For Load Data ",-1),Ut={class:"w-full grid grid-cols-2 grid-rows-1 gap-1"},Et={class:"flex flex-col flex-wrap p-1"},Lt=t("label",{for:""},"From",-1),Rt={class:"grow"},Kt={class:"flex flex-col flex-wrap p-1"},Jt=t("label",{for:""},"To",-1),Gt={class:"grow"},mo={__name:"index",async setup(qt){let S,K;const{$moment:A}=rt(),_={};_._TimeZoneOffset=new Date().getTimezoneOffset(),_.sort="tanggal:desc";const j=s({}),y=s({from:"",to:""}),g=se("token"),ue=se("role"),de=a=>a.includes(ue.value),{data:_e}=([S,K]=Qe(async()=>st(async()=>{v().loading_full=!0;let a=[];const[e,p]=await Promise.all([$("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},retry:0})]);return e.status.value!=="error"&&(a=e.data.value.data),e.status.value==="error"?(D().trigger(e.error),{trx_trps:a}):(v().loading_full=!1,{trx_trps:a})},"$pFLmKcrKj9")),S=await S,K(),S),r=s(_e.value.trx_trps||[]),J=s([]),G=s([]),q=s([]),Z=s([]),k=s(!1),ce=async(a,e="")=>{v().loading_full=!0;let p=d.value.from?A(d.value.from).format("Y-MM-DD"):"",b=d.value.to?A(d.value.to).format("Y-MM-DD"):"";const{data:c,error:M,status:w}=await $("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},params:{jenis:a,online_status:k.value,from:p,to:b,transition_to:e},retry:0});if(v().loading_full=!1,w.value==="error"){D().trigger(M);return}J.value=c.value.list_ujalan,G.value=c.value.list_cost_center,q.value=c.value.list_ticket,Z.value=c.value.list_pv},i=s(""),h=s({field:"tanggal",by:"desc"}),u=s(-1),f=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),pe=()=>{_.like="",i.value!=""&&(_.like=`id:%${i.value}%,xto:%${i.value}%,jenis:%${i.value}%,pv_no:%${i.value}%,ticket_a_no:%${i.value}%,ticket_b_no:%${i.value}%,no_pol:%${i.value}%,supir:%${i.value}%,kernet:%${i.value}%,cost_center_code:%${i.value}%,cost_center_desc:%${i.value}%,pvr_id:%${i.value}%,pvr_no:%${i.value}%,tanggal:%${i.value}%,transition_to:%${i.value}%`),_.sort="",h.value.field&&(_.sort=h.value.field+":"+h.value.by),_.date_from=y.value.from?A(y.value.from).format("YYYY-MM-DD"):"",_.date_to=y.value.to?A(y.value.to).format("YYYY-MM-DD"):""},Q=async()=>{v().loading_full=!0,j.value={},f.value.may_get_data=!1,_.page=f.value.page,_.page==1&&(r.value=[]),_.first_row&&delete _.first_row,_.page>1&&(_.first_row=JSON.stringify(r.value[0]));const{data:a,error:e,status:p}=await $("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},params:_,retry:0});if(v().loading_full=!1,f.value.may_get_data=!0,p.value==="error"){D().trigger(e,j);return}f.value.page==1?r.value=a.value.data:f.value.page>1&&(r.value=[...r.value,...a.value.data]),a.value.data.length==0&&(f.value.is_last_record=!0)},ve=()=>{f.value.page=1,f.value.is_last_record=!1,pe(),Q()};We();const P=s(!1),H=s(0),fe=()=>{H.value=0,P.value=!0},{display:C}=ne();Xe(ne());const me=()=>{u.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(H.value=r.value[u.value].id,P.value=!0)},O=s(!1),W=s(0),be=()=>{u.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(W.value=r.value[u.value].id,O.value=!0)},X=s({}),V=s(!1),ye=async()=>{V.value&&(V.value=!1)},ke=()=>{u.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(X.value={id:r.value[u.value].id},V.value=!0)},xe=async()=>{v().loading_full=!0;const a=new FormData;a.append("id",r.value[u.value].id),a.append("_method","DELETE");const{data:e,error:p,status:b}=await $("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,b.value==="error"){D().trigger(p);return}r.value.splice(u.value,1),u.value=-1,V.value=!1},{downloadFile:ge,printHtml:he}=He(),z=s(!1),ee=s(""),te=async()=>{if(z.value==!0){z.value=!1;return}if(u.value==-1){C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}v().loading_full=!0;const{data:a,error:e,status:p}=await $("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},params:{id:r.value[u.value].id},retry:0});if(v().loading_full=!1,p.value==="error"){D().trigger(e);return}he(a.value.html,318)},we=()=>{ge(ee.value)},oe=a=>a.pv_id<=0||["CPO","PK"].indexOf(a.jenis)>-1&&(a.ticket_a_id<=0||a.ticket_b_bruto<=0||a.ticket_b_tara<=0||a.ticket_b_netto<=0||a.ticket_b_in_at==""||a.ticket_b_out_at=="")||a.jenis=="TBS"&&(a.ticket_a_id<=0||a.ticket_b_id<=0)||a.jenis=="TBSK"&&a.ticket_b_id<=0?0:1,B=s(!1),d=s({from:new Date().setDate(new Date().getDate()-3),to:new Date}),ae=a=>{a=="from"?d.value.from-d.value.to>0&&(d.value.from=d.value.to):d.value.to-d.value.from<0&&(d.value.to=d.value.from)},De=async()=>{v().loading_full=!0;const a=new FormData;a.append("id",r.value[u.value].id),a.append("online_status",k.value);const{data:e,error:p,status:b}=await $("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,b.value==="error"){D().trigger(p);return}let c=r.value[u.value];c.pvr_id=e.value.pvr_id,c.pvr_no=e.value.pvr_no,c.pvr_total=e.value.pvr_total,c.pvr_had_detail=e.value.pvr_had_detail,c.updated_at=e.value.updated_at,r.value.splice(u.value,1,{...c}),u.value=-1,C({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},$e=async()=>{v().loading_full=!0;const a=new FormData;a.append("online_status",k.value);const{data:e,error:p,status:b}=await $("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${g.value}`,Accept:"application/json"},body:a,retry:0});if(v().loading_full=!1,b.value==="error"){D().trigger(p);return}e.value.data.forEach(c=>{let M=r.value.map(w=>w.id).indexOf(c.id);if(M!==-1){let w={pv_id:e.value.pv_id,pv_no:e.value.pv_no,pv_total:e.value.pv_total,updated_at:e.value.updated_at};r.value.splice(M,1,{...w})}}),C({show:!0,status:"Success",message:"Update PV Done"})},Ce=s([{key:"status",label:"Status"},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"id",label:"ID"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol"},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"default",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"transition_to",label:"Peralihan"},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No"},{key:"ticket_a_bruto",label:"Bruto"},{key:"ticket_a_tara",label:"Tara"},{key:"ticket_a_netto",label:"Netto"},{key:"ticket_a_supir",label:"Supir"},{key:"ticket_a_no_pol",label:"No Pol"},{key:"ticket_a_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_a_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No"},{key:"ticket_b_bruto",label:"Bruto"},{key:"ticket_b_tara",label:"Tara"},{key:"ticket_b_netto",label:"Netto"},{key:"ticket_b_supir",label:"Supir"},{key:"ticket_b_no_pol",label:"No Pol"},{key:"ticket_b_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_b_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"}]);return(a,e)=>{const p=Be,b=Ne,c=Ie,M=Ye,w=Fe,Me=Oe,Te=ze,N=et("vue-date-picker"),I=Ue,Ve=Ee,U=Le,E=Re,Se=Ke,Ae=Je,je=Ge,Pe=qe,le=Ze;return m(),Y("div",it,[n(p,{title:"List Transaction"}),t("div",ut,[t("div",dt,[t("div",_t,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[0]||(e[0]=o=>fe())},[n(b)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>me())},[n(c)]),de(["PabrikTransport"])?L("",!0):(m(),Y("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>ke())},[n(M)])),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>be())},[n(w)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>te())},[n(Me)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>B.value=!0)},[n(Te)])]),t("div",ct,[t("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[6]||(e[6]=o=>De())}," Gen/Update PVR "),t("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[7]||(e[7]=o=>$e())}," Update PV "),t("div",{class:"m-1 card-border cursor-pointer",onClick:e[8]||(e[8]=o=>k.value=!l(k))},[pt,tt(" : "),t("span",{class:re(["font-bold",l(k)?"text-green-600":"text-red-600"])},F(l(k)?"ONLINE":"OFFLINE"),3)])])]),t("form",vt,[t("div",null,[ft,n(I,null,{default:x(()=>[n(N,{modelValue:l(y).from,"onUpdate:modelValue":e[9]||(e[9]=o=>l(y).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",mt,F(l(j).date_from),1)]),t("div",null,[bt,n(I,null,{default:x(()=>[n(N,{modelValue:l(y).to,"onUpdate:modelValue":e[10]||(e[10]=o=>l(y).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",yt,F(l(j).date_to),1)]),t("div",kt,[xt,R(t("input",{class:"",type:"text","onUpdate:modelValue":e[11]||(e[11]=o=>at(i)?i.value=o:null),name:"search",placeholder:"Keyword"},null,512),[[ot,l(i)]])]),t("div",gt,[ht,R(t("select",{class:"","onUpdate:modelValue":e[12]||(e[12]=o=>l(h).field=o)},Dt,512),[[ie,l(h).field]])]),t("div",$t,[Ct,R(t("select",{class:"","onUpdate:modelValue":e[13]||(e[13]=o=>l(h).by=o)},Vt,512),[[ie,l(h).by]])]),t("div",St,[t("button",{class:"",type:"submit",name:"button",onClick:e[14]||(e[14]=lt(o=>ve(),["prevent"]))},[n(Ve,{class:"text-2xl"})])])]),n(Se,{thead:l(Ce),selected:l(u),onSetSelected:e[15]||(e[15]=o=>u.value=o),tbody:l(r),fnCallData:Q,scrolling:l(f),onSetScrollingPage:e[16]||(e[16]=o=>l(f).page=o)},{status:x(({item:o})=>[t("div",{class:re(["text-white text-xs px-2 py-1 rounded-lg",oe(o)?"bg-green-600":"bg-red-600"])},F(oe(o)?"Done":"Not Done"),3)]),app1:x(({item:o})=>[o.val?(m(),T(E,{key:1})):(m(),T(U,{key:0}))]),app2:x(({item:o})=>[o.val1?(m(),T(E,{key:1})):(m(),T(U,{key:0}))]),pvr_completed:x(({item:o})=>[o.pvr_had_detail?(m(),T(E,{key:1})):(m(),T(U,{key:0}))]),_:2},1032,["thead","selected","tbody","scrolling"])]),n(Ae,{type:"delete",show:l(V),data:l(X),fnClose:ye,fnConfirm:xe},null,8,["show","data"]),n(je,{show:l(P),fnClose:()=>{P.value=!1},fnLoadDBData:ce,id:l(H),p_data:l(r),list_ujalan:l(J),list_ticket:l(q),list_pv:l(Z),list_cost_center:l(G),online_status:l(k)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv","list_cost_center","online_status"]),n(Pe,{show:l(O),fnClose:()=>{O.value=!1},id:l(W),p_data:l(r)},null,8,["show","fnClose","id","p_data"]),l(z)?(m(),Y("div",At,[t("div",jt,[t("div",Pt,[n(le,{style:{color:"black",cursor:"pointer"},onClick:e[17]||(e[17]=o=>te())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(ee).dataBase64},null,8,Bt),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:e[18]||(e[18]=o=>we())})])])):L("",!0),l(B)?(m(),Y("div",Nt,[t("div",It,[t("div",Yt,[n(le,{style:{color:"black",cursor:"pointer"},onClick:e[19]||(e[19]=o=>B.value=!1)})]),t("div",Ft,[t("div",Ht,[t("div",Ot,[zt,t("div",Ut,[t("div",Et,[Lt,t("div",Rt,[n(I,null,{default:x(()=>[n(N,{modelValue:l(d).from,"onUpdate:modelValue":e[20]||(e[20]=o=>l(d).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:e[21]||(e[21]=o=>ae("from"))},null,8,["modelValue"])]),_:1})])]),t("div",Kt,[Jt,t("div",Gt,[n(I,null,{default:x(()=>[n(N,{modelValue:l(d).to,"onUpdate:modelValue":e[22]||(e[22]=o=>l(d).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:e[23]||(e[23]=o=>ae("to"))},null,8,["modelValue"])]),_:1})])])])])])]),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:e[24]||(e[24]=o=>B.value=!1)})])])):L("",!0)])}}};export{mo as default};
