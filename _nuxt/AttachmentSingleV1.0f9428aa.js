import P from"./PDFJsView.23e8f727.js";import{Q as S,a4 as F,M as I,r as s,g as V,a2 as $,f as L,o as c,c as p,a as h,t as q,l as f,n as m,z as A,k as B,L as O}from"./entry.0773fa5b.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";function M(i,v,l,_){let t,g=!1;S(()=>{t=new IntersectionObserver(async([k])=>{k.isIntersecting&&!g&&(g=!0,await v())},{threshold:0,rootMargin:"300px",..._}),i.value&&t.observe(i.value)}),F(()=>{t==null||t.disconnect(),l==null||l()})}const z={class:"w-full"},N={for:""},E={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},J={class:"image-box"},Q={key:0},W=["src"],G={key:1,class:"skeleton"},H=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(i,{emit:v}){const l=i;s(!1);const _=s(null);s(null),s(null);const t=s(!1),g=e=>{const o=e.target.files;if(!o||!o.length)return;t.value=!0;const r=o[0];u.value=r,n&&URL.revokeObjectURL(n),n=URL.createObjectURL(r),a.value=n,v("setPreview","exist"),v("setFile",r)},k=()=>{b(!0);const e=_.value;e&&(e.value=""),v("setFile",null),v("setPreview",null)},y=s(null),a=s(null);let n=null;const R=V("token"),{apiBase:C}=$(),u=s();L(()=>l.link,e=>{console.log("+openlink"),e&&(y.value&&w(),console.log("-openlink"))},{immediate:!0});const d=s(!1);L(()=>l.show,e=>{console.log("+showing"),b(!0),a.value=null,u.value=null,d.value=!1,t.value=!1,console.log("-showing")},{immediate:!0});async function w(){if(console.log("++++++trigger load"),console.log("props.link",l.link),console.log("src.value",a.value),console.log("isUserFile.value",t.value),console.log("loadedOnce.value",d.value),console.log("------trigger load"),!l.link||a.value||l.link=="exist"||t.value||d.value)return;const e=l.link.startsWith("http")?l.link:`${C}${l.link}`,o=await fetch(e,{headers:{Authorization:`Bearer ${R.value}`}});if(!o.ok){let r=_.value;r&&(r.value="");return}u.value=await o.blob(),n=URL.createObjectURL(u.value),a.value=n,d.value=!0}function b(e=!1){t.value&&e==!1||d.value&&e==!1||(n&&(URL.revokeObjectURL(n),n=null),a.value=null,u.value=null)}return M(y,w,b,{rootMargin:"300px 0px",threshold:0}),F(()=>{d.value=!1}),(e,o)=>{var x,U;const r=P;return c(),p("div",{ref_key:"wrapper",ref:y,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[h("div",z,[h("label",N,q(i.label),1)]),h("div",E,[h("div",J,[f(a)?(c(),p("div",Q,[(x=f(u))!=null&&x.type.match(/image/)?(c(),p("img",{key:0,src:f(a),class:"w-full h-full object-cover"},null,8,W)):m("",!0),(U=f(u))!=null&&U.type.match(/application\/pdf/)?(c(),A(r,{key:1,pdfObjUrl:f(n)},null,8,["pdfObjUrl"])):m("",!0)])):(c(),p("div",G))])]),i.can_remove?B((c(),p("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:o[0]||(o[0]=j=>k())},"Clear",512)),[[O,f(a)]]):m("",!0),i.can_remove?B((c(),p("input",{key:1,class:"w-full",onChange:o[1]||(o[1]=j=>g(j)),ref_key:"photo_input",ref:_,type:"file",name:"photo"},null,544)),[[O,!f(a)]]):m("",!0)],512)}}});const Y=D(H,[["__scopeId","data-v-9a9684f2"]]);export{Y as default};
