import{_ as H}from"./HeaderPopup.vue.cc33d5aa.js";import{r as p,g as K,i as C,f as R,k as m,L as I,o as _,c as w,a as e,b as Q,l as s,A as j,t as g,G as $,m as z,F as B,E as L,K as N,D as W,x as c,y as A}from"./entry.1b15191a.js";import{u as D}from"./useMyFetch.53166450.js";import"./Times.a77dacc1.js";import"./_plugin-vue_export-helper.c27b6911.js";const X={class:"box-fixed"},Y={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Z={class:"w-full flex flex-col items-center grow overflow-auto"},ee={class:"w-full flex flex-row flex-wrap"},te={class:"w-full flex flex-col flex-wrap p-1"},ae=e("label",{for:""},"Name",-1),le={class:"text-red-500"},se={class:"w-full flex flex-col sm:flex-row grow p-1 justify-between flex-wrap md:overflow-hidden"},oe={class:"w-full max-w-full p-0 md:pr-1 md:w-1/2 md:max-h-full md:overflow-auto"},re={class:"w-full",role:"sticky"},ne={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ue=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission List ")],-1),ie={class:"sticky top-7 !z-[2]"},de={class:"min-w-[20px] !w-[20px] max-w-[20px]"},ce={class:"w-full flex items-center"},fe={ref:"to_move"},pe={class:"!w-[10px]"},me={class:"w-full h-full flex items-center justify-center"},he=["onUpdate:modelValue"],ve={class:"w-full h-full flex items-center justify-start"},_e={class:"w-full max-w-full max-h-full px-0 py-2 md:pl-1 md:py-0 md:w-1/2 md:overflow-auto"},we={class:"w-full",role:"sticky"},ge={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ye=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission User ")],-1),xe={class:"sticky top-7 !z-[2]"},be={class:"min-w-[10px] !w-[10px] max-w-[10px]"},ke={class:"w-full flex items-center"},Ce={ref:"to_move"},Ae={class:"!w-[10px]"},De={class:"w-full h-full flex items-center justify-center"},Ue=["onUpdate:modelValue"],je={class:"w-full h-full flex items-center justify-start"},Se={class:"w-full flex items-center justify-end"},Ne={__name:"permission_group",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(y){const d=y,S={name:"",list:[]},r=p({...S}),x=K("token"),U=p({}),q=async()=>{c().loading_full=!0,U.value={};const l=new FormData;l.append("name",r.value.name),l.append("permission_list",JSON.stringify(b.value)),l.append("users",JSON.stringify(k.value));let t="post",i=d.is_copy?0:d.id;i==0||(l.append("id",i),l.append("_method","PUT"));const{data:a,error:f,status:u}=await D("/permission_group",{method:t,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(c().loading_full=!1,u.value==="error"){A().trigger(f,U);return}if(i<=0)r.value.id=a.value.id,r.value.created_at=a.value.created_at,r.value.updated_at=a.value.updated_at,d.p_data.unshift(r.value);else{r.value.updated_at=a.value.updated_at;let V=d.p_data.map(T=>T.id).indexOf(i);V>-1&&d.p_data.splice(V,1,{...r.value})}d.fnClose()},P=async()=>{c().loading_full=!0;const{data:l,error:t,status:i}=await D("/permission_group",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(c().loading_full=!1,i.value==="error"){A().trigger(t);return}r.value=l.value.data,d.is_copy&&(r.value.val=0,r.value.val1=0),l.value.data.details.forEach((a,f)=>{o.value=o.value.map(u=>(u.name==a.permission_list_name&&(u.checked=!0),u))}),l.value.data.users.forEach((a,f)=>{n.value=n.value.map(u=>(u.username==a.username&&(u.checked=!0),u))})},o=p([]),F=async()=>{c().loading_full=!0;const{data:l,error:t,status:i}=await D("/permission_lists",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{sort:"name:asc"},retry:0});if(c().loading_full=!1,i.value==="error"){A().trigger(t);return}o.value=l.value.data.map(a=>(a.checked=!1,a))},n=p([]),E=async()=>{c().loading_full=!0;const{data:l,error:t,status:i}=await D("/users",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{sort:"username:asc"},retry:0});if(c().loading_full=!1,i.value==="error"){A().trigger(t);return}n.value=l.value.data.map(a=>(a.checked=!1,a))},b=C(l=>o.value.filter(t=>t.checked)),M=l=>{b.value.length!=o.value.length?o.value=o.value.map(t=>(t.checked=!0,t)):o.value=o.value.map(t=>(t.checked=!1,t))},k=C(l=>n.value.filter(t=>t.checked)),O=l=>{k.value.length!=n.value.length?n.value=n.value.map(t=>(t.checked=!0,t)):n.value=n.value.map(t=>(t.checked=!1,t))},h=p(""),G=C(()=>h.value!=""?o.value.filter(l=>l.name.toLowerCase().includes(h.value.toLowerCase())):o.value),v=p(""),J=C(()=>v.value!=""?n.value.filter(l=>l.username.toLowerCase().includes(v.value.toLowerCase())):n.value);return R(()=>d.show,async(l,t)=>{l==!0&&(r.value={...S},o.value=[],await F(),await E(),d.id!=0&&await P())},{immediate:!0}),(l,t)=>{const i=H;return m((_(),w("section",X,[e("div",null,[Q(i,{title:"Form Permission Group",fn:y.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Y,[e("div",Z,[e("div",ee,[e("div",te,[ae,m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s(r).name=a)},null,512),[[j,s(r).name]]),e("p",le,g(s(U).name),1)])]),e("div",se,[e("div",oe,[e("div",re,[e("table",ne,[e("thead",null,[ue,e("tr",ie,[e("th",de,[e("button",{type:"button",name:"button",class:$(["text-xs",s(b).length!=s(o).length?"bg-green-500":"bg-red-500"]),onClick:t[1]||(t[1]=a=>M())},g(s(b).length!=s(o).length?"Allow":"Deny"),3)]),e("th",null,[e("div",ce,[m(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>z(h)?h.value=a:null),name:"search",placeholder:"Name"},null,512),[[j,s(h)]])])])])]),e("tbody",fe,[(_(!0),w(B,null,L(s(G),(a,f)=>(_(),w("tr",{key:f},[e("td",pe,[e("div",me,[m(e("input",{type:"checkbox","onUpdate:modelValue":u=>a.checked=u,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,he),[[N,a.checked]])])]),e("td",null,[e("div",ve,g(a.name),1)])]))),128))],512)])])]),e("div",_e,[e("div",we,[e("table",ge,[e("thead",null,[ye,e("tr",xe,[e("th",be,[e("button",{type:"button",name:"button",class:$(["text-xs",s(k).length!=s(n).length?"bg-green-500":"bg-red-500"]),onClick:t[3]||(t[3]=a=>O())},g(s(k).length!=s(n).length?"Allow":"Deny"),3)]),e("th",null,[e("div",ke,[m(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>z(v)?v.value=a:null),name:"search",placeholder:"Name"},null,512),[[j,s(v)]])])])])]),e("tbody",Ce,[(_(!0),w(B,null,L(s(J),(a,f)=>(_(),w("tr",{key:f},[e("td",Ae,[e("div",De,[m(e("input",{type:"checkbox","onUpdate:modelValue":u=>a.checked=u,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,Ue),[[N,a.checked]])])]),e("td",null,[e("div",je,g(a.username),1)])]))),128))],512)])])])])]),e("div",Se,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[5]||(t[5]=a=>y.fnClose())}," Cancel "),e("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[6]||(t[6]=W(a=>q(),["prevent"]))}," Save ")])])])],512)),[[I,y.show]])}}};export{Ne as default};
