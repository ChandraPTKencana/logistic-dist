import{_ as Z}from"./HeaderPopup.vue.d6f31a0e.js";import{_ as ee}from"./client-only.615b87d5.js";import{_ as te}from"./WidthMiniList.vue.3f5cd607.js";import{r as x,f as le,i as oe,G as S,j as N,I as ae,m as g,M as se,o as c,c as p,a as t,b as y,k as o,w as ne,C as re,t as r,q as O,v as K,F as B,y as D,l as A,x as ie,E as de,A as k,B as P}from"./entry.5e60e084.js";import{u as T}from"./useUtils.8f5554e5.js";import{u as $}from"./useMyFetch.6c881b2f.js";import"./Times.042464b5.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.6354185e.js";const _e={class:"box-fixed"},ue={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ce={class:"w-full flex flex-col items-center grow overflow-auto"},pe={class:"w-full flex flex-row flex-wrap"},ve={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},fe=t("label",{for:""},"U.Jalan Per",-1),me={key:0,class:"grow"},we={key:1,class:"grow"},he={class:"text-red-500"},xe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ge=t("label",{for:""},"Jenis",-1),ke=["disabled"],be=t("option",{value:"TBS"},"TBS",-1),ye=t("option",{value:"TBSK"},"TBSK",-1),Ce=t("option",{value:"CPO"},"CPO",-1),je=t("option",{value:"PK"},"PK",-1),Se=[be,ye,Ce,je],Ne={class:"text-red-500"},Be={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},De=t("label",{for:""},"No Pol",-1),Te=["disabled"],Ve={id:"vehicle"},Je=["value"],Oe={class:"text-red-500"},Ae={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Pe=t("label",{for:""},"Supir",-1),$e={class:"text-red-500"},Fe={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Me=t("label",{for:""},"Kernet",-1),Ue={class:"text-red-500"},qe={key:0,class:"w-full flex flex-wrap"},Ie={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ke=t("label",{for:""},"Tujuan",-1),Le=["disabled"],Ee={class:"text-red-500"},Ye={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},ze=t("label",{for:""},"Tipe",-1),Re=["disabled"],Ge=["value","selected"],He={class:"text-red-500"},We={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Qe=t("label",{for:""},"Total Dari U.Jalan",-1),Xe={class:"card-border disabled"},Ze={key:1,class:"w-full flex flex-wrap"},et={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},tt=t("label",{for:""},"Cost Center Code",-1),lt=["disabled"],ot={id:"cost_center"},at=["value"],st={class:"text-red-500"},nt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},rt=t("label",{for:""},"Cost Center Desc",-1),it={class:"card-border disabled"},dt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},_t=t("label",{for:""},"PVR No",-1),ut={class:"card-border disabled"},ct={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},pt=t("label",{for:""},"PVR Total",-1),vt={class:"card-border disabled"},ft={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},mt=t("label",{for:""},"PV",-1),wt={class:"card-border disabled"},ht={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},xt=t("label",{for:""},"PV Amount",-1),gt={class:"card-border disabled"},kt={class:"w-full flex items-center justify-end"},Vt={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const d=b,{$moment:F}=de(),{pointFormat:V}=T(),C={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:""};let w={...C};const e=x({...C}),J=le("token"),f=x({}),L=s=>{let l=s.target.value;if(!l){e.value.cost_center_code="",e.value.cost_center_desc="";return}d.list_cost_center.filter(a=>a.CostCenter==l).length==0&&(e.value.cost_center_code="112",e.value.cost_center_desc="Transport")},E=s=>{e.value.transition_target=s.target.value=="TBS"?e.value.transition_target:""};oe();const Y=async()=>{k().loading_full=!0,f.value={};const s=new FormData;s.append("tanggal",F(e.value.tanggal).format("Y-MM-DD")),s.append("jenis",e.value.jenis),s.append("id_uj",e.value.id_uj),s.append("xto",e.value.xto),s.append("cost_center_code",e.value.cost_center_code),s.append("online_status",d.online_status),s.append("transition_target",e.value.transition_target),s.append("no_pol",e.value.no_pol),s.append("supir_id",_.value.id),s.append("kernet_id",u.value.id);let l="post",i=d.id;i==0||(s.append("id",i),s.append("_method","PUT"));const{data:a,error:v,status:m}=await $("/trx_trp",{method:l,headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},body:s,retry:0});if(k().loading_full=!1,m.value==="error"){P().trigger(v,f);return}if(e.value.supir=_.value.name,e.value.supir_rek_no=_.value._.rek_no.val,e.value.supir_rek_name=_.value._.rek_name.val,e.value.kernet=u.value.name,e.value.kernet_rek_no=u.value._.rek_no.val,e.value.kernet_rek_name=u.value._.rek_name.val,e.value.updated_at=a.value.updated_at,d.id<=0)e.value.id=a.value.id,e.value.created_at=a.value.created_at,d.p_data.unshift(e.value);else{let n=d.p_data.map(X=>X.id).indexOf(d.id);n>=-1&&d.p_data.splice(n,1,{...e.value})}d.fnClose()},z=S(()=>{let s=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(j.value.filter(l=>l.jenis==s).map(l=>l.xto))]}),R=S(()=>{let s=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return j.value.filter(l=>l.xto==e.value.xto&&l.jenis==s)}),h={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},_=x(JSON.parse(JSON.stringify(h))),u=x(JSON.parse(JSON.stringify(h))),M=S(()=>{let s=[];return q.value.forEach((l,i)=>{let a=JSON.parse(JSON.stringify(h));a._.id.val=l.id,a._.name.val=l.name,a._.rek_no.val=l.rek_no,a._.rek_name.val=l.rek_name,a.id=l.id,a.name=l.name,a.title=(l.rek_no||"")+" "+(l.rek_name||""),a.note=G(l),a._raw=l,s.push(JSON.parse(JSON.stringify(a)))}),s}),G=s=>s.potongan?"Akan ada potong sebesar :"+T().pointFormat(s.potongan.nominal_cut):"",H=S(()=>!1),W=async()=>{k().loading_full=!0;const{data:s,error:l,status:i}=await $("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(k().loading_full=!1,i.value==="error"){P().trigger(l);return}let a=s.value.data;e.value=a,w={...a},_.value._.id.val=a.supir_id,_.value._.name.val=a.supir,_.value._.rek_no.val=a.supir_rek_no,_.value._.rek_name.val=a.supir_rek_name,_.value.id=a.supir_id,_.value.name=a.supir,_.value.rek_no=(a.supir_rek_no||"")+" "+(a.supir_rek_name||""),u.value._.id.val=a.kernet_id,u.value._.name.val=a.kernet,u.value._.rek_no.val=a.kernet_rek_no,u.value._.rek_name.val=a.kernet_rek_name,u.value.id=a.kernet_id,u.value.name=a.kernet,u.value.rek_no=(a.kernet_rek_no||"")+" "+(a.kernet_rek_name||"");let v=0,m=0;a.potongan.forEach(n=>{n.potongan_mst.employee_id==a.supir_id&&(v+=parseInt(n.nominal_cut)),n.potongan_mst.employee_id==a.kernet_id&&(m+=parseInt(n.nominal_cut))}),v>0&&(_.value.note="Telah di potong sebesar :"+T().pointFormat(v)),m>0&&(u.value.note="Telah di potong sebesar :"+T().pointFormat(m)),d.fnLoadDBData()},j=x([]),U=x([]),q=x([]),Q=async()=>{k().loading_full=!0;const{data:s,error:l,status:i}=await $("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${J.value}`,Accept:"application/json"},retry:0});if(k().loading_full=!1,i.value==="error"){P().trigger(l);return}j.value=s.value.list_ujalan,U.value=s.value.list_vehicle,q.value=s.value.list_employee};N(()=>d.show,async(s,l)=>{s==!0&&(await Q(),await d.fnLoadDBData(),e.value={...C},w={...C},_.value=JSON.parse(JSON.stringify(h)),u.value=JSON.parse(JSON.stringify(h)),f.value={},d.id!=0&&W())},{immediate:!0}),N(()=>e.value.cost_center_code,(s,l)=>{let i="";if(s==""||s){let a=d.list_cost_center.filter(v=>v.CostCenter==e.value.cost_center_code);a.length>0?i=a[0].Description:e.value.cost_center_code==w.cost_center_code&&(i=w.cost_center_desc),e.value.cost_center_desc=i}},{deep:!0,immediate:!0});const I=(s,l)=>{let i=0,a="";if(s==""||s){let v=j.value.filter(m=>m.id==e.value.id_uj);v.length>0?(i=v[0].harga,a=v[0].tipe):e.value.id_uj==w.id_uj&&(i=w.amount,a=w.tipe),e.value.tipe=a,e.value.amount=i}};return N(()=>e.value.xto,(s,l)=>{d.show&&I(s)},{deep:!0,immediate:!0}),N(()=>e.value.id_uj,(s,l)=>{d.show&&I(s)},{deep:!0,immediate:!0}),(s,l)=>{const i=Z,a=ae("vue-date-picker"),v=ee,m=te;return g((c(),p("section",_e,[t("div",null,[y(i,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",ue,[t("div",ce,[t("div",pe,[t("div",ve,[fe,o(e).val!==1?(c(),p("div",me,[y(v,null,{default:ne(()=>[y(a,{modelValue:o(e).tanggal,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(c(),p("div",we,[t("div",{class:re(["card-border disabled",o(e).pvr_no!=""?"unselectable":""])},r(o(e).tanggal?o(F)(o(e).tanggal).format("DD-MM-YYYY"):""),3)])),t("p",he,r(o(f).tanggal),1)]),t("div",xe,[ge,g(t("select",{"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).jenis=n),onChange:l[2]||(l[2]=n=>E(n)),disabled:o(e).val==1},Se,40,ke),[[O,o(e).jenis]]),t("p",Ne,r(o(f).jenis),1)]),t("div",Be,[De,g(t("input",{type:"text",list:"vehicle","onUpdate:modelValue":l[3]||(l[3]=n=>o(e).no_pol=n),disabled:o(e).val==1},null,8,Te),[[K,o(e).no_pol]]),t("datalist",Ve,[(c(!0),p(B,null,D(o(U),n=>(c(),p("option",{value:n.no_pol},r(n.no_pol),9,Je))),256))]),t("p",Oe,r(o(f).no_pol),1)]),t("div",Ae,[Pe,y(m,{arr:o(M),selected:o(_),pure:h,onSetSelected:l[4]||(l[4]=n=>_.value=n),disabled:o(w).supir_id>1},null,8,["arr","selected","disabled"]),t("p",$e,r(o(f).supir_id),1)]),t("div",Fe,[Me,y(m,{arr:o(M),selected:o(u),pure:h,onSetSelected:l[5]||(l[5]=n=>u.value=n),disabled:o(w).kernet_id>1},null,8,["arr","selected","disabled"]),t("p",Ue,r(o(f).kernet_id),1)]),o(e).jenis!=""?(c(),p("div",qe,[t("div",Ie,[Ke,g(t("select",{"onUpdate:modelValue":l[6]||(l[6]=n=>o(e).xto=n),disabled:o(e).val==1},[(c(!0),p(B,null,D(o(z),n=>(c(),p("option",null,r(n),1))),256))],8,Le),[[O,o(e).xto]]),t("p",Ee,r(o(f).xto),1)]),t("div",Ye,[ze,g(t("select",{"onUpdate:modelValue":l[7]||(l[7]=n=>o(e).id_uj=n),disabled:o(e).val==1},[(c(!0),p(B,null,D(o(R),n=>(c(),p("option",{value:n.id,selected:n.id==o(e).id_uj},r(n.tipe),9,Ge))),256))],8,Re),[[O,o(e).id_uj]]),t("p",He,r(o(f).id_uj),1)]),t("div",We,[Qe,t("div",Xe,r(o(V)(o(e).amount)),1)])])):A("",!0),o(e).jenis!=""?(c(),p("div",Ze,[t("div",et,[tt,g(t("input",{list:"cost_center","onUpdate:modelValue":l[8]||(l[8]=n=>o(e).cost_center_code=n),onBlur:l[9]||(l[9]=n=>L(n)),disabled:o(e).pvr_no!=""},null,40,lt),[[K,o(e).cost_center_code]]),t("datalist",ot,[(c(!0),p(B,null,D(b.list_cost_center,n=>(c(),p("option",{value:n.CostCenter},r(n.CostCenter+"-"+n.Description),9,at))),256))]),t("p",st,r(o(f).cost_center_code),1)]),t("div",nt,[rt,t("div",it,r(o(e).cost_center_desc),1)]),t("div",dt,[_t,t("div",ut,r(o(e).pvr_no),1)]),t("div",ct,[pt,t("div",vt,r(o(V)(o(e).pvr_total||0)),1)]),t("div",ft,[mt,t("div",wt,r(o(e).pv_no),1)]),t("div",ht,[xt,t("div",gt,r(o(V)(o(e).pv_total)),1)])])):A("",!0)])]),t("div",kt,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[10]||(l[10]=n=>b.fnClose())}," Cancel "),o(H)?A("",!0):(c(),p("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[11]||(l[11]=ie(n=>Y(),["prevent"]))}," Save "))])])])],512)),[[se,b.show]])}}};export{Vt as default};
