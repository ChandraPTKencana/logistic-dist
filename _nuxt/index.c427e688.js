import Me from"./Header.aa91d143.js";import qe from"./Copy.18fb0eaf.js";import je from"./Plus.9ef761e0.js";import Be from"./Edit.a2902b16.js";import Fe from"./Eyes.e9b5b753.js";import Ee from"./Delete.a9a612af.js";import Ne from"./Signature.cc950431.js";import Ye from"./PrinterEye.f3ecf078.js";import Ie from"./Line.55942fce.js";import He from"./Check.c8e392ea.js";import Re from"./TableView.cceed316.js";import{_ as Ve}from"./PopupMini.vue.3aa091a0.js";import ze from"./extra_money.5e1dce99.js";import Ue from"./extra_money_validasi.fe1b6e80.js";import{r,j as X,f as Je,g as Le,G as x,i as ee,s as Ke,A as u,c as b,b as d,a as c,m as te,q as Ge,k as l,n as ae,l as k,w as O,z as Qe,B as M,o as _,D as q,d as H,t as le,v as Ze,E as We}from"./entry.25e4ac22.js";import{u as p}from"./useUtils.786a5149.js";import{u as j}from"./useMyFetch.0dee4895.js";import{u as Xe}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.56cbb31f.js";import"./Adjust.95c076d7.js";import"./TableHeaderEye.28d1d763.js";import"./Times.87d2be07.js";import"./ClearAll.a89995bf.js";import"./client-only.b97ccef2.js";import"./ClearEach.02e6ce5e.js";import"./CaretLeftDoubleBold.9f501833.js";import"./CaretLeftBold.fe374c22.js";import"./CaretRightBold.783ac586.js";import"./CaretRightDoubleBold.e7a54877.js";import"./Exclamation.dd98ee48.js";import"./HeaderPopup.vue.396fcac1.js";import"./WidthMiniList.vue.da54010c.js";import"./WidthMiniPart.vue.48372383.js";import"./InputPointFormat.vue.5d341f25.js";const et={class:"w-full h-full flex flex-col"},tt={class:"w-full flex grow flex-col overflow-auto h-0"},at={class:"w-full flex justify-between flex-wrap"},lt={class:"grow flex"},ot={class:"m-1"},nt=c("option",{value:"available"},"Available",-1),st=c("option",{value:"unapprove"},"Unapprove",-1),rt=c("option",{value:"deleted"},"Trash",-1),it=c("option",{value:"all"},"All",-1),ut=[nt,st,rt,it],dt={class:"grow mb-5"},Lt={__name:"index",async setup(_t){let A,R;const{$moment:V}=We(),{pointFormat:oe}=p(),z=t=>t.deleted==1?"!bg-red-400":t.pv_id>0?"!bg-blue-300":"",B=t=>(t.map(e=>{e.class_h=z(e)}),t),y=r("available");X(()=>y.value,t=>{G.value.map(e=>{let m=["deleted_by_username","deleted_at","deleted_reason"].indexOf(e.key)>-1;return["all","deleted"].indexOf(t)>-1?m&&(e.tbl_show=1):m&&(e.tbl_show=0),e}),L()},{immediate:!1});const i={};i._TimeZoneOffset=new Date().getTimezoneOffset(),i.sort="tanggal:desc";const U=r({}),$=r({from:"",to:""}),C=Je("token"),{data:ne}=([A,R]=Le(async()=>Qe(async()=>{u().loading_full=!0;let t=[];const[e,m]=await Promise.all([j("/extra_moneys",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return e.status.value!=="error"&&(t=B(e.data.value.data)),e.status.value==="error"?(M().trigger(e.error),{extra_moneys:t}):(u().loading_full=!1,{extra_moneys:t})},"$pjdlE6mDqg")),A=await A,R(),A),n=r(ne.value.extra_moneys||[]),F=r({field:"tanggal",by:"desc"}),a=r(-1),s=x(()=>n.value[a.value]),f=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),se=()=>{i.like="";let t=JSON.parse(JSON.stringify(u()._tv.global_keyword));t!=""&&(i.like=`id:%${t}%,transition_target:%${t}%,transition_type:%${t}%,extra_money_name:%${t}%,extra_money_type:%${t}%,xto:%${t}%,transition_target:%${t}%`),i.sort="",F.value.field&&(i.sort=F.value.field+":"+F.value.by),i.date_from=$.value.from?V($.value.from).format("YYYY-MM-DD"):"",i.date_to=$.value.to?V($.value.to).format("YYYY-MM-DD"):"",i.filter_model=JSON.stringify(u()._tv.filter_model)},J=async()=>{u().loading_full=!0,U.value={},f.value.may_get_data=!1,i.page=f.value.page,i.page==1&&(n.value=[]),i.first_row&&delete i.first_row,i.page>1&&(i.first_row=JSON.stringify(n.value[0])),i.filter_status=y.value;const{data:t,error:e,status:m}=await j("/extra_moneys",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:i,retry:0});if(u().loading_full=!1,f.value.may_get_data=!0,m.value==="error"){M().trigger(e,U);return}f.value.page==1?n.value=B(t.value.data):f.value.page>1&&(n.value=[...n.value,...B(t.value.data)]),t.value.data.length==0&&(f.value.is_last_record=!0),u()._tv.filter_box=!1},L=()=>{a.value=-1,f.value.page=1,f.value.is_last_record=!1,se(),J()},w=r(!1),P=r(0),S=r(0),re=()=>{P.value=0,w.value=!0,S.value=!1},{display:g}=ee();Ke(ee());const ie=()=>{a.value==-1?g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value=n.value[a.value].id,w.value=!0,S.value=!1)},ue=()=>{a.value==-1?g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value=n.value[a.value].id,w.value=!0,S.value=!0)},T=r(!1),E=r(0),N=r(!1),de=()=>{a.value==-1?g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(E.value=n.value[a.value].id,T.value=!0,N.value=!1)},_e=()=>{a.value==-1?g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(E.value=n.value[a.value].id,T.value=!0,N.value=!0)},Y=r(!1),K=r({}),D=r(!1),h=r(""),me=async()=>{D.value&&(D.value=!1)},ce=()=>{a.value==-1?g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(h.value="",K.value={id:n.value[a.value].id,tujuan:n.value[a.value].xto},D.value=!0)};X(()=>h.value,t=>{t.trim().length>0?Y.value=!0:Y.value=!1},{immediate:!1});const fe=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",h.value),t.append("_method","DELETE");const{data:e,error:m,status:I}=await j("/extra_money",{method:"post",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,I.value==="error"){M().trigger(m);return}let v={...n.value[a.value]};v.deleted=e.value.deleted,v.deleted_user=e.value.deleted_user,v.deleted_at=e.value.deleted_at,v.deleted_by=e.value.deleted_by,v.deleted_reason=e.value.deleted_reason,v.class_h=z(v),y.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...v}),a.value=-1,D.value=!1},{printHtml:ve}=Xe(),pe=async()=>{if(a.value==-1){g({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}u().loading_full=!0;const{data:t,error:e,status:m}=await j("/extra_money_preview_file",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{id:n.value[a.value].id},retry:0});if(u().loading_full=!1,m.value==="error"){M().trigger(e);return}ve(t.value.html,318)},G=r([{key:"no",label:"No",isai:!0},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"transition_target",label:"Pengalihan",filter_on:1,type:"select",select_item:u().list_pabrik},{key:"transition_type",label:"Tipe Pengalihan",type:"select",select_item:[{k:"From",v:"Dari"},{k:"To",v:"Ke"}]},{key:"ac_account",label:"Account",childs:[{key:"ac_account_id",label:"Account ID",filter_on:1,type:"string"},{key:"ac_account_code",label:"Account Code",filter_on:1,type:"string"},{key:"ac_account_name",label:"Account Name",filter_on:1,type:"string"}]},{key:"description",label:"Deskripsi",filter_on:1,type:"string"},{key:"qty",label:"Qty",class:" justify-end",type:"number"},{key:"nominal",label:"Nominal",class:" justify-end",type:"number"},{key:"qn_total",label:"Total",class:" justify-end",type:"number"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ye=x(()=>a.value>-1&&[void 0,0].indexOf(s.value.deleted)>-1&&[void 0,0].indexOf(s.value.req_deleted)>-1&&p().checkPermission("extra_money.create")),be=x(()=>["available","all"].indexOf(y.value)>-1&&p().checkPermission("extra_money.create")),xe=x(()=>a.value>-1&&[void 0,0].indexOf(s.value.deleted)>-1&&[void 0,0].indexOf(s.value.req_deleted)>-1&&[void 0,0].indexOf(s.value.val)>-1&&[void 0,""].indexOf(s.value.pvr_id)>-1&&p().checkPermission("extra_money.modify")),ke=x(()=>a.value>-1&&[void 0,0].indexOf(s.value.deleted)>-1&&[void 0,0].indexOf(s.value.req_deleted)>-1&&([void 0,""].indexOf(s.value.pvr_id)>-1&&(p().checkPermission("extra_money.val")&&[void 0,0].indexOf(s.value.val)>-1||p().checkPermission("extra_money.val1")&&[void 0,0].indexOf(s.value.val1)>-1)||s.value.pvr_id>-1&&p().checkPermission("extra_money.val2")&&[void 0,0].indexOf(s.value.val2)>-1)),ge=x(()=>p().checkPermission("extra_money.remove")&&a.value>-1&&[void 0,0].indexOf(s.value.deleted)>-1&&[void 0,0].indexOf(s.value.req_deleted)>-1&&[void 0,""].indexOf(s.value.pvr_id)>-1),he=x(()=>p().checkPermission("extra_money.preview_file")&&a.value>-1&&[void 0,0].indexOf(s.value.deleted)>-1&&[void 0,0].indexOf(s.value.req_deleted)>-1&&s.value.val==1);return(t,e)=>{const m=Me,I=qe,v=je,we=Be,De=Fe,Oe=Ee,Ae=Ne,$e=Ye,Q=Ie,Z=He,Ce=Re,Pe=Ve,Se=ze,Te=Ue;return _(),b("div",et,[d(m,{title:"List Transaction"}),c("div",tt,[c("div",at,[c("div",lt,[c("div",ot,[te(c("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>ae(y)?y.value=o:null)},ut,512),[[Ge,l(y)]])]),l(ye)?(_(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>ue())},[d(I)])):k("",!0),l(be)?(_(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>re())},[d(v)])):k("",!0),l(xe)?(_(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>ie())},[d(we)])):k("",!0),l(a)>-1?(_(),b("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>_e())},[d(De)])):k("",!0),l(ge)?(_(),b("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>ce())},[d(Oe)])):k("",!0),l(ke)?(_(),b("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>de())},[d(Ae)])):k("",!0),l(he)?(_(),b("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>pe())},[d($e)])):k("",!0)])]),d(Ce,{thead:l(G),selected:l(a),onSetSelected:e[8]||(e[8]=o=>a.value=o),tbody:l(n),fnCallData:J,scrolling:l(f),onSetScrollingPage:e[9]||(e[9]=o=>l(f).page=o),onDoFilter:e[10]||(e[10]=o=>L())},{val1:O(({item:o})=>[o.val1?(_(),q(Z,{key:1})):(_(),q(Q,{key:0}))]),val2:O(({item:o})=>[o.val2?(_(),q(Z,{key:1})):(_(),q(Q,{key:0}))]),qn_total:O(({item:o})=>[H(" Rp. "+le(l(oe)(parseFloat(o.total)||0)),1)]),deleted_by_username:O(({item:o})=>{var W;return[H(le((W=o.deleted_by)==null?void 0:W.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),d(Pe,{type:"delete",show:l(D),data:l(K),fnClose:me,fnConfirm:fe,enabledOk:l(Y)},{footer:O(()=>[H(" Masukkan Alasan Penghapusan: "),c("div",dt,[te(c("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>ae(h)?h.value=o:null)},null,512),[[Ze,l(h)]])])]),_:1},8,["show","data","enabledOk"]),d(Se,{show:l(w),fnClose:()=>{w.value=!1},id:l(P),p_data:l(n),is_copy:l(S)},null,8,["show","fnClose","id","p_data","is_copy"]),d(Te,{show:l(T),fnClose:()=>{T.value=!1},id:l(E),p_data:l(n),is_view:l(N)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{Lt as default};
