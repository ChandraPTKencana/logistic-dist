import je from"./Header.3b7de3c0.js";import Oe from"./Edit.a3f584b7.js";import Ve from"./Eyes.d3098282.js";import Ye from"./Void.d1e26b0c.js";import He from"./Signature.c40dfa32.js";import Fe from"./Cog.3c24f3c5.js";import Ie from"./Image.47606aef.js";import Ue from"./Line.2062a520.js";import ze from"./Check.97a7a142.js";import Ee from"./TableView.f59b74e3.js";import{_ as Re}from"./PopupMini.vue.cbdf9118.js";import Le from"./trx_trp_ticket.4f6143f0.js";import Je from"./trx_trp_ticket_validasi.b61dc4e2.js";import Ke from"./trx_absen.14233d05.js";import Ge from"./Times.e420182d.js";import{_ as Xe}from"./client-only.47e2a1a9.js";import{r as _,j as Ze,f as Qe,g as We,G as B,h as et,i as _e,s as tt,A as c,I as at,c as D,b as p,a as r,m as lt,q as ot,k as s,n as st,l as $,d as N,C as nt,t as G,w as g,z as rt,B as T,o as f,D as C,H as it,E as _t}from"./entry.90f7e7d0.js";import{u as M}from"./useMyFetch.ffe077f5.js";import{u as H}from"./useUtils.607571cd.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.0fbb0fe2.js";import"./Adjust.020c3622.js";import"./TableHeaderEye.39686e97.js";import"./ClearAll.20db9eba.js";import"./ClearEach.3e5f3ae8.js";import"./CaretLeftDoubleBold.c67adb43.js";import"./CaretLeftBold.17750da4.js";import"./CaretRightBold.5fa41feb.js";import"./CaretRightDoubleBold.6832109d.js";import"./Exclamation.8794f90f.js";import"./HeaderPopup.vue.2b313006.js";import"./InputPointFormat.vue.dade0de4.js";const ut={class:"w-full h-full flex flex-col"},dt={class:"w-full flex grow flex-col overflow-auto h-0"},ct={class:"w-full flex justify-between flex-wrap"},pt={class:"grow flex"},mt={class:"m-1"},ft=it('<option value="ticket_not_done">Undone</option><option value="ticket_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),vt=[ft],kt={class:"flex"},bt=r("span",{class:"text-xs"},"Mode",-1),yt=r("b",null,"tidak dapat dibatalkan lagi",-1),gt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},xt={class:"relative",style:{width:"95%",height:"90%"}},ht={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},wt={class:"w-full h-full flex flex-col items-center justify-content-center bg-white"},Dt={class:"w-full p-1"},$t={class:"w-full p-1 bg-gray-200"},Ct=r("div",{class:"w-full text-blue-600 font-bold"}," Set Date For Load Data ",-1),At={class:"w-full grid grid-cols-2 grid-rows-1 gap-1"},Tt={class:"flex flex-col flex-wrap p-1"},Mt=r("label",{for:""},"From",-1),St={class:"grow"},qt={class:"flex flex-col flex-wrap p-1"},Bt=r("label",{for:""},"To",-1),Nt={class:"grow"},ma={__name:"ticket",async setup(Pt){let P,X;const{$moment:j}=_t(),Z=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":["CPO","PK"].indexOf(e.jenis)>-1&&e.ticket_a_id!=""&&e.ticket_b_bruto!=""&&e.ticket_b_tara!=""&&e.ticket_b_netto!=""&&e.ticket_b_in_at!=""&&e.ticket_b_out_at!=""||e.jenis=="TBS"&&e.ticket_a_id!=""&&e.ticket_b_id!=""||e.jenis=="TBSK"&&e.ticket_b_id!=""?"!bg-blue-300":"",F=e=>(e.map(t=>{t.class_h=Z(t)}),e),x=_("ticket_not_done");Ze(()=>x.value,e=>{ne.value.map(t=>{let m=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?m&&(t.tbl_show=1):m&&(t.tbl_show=0),t}),te()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const Q=_({}),O=_({from:"",to:""}),A=Qe("token"),{data:ue}=([P,X]=We(async()=>rt(async()=>{c().loading_full=!0;let e=[];const[t,m]=await Promise.all([M("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{filter_status:x},retry:0})]);return t.status.value!=="error"&&(e=F(t.data.value.data)),t.status.value==="error"?(T().trigger(t.error),{trx_trps:e}):(c().loading_full=!1,{trx_trps:e})},"$X4xCu6yBOs")),P=await P,X(),P),n=_(ue.value.trx_trps||[]),W=_([]),h=_(!1),de=async(e,t="")=>{c().loading_full=!0;let m=d.value.from?j(d.value.from).format("Y-MM-DD"):"",y=d.value.to?j(d.value.to).format("Y-MM-DD"):"";const{data:a,error:v,status:o}=await M("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{jenis:e,online_status:h.value,from:m,to:y,transition_target:t},retry:0});if(c().loading_full=!1,o.value==="error"){T().trigger(v);return}W.value=a.value.list_ticket},I=_({field:"tanggal",by:"desc"}),i=_(-1),b=B(()=>n.value[i.value]),k=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ce=()=>{u.like="";let e=JSON.parse(JSON.stringify(c()._tv.global_keyword));e!=""&&(u.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),u.sort="",I.value.field&&(u.sort=I.value.field+":"+I.value.by),u.date_from=O.value.from?j(O.value.from).format("YYYY-MM-DD"):"",u.date_to=O.value.to?j(O.value.to).format("YYYY-MM-DD"):"",u.filter_model=JSON.stringify(c()._tv.filter_model)},ee=async()=>{c().loading_full=!0,Q.value={},k.value.may_get_data=!1,u.page=k.value.page,u.page==1&&(n.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(n.value[0])),u.filter_status=x.value;const{data:e,error:t,status:m}=await M("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:u,retry:0});if(c().loading_full=!1,k.value.may_get_data=!0,m.value==="error"){T().trigger(t,Q);return}k.value.page==1?n.value=F(e.value.data):k.value.page>1&&(n.value=[...n.value,...F(e.value.data)]),e.value.data.length==0&&(k.value.is_last_record=!0),c()._tv.filter_box=!1},te=()=>{i.value=-1,k.value.page=1,k.value.is_last_record=!1,ce(),ee()};et();const U=_(!1),ae=_(0),{display:S}=_e();tt(_e());const pe=()=>{i.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(ae.value=n.value[i.value].id,U.value=!0)},V=_(!1),z=_(0),E=_(!1),me=()=>{i.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(z.value=n.value[i.value].id,V.value=!0,E.value=!1)},fe=()=>{i.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(z.value=n.value[i.value].id,V.value=!0,E.value=!0)},R=_(!1),le=_(0),ve=e=>{le.value=e,R.value=!0},oe=_({}),q=_(!1),ke=_(""),be=async()=>{q.value&&(q.value=!1)},ye=()=>{var e;i.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(ke.value="",oe.value={id:n.value[i.value].id,"no pol":n.value[i.value].no_pol,tujuan:n.value[i.value].xto,permintaan:(e=n.value[i.value].req_deleted_by)==null?void 0:e.username,alasan:n.value[i.value].req_deleted_reason},q.value=!0)},ge=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",n.value[i.value].id),e.append("_method","DELETE");const{data:t,error:m,status:y}=await M("/trx_trp_approve_req_delete",{method:"post",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){T().trigger(m);return}let a={...n.value[i.value]};a.deleted=t.value.deleted,a.deleted_user=t.value.deleted_user,a.deleted_at=t.value.deleted_at,a.deleted_by=t.value.deleted_by,a.deleted_reason=t.value.deleted_reason,a.class_h=Z(a),x.value!="all"?n.value.splice(i.value,1):n.value.splice(i.value,1,{...a}),i.value=-1,q.value=!1},xe=async()=>{c().loading_full=!0;const e=new FormData;e.append("ids",JSON.stringify(L.value)),e.append("_method","PUT");const{data:t,error:m,status:y}=await M("/trx_trp_val_tickets",{method:"post",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){T().trigger(m);return}t.value.val_lists.forEach(a=>{let v=n.value.map(o=>o.id).indexOf(a.id);if(v>-1){let o=n.value[v];o.val_ticket=a.val_ticket,o.val_ticket_by=a.val_ticket_by,o.val_ticket_at=a.val_ticket_at,n.value.splice(v,1,{...o})}})},Y=_(!1),d=_({from:new Date().setDate(new Date().getDate()-3),to:new Date}),se=e=>{e=="from"?d.value.from-d.value.to>0&&(d.value.from=d.value.to):d.value.to-d.value.from<0&&(d.value.to=d.value.from)},he=async()=>{c().loading_full=!0;const e=new FormData;e.append("online_status",h.value);const{data:t,error:m,status:y}=await M("/trx_trp_do_update_ticket",{method:"post",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){T().trigger(m);return}t.value.data.forEach(a=>{let v=n.value.map(o=>o.id).indexOf(a.id);if(v!==-1){let o=n.value[v];o.ticket_a_id=a.ticket_a_id,o.ticket_a_no=a.ticket_a_no,o.ticket_a_bruto=a.ticket_a_bruto,o.ticket_a_tara=a.ticket_a_tara,o.ticket_a_netto=a.ticket_a_netto,o.ticket_a_supir=a.ticket_a_supir,o.ticket_a_no_pol=a.ticket_a_no_pol,o.ticket_a_in_at=a.ticket_a_in_at,o.ticket_a_out_at=a.ticket_a_out_at,o.ticket_b_id=a.ticket_b_id,o.ticket_b_no=a.ticket_b_no,o.ticket_b_bruto=a.ticket_b_bruto,o.ticket_b_tara=a.ticket_b_tara,o.ticket_b_netto=a.ticket_b_netto,o.ticket_b_supir=a.ticket_b_supir,o.ticket_b_no_pol=a.ticket_b_no_pol,o.ticket_b_in_at=a.ticket_b_in_at,o.ticket_b_out_at=a.ticket_b_out_at,o.updated_at=a.updated_at,n.value.splice(v,1,{...o})}}),S({show:!0,status:"Success",message:"Update PV Done"})},L=_([]),ne=_([{key:"cb",label:"",checkbox:"id"},{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val_ticket",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:c().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),we=B(()=>i.value>-1&&H().checkPermission("trp_trx.ticket.view")),De=B(()=>i.value>-1&&b.value.deleted==0&&b.value.req_deleted==0&&b.value.val_ticket==0&&H().checkPermission("trp_trx.ticket.modify")),$e=B(()=>i.value>-1&&b.value.deleted==0&&b.value.req_deleted==0&&b.value.val_ticket==0&&H().checkPermission("trp_trx.ticket.val_ticket")),Ce=B(()=>i.value>-1&&b.value.deleted==0&&b.value.req_deleted==1&&b.value.val_ticket==0&&H().checkPermission("trp_trx.approve_request_remove"));return(e,t)=>{const m=je,y=Oe,a=Ve,v=Ye,o=He,Ae=Fe,Te=Ie,J=Ue,K=ze,Me=Ee,Se=Re,qe=Le,Be=Je,Ne=Ke,Pe=Ge,re=at("vue-date-picker"),ie=Xe;return f(),D("div",ut,[p(m,{title:"List Transaction"}),r("div",dt,[r("div",ct,[r("div",pt,[r("div",mt,[lt(r("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=l=>st(x)?x.value=l:null)},vt,512),[[ot,s(x)]])]),s(De)?(f(),D("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=l=>pe())},[p(y)])):$("",!0),s(we)?(f(),D("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=l=>fe())},[p(a)])):$("",!0),s(Ce)?(f(),D("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=l=>ye())},[p(v)])):$("",!0),s($e)?(f(),D("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=l=>me())},[p(o)])):$("",!0)]),r("div",kt,[s(L).length>0?(f(),D("button",{key:0,type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[5]||(t[5]=l=>xe())}," Multi Val ")):$("",!0),r("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[6]||(t[6]=l=>Y.value=!0)},[p(Ae)]),r("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[7]||(t[7]=l=>he())}," Update Ticket "),r("div",{class:"m-1 card-border cursor-pointer",onClick:t[8]||(t[8]=l=>h.value=!s(h))},[bt,N(" : "),r("span",{class:nt(["font-bold",s(h)?"text-green-600":"text-red-600"])},G(s(h)?"ONLINE":"OFFLINE"),3)])])]),p(Me,{thead:s(ne),selected:s(i),onSetSelected:t[9]||(t[9]=l=>i.value=l),tbody:s(n),fnCallData:ee,scrolling:s(k),onSetScrollingPage:t[10]||(t[10]=l=>s(k).page=l),onDoFilter:t[11]||(t[11]=l=>te()),onSetCheckbox:t[12]||(t[12]=l=>L.value=l)},{absen:g(({item:l,index:w})=>[l.trx_absens&&l.trx_absens.length>0?(f(),C(Te,{key:0,class:"cursor-pointer",onClick:jt=>ve(w)},null,8,["onClick"])):$("",!0)]),val:g(({item:l})=>[l.val?(f(),C(K,{key:1})):(f(),C(J,{key:0}))]),val1:g(({item:l})=>[l.val1?(f(),C(K,{key:1})):(f(),C(J,{key:0}))]),val_ticket:g(({item:l})=>[l.val_ticket?(f(),C(K,{key:1})):(f(),C(J,{key:0}))]),deleted_by_username:g(({item:l})=>{var w;return[N(G((w=l.deleted_by)==null?void 0:w.username),1)]}),req_deleted_by_username:g(({item:l})=>{var w;return[N(G((w=l.req_deleted_by)==null?void 0:w.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),p(Se,{type:"custome",show:s(q),data:s(oe),fnClose:be,fnConfirm:ge},{words:g(()=>[N(" Data akan diproses dan "),yt,N(", apakah Anda menyetujui permintaan penghapusan data berikut? ")]),_:1},8,["show","data"]),p(qe,{show:s(U),fnClose:()=>{U.value=!1},fnLoadDBData:de,id:s(ae),p_data:s(n),list_ticket:s(W),online_status:s(h)},null,8,["show","fnClose","id","p_data","list_ticket","online_status"]),p(Be,{show:s(V),fnClose:()=>{V.value=!1},id:s(z),p_data:s(n),is_view:s(E)},null,8,["show","fnClose","id","p_data","is_view"]),p(Ne,{show:s(R),fnClose:()=>{R.value=!1},index:s(le),p_data:s(n)},null,8,["show","fnClose","index","p_data"]),s(Y)?(f(),D("div",gt,[r("div",xt,[r("div",ht,[p(Pe,{style:{color:"black",cursor:"pointer"},onClick:t[13]||(t[13]=l=>Y.value=!1)})]),r("div",wt,[r("div",Dt,[r("div",$t,[Ct,r("div",At,[r("div",Tt,[Mt,r("div",St,[p(ie,null,{default:g(()=>[p(re,{modelValue:s(d).from,"onUpdate:modelValue":t[14]||(t[14]=l=>s(d).from=l),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[15]||(t[15]=l=>se("from"))},null,8,["modelValue"])]),_:1})])]),r("div",qt,[Bt,r("div",Nt,[p(ie,null,{default:g(()=>[p(re,{modelValue:s(d).to,"onUpdate:modelValue":t[16]||(t[16]=l=>s(d).to=l),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[17]||(t[17]=l=>se("to"))},null,8,["modelValue"])]),_:1})])])])])])]),r("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[18]||(t[18]=l=>Y.value=!1)})])])):$("",!0)])}}};export{ma as default};
