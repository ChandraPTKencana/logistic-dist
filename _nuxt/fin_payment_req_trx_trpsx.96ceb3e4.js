import{_ as D}from"./HeaderPopup.vue.1bf79ead.js";import{r as _,g as N,j as B,f as z,k as O,L as P,o as m,c as v,a as e,b as T,F as V,E,t as r,l as f,D as L,x as p,y as k}from"./entry.050cce63.js";import{u as R}from"./useUtils.dfb08e84.js";import{u as q}from"./useMyFetch.2cc780a9.js";import"./Times.2788dd5e.js";import"./_plugin-vue_export-helper.c27b6911.js";const U={class:"box-fixed"},M={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto p-2 bg-white"},G={class:"w-full flex flex-col items-center grow overflow-auto"},H={class:"w-full",role:"sticky"},I={class:"tacky",style:{"white-space":"normal"}},J=e("tr",{class:"sticky top-0 !z-[2]"},[e("td",{colspan:8,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),K={class:"sticky top-7 !z-[2]"},Q={rowspan:"2",class:"min-w-[50px] !w-[50px] max-w-[50px]"},W=e("th",{rowspan:"2",class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),X=e("th",{colspan:"2"},"Transaction",-1),Y=e("th",{colspan:"2"},"PVR",-1),Z=e("th",{colspan:"2"},"PV",-1),ee=e("tr",{class:"sticky top-[60px] !z-[2]"},[e("th",null,"ID"),e("th",null,"Amount"),e("th",null,"No"),e("th",null,"Amount"),e("th",null,"No"),e("th",null,"Amount")],-1),te={ref:"to_move"},se=["data-index"],le={class:"tools cell"},oe={class:"w-full h-full flex items-center justify-center"},ae=["checked","onClick"],ne={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},ie={class:"w-full h-full flex items-center justify-center"},re={class:"cell"},ce={class:"w-full h-full flex items-center justify-center"},ue={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},de={class:"w-full h-full flex items-center justify-center"},_e={class:"cell"},fe={class:"w-full h-full flex items-center justify-center"},pe={class:"cell"},he={class:"w-full h-full flex items-center justify-center"},me={class:"cell"},ve={class:"w-full h-full flex items-center justify-center unselectable"},xe={class:"w-full flex items-center justify-end"},Ce={__name:"fin_payment_req_trx_trpsx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(u){const n=u,{pointFormat:h}=R(),x={id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]},i=_({...x}),y=N("token"),w=_({});B();const C=async()=>{p().loading_full=!0,w.value={};const s=new FormData;s.append("details",JSON.stringify(a.value));let l="post",o=n.is_copy?0:n.id;o==0||(s.append("id",o),s.append("_method","PUT"));const{data:t,error:c,status:g}=await q("/fin_payment_req",{method:l,headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},body:s,retry:0});if(p().loading_full=!1,g.value==="error"){k().trigger(c,w);return}if(o<=0)i.value.id=t.value.id,i.value.created_at=t.value.created_at,i.value.updated_at=t.value.updated_at,n.p_data.unshift(i.value);else{i.value.updated_at=t.value.updated_at;let b=n.p_data.map($=>$.id).indexOf(o);b>-1&&n.p_data.splice(b,1,{...i.value})}n.fnClose()},a=_([]),j=s=>a.value.map(o=>o.id).indexOf(s.id)!==-1,A=s=>{const l=a.value.map(o=>o.id).indexOf(s.id);l===-1?a.value.push(s):a.value.splice(l,1)},F=s=>{a.value.length<d.value.length?a.value=[...d.value]:a.value=[]},d=_([]),S=async()=>{p().loading_full=!0;const{data:s,error:l,status:o}=await q("/fin_payment_req/get_trx_trp_unprocessed",{method:"get",headers:{Authorization:`Bearer ${y.value}`,Accept:"application/json"},params:{},retry:0});if(p().loading_full=!1,o.value==="error"){k().trigger(l);return}d.value=s.value.data};return z(()=>n.show,async(s,l)=>{s==!0&&(await S(),i.value={...x},a.value=[])},{immediate:!0}),(s,l)=>{const o=D;return O((m(),v("section",U,[e("div",null,[T(o,{title:"Form fin_payment_req",fn:u.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",M,[e("div",G,[e("div",H,[e("table",I,[e("thead",null,[J,e("tr",K,[e("th",Q,[e("button",{type:"button",name:"button",class:"bg-yellow-600",onClick:l[0]||(l[0]=t=>F())}," U/Ch ")]),W,X,Y,Z]),ee]),e("tbody",te,[(m(!0),v(V,null,E(f(d),(t,c)=>(m(),v("tr",{key:c,"data-index":c},[e("td",le,[e("div",oe,[e("input",{type:"checkbox",checked:j(t),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer",onClick:g=>A(t)},null,8,ae)])]),e("td",null,r(c+1)+".",1),e("td",ne,[e("div",ie,r(t.id),1)]),e("td",re,[e("div",ce,r(f(h)(t.amount||0)),1)]),e("td",ue,[e("div",de,r(t.pvr_no),1)]),e("td",_e,[e("div",fe,r(f(h)(t.pvr_total||0)),1)]),e("td",pe,[e("div",he,r(t.pv_no),1)]),e("td",me,[e("div",ve,r(f(h)(t.pv_total||0)),1)])],8,se))),128))],512)])])]),e("div",xe,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[1]||(l[1]=t=>u.fnClose())}," Cancel "),e("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[2]||(l[2]=L(t=>C(),["prevent"]))}," Generate Request ")])])])],512)),[[P,u.show]])}}};export{Ce as default};
