import{_ as te}from"./HeaderPopup.vue.f6f6cf51.js";import{_ as ae}from"./client-only.1eecdd48.js";import{_ as le}from"./WidthMiniList.vue.7a254590.js";import{r as w,g as oe,i as B,f as L,I as se,k as N,J as V,o as c,c as v,a as s,b as x,l,w as ne,E as re,t as m,v as Y,F as z,D as R,A as ie,n as A,C as _e,G as de,x as S,y as I}from"./entry.32cfc48a.js";import{u as C}from"./useUtils.bcb0d417.js";import{u as F}from"./useMyFetch.9e26ba49.js";import"./Times.a3a74d3c.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.c88696fd.js";const ue={class:"box-fixed"},pe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ce={class:"w-full flex flex-col items-center grow overflow-auto"},ve={class:"w-full flex flex-row flex-wrap"},me={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},fe=s("label",{for:""},"U.Jalan Per",-1),he={key:0,class:"grow"},ge={key:1,class:"grow"},we={class:"text-red-500"},ye={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ke=s("label",{for:""},"Jenis",-1),xe=["disabled"],Se=s("option",{value:"TBS"},"TBS",-1),be=s("option",{value:"TBSK"},"TBSK",-1),Ne=s("option",{value:"CPO"},"CPO",-1),Oe=s("option",{value:"PK"},"PK",-1),je=[Se,be,Ne,Oe],Je={class:"text-red-500"},De={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Be=s("label",{for:""},"Payment Method",-1),Ce=["disabled"],Te=["value"],Ae={class:"text-red-500"},Ie={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Fe=s("label",{for:""},"No Pol",-1),Me=["disabled"],Pe={id:"vehicle"},Ee=["value"],$e={class:"text-red-500"},Ke={key:0,class:"w-full flex flex-wrap"},Ue={class:"w-full flex flex-col flex-wrap p-1"},qe=s("label",{for:""},"Uang Jalan",-1),Le={class:"text-red-500"},Ve={key:1,class:"w-full flex flex-wrap"},Ye={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ze=s("label",{for:""},"Supir",-1),Re={class:"text-red-500"},Ge={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},He=s("label",{for:""},"Kernet",-1),We={class:"text-red-500"},Qe={class:"w-full flex items-center justify-end"},rt={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(O){const _=O,{$moment:M}=de(),{pointFormat:P}=C(),j={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",transition_type:"",payment_method_id:2,payment_method:{id:0,name:""},uj:{}};let b={...j};const a=w({...j}),T=oe("token"),d=w({}),G=async()=>{S().loading_full=!0,d.value={};const t=new FormData;t.append("tanggal",M(a.value.tanggal).format("Y-MM-DD")),t.append("jenis",a.value.jenis),t.append("id_uj",f.value.id),t.append("payment_method_id",a.value.payment_method_id),t.append("no_pol",a.value.no_pol),t.append("supir_id",i.value.id),t.append("kernet_id",r.value.id);let e="post",p=_.id;p==0||(t.append("id",p),t.append("_method","PUT"));const{data:o,error:y,status:h}=await F("/trx_trp",{method:e,headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:t,retry:0});if(S().loading_full=!1,h.value==="error"){I().trigger(y,d);return}a.value.supir=i.value.name,a.value.supir_rek_no=i.value._.rek_no.val,a.value.supir_rek_name=i.value._.rek_name.val,a.value.kernet=r.value.name,a.value.kernet_rek_no=r.value._.rek_no.val,a.value.kernet_rek_name=r.value._.rek_name.val,a.value.uj=f.value._raw;let g=D.value.map(k=>k.id).indexOf(a.value.payment_method_id);if(a.value.payment_method={...D.value[g]},a.value.updated_at=o.value.updated_at,_.id<=0)a.value.id=o.value.id,a.value.created_at=o.value.created_at,_.p_data.unshift(a.value);else{let k=_.p_data.map(n=>n.id).indexOf(_.id);k>=-1&&_.p_data.splice(k,1,{...a.value})}_.fnClose()},H=B(()=>{let t=a.value.jenis=="TBSK"?"TBS":a.value.jenis;return K.value.filter(e=>e.jenis==t)}),u={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},i=w(JSON.parse(JSON.stringify(u))),r=w(JSON.parse(JSON.stringify(u))),E=B(()=>{let t=[];return q.value.forEach((e,p)=>{let o=JSON.parse(JSON.stringify(u));o._.id.val=e.id,o._.name.val=e.name,o._.rek_no.val=e.rek_no,o._.rek_name.val=e.rek_name,o.id=e.id,o.name=e.name,o.title=(e.rek_no||"")+" "+(e.rek_name||""),o.note=Q(e),o._raw=e,t.push(JSON.parse(JSON.stringify(o)))}),t}),J={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},xto:{tcon:"IconsLocationOn",text:"Tujuan",val:""},asst_opt:{tcon:"IconsPerson",text:"Info",val:""},tipe:{tcon:"",text:"Tipe",val:""},harga:{tcon:"IconsMoney",text:"Amount",val:""}},id:"",name:"",title:"",note:""},f=w(JSON.parse(JSON.stringify(J))),$=t=>{let e=JSON.parse(JSON.stringify(J));return e._.id.val=t.id,e._.xto.val=t.xto,e._.asst_opt.val=t.asst_opt,e._.tipe.val=t.tipe,e._.harga.val=P(t.harga),e.id=t.id,e.name=t.xto,e.title=(t.asst_opt||"")+" "+(t.tipe||"")+" "+(P(t.harga)||""),e._raw=t,e},W=B(()=>{let t=[];return H.value.forEach((e,p)=>{t.push(JSON.parse(JSON.stringify($(e))))}),t}),Q=t=>t.potongan?"Akan ada potong sebesar :"+C().pointFormat(t.potongan.nominal_cut):"",X=B(()=>!1),Z=async()=>{S().loading_full=!0;const{data:t,error:e,status:p}=await F("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(S().loading_full=!1,p.value==="error"){I().trigger(e);return}let o=t.value.data;a.value=o,b={...o},i.value._.id.val=o.supir_id,i.value._.name.val=o.supir,i.value._.rek_no.val=o.supir_rek_no,i.value._.rek_name.val=o.supir_rek_name,i.value.id=o.supir_id,i.value.name=o.supir,i.value.rek_no=(o.supir_rek_no||"")+" "+(o.supir_rek_name||""),r.value._.id.val=o.kernet_id,r.value._.name.val=o.kernet,r.value._.rek_no.val=o.kernet_rek_no,r.value._.rek_name.val=o.kernet_rek_name,r.value.id=o.kernet_id,r.value.name=o.kernet,r.value.rek_no=(o.kernet_rek_no||"")+" "+(o.kernet_rek_name||""),f.value=$(o.uj);let y=0,h=0;o.potongan.forEach(g=>{g.potongan_mst.employee_id==o.supir_id&&(y+=parseInt(g.nominal_cut)),g.potongan_mst.employee_id==o.kernet_id&&(h+=parseInt(g.nominal_cut))}),y>0&&(i.value.note="Telah di potong sebesar :"+C().pointFormat(y)),h>0&&(r.value.note="Telah di potong sebesar :"+C().pointFormat(h)),_.fnLoadDBData()},K=w([]),U=w([]),q=w([]),D=w([]),ee=async()=>{S().loading_full=!0;const{data:t,error:e,status:p}=await F("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0});if(S().loading_full=!1,p.value==="error"){I().trigger(e);return}K.value=t.value.list_ujalan,U.value=t.value.list_vehicle,q.value=t.value.list_employee,D.value=t.value.list_payment_methods};return L(()=>_.show,async(t,e)=>{t==!0&&(await ee(),await _.fnLoadDBData(),a.value={...j},b={...j},i.value=JSON.parse(JSON.stringify(u)),r.value=JSON.parse(JSON.stringify(u)),f.value=JSON.parse(JSON.stringify(J)),d.value={},_.id!=0&&Z())},{immediate:!0}),L(()=>f.value._raw,(t,e)=>{t&&Object.keys(t).length===0&&t.constructor===Object?(i.value=JSON.parse(JSON.stringify(u)),r.value=JSON.parse(JSON.stringify(u)),a.value.transition_target="",a.value.transition_type=""):t.asst_opt&&t.asst_opt=="TANPA KERNET"&&(r.value=JSON.parse(JSON.stringify(u)),t.transition_from&&(a.value.transition_target=t.transition_from,a.value.transition_type="From"))},{deep:!0,immediate:!0}),(t,e)=>{var g,k;const p=te,o=se("vue-date-picker"),y=ae,h=le;return N((c(),v("section",ue,[s("div",null,[x(p,{title:"Form Transaction",fn:O.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("form",pe,[s("div",ce,[s("div",ve,[s("div",me,[fe,l(a).val!==1?(c(),v("div",he,[x(y,null,{default:ne(()=>[x(o,{modelValue:l(a).tanggal,"onUpdate:modelValue":e[0]||(e[0]=n=>l(a).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(c(),v("div",ge,[s("div",{class:re(["card-border disabled",l(a).pvr_no!=""?"unselectable":""])},m(l(a).tanggal?l(M)(l(a).tanggal).format("DD-MM-YYYY"):""),3)])),s("p",we,m(l(d).tanggal),1)]),s("div",ye,[ke,N(s("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>l(a).jenis=n),disabled:l(a).val==1},je,8,xe),[[Y,l(a).jenis]]),s("p",Je,m(l(d).jenis),1)]),s("div",De,[Be,N(s("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>l(a).payment_method_id=n),disabled:l(a).val==1},[(c(!0),v(z,null,R(l(D),n=>(c(),v("option",{value:n.id},m(n.name),9,Te))),256))],8,Ce),[[Y,l(a).payment_method_id]]),s("p",Ae,m(l(d).payment_method_id),1)]),s("div",Ie,[Fe,N(s("input",{type:"text",list:"vehicle","onUpdate:modelValue":e[3]||(e[3]=n=>l(a).no_pol=n),disabled:l(a).val==1},null,8,Me),[[ie,l(a).no_pol]]),s("datalist",Pe,[(c(!0),v(z,null,R(l(U),n=>(c(),v("option",{value:n.no_pol},m(n.no_pol),9,Ee))),256))]),s("p",$e,m(l(d).no_pol),1)]),l(a).jenis!=""?(c(),v("div",Ke,[s("div",Ue,[qe,x(h,{arr:l(W),selected:l(f),pure:J,onSetSelected:e[4]||(e[4]=n=>f.value=n),disabled:l(b).supir_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",Le,m(l(d).id_uj),1)])])):A("",!0),(g=l(f)._raw)!=null&&g.asst_opt?(c(),v("div",Ve,[s("div",Ye,[ze,x(h,{arr:l(E),selected:l(i),pure:u,onSetSelected:e[5]||(e[5]=n=>i.value=n),disabled:l(b).supir_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",Re,m(l(d).supir_id),1)]),N(s("div",Ge,[He,x(h,{arr:l(E),selected:l(r),pure:u,onSetSelected:e[6]||(e[6]=n=>r.value=n),disabled:l(b).kernet_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",We,m(l(d).kernet_id),1)],512),[[V,((k=l(f)._raw)==null?void 0:k.asst_opt)=="DENGAN KERNET"]])])):A("",!0)])]),s("div",Qe,[s("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[7]||(e[7]=n=>O.fnClose())}," Cancel "),l(X)?A("",!0):(c(),v("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:e[8]||(e[8]=_e(n=>G(),["prevent"]))}," Save "))])])])],512)),[[V,O.show]])}}};export{rt as default};
