import{_ as re}from"./Header.87ef7e84.js";import{_ as W}from"./Plus.8f26e740.js";import{_ as de}from"./Edit.5404f9e6.js";import{_ as ce}from"./Eyes.6273d2e8.js";import{_ as _e}from"./Delete.a37f2e94.js";import{_ as pe}from"./Search.ccfc874a.js";import{_ as fe}from"./PopupMini.vue.901ca6da.js";import{_ as ve}from"./HeaderPopup.vue.3aad9459.js";import{_ as me,a as he}from"./ToolsPopup.fcea9157.js";import{r as c,u as ee,R as we,g as xe,o as f,c as x,n as b,v as ye,a as e,b as k,x as t,s as V,t as g,y as Q,M as I,F as E,A as te,B as X,z as le,D as j,E as N,p as ge,e as be,K as $e,I as ke,N as Z,O as je,T as G,q as Ce,L as Ae,U as Se,C as De}from"./entry.fef32b7f.js";import{u as P}from"./useMyFetch.d0e12c91.js";import{_ as Te}from"./_plugin-vue_export-helper.c27b6911.js";import{u as Ue}from"./useUtils.100f5b4a.js";import"./Times.6713c5e3.js";const C=A=>(ge("data-v-0d7dcf3f"),A=A(),be(),A),Ve={class:"box-fixed"},Be={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},qe={class:"w-full flex flex-col items-center justify-center grow overflow-auto"},Ie={class:"w-full flex flex-row flex-wrap"},Me={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Fe=C(()=>e("label",{for:""},"To",-1)),He={class:"text-red-500"},Le={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ne=C(()=>e("label",{for:""},"Tipe",-1)),Pe={class:"text-red-500"},Re={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ze=C(()=>e("label",{for:""},"Jenis",-1)),Ee=C(()=>e("option",{value:"CPO"},"CPO",-1)),Oe=C(()=>e("option",{value:"TBS"},"TBS",-1)),Je=[Ee,Oe],Ke={class:"text-red-500"},Ye={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Qe=C(()=>e("label",{for:""},"Harga",-1)),Xe={class:"text-red-500"},Ze={class:"w-full flex grow p-1 overflow-auto"},Ge={role:"sticky",ref:"loadRef"},We={class:"tacky w-full",style:{"white-space":"normal"}},et={class:"sticky top-0 !z-[2]"},tt={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},lt=C(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1)),ot=C(()=>e("th",null,"Desc",-1)),st=C(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"Qty",-1)),at=C(()=>e("th",{class:"min-w-[100px] !w-[100px] max-w-[100px]"},"Harga",-1)),nt={ref:"to_move"},ut=["data-index"],it={key:0,class:"tools cell"},rt={class:"w-full h-full flex items-center justify-center"},dt=["onClick"],ct={key:1,class:"cell"},_t={class:"w-full h-full flex items-center justify-center"},pt=["disabled","onUpdate:modelValue"],ft={class:"w-full h-full flex items-center justify-center"},vt=["onUpdate:modelValue"],mt={class:"w-full h-full flex items-center justify-center"},ht=["onUpdate:modelValue"],wt={key:0},xt={class:"tools cell"},yt={class:"w-full flex items-center justify-end"},gt={__name:"ujalan",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(A){const v=A,M={id:-1,xto:"",tipe:"",jenis:"",harga:0,details:[]},n=c({...M}),R=ee("token"),u=c({}),i=c([]),F=c({ordinal:0,id:-1,xdesc:"",qty:0,harga:0,p_status:""}),p=async()=>{j().loading_full=!0,u.value={};const s=new FormData;s.append("xto",n.value.xto),s.append("tipe",n.value.tipe),s.append("jenis",n.value.jenis),s.append("harga",n.value.harga),s.append("details",JSON.stringify(i.value));let l="post",D=v.id;D==0||(s.append("id",D),s.append("_method","PUT"));const{data:w,error:H,status:q}=await P("/ujalan",{method:l,headers:{Authorization:`Bearer ${R.value}`,Accept:"application/json"},body:s,retry:0});if(j().loading_full=!1,q.value==="error"){N().trigger(H,u);return}if(v.id<=0)n.value.id=w.value.id,n.value.created_at=w.value.created_at,n.value.updated_at=w.value.updated_at,v.p_data.unshift(n.value);else{n.value.updated_at=w.value.updated_at;let o=v.p_data.map(T=>T.id).indexOf(v.id);o>=-1&&v.p_data.splice(o,1,{...n.value})}v.fnClose()},a=c(-1),y=c(!1),m=c({left:0,top:0}),h=(s,l)=>{a.value=l,y.value=!0,m.value={left:s.clientX,top:s.clientY}},O=()=>{i.value.push({...F.value,p_status:"Add"})},B=()=>{y.value=!1},z=(s="")=>{if(s=="insert")i.value.splice(a.value,0,{...F.value,p_status:"Add"});else if(s=="delete")i.value[a.value].p_status=="Edit"?i.value[a.value].p_status="Remove":i.value.splice(a.value,1);else if(s=="move_top"){let l=i.value[a.value];i.value.splice(a.value,1),i.value.splice(a.value-1,0,{...l})}else if(s=="move_bottom"){let l=i.value[a.value];i.value.splice(a.value,1),i.value.splice(a.value+1,0,{...l})}y.value=!1},$=we(()=>!1),J=async()=>{j().loading_full=!0;const{data:s,error:l,status:D}=await P("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${R.value}`,Accept:"application/json"},params:{id:v.id},retry:0});if(j().loading_full=!1,D.value==="error"){N().trigger(l);return}n.value=s.value.data,i.value=s.value.data.details.map(w=>(w.p_status="Edit",w.key=w.ordinal,w))};return xe(()=>v.show,(s,l)=>{s==!0&&(n.value={...M},i.value=[],v.id!=0&&J())},{immediate:!0}),(s,l)=>{const D=ve,w=me,H=W,q=he;return f(),x(E,null,[b(e("section",Ve,[e("div",null,[k(D,{title:"Form Ujalan",fn:A.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Be,[e("div",qe,[e("div",Ie,[e("div",Me,[Fe,b(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>t(n).xto=o)},null,512),[[V,t(n).xto]]),e("p",He,g(t(u).xto),1)]),e("div",Le,[Ne,b(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=o=>t(n).tipe=o)},null,512),[[V,t(n).tipe]]),e("p",Pe,g(t(u).tipe),1)]),e("div",Re,[ze,b(e("select",{"onUpdate:modelValue":l[2]||(l[2]=o=>t(n).jenis=o)},Je,512),[[Q,t(n).jenis]]),e("p",Ke,g(t(u).jenis),1)]),e("div",Ye,[Qe,b(e("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>t(n).harga=o)},null,512),[[V,t(n).harga]]),e("p",Xe,g(t(u).harga),1)])]),e("div",Ze,[e("div",Ge,[e("table",We,[e("thead",null,[e("tr",et,[t($)?I("",!0):(f(),x("th",tt)),lt,ot,st,at])]),e("tbody",nt,[(f(!0),x(E,null,te(t(i),(o,T)=>(f(),x(E,{key:T},[o.p_status!="Remove"?(f(),x("tr",{key:0,"data-index":T},[t($)?I("",!0):(f(),x("td",it,[e("div",rt,[e("button",{type:"button",name:"button",onClick:S=>h(S,T)},[k(w)],8,dt)])])),e("td",null,g(T+1)+".",1),t($)?I("",!0):(f(),x("td",ct,[e("div",_t,[b(e("textarea",{disabled:t($),class:"p-1 w-full","onUpdate:modelValue":S=>o.xdesc=S,cols:"7",rows:"2"},null,8,pt),[[V,o.xdesc]])])])),e("td",{class:X(["cell bold",t($)?"unselectable":""])},[e("div",ft,[b(e("input",{type:"number","onUpdate:modelValue":S=>o.qty=S},null,8,vt),[[V,o.qty]])])],2),e("td",{class:X(["cell",t($)?"unselectable":""])},[e("div",mt,[b(e("input",{type:"number","onUpdate:modelValue":S=>o.harga=S},null,8,ht),[[V,o.harga]])])],2)],8,ut)):I("",!0)],64))),128)),t($)?I("",!0):(f(),x("tr",wt,[e("td",xt,[e("button",{type:"button",name:"button",onClick:l[4]||(l[4]=o=>O())},[k(H)])])]))],512)])],512)])]),e("div",yt,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[5]||(l[5]=o=>A.fnClose())}," Cancel "),t($)?I("",!0):(f(),x("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[6]||(l[6]=le(o=>p(),["prevent"]))}," Save "))])])])],512),[[ye,A.show]]),k(q,{show:t(y),coor:t(m),fn:B,data:t(i),data_index:t(a),onReplyAct:l[7]||(l[7]=o=>z(o))},null,8,["show","coor","data","data_index"])],64)}}},bt=Te(gt,[["__scopeId","data-v-0d7dcf3f"]]),$t={class:"w-full h-full flex flex-col"},kt={class:"w-full flex grow flex-col overflow-auto h-0"},jt={class:"w-full flex"},Ct={action:"#",class:"w-full flex p-1"},At={class:"grow"},St=e("div",{class:"font-bold"}," Keyword ",-1),Dt={class:"pl-1"},Tt=e("div",{class:"font-bold"}," Sort By ",-1),Ut=Se('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Vt=[Ut],Bt={class:"pl-1"},qt=e("div",{class:"font-bold"}," Sort Order ",-1),It=e("option",{value:"asc"},"Asc",-1),Mt=e("option",{value:"desc"},"Desc",-1),Ft=[It,Mt],Ht={class:"flex items-end pl-1"},Lt={class:"w-full flex justify-center items-center grow h-0 p-1"},Nt={key:0,class:""},Pt={class:"tacky"},Rt=e("thead",null,[e("tr",{class:"sticky top-0 !z-[2]"},[e("th",null,"ID"),e("th",null,"To"),e("th",null,"Tipe"),e("th",null,"Jenis"),e("th",null,"Harga"),e("th",null,"Created At"),e("th",null,"Updated At")])],-1),zt=["onClick"],Et={class:"bold"},nl={__name:"index",async setup(A){let v,M;const{$moment:n}=De(),{pointFormat:R}=Ue(),u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="created_at:desc";const i=ee("token"),{data:F}=([v,M]=$e(async()=>Ae(async()=>{j().loading_full=!0;const{data:_,error:r,status:U}=await P("/ujalan",{method:"get",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},params:u,retry:0});if(j().loading_full=!1,U.value==="error")return N().trigger(r),[];let L=_.value.data,K=_.value.request_notif;return{ujalans:L,request_notif:K}},"$SN3C927rLk")),v=await v,M(),v),p=c(F.value.ujalans);c(F.value.request_notif);const a=c(""),y=c({field:"created_at",by:"desc"}),m=c(-1),h=c({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),O=()=>{u.like="",a.value!=""&&(u.like=`id:%${a.value}%,warehouse_name:%${a.value}%,warehouse_source_name:%${a.value}%,warehouse_target_name:%${a.value}%,item_name:%${a.value}%,status:%${a.value}%,type:%${a.value}%`),u.sort="",y.value.field&&(u.sort=y.value.field+":"+y.value.by)},B=c(null),z=async()=>{j().loading_full=!0,h.value.may_get_data=!1,u.page=h.value.page,u.page==1&&(p.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(p.value[0]));const{data:_,error:r,status:U}=await P("/ujalan",{method:"get",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},params:u,retry:0});if(j().loading_full=!1,h.value.may_get_data=!0,U.value==="error"){N().trigger(r);return}h.value.page==1?(p.value=_.value.data,B.value&&(B.value.scrollTop=0)):h.value.page>1&&(p.value=[...p.value,..._.value.data]),_.value.data.length==0&&(h.value.is_last_record=!0)},$=async()=>{if(!h.value.may_get_data)return;let _=B.value;if(_.scrollLeft!=h.value.scrollLeft){h.value.scrollLeft=_.scrollLeft;return}h.value.is_last_record||!(Math.round(_.scrollTop)+_.clientHeight>=_.scrollHeight-1)||(h.value.page++,await z())},J=()=>{h.value.page=1,h.value.is_last_record=!1,O(),z()};ke();const s=c(!1),l=c(0),D=()=>{l.value=0,s.value=!0},{display:w}=Z();je(Z());const H=()=>{m.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(l.value=p.value[m.value].id,s.value=!0)},q=c({}),o=c(!1),T=async()=>{o.value&&(o.value=!1)},S=()=>{m.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(q.value={id:p.value[m.value].id},o.value=!0)},oe=async()=>{j().loading_full=!0;const _=new FormData;_.append("id",p.value[m.value].id),_.append("_method","DELETE");const{data:r,error:U,status:L}=await P("/ujalan",{method:"post",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},body:_,retry:0});if(j().loading_full=!1,L.value==="error"){N().trigger(U);return}p.value.splice(m.value,1),m.value=-1,o.value=!1};return(_,r)=>{const U=re,L=W,K=de,se=ce,ae=_e,ne=pe,ue=fe,ie=bt;return f(),x("div",$t,[k(U,{title:"List Ujalan"}),e("div",kt,[e("div",jt,[e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[0]||(r[0]=d=>D())},[k(L)]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[1]||(r[1]=d=>H())},[t(m)==-1||t(p)[t(m)].ref_id==null&&t(p)[t(m)].confirmed_by==null?(f(),G(K,{key:0})):(f(),G(se,{key:1}))]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[2]||(r[2]=d=>S())},[k(ae)])]),e("form",Ct,[e("div",At,[St,b(e("input",{class:"",type:"text","onUpdate:modelValue":r[3]||(r[3]=d=>Ce(a)?a.value=d:null),name:"search",placeholder:"Keyword"},null,512),[[V,t(a)]])]),e("div",Dt,[Tt,b(e("select",{class:"","onUpdate:modelValue":r[4]||(r[4]=d=>t(y).field=d)},Vt,512),[[Q,t(y).field]])]),e("div",Bt,[qt,b(e("select",{class:"","onUpdate:modelValue":r[5]||(r[5]=d=>t(y).by=d)},Ft,512),[[Q,t(y).by]])]),e("div",Ht,[e("button",{class:"",type:"submit",name:"button",onClick:r[6]||(r[6]=le(d=>J(),["prevent"]))},[k(ne,{class:"text-2xl"})])])]),e("div",Lt,[t(p).length==0?(f(),x("div",Nt," Maaf Tidak Ada Record ")):(f(),x("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:B,onScroll:$},[e("table",Pt,[Rt,e("tbody",null,[(f(!0),x(E,null,te(t(p),(d,Y)=>(f(),x("tr",{key:Y,onClick:Ot=>m.value=Y,class:X(t(m)==Y?"active":"")},[e("td",Et,g(d.id),1),e("td",null,g(d.xto),1),e("td",null,g(d.tipe),1),e("td",null,g(d.jenis),1),e("td",null,g(t(R)(d.harga)),1),e("td",null,g(d.created_at?t(n)(d.created_at).format("DD-MM-Y HH:mm:ss"):""),1),e("td",null,g(d.updated_at?t(n)(d.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,zt))),128))])])],544))])]),k(ue,{type:"delete",show:t(o),data:t(q),fnClose:T,fnConfirm:oe},null,8,["show","data"]),k(ie,{show:t(s),fnClose:()=>{s.value=!1},id:t(l),p_data:t(p)},null,8,["show","fnClose","id","p_data"])])}}};export{nl as default};
