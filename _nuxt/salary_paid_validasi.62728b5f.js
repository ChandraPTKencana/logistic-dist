import{_ as H}from"./HeaderPopup.vue.f517fb30.js";import{r as b,f as L,G as p,j as U,m as q,J as G,o as u,c as _,a as e,b as J,t as n,k as t,n as K,v as O,l as f,d as g,F as T,y as Q,x as W,E as X,A as F,B as I,p as Z,e as ee}from"./entry.d666f234.js";import{u as ae}from"./useUtils.05bab760.js";import{u as R}from"./useMyFetch.587fa9a2.js";import{_ as te}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.c23c0c4b.js";const r=i=>(Z("data-v-0236c323"),i=i(),ee(),i),le={class:"box-fixed"},se={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},oe={class:"w-full flex flex-col items-center grow overflow-auto"},ne={class:"w-full flex flex-row flex-wrap"},re={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ie=r(()=>e("label",{for:""},"Period End",-1)),ue={class:"card-border"},_e={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},de=r(()=>e("label",{for:""},"Period Part",-1)),ce={class:"card-border"},ve={key:0,class:"w-full p-1"},pe=r(()=>e("div",{class:"font-bold"}," Filter Nama ",-1)),me={key:1,class:"w-full flex p-1 justify-between flex-wrap"},fe={class:"w-full",role:"sticky"},he={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ye=r(()=>e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"11",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1)),we={class:"sticky top-7 !z-[2]"},be=r(()=>e("th",null,"No",-1)),xe=r(()=>e("th",null,"Jabatan",-1)),ke=r(()=>e("th",null,"Nama Pekerja",-1)),ge=r(()=>e("th",null,"No KTP",-1)),Fe=r(()=>e("th",null,"Rek No",-1)),Ne=r(()=>e("th",null,"Rek Nama",-1)),Be=r(()=>e("th",null,"Bank Name",-1)),Ce={class:"text-sm"},Se={class:"text-sm"},je={class:"text-sm"},Ee={class:"text-sm"},Me={ref:"to_move"},Ve=["data-index"],Ae={class:"w-full flex items-center justify-end"},De={class:"w-full flex flex-wrap p-3 items-center"},Pe=r(()=>e("div",null," Di Validasi oleh : ",-1)),$e={key:0,class:"border-solid border-2 w-fit p-1 bg-slate-700 text-white text-xs"},qe={key:0},Te={__name:"salary_paid_validasi",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_view:{type:Boolean,required:!1,default:!1}},setup(i){const d=i,{$moment:B}=X(),{pointFormat:c}=ae(),s=b({...{id:-1,name:"",tipe:"",is_transition:!1,amount:0,details:[],val1:0,val1_by:{username:""},val1_at:"",val2:0,val2_by:{username:""},val2_at:"",val3:0,val3_by:{username:""},val3_at:""}}),C=L("token"),S=b({}),j=b(null),v=b([]),Y=async()=>{F().loading_full=!0,S.value={};const l=new FormData;let o="post",m=d.id;m==0||(l.append("id",m),l.append("_method","PUT"));const{data:a,error:y,status:x}=await R("/salary_paid_validasi",{method:o,headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:l,retry:0});if(F().loading_full=!1,x.value==="error"){I().trigger(y,S);return}s.value.val1=a.value.val1,s.value.val1_user=a.value.val1_user,s.value.val1_by=a.value.val1_by,s.value.val1_at=a.value.val1_at,s.value.val2=a.value.val2,s.value.val2_user=a.value.val2_user,s.value.val2_by=a.value.val2_by,s.value.val2_at=a.value.val2_at,s.value.val3=a.value.val3,s.value.val3_user=a.value.val3_user,s.value.val3_by=a.value.val3_by,s.value.val3_at=a.value.val3_at;let w=d.p_data.map(k=>k.id).indexOf(d.id);w>=-1&&d.p_data.splice(w,1,{...s.value}),d.fnClose()};p(()=>{let l=0;return v.value.forEach(o=>{l+=parseFloat(o.standby_nominal)}),l});const E=p(()=>{let l=0;return v.value.forEach(o=>{l+=parseFloat(o.sb_gaji)}),l}),M=p(()=>{let l=0;return v.value.forEach(o=>{l+=parseFloat(o.sb_makan)}),l}),V=p(()=>{let l=0;return v.value.forEach(o=>{l+=parseFloat(o.salary_bonus_nominal)}),l}),z=async()=>{F().loading_full=!0;const{data:l,error:o,status:m}=await R("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(F().loading_full=!1,m.value==="error"){I().trigger(o);return}s.value=l.value.data,v.value=l.value.data.details};p(()=>{let l=0;return v.value.forEach(o=>{o.p_status!="Remove"&&(l+=parseInt(o.amount))}),l}),p(()=>!1);const h=b(""),N=p(()=>h.value!=""?v.value.filter(l=>l.employee.name.toLowerCase().includes(h.value.toLowerCase())):v.value);return U(()=>d.show,(l,o)=>{l==!0&&(d.is_view==!1&&setTimeout(()=>{j.value.focus()},1),z())},{immediate:!0}),(l,o)=>{const m=H;return q((u(),_("section",le,[e("div",null,[J(m,{title:"Form Master Standby Validation",fn:i.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",se,[e("div",oe,[e("div",ne,[e("div",re,[ie,e("div",ue,n(t(B)(t(s).period_end).format("MM-Y")),1)]),e("div",_e,[de,e("div",ce,n(t(s).period_part),1)])]),t(N).length?(u(),_("div",ve,[pe,q(e("input",{class:"",type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>K(h)?h.value=a:null),name:"search",placeholder:"Nama"},null,512),[[O,t(h)]])])):f("",!0),t(N).length?(u(),_("div",me,[e("div",fe,[e("table",he,[e("thead",null,[ye,e("tr",we,[be,xe,ke,ge,Fe,Ne,Be,e("th",null,[g("SB.Gaji "),e("span",Ce,"("+n(t(c)(t(E)||0))+")",1)]),e("th",null,[g("SB.Makan "),e("span",Se,"("+n(t(c)(t(M)||0))+")",1)]),e("th",null,[g("Nominal Bonus "),e("span",je,"("+n(t(c)(t(V)||0))+")",1)]),e("th",null,[g("Total "),e("span",Ee,"("+n(t(c)(t(E)+t(M)+t(V)||0))+")",1)])])]),e("tbody",Me,[(u(!0),_(T,null,Q(t(N),(a,y)=>{var x,w,k,A,D,P,$;return u(),_(T,{key:y},[a.p_status!="Remove"?(u(),_("tr",{key:0,"data-index":y},[e("td",null,n(y+1)+".",1),e("td",null,n((x=a.employee)==null?void 0:x.role),1),e("td",null,n((w=a.employee)==null?void 0:w.name),1),e("td",null,n((k=a.employee)==null?void 0:k.ktp_no),1),e("td",null,n((A=a.employee)==null?void 0:A.rek_no),1),e("td",null,n((D=a.employee)==null?void 0:D.rek_name),1),e("td",null,n(($=(P=a.employee)==null?void 0:P.bank)==null?void 0:$.code),1),e("td",null,n(t(c)(a.sb_gaji)),1),e("td",null,n(t(c)(a.sb_makan)),1),e("td",null,n(t(c)(a.salary_bonus_nominal)),1),e("td",null,n(t(c)(parseFloat(a.sb_gaji)+parseFloat(a.sb_makan)+parseFloat(a.salary_bonus_nominal))),1)],8,Ve)):f("",!0)],64)}),128))],512)])])])):f("",!0)]),e("div",Ae,[e("div",De,[Pe,t(s).val1||t(s).val2||t(s).val3?(u(),_("div",$e,[t(s).val1?(u(),_("div",qe," App 1 : "+n(t(s).val1_by.username)+" ( "+n(t(s).val1_at?t(B)(t(s).val1_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):f("",!0)])):f("",!0)]),e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:o[1]||(o[1]=a=>i.fnClose())}," Cancel "),i.is_view==0?(u(),_("button",{key:0,ref_key:"it_val",ref:j,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:o[2]||(o[2]=W(a=>Y(),["prevent"]))}," Validasi ",512)):f("",!0)])])])],512)),[[G,i.show]])}}},Ge=te(Te,[["__scopeId","data-v-0236c323"]]);export{Ge as default};
