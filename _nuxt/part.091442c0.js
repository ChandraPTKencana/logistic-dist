import ae from"./Plus.2d61942e.js";import le from"./Edit.9e67d06f.js";import oe from"./Signature.c651e9c7.js";import ne from"./Calculator.d9665d6d.js";import ie from"./Search.5cd9772e.js";import re from"./Line.b9ef3202.js";import ue from"./Check.2a337176.js";import de from"./trx.9cd3a2fd.js";import ce from"./trx_validasi.cc12a183.js";import{f as me,r as o,i as fe,j as L,o as r,c as m,a as e,k as l,b as _,l as S,m as _e,v as pe,n as ve,x as he,F as ge,y as ye,C as c,D as w,t as p,E as ke,A as b,B as H}from"./entry.e2a348bc.js";import{u as x}from"./useUtils.eac65038.js";import{u as V}from"./useMyFetch.e2cc1362.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.5d5e0ea9.js";import"./Times.14b13dbc.js";import"./InputPointFormat.vue.38d1571b.js";const we={class:"w-full h-full flex flex-col bg-white"},be={class:"w-full flex grow flex-col"},xe={class:"w-full flex"},Ce={action:"#",class:"w-full flex p-1"},$e={class:"grow"},De=e("div",{class:"font-bold"}," Keyword ",-1),Ae={class:"flex items-end pl-1"},Te={class:"w-full flex justify-center items-center grow p-1"},Me={key:0,class:""},Se={class:"tacky"},Ue=e("thead",null,[e("tr",{class:"sticky top-0 !z-[2]"},[e("th",null,"App 1"),e("th",null,"App 2"),e("th",null,"ID"),e("th",null,"ID Trx Trp"),e("th",null,"Nominal Potong"),e("th",null,"Note"),e("th",null,"Created At"),e("th",null,"Updated At")])],-1),Be=["onClick"],Fe={class:"flex items-center justify-center"},Ie={class:"flex items-center justify-center"},We={__name:"part",props:{show:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!1,default:0},is_view:{type:Boolean,required:!1,default:!1}},emits:["updateRemainingCut"],setup(g,{emit:z}){const v=g,{$moment:U}=ke(),{pointFormat:E}=x(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="created_at:desc";const B=me("token"),u=o([]),d=o(""),C=o({field:"created_at",by:"desc"}),f=o(-1),i=o({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),O=()=>{n.like="",d.value!=""&&(n.like=`id:%${d.value}%,employee_name:%${d.value}%,no_pol:%${d.value}%,info:%${d.value}%,status:%${d.value}%`),n.sort="",C.value.field&&(n.sort=C.value.field+":"+C.value.by)},y=o(null),$=async()=>{b().loading_full=!0,i.value.may_get_data=!1,n.page=i.value.page,n.page==1&&(u.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(u.value[0])),n.potongan_mst_id=v.id;const{data:s,error:a,status:h}=await V("/potongan_trxs",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,i.value.may_get_data=!0,h.value==="error"){H().trigger(a);return}i.value.page==1?(u.value=s.value.data,y.value&&(y.value.scrollTop=0)):i.value.page>1&&(u.value=[...u.value,...s.value.data]),s.value.data.length==0&&(i.value.is_last_record=!0)},q=async()=>{if(!i.value.may_get_data)return;let s=y.value;if(s.scrollLeft!=i.value.scrollLeft){i.value.scrollLeft=s.scrollLeft;return}i.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(i.value.page++,await $())},K=()=>{i.value.page=1,i.value.is_last_record=!1,O(),$()},k=o(!1),D=o(0),F=o(0),Y=()=>{D.value=0,k.value=!0,F.value=!1},{display:I}=fe(),J=()=>{f.value==-1?I({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(D.value=u.value[f.value].id,k.value=!0,F.value=!1)},A=o(!1),P=o(0),Z=()=>{f.value==-1?I({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value=u.value[f.value].id,A.value=!0)},N=o(!1);o({}),o(!1);const G=o("");L(()=>G.value,s=>{s.trim().length>0?N.value=!0:N.value=!1},{immediate:!1});const Q=async()=>{b().loading_full=!0;const s=new FormData;s.append("potongan_mst_id",v.id);const{data:a,error:h,status:T}=await V("/potongan_trx_recalculate",{method:"post",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:s,retry:0});if(b().loading_full=!1,T.value==="error"){H().trigger(h);return}z("updateRemainingCut",a.value.remaining_cut)};return L(()=>v.show,async(s,a)=>{s==!0&&v.id!=0&&$()},{immediate:!0}),(s,a)=>{const h=ae,T=le,W=oe,X=ne,ee=ie,R=re,j=ue,te=de,se=ce;return r(),m("div",we,[e("div",be,[e("div",xe,[!g.is_view&&("useUtils"in s?s.useUtils:l(x))().checkPermission("potongan_trx.create")?(r(),m("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=t=>Y())},[_(h)])):S("",!0),!g.is_view&&("useUtils"in s?s.useUtils:l(x))().checkPermissions(["potongan_trx.modify"])&&l(f)>-1?(r(),m("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=t=>J())},[_(T)])):S("",!0),!g.is_view&&("useUtils"in s?s.useUtils:l(x))().checkPermissions(["potongan_trx.val","potongan_trx.val1"])?(r(),m("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=t=>Z())},[_(W)])):S("",!0),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=t=>Q())},[_(X)])]),e("form",Ce,[e("div",$e,[De,_e(e("input",{class:"",type:"text","onUpdate:modelValue":a[4]||(a[4]=t=>ve(d)?d.value=t:null),name:"search",placeholder:"Keyword"},null,512),[[pe,l(d)]])]),e("div",Ae,[e("button",{class:"",type:"submit",name:"button",onClick:a[5]||(a[5]=he(t=>K(),["prevent"]))},[_(ee,{class:"text-2xl"})])])]),e("div",Te,[l(u).length==0?(r(),m("div",Me," Maaf Tidak Ada Record ")):(r(),m("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:y,onScroll:q},[e("table",Se,[Ue,e("tbody",null,[(r(!0),m(ge,null,ye(l(u),(t,M)=>(r(),m("tr",{key:M,onClick:Pe=>f.value=M,class:c(l(f)==M?"active":"")},[e("td",{class:c(t.deleted?"!bg-red-500":"")},[e("div",Fe,[t.val?(r(),w(j,{key:1})):(r(),w(R,{key:0}))])],2),e("td",{class:c(t.deleted?"!bg-red-500":"")},[e("div",Ie,[t.val1?(r(),w(j,{key:1})):(r(),w(R,{key:0}))])],2),e("td",{class:c([t.deleted?"!bg-red-500":"","bold"])},p(t.id),3),e("td",{class:c(t.deleted?"!bg-red-500":"")},p(t.trx_trp_id),3),e("td",{class:c(t.deleted?"!bg-red-500":"")},p(l(E)(t.nominal_cut)),3),e("td",{class:c(t.deleted?"!bg-red-500":"")},p(t.note),3),e("td",{class:c(t.deleted?"!bg-red-500":"")},p(t.created_at?l(U)(t.created_at).format("DD-MM-Y HH:mm:ss"):""),3),e("td",{class:c(t.deleted?"!bg-red-500":"")},p(t.updated_at?l(U)(t.updated_at).format("DD-MM-Y HH:mm:ss"):""),3)],10,Be))),128))])])],544))])]),_(te,{show:l(k),fnClose:()=>{k.value=!1},id:l(D),potongan_mst_id:v.id,p_data:l(u),onUpdateRemainingCut:a[6]||(a[6]=t=>s.$emit("updateRemainingCut",t))},null,8,["show","fnClose","id","potongan_mst_id","p_data"]),_(se,{show:l(A),fnClose:()=>{A.value=!1},id:l(P),p_data:l(u)},null,8,["show","fnClose","id","p_data"])])}}};export{We as default};
