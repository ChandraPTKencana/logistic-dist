import ie from"./Header.ba345b02.js";import re from"./Copy.3d533d79.js";import ue from"./Plus.67b979d1.js";import de from"./Edit.4d66f7b9.js";import _e from"./Eyes.cffe2562.js";import fe from"./TableView.7cf7e715.js";import ce from"./destination_location.c15e97dd.js";import me from"./destination_location_validasi.8d6bfb24.js";import{r as a,f as z,g as pe,h as ve,i as f,j as I,s as ye,c as b,b as d,a as P,l,n as D,q as be,x as c,y as L,o as g,G as ge}from"./entry.fa369e0d.js";import{u as m}from"./useUtils.9e7b4deb.js";import{u as V}from"./useMyFetch.c3981d40.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.d82f9cc4.js";import"./Adjust.b0fe8a79.js";import"./TableHeaderEye.914ecbcd.js";import"./Times.da78eaa7.js";import"./ClearAll.5136f4dc.js";import"./client-only.9a731e20.js";import"./ClearEach.82e6b7a4.js";import"./CaretLeftDoubleBold.2d0b1871.js";import"./CaretLeftBold.48112c8a.js";import"./CaretRightBold.2ecf1951.js";import"./CaretRightDoubleBold.0ddce6d7.js";import"./HeaderPopup.vue.46d7f32b.js";import"./InputPointFormat.vue.b1a6ebfa.js";const xe={class:"w-full h-full flex flex-col"},he={class:"w-full flex grow flex-col overflow-auto h-0"},ke={class:"w-full flex justify-between flex-wrap"},we={class:"grow flex"},Ge={__name:"index",async setup(De){let x,T;const{$moment:M}=ge(),E=e=>e.deleted==1?"!bg-red-400":e.pv_id>0?"!bg-blue-300":"",O=e=>(e.map(t=>{t.class_h=E(t)}),e),h=a("available");z(()=>h.value,e=>{H.value.map(t=>{let _=["deleted_by_username","deleted_at","deleted_reason"].indexOf(t.key)>-1;return["all","deleted"].indexOf(e)>-1?_&&(t.tbl_show=1):_&&(t.tbl_show=0),t}),N()},{immediate:!1});const o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const j=a({}),k=a({from:"",to:""}),A=pe("token"),{data:J}=([x,T]=ve(async()=>be(async()=>{c().loading_full=!0;let e=[];const[t,_]=await Promise.all([V("/destination_locations",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{filter_status:h},retry:0})]);return t.status.value!=="error"&&(e=O(t.data.value.data)),t.status.value==="error"?(L().trigger(t.error),{destination_locations:e}):(c().loading_full=!1,{destination_locations:e})},"$xzB8heZwKP")),x=await x,T(),x),s=a(J.value.destination_locations||[]),$=a({field:"tanggal",by:"desc"}),n=a(-1),i=f(()=>s.value[n.value]),r=a({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),K=()=>{o.like="";let e=JSON.parse(JSON.stringify(c()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,transition_target:%${e}%,transition_type:%${e}%,destination_location_name:%${e}%,destination_location_type:%${e}%,xto:%${e}%,transition_target:%${e}%`),o.sort="",$.value.field&&(o.sort=$.value.field+":"+$.value.by),o.date_from=k.value.from?M(k.value.from).format("YYYY-MM-DD"):"",o.date_to=k.value.to?M(k.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(c()._tv.filter_model)},B=async()=>{c().loading_full=!0,j.value={},r.value.may_get_data=!1,o.page=r.value.page,o.page==1&&(s.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(s.value[0])),o.filter_status=h.value;const{data:e,error:t,status:_}=await V("/destination_locations",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:o,retry:0});if(c().loading_full=!1,r.value.may_get_data=!0,_.value==="error"){L().trigger(t,j);return}r.value.page==1?s.value=O(e.value.data):r.value.page>1&&(s.value=[...s.value,...O(e.value.data)]),e.value.data.length==0&&(r.value.is_last_record=!0),c()._tv.filter_box=!1},N=()=>{n.value=-1,r.value.page=1,r.value.is_last_record=!1,K(),B()},p=a(!1),w=a(0),v=a(0),y=a(!1),R=()=>{w.value=0,y.value=!1,v.value=!1,p.value=!0},{display:S}=I();ye(I());const U=()=>{n.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=s.value[n.value].id,y.value=!1,v.value=!1,p.value=!0)},Z=()=>{n.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=s.value[n.value].id,y.value=!1,v.value=!0,p.value=!0)},C=a(!1),Y=a(0),q=()=>{n.value==-1?S({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(Y.value=s.value[n.value].id,y.value=!0,v.value=!1,C.value=!0)},F=a(!1);a({}),a(!1);const G=a("");z(()=>G.value,e=>{e.trim().length>0?F.value=!0:F.value=!1},{immediate:!1});const H=a([{key:"no",label:"No",isai:!0},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"minimal_trip",label:"Min Trip",class:" justify-end",type:"number"},{key:"bonus_trip_supir",label:"Bonus Trip Supir",class:" justify-end",type:"number"},{key:"bonus_next_trip_supir",label:"Bonus Next Trip Supir",class:" justify-end",type:"number"},{key:"bonus_trip_kernet",label:"Bonus Trip Kernet",class:" justify-end",type:"number"},{key:"bonus_next_trip_kernet",label:"Bonus Next Trip Kernet",class:" justify-end",type:"number"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1}]),Q=f(()=>n.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&m().checkPermission("destination_location.create")),W=f(()=>["available","all"].indexOf(h.value)>-1&&m().checkPermission("destination_location.create")),X=f(()=>n.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,0].indexOf(i.value.val1)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1&&m().checkPermission("destination_location.modify"));return f(()=>n.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1&&(m().checkPermission("destination_location.val1")&&[void 0,0].indexOf(i.value.val1)>-1||m().checkPermission("destination_location.val2")&&[void 0,0].indexOf(i.value.val2)>-1)),f(()=>m().checkPermission("destination_location.remove")&&n.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1),f(()=>m().checkPermission("destination_location.preview_file")&&n.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&i.value.val==1),(e,t)=>{const _=ie,ee=re,te=ue,ae=de,oe=_e,le=fe,ne=ce,se=me;return g(),b("div",xe,[d(_,{title:"List Location"}),P("div",he,[P("div",ke,[P("div",we,[l(Q)?(g(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=u=>Z())},[d(ee)])):D("",!0),l(W)?(g(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=u=>R())},[d(te)])):D("",!0),l(X)?(g(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=u=>U())},[d(ae)])):D("",!0),l(n)>-1?(g(),b("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=u=>q())},[d(oe)])):D("",!0)])]),d(le,{thead:l(H),selected:l(n),onSetSelected:t[4]||(t[4]=u=>n.value=u),tbody:l(s),fnCallData:B,scrolling:l(r),onSetScrollingPage:t[5]||(t[5]=u=>l(r).page=u),onDoFilter:t[6]||(t[6]=u=>N())},null,8,["thead","selected","tbody","scrolling"])]),d(ne,{show:l(p),fnClose:()=>{p.value=!1},id:l(w),p_data:l(s),is_copy:l(v)},null,8,["show","fnClose","id","p_data","is_copy"]),d(se,{show:l(C),fnClose:()=>{C.value=!1},id:l(Y),p_data:l(s),is_view:l(y)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{Ge as default};
