import{_ as R}from"./HeaderPopup.vue.910fdc26.js";import{_ as le}from"./client-only.560f86f6.js";import{r as D,f as E,H as se,J as B,g as T,L as oe,h as g,v as I,o as r,c as d,a as e,b as F,k as t,w as ae,q as ne,t as i,l as J,j as U,F as C,n as k,G as x,m as G,s as Q,x as h,y as S}from"./entry.088021ef.js";import{u as W}from"./useUtils.b741a801.js";import{u as A}from"./useMyFetch.38ca3367.js";const ie={class:"box-fixed"},re={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},de={class:"w-full flex flex-col items-center grow overflow-auto"},_e={class:"w-full flex flex-row flex-wrap"},ce={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ue=e("label",{for:""},"U.Jalan Per",-1),pe={key:0,class:"grow"},ve={key:1,class:"grow"},fe={class:"text-red-500"},we={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},me=e("label",{for:""},"Jenis",-1),xe=["disabled"],he=e("option",{value:"TBS"},"TBS",-1),be=e("option",{value:"TBSK"},"TBSK",-1),ge=e("option",{value:"CPO"},"CPO",-1),ye=e("option",{value:"PK"},"PK",-1),$e=[he,be,ge,ye],je={class:"text-red-500"},Ce={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ke=e("label",{for:""},"Supir",-1),De=["disabled"],Ve={id:"supir"},Be=["value"],Te={class:"text-red-500"},Se={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ae=e("label",{for:""},"Kernet",-1),Pe=["disabled"],Ye={id:"kernet"},Me=["value"],Ue={class:"text-red-500"},Fe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},qe=e("label",{for:""},"No Pol",-1),Ne=["disabled"],He={id:"vehicle"},Ke=["value"],Je={class:"text-red-500"},ze={key:0,class:"w-full flex flex-wrap"},Le={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Oe=e("label",{for:""},"Tujuan",-1),Re=["disabled"],Ee={class:"text-red-500"},Ie={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ge=e("label",{for:""},"Tipe",-1),Qe=["disabled"],We=["value","selected"],Xe={class:"text-red-500"},Ze={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},et=e("label",{for:""},"Total Dari U.Jalan",-1),tt={class:"card-border disabled"},lt={key:1,class:"w-full flex flex-wrap"},st={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ot=e("label",{for:""},"Cost Center Code",-1),at=["disabled"],nt={id:"cost_center"},it=["value"],rt={class:"text-red-500"},dt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},_t=e("label",{for:""},"Cost Center Desc",-1),ct={class:"card-border disabled"},ut={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},pt=e("label",{for:""},"PVR No",-1),vt={class:"card-border disabled"},ft={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},wt=e("label",{for:""},"PVR Total",-1),mt={class:"card-border disabled"},xt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},ht=e("label",{for:""},"PV",-1),bt={class:"card-border disabled"},gt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},yt=e("label",{for:""},"PV Amount",-1),$t={class:"card-border disabled"},jt={class:"w-full flex items-center justify-end"},Sl={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(f){const _=f,{$moment:$}=Q(),{pointFormat:j}=W(),P={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_to:""};let s={...P};const l=D({...P}),V=E("token"),v=D({}),m=o=>{let a=o.target.value;if(!a){l.value.cost_center_code="",l.value.cost_center_desc="";return}_.list_cost_center.filter(p=>p.CostCenter==a).length==0&&(l.value.cost_center_code="112",l.value.cost_center_desc="Transport")},w=o=>{l.value.transition_to=o.target.value=="TBS"?l.value.transition_to:""},{display:y}=se(),u=async()=>{if(l.value.pv_no&&parseInt(l.value.pv_total)!=parseInt(l.value.amount)){y({show:!0,status:"Failed",message:"Total dari Ujalan dan PV tidak cocok"});return}h().loading_full=!0,v.value={};const o=new FormData;o.append("tanggal",$(l.value.tanggal).format("Y-MM-DD")),o.append("jenis",l.value.jenis),o.append("id_uj",l.value.id_uj),o.append("xto",l.value.xto),o.append("cost_center_code",l.value.cost_center_code),o.append("online_status",_.online_status),o.append("transition_to",l.value.transition_to),o.append("supir",l.value.supir),o.append("kernet",l.value.kernet),o.append("no_pol",l.value.no_pol);let a="post",c=_.id;c==0||(o.append("id",c),o.append("_method","PUT"));const{data:p,error:b,status:n}=await A("/trx_trp",{method:a,headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},body:o,retry:0});if(h().loading_full=!1,n.value==="error"){S().trigger(b,v);return}if(l.value.updated_at=p.value.updated_at,_.id<=0)l.value.id=p.value.id,l.value.created_at=p.value.created_at,_.p_data.unshift(l.value);else{let O=_.p_data.map(te=>te.id).indexOf(_.id);O>=-1&&_.p_data.splice(O,1,{...l.value})}_.fnClose()},q=B(()=>{let o=l.value.jenis=="TBSK"?"TBS":l.value.jenis;return[...new Set(M.value.filter(a=>a.jenis==o).map(a=>a.xto))]}),N=B(()=>{let o=l.value.jenis=="TBSK"?"TBS":l.value.jenis;return M.value.filter(a=>a.xto==l.value.xto&&a.jenis==o)}),Y=B(()=>[...new Set(K.value.filter(o=>o.role=="Supir"))]),H=B(()=>[...new Set(K.value.filter(o=>o.role=="Kernet"))]),X=B(()=>!1),Z=async()=>{h().loading_full=!0;const{data:o,error:a,status:c}=await A("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(h().loading_full=!1,c.value==="error"){S().trigger(a);return}l.value=o.value.data,s={...o.value.data},_.fnLoadDBData()},M=D([]),z=D([]),K=D([]),ee=async()=>{h().loading_full=!0;const{data:o,error:a,status:c}=await A("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},retry:0});if(h().loading_full=!1,c.value==="error"){S().trigger(a);return}M.value=o.value.list_ujalan,z.value=o.value.list_vehicle,K.value=o.value.list_employee};T(()=>_.show,async(o,a)=>{o==!0&&(await ee(),await _.fnLoadDBData(),l.value={...P},v.value={},_.id!=0&&Z())},{immediate:!0}),T(()=>l.value.cost_center_code,(o,a)=>{let c="";if(o==""||o){let p=_.list_cost_center.filter(b=>b.CostCenter==l.value.cost_center_code);p.length>0?c=p[0].Description:l.value.cost_center_code==s.cost_center_code&&(c=s.cost_center_desc),l.value.cost_center_desc=c}},{deep:!0,immediate:!0});const L=(o,a)=>{let c=0,p="";if(o==""||o){let b=M.value.filter(n=>n.id==l.value.id_uj);b.length>0?(c=b[0].harga,p=b[0].tipe):l.value.id_uj==s.id_uj&&(c=s.amount,p=s.tipe),l.value.tipe=p,l.value.amount=c}};return T(()=>l.value.xto,(o,a)=>{_.show&&L(o)},{deep:!0,immediate:!0}),T(()=>l.value.id_uj,(o,a)=>{_.show&&L(o)},{deep:!0,immediate:!0}),(o,a)=>{const c=R,p=oe("vue-date-picker"),b=le;return g((r(),d("section",ie,[e("div",null,[F(c,{title:"Form Transaction",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",re,[e("div",de,[e("div",_e,[e("div",ce,[ue,t(l).val!==1?(r(),d("div",pe,[F(b,null,{default:ae(()=>[F(p,{modelValue:t(l).tanggal,"onUpdate:modelValue":a[0]||(a[0]=n=>t(l).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(r(),d("div",ve,[e("div",{class:ne(["card-border disabled",t(l).pvr_no!=""?"unselectable":""])},i(t(l).tanggal?t($)(t(l).tanggal).format("DD-MM-YYYY"):""),3)])),e("p",fe,i(t(v).tanggal),1)]),e("div",we,[me,g(e("select",{"onUpdate:modelValue":a[1]||(a[1]=n=>t(l).jenis=n),onChange:a[2]||(a[2]=n=>w(n)),disabled:t(l).val==1},$e,40,xe),[[J,t(l).jenis]]),e("p",je,i(t(v).jenis),1)]),e("div",Ce,[ke,g(e("input",{type:"text",list:"supir","onUpdate:modelValue":a[3]||(a[3]=n=>t(l).supir=n),disabled:t(l).val==1},null,8,De),[[U,t(l).supir]]),e("datalist",Ve,[(r(!0),d(C,null,k(t(Y),n=>(r(),d("option",{value:n.name},i(n.name),9,Be))),256))]),e("p",Te,i(t(v).supir),1)]),e("div",Se,[Ae,g(e("input",{type:"text",list:"kernet","onUpdate:modelValue":a[4]||(a[4]=n=>t(l).kernet=n),disabled:t(l).val==1},null,8,Pe),[[U,t(l).kernet]]),e("datalist",Ye,[(r(!0),d(C,null,k(t(H),n=>(r(),d("option",{value:n.name},i(n.name),9,Me))),256))]),e("p",Ue,i(t(v).kernet),1)]),e("div",Fe,[qe,g(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=n=>t(l).no_pol=n),disabled:t(l).val==1},null,8,Ne),[[U,t(l).no_pol]]),e("datalist",He,[(r(!0),d(C,null,k(t(z),n=>(r(),d("option",{value:n.no_pol},i(n.no_pol),9,Ke))),256))]),e("p",Je,i(t(v).no_pol),1)]),t(l).jenis!=""?(r(),d("div",ze,[e("div",Le,[Oe,g(e("select",{"onUpdate:modelValue":a[6]||(a[6]=n=>t(l).xto=n),disabled:t(l).val==1},[(r(!0),d(C,null,k(t(q),n=>(r(),d("option",null,i(n),1))),256))],8,Re),[[J,t(l).xto]]),e("p",Ee,i(t(v).xto),1)]),e("div",Ie,[Ge,g(e("select",{"onUpdate:modelValue":a[7]||(a[7]=n=>t(l).id_uj=n),disabled:t(l).val==1},[(r(!0),d(C,null,k(t(N),n=>(r(),d("option",{value:n.id,selected:n.id==t(l).id_uj},i(n.tipe),9,We))),256))],8,Qe),[[J,t(l).id_uj]]),e("p",Xe,i(t(v).id_uj),1)]),e("div",Ze,[et,e("div",tt,i(t(j)(t(l).amount)),1)])])):x("",!0),t(l).jenis!=""?(r(),d("div",lt,[e("div",st,[ot,g(e("input",{list:"cost_center","onUpdate:modelValue":a[8]||(a[8]=n=>t(l).cost_center_code=n),onBlur:a[9]||(a[9]=n=>m(n)),disabled:t(l).pvr_no!=""},null,40,at),[[U,t(l).cost_center_code]]),e("datalist",nt,[(r(!0),d(C,null,k(f.list_cost_center,n=>(r(),d("option",{value:n.CostCenter},i(n.CostCenter+"-"+n.Description),9,it))),256))]),e("p",rt,i(t(v).cost_center_code),1)]),e("div",dt,[_t,e("div",ct,i(t(l).cost_center_desc),1)]),e("div",ut,[pt,e("div",vt,i(t(l).pvr_no),1)]),e("div",ft,[wt,e("div",mt,i(t(j)(t(l).pvr_total||0)),1)]),e("div",xt,[ht,e("div",bt,i(t(l).pv_no),1)]),e("div",gt,[yt,e("div",$t,i(t(j)(t(l).pv_total)),1)])])):x("",!0)])]),e("div",jt,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[10]||(a[10]=n=>f.fnClose())}," Cancel "),t(X)?x("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[11]||(a[11]=G(n=>u(),["prevent"]))}," Save "))])])])],512)),[[I,f.show]])}}},Ct={class:"box-fixed"},kt={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Dt={class:"w-full flex flex-col items-center grow overflow-auto"},Vt={class:"w-full flex flex-row flex-wrap"},Bt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Tt=e("label",{for:""},"U.Jalan Per",-1),St={class:"card-border"},At={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Pt=e("label",{for:""},"Jenis",-1),Yt={class:"card-border"},Mt={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ut=e("label",{for:""},"Supir",-1),Ft={class:"card-border"},qt={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Nt=e("label",{for:""},"Kernet",-1),Ht={class:"card-border"},Kt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Jt=e("label",{for:""},"No Pol",-1),zt={class:"card-border"},Lt={key:0,class:"w-full flex flex-wrap"},Ot={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Rt=e("label",{for:""},"Tujuan",-1),Et={class:"card-border"},It={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Gt=e("label",{for:""},"Tipe",-1),Qt={class:"card-border"},Wt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Xt=e("label",{for:""},"Total Dari U.Jalan",-1),Zt={class:"card-border"},el={key:1,class:"w-full flex flex-wrap"},tl={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ll=e("label",{for:""},"Cost Center Code",-1),sl={class:"card-border"},ol={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},al=e("label",{for:""},"Cost Center Desc",-1),nl={class:"card-border"},il={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},rl=e("label",{for:""},"PVR No",-1),dl={class:"card-border"},_l={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},cl=e("label",{for:""},"PVR Total",-1),ul={class:"card-border"},pl={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},vl=e("label",{for:""},"PV",-1),fl={class:"card-border"},wl={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ml=e("label",{for:""},"PV Amount",-1),xl={class:"card-border"},hl={class:"w-full flex items-center justify-end"},bl={class:"w-full flex flex-wrap p-3 items-center"},gl=e("div",null," Di Validasi oleh : ",-1),yl={key:0,class:"border-solid border-2 w-fit p-1 bg-slate-700 text-white text-xs"},$l={key:0},jl={key:1},Cl={key:2},Al={__name:"trx_trp_validasi",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_view:{type:Boolean,required:!1,default:!1}},setup(f){const _=f,{$moment:$}=Q(),{pointFormat:j}=W(),s=D({...{id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",val:0,val_by:{username:""},val_at:"",val1:0,val1_by:{username:""},val1_at:"",val2:0,val2_by:{username:""},val2_at:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:"",pvr_had_detail:""}}),l=E("token"),V=async()=>{h().loading_full=!0;const m=new FormData;let w="post",y=_.id;y==0||(m.append("id",y),m.append("_method","PUT"));const{data:u,error:q,status:N}=await A("/trx_trp_validasi",{method:w,headers:{Authorization:`Bearer ${l.value}`,Accept:"application/json"},body:m,retry:0});if(h().loading_full=!1,N.value==="error"){S().trigger(q);return}s.value.val=u.value.val,s.value.val_user=u.value.val_user,s.value.val_by=u.value.val_by,s.value.val_at=u.value.val_at,s.value.val1=u.value.val1,s.value.val1_user=u.value.val1_user,s.value.val1_by=u.value.val1_by,s.value.val1_at=u.value.val1_at,s.value.val2=u.value.val2,s.value.val2_user=u.value.val2_user,s.value.val2_by=u.value.val2_by,s.value.val2_at=u.value.val2_at;let Y=_.p_data.map(H=>H.id).indexOf(_.id);Y>=-1&&_.p_data.splice(Y,1,{...s.value}),_.fnClose()},v=async()=>{h().loading_full=!0;const{data:m,error:w,status:y}=await A("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${l.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(h().loading_full=!1,y.value==="error"){S().trigger(w);return}s.value=m.value.data};return T(()=>_.show,(m,w)=>{m==!0&&v()},{immediate:!0}),(m,w)=>{const y=R;return g((r(),d("section",Ct,[e("div",null,[F(y,{title:"Form Transaction Validation",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",kt,[e("div",Dt,[e("div",Vt,[e("div",Bt,[Tt,e("div",St,i(t(s).tanggal?t($)(t(s).tanggal).format("DD-MM-YYYY"):""),1)]),e("div",At,[Pt,e("div",Yt,i(t(s).jenis),1)]),e("div",Mt,[Ut,e("div",Ft,i(t(s).supir),1)]),e("div",qt,[Nt,e("div",Ht,i(t(s).kernet),1)]),e("div",Kt,[Jt,e("div",zt,i(t(s).no_pol),1)]),t(s).jenis!=""?(r(),d("div",Lt,[e("div",Ot,[Rt,e("div",Et,i(t(s).xto),1)]),e("div",It,[Gt,e("div",Qt,i(t(s).tipe),1)]),e("div",Wt,[Xt,e("div",Zt,i(t(j)(t(s).amount||0)),1)])])):x("",!0),t(s).jenis!=""?(r(),d("div",el,[e("div",tl,[ll,e("div",sl,i(t(s).cost_center_code),1)]),e("div",ol,[al,e("div",nl,i(t(s).cost_center_desc),1)]),e("div",il,[rl,e("div",dl,i(t(s).pvr_no),1)]),e("div",_l,[cl,e("div",ul,i(t(j)(t(s).pvr_total||0)),1)]),e("div",pl,[vl,e("div",fl,i(t(s).pv_no),1)]),e("div",wl,[ml,e("div",xl,i(t(j)(t(s).pv_total||0)),1)])])):x("",!0)])]),e("div",hl,[e("div",bl,[gl,t(s).val||t(s).val1||t(s).val2?(r(),d("div",yl,[t(s).val?(r(),d("div",$l," App 1 : "+i(t(s).val_by.username)+" ( "+i(t(s).val_at?t($)(t(s).val_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):x("",!0),t(s).val1?(r(),d("div",jl," App 2 : "+i(t(s).val1_by.username)+" ( "+i(t(s).val1_at?t($)(t(s).val1_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):x("",!0),t(s).val2?(r(),d("div",Cl," App 3 : "+i(t(s).val2_by.username)+" ( "+i(t(s).val2_at?t($)(t(s).val2_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):x("",!0)])):x("",!0)]),e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:w[0]||(w[0]=u=>f.fnClose())}," Cancel "),f.is_view==0?(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:w[1]||(w[1]=G(u=>V(),["prevent"]))}," Validasi ")):x("",!0)])])])],512)),[[I,f.show]])}}};export{Sl as _,Al as a};
