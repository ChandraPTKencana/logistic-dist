import de from"./Header.b86d183c.js";import _e from"./Plus.d534fdc4.js";import pe from"./Edit.74a992c5.js";import me from"./Signature.1c90785e.js";import fe from"./Table2Column.02116494.js";import ve from"./TableUp.526aa14e.js";import ye from"./Calculator.00cb98e4.js";import he from"./Line.6d52a1d4.js";import ge from"./Check.9ea31e10.js";import{_ as we}from"./PopupMini.vue.66369f07.js";import ke from"./rpt_salary.c5e7080e.js";import xe from"./rpt_salary_validasi.a7cc71f9.js";import be from"./rpt_salary_check.76058757.js";import{g as Ce,h as De,r as n,B as Ae,j as U,s as $e,f as Te,c as _,b as p,a as o,l as t,n as y,F as Se,D as Fe,w as Me,q as Be,x as c,y as h,o as i,E as Pe,z as j,t as $,d as ze,k as Ee,A as Ie,m as Le,G as Re}from"./entry.8d433bfd.js";import{u as z}from"./useUtils.eb752aee.js";import{u as g}from"./useMyFetch.373a87d8.js";import{u as Ue}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Times.6a55b48e.js";import"./Exclamation.6ea5854d.js";import"./HeaderPopup.vue.b5ecad76.js";import"./client-only.c87b4383.js";import"./Refresh.0f85080c.js";const je={class:"w-full h-full flex flex-col"},Ne={class:"w-full flex grow flex-col overflow-auto h-0"},He={class:"w-full flex"},Oe={class:"w-full flex justify-center items-center grow h-0 p-1"},Ve={key:0,class:""},Ye={class:"tacky"},Je=o("thead",null,[o("tr",{class:"sticky top-0 !z-[2]"},[o("th",null,"Logistik"),o("th",null,"ID"),o("th",null,"Period End"),o("th",null,"Created At"),o("th",null,"Updated At")])],-1),qe=["onClick"],Ge={class:"flex items-center justify-center"},We={class:"bold"},Xe={class:"grow mb-5"},bt={__name:"rpt",async setup(Ze){let k,E;const{$moment:T}=Re(),m={};m._TimeZoneOffset=new Date().getTimezoneOffset(),m.sort="created_at:desc";const v=Ce("token"),{data:N}=([k,E]=De(async()=>Be(async()=>{let e=[];c().loading_full=!0;const{data:a,error:u,status:f}=await g("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:m,retry:0});return c().loading_full=!1,f.value==="error"?(h().trigger(u),{rpt_salarys:e}):(e=a.value.data,{rpt_salarys:e})},"$fWJlXxIgiP")),k=await k,E(),k),l=n(N.value.rpt_salarys);n(""),n({field:"created_at",by:"desc"});const s=n(-1),d=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),x=n(null),H=async()=>{c().loading_full=!0,d.value.may_get_data=!1,m.page=d.value.page,m.page==1&&(l.value=[]),m.first_row&&delete m.first_row,m.page>1&&(m.first_row=JSON.stringify(l.value[0]));const{data:e,error:a,status:u}=await g("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:m,retry:0});if(c().loading_full=!1,d.value.may_get_data=!0,u.value==="error"){h().trigger(a);return}d.value.page==1?(l.value=e.value.data,x.value&&(x.value.scrollTop=0)):d.value.page>1&&(l.value=[...l.value,...e.value.data]),e.value.data.length==0&&(d.value.is_last_record=!0)},O=async()=>{if(!d.value.may_get_data)return;let e=x.value;if(e.scrollLeft!=d.value.scrollLeft){d.value.scrollLeft=e.scrollLeft;return}d.value.is_last_record||!(Math.round(e.scrollTop)+e.clientHeight>=e.scrollHeight-1)||(d.value.page++,await H())};Ae();const b=n(!1),S=n(0),C=n(0),V=()=>{S.value=0,b.value=!0,C.value=!1},{display:D}=U();$e(U());const Y=()=>{s.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=l.value[s.value].id,b.value=!0,C.value=!1)},F=n(!1),I=n(0),J=()=>{s.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=l.value[s.value].id,C.value=!0,F.value=!0)},M=n(!1),q=n({}),A=n(!1),w=n(""),G=async()=>{A.value&&(A.value=!1)};Te(()=>w.value,e=>{e.trim().length>0?M.value=!0:M.value=!1},{immediate:!1});const W=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",l.value[s.value].id),e.append("deleted_reason",w.value),e.append("_method","DELETE");const{data:a,error:u,status:f}=await g("/rpt_salary",{method:"post",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,f.value==="error"){h().trigger(u);return}l.value.splice(s.value,1),s.value=-1,A.value=!1},{downloadFile:L,viewFile:Ke}=Ue();n(!1),n({});const X=async()=>{c().loading_full=!0;const{data:e,error:a,status:u}=await g("/rpt_salary/excel_download",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{id:l.value[s.value].id},retry:0});if(c().loading_full=!1,u.value==="error"){h().trigger(a);return}L(e.value)},Z=async()=>{c().loading_full=!0;const{data:e,error:a,status:u}=await g("/rpt_salary/excel_download2",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{id:l.value[s.value].id},retry:0});if(c().loading_full=!1,u.value==="error"){h().trigger(a);return}L(e.value)},R=n(0),B=n(!1),K=()=>{s.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(R.value=l.value[s.value].id,B.value=!0)},Q=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",l.value[s.value].id);const{data:a,error:u,status:f}=await g("/rpt_salary/recal_trip",{method:"post",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,f.value==="error"){h().trigger(u);return}D({show:!0,status:"Success",message:"Recal Trip Done"})};return(e,a)=>{const u=de,f=_e,ee=pe,te=me,ae=fe,oe=ve,le=ye,se=he,ne=ge,re=we,ue=ke,ie=xe,ce=be;return i(),_("div",je,[p(u,{title:"List Salary Paid"}),o("div",Ne,[o("div",He,[("useUtils"in e?e.useUtils:t(z))().checkPermission("rpt_salary.create")?(i(),_("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=r=>V())},[p(f)])):y("",!0),("useUtils"in e?e.useUtils:t(z))().checkPermissions(["rpt_salary.modify"])?(i(),_("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=r=>Y())},[p(ee)])):y("",!0),("useUtils"in e?e.useUtils:t(z))().checkPermissions(["rpt_salary.val1","rpt_salary.val2","rpt_salary.val3"])?(i(),_("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=r=>J())},[p(te)])):y("",!0),t(s)>-1&&t(l)[t(s)].val1==1?(i(),_("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=r=>X())},[p(ae)])):y("",!0),t(s)>-1&&t(l)[t(s)].val1==1?(i(),_("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[4]||(a[4]=r=>Z())},[p(oe)])):y("",!0),t(s)>-1&&t(l)[t(s)].val1==1?(i(),_("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[5]||(a[5]=r=>Q())},[p(le)])):y("",!0),o("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:a[6]||(a[6]=r=>K())}," Check Nilai ")]),o("div",Oe,[t(l).length==0?(i(),_("div",Ve," Maaf Tidak Ada Record ")):(i(),_("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:x,onScroll:O},[o("table",Ye,[Je,o("tbody",null,[(i(!0),_(Se,null,Fe(t(l),(r,P)=>(i(),_("tr",{key:P,onClick:Qe=>s.value=P,class:Pe(t(s)==P?"active":"")},[o("td",null,[o("div",Ge,[r.val1?(i(),j(ne,{key:1})):(i(),j(se,{key:0}))])]),o("td",We,$(r.id),1),o("td",null,$(r.period_end?t(T)(r.period_end).format("MM-Y"):""),1),o("td",null,$(r.created_at?t(T)(r.created_at).format("DD-MM-Y HH:mm:ss"):""),1),o("td",null,$(r.updated_at?t(T)(r.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,qe))),128))])])],544))])]),p(re,{type:"delete",show:t(A),data:t(q),fnClose:G,fnConfirm:W,enabledOk:t(M)},{footer:Me(()=>[ze(" Masukkan Alasan Penghapusan: "),o("div",Xe,[Ee(o("textarea",{"onUpdate:modelValue":a[7]||(a[7]=r=>Le(w)?w.value=r:null)},null,512),[[Ie,t(w)]])])]),_:1},8,["show","data","enabledOk"]),p(ue,{show:t(b),fnClose:()=>{b.value=!1},id:t(S),p_data:t(l),is_copy:t(C)},null,8,["show","fnClose","id","p_data","is_copy"]),p(ie,{show:t(F),fnClose:()=>{F.value=!1},id:t(I),p_data:t(l)},null,8,["show","fnClose","id","p_data"]),p(ce,{show:t(B),fnClose:()=>{B.value=!1},id:t(R)},null,8,["show","fnClose","id"])])}}};export{bt as default};
