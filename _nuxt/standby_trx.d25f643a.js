import{_ as xe}from"./HeaderPopup.vue.76d2fee8.js";import{_ as ye}from"./WidthMiniList.vue.6b6ea8d2.js";import be from"./Tools.37ee6b5b.js";import{_ as ke}from"./client-only.2ddfa6d7.js";import ge from"./AttachmentSingle.e3249a50.js";import Se from"./Times.5b5e07d6.js";import Ne from"./Check.06cab63b.js";import Ce from"./Plus.0c9dd364.js";import Ue from"./ToolsPopup.824c6915.js";import{r as f,g as Ve,j as Ie,i as te,f as se,x as N,I as De,o as r,c as u,k as g,J as Te,a as e,b,l as t,A as O,F as I,D as E,t as c,v as le,n as D,w as ae,E as Ae,z as oe,C as Oe,y as M,p as Ee,e as Je,G as Pe}from"./entry.379a219d.js";import{u as ne}from"./useUtils.eceb15d4.js";import{u as B}from"./useMyFetch.55d023bc.js";import{_ as $e}from"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.c0bfb0ce.js";import"./PDFJsView.a854b46c.js";const i=S=>(Ee("data-v-f757ddf2"),S=S(),Je(),S),je={class:"box-fixed"},Fe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Re={class:"w-full flex flex-col items-center grow overflow-auto"},Me={class:"w-full flex flex-row flex-wrap"},Be={class:"w-full sm:w-9/12 flex px-2 py-3"},ze={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},Ke=i(()=>e("div",{class:"absolute bg-white -top-3"}," Standby ",-1)),qe={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},He=i(()=>e("label",{for:""},"ID",-1)),Le=["disabled"],We={id:"standby_mst"},Ye=["value"],Ge={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Qe=i(()=>e("label",{for:""},"Name",-1)),Ze={class:"card-border disabled"},et={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},tt=i(()=>e("label",{for:""},"Type",-1)),st={class:"card-border disabled"},lt={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},at=i(()=>e("label",{for:""},"Amount",-1)),ot={class:"card-border disabled"},nt={class:"w-full sm:w-3/12 flex px-2 py-3"},it={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative items-end"},_t=i(()=>e("div",{class:"absolute bg-white -top-3"}," Peralihan ",-1)),rt={class:"w-6/12 flex flex-col flex-wrap p-1"},dt=["disabled"],ut=i(()=>e("option",{value:""},null,-1)),ct=i(()=>e("option",{value:"From"},"Dari",-1)),pt=i(()=>e("option",{value:"To"},"Ke",-1)),mt=[ut,ct,pt],vt={class:"text-red-500"},ft={class:"w-6/12 flex flex-col flex-wrap p-1"},wt=["disabled"],ht=i(()=>e("option",{value:""},null,-1)),xt=["value"],yt={class:"text-red-500"},bt={class:"w-full flex flex-wrap"},kt={key:0,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},gt=i(()=>e("label",{for:""},"Supir",-1)),St={class:"text-red-500"},Nt={key:1,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ct=i(()=>e("label",{for:""},"Kernet",-1)),Ut={class:"text-red-500"},Vt={class:"w-full flex flex-wrap"},It={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Dt=i(()=>e("label",{for:""},"No Pol",-1)),Tt=["disabled"],At={id:"vehicle"},Ot=["value"],Et={class:"text-red-500"},Jt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Pt=i(()=>e("label",{for:""},"Tujuan",-1)),$t=["disabled"],jt={id:"xto"},Ft={class:"text-red-500"},Rt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Mt=i(()=>e("label",{for:""},"Note For Remarks",-1)),Bt=["disabled"],zt={class:"text-red-500"},Kt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},qt=i(()=>e("label",{for:""},"Trx Trp ID#",-1)),Ht=["disabled"],Lt={class:"text-red-500"},Wt={class:"w-full flex grow p-1 overflow-auto 2xl:overflow-hidden justify-between flex-wrap"},Yt={class:"w-full",role:"sticky"},Gt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Xt={class:"sticky -top-1 !z-[2]"},Qt=["colspan"],Zt={class:"sticky top-7 !z-[2]"},es={key:0,class:"!min-w-[30px] !w-[30px] !max-w-[30px]"},ts=i(()=>e("th",{class:"!min-w-[50px] !w-[50px] !max-w-[50px]"},"No",-1)),ss=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Tanggal",-1)),ls=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Waktu",-1)),as=i(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Foto",-1)),os=i(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Note",-1)),ns=i(()=>e("th",{class:"!min-w-[70px] !w-[70px] !max-w-[70px]"},"Dibayar",-1)),is={ref:"to_move"},_s=["data-index"],rs={key:0,class:"tools cell"},ds={class:"w-full h-full flex items-center justify-center"},us=["onClick"],cs={class:"cell"},ps={class:"w-full h-full flex items-center justify-center relative"},ms={class:"cell"},vs={class:"w-full h-full flex items-center justify-center relative"},fs={class:"cell"},ws={style:{width:"60vw"},class:"h-full flex items-center justify-center"},hs={class:"cell"},xs={class:"h-full flex items-center justify-center"},ys=["onUpdate:modelValue"],bs={class:"w-full h-full flex items-center justify-center"},ks={key:0},gs={class:"tools cell"},Ss={class:"w-full flex items-center justify-end"},Ns={__name:"standby_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(S){const k=S,{$moment:ie}=Pe(),{pointFormat:z}=ne(),$={id:-1,transition_target:"",transition_type:"",standby_mst_id:"",standby_mst_:{name:"",tipe:"",amount:0,is_transition:0},supir:"",kernet:"",no_pol:"",xto:"",note_for_remarks:"",trx_trp_id:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:0,pv_id:"",pv_no:"",pv_total:0,pv_datetime:"",rv_id:"",rv_no:"",rv_total:0,rv_had_detail:"",details:[],details_count:0},d=f([]),K=f({ordinal:0,id:"",tanggal:new Date,waktu:{hours:new Date().getHours(),minutes:new Date().getMinutes()},note:"",be_paid:0,p_status:"",attachment_1:"",attachment_1_preview:""});let j={...$};const s=f({...$}),F=Ve("token"),w=f({});Ie();const _e=async()=>{N().loading_full=!0,w.value={};const o=new FormData;o.append("transition_target",s.value.transition_target),o.append("transition_type",s.value.transition_type),o.append("standby_mst_id",s.value.standby_mst_id),o.append("supir_id",p.value.id),o.append("kernet_id",m.value.id),o.append("no_pol",s.value.no_pol),o.append("xto",s.value.xto),o.append("note_for_remarks",s.value.note_for_remarks),o.append("trx_trp_id",s.value.trx_trp_id);let l=[...d.value];l=l.map((_,A)=>(_.tanggal=_.tanggal?ie(_.tanggal).format("Y-MM-DD"):"",_.waktu=_.waktu?_.waktu.hours+":"+_.waktu.minutes:"",_.attachment_1_preview=_.attachment_1_preview?"Exists":null,o.append(`attachments[${A}]`,_.attachment_1),_)),o.append("details",JSON.stringify(l));let x="post",n=k.id;n==0||(o.append("id",n),o.append("_method","PUT"));const{data:U,error:v,status:V}=await B("/standby_trx",{method:x,headers:{Authorization:`Bearer ${F.value}`,Accept:"application/json"},body:o,retry:0});if(N().loading_full=!1,V.value==="error"){M().trigger(v,w);return}if(s.value.details=[...d.value].map((_,A)=>(_.attachment_1_type=_.attachment_1_preview?"Exists":"",_)),s.value.details_count=d.value.length,s.value.supir=p.value.name,s.value.supir_rek_no=p.value._.rek_no.val,s.value.supir_rek_name=p.value._.rek_name.val,s.value.kernet=m.value.name,s.value.kernet_rek_no=m.value._.rek_no.val,s.value.kernet_rek_name=m.value._.rek_name.val,s.value.updated_at=U.value.updated_at,k.id<=0)s.value.id=U.value.id,s.value.created_at=U.value.created_at,k.p_data.unshift(s.value);else{let _=k.p_data.map(A=>A.id).indexOf(k.id);_>=-1&&k.p_data.splice(_,1,{...s.value})}k.fnClose()},C={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},p=f(JSON.parse(JSON.stringify(C))),m=f(JSON.parse(JSON.stringify(C))),q=te(()=>{let o=[];return W.value.forEach((l,x)=>{let n=JSON.parse(JSON.stringify(C));n._.id.val=l.id,n._.name.val=l.name,n._.rek_no.val=l.rek_no,n._.rek_name.val=l.rek_name,n.id=l.id,n.name=l.name,n.title=(l.rek_no||"")+" "+(l.rek_name||""),o.push(JSON.parse(JSON.stringify(n)))}),o}),T=te(()=>!1),re=async()=>{N().loading_full=!0;const{data:o,error:l,status:x}=await B("/standby_trx",{method:"get",headers:{Authorization:`Bearer ${F.value}`,Accept:"application/json"},params:{id:k.id},retry:0});if(N().loading_full=!1,x.value==="error"){M().trigger(l);return}let n=o.value.data;s.value=n,j={...n},p.value._.id.val=n.supir_id,p.value._.name.val=n.supir,p.value._.rek_no.val=n.supir_rek_no,p.value._.rek_name.val=n.supir_rek_name,p.value.id=n.supir_id,p.value.name=n.supir,p.value.rek_no=(n.supir_rek_no||"")+" "+(n.supir_rek_name||""),m.value._.id.val=n.kernet_id,m.value._.name.val=n.kernet,m.value._.rek_no.val=n.kernet_rek_no,m.value._.rek_name.val=n.kernet_rek_name,m.value.id=n.kernet_id,m.value.name=n.kernet,m.value.rek_no=(n.kernet_rek_no||"")+" "+(n.kernet_rek_name||"");let U="Edit";d.value=o.value.data.details.map(v=>{if(v.waktu!=""){let V=v.waktu.split(":");v.waktu={hours:V[0],minutes:V[1]}}else v.waktu=null;return v.p_status=U,v.key=v.ordinal,v})},R=f([]),H=f([]),L=f([]),W=f([]),de=async()=>{N().loading_full=!0;const{data:o,error:l,status:x}=await B("/standby_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${F.value}`,Accept:"application/json"},retry:0});if(N().loading_full=!1,x.value==="error"){M().trigger(l);return}R.value=o.value.list_standby_mst,H.value=o.value.list_xto,L.value=o.value.list_vehicle,W.value=o.value.list_employee},h=f(-1),J=f(!1),Y=f({left:0,top:0}),ue=(o,l)=>{h.value=l,J.value=!0,Y.value={left:o.clientX,top:o.clientY}},ce=()=>{d.value.push({...K.value,p_status:"Add"})},pe=()=>{J.value=!1},me=(o="")=>{if(o=="insert")d.value.splice(h.value,0,{...K.value,p_status:"Add"});else if(o=="delete")d.value[h.value].p_status=="Edit"?d.value[h.value].p_status="Remove":d.value.splice(h.value,1);else if(o=="move_top"){let l=d.value[h.value];d.value.splice(h.value,1),d.value.splice(h.value-1,0,{...l})}else if(o=="move_bottom"){let l=d.value[h.value];d.value.splice(h.value,1),d.value.splice(h.value+1,0,{...l})}J.value=!1};se(()=>k.show,async(o,l)=>{o==!0&&(await de(),s.value={...$},p.value=JSON.parse(JSON.stringify(C)),m.value=JSON.parse(JSON.stringify(C)),d.value=[],w.value={},k.id!=0&&re())},{immediate:!0});let ve={name:"",tipe:"",amount:0,is_transition:0};return se(()=>s.value.standby_mst_id,(o,l)=>{if(N().loading_full==!1&&(o==""||o!="")){let x=R.value.filter(n=>n.id==o);x.length>0?s.value.standby_mst_={...x[0]}:s.value.standby_mst_id==j.standby_mst_id?s.value.standby_mst_={...j.standby_mst_}:s.value.standby_mst_={...ve},s.value.standby_mst_.is_transition||(s.value.transition_target="",s.value.transition_type="")}},{}),(o,l)=>{var G,X,Q,Z,ee;const x=xe,n=ye,U=be,v=De("vue-date-picker"),V=ke,_=ge,A=Se,fe=Ne,we=Ce,he=Ue;return r(),u(I,null,[g(e("section",je,[e("div",null,[b(x,{title:"Form Transaction",fn:S.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Fe,[e("div",Re,[e("div",Me,[e("div",Be,[e("div",ze,[Ke,e("div",qe,[He,g(e("input",{type:"text",list:"standby_mst","onUpdate:modelValue":l[0]||(l[0]=a=>t(s).standby_mst_id=a),disabled:t(s).pvr_no!=""},null,8,Le),[[O,t(s).standby_mst_id]]),e("datalist",We,[(r(!0),u(I,null,E(t(R),a=>(r(),u("option",{value:a.id},c(a.name+"-"+a.tipe+"-"+t(z)(a.amount||0)),9,Ye))),256))]),e("p",Ge,c(t(w).standby_mst_id),1)]),e("div",Xe,[Qe,e("div",Ze,c((G=t(s).standby_mst_)==null?void 0:G.name),1)]),e("div",et,[tt,e("div",st,c((X=t(s).standby_mst_)==null?void 0:X.tipe),1)]),e("div",lt,[at,e("div",ot,c(t(z)((Q=t(s).standby_mst_)==null?void 0:Q.amount)),1)])])]),e("div",nt,[e("div",it,[_t,e("div",rt,[g(e("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>t(s).transition_type=a),disabled:((Z=t(s).standby_mst_)==null?void 0:Z.is_transition)==0},mt,8,dt),[[le,t(s).transition_type]]),e("p",vt,c(t(w).transition_type),1)]),e("div",ft,[g(e("select",{"onUpdate:modelValue":l[2]||(l[2]=a=>t(s).transition_target=a),disabled:((ee=t(s).standby_mst_)==null?void 0:ee.is_transition)==0},[ht,(r(!0),u(I,null,E(t(N)().list_pabrik,a=>(r(),u("option",{value:a},c(a),9,xt))),256))],8,wt),[[le,t(s).transition_target]]),e("p",yt,c(t(w).transition_target),1)])])]),e("div",bt,[["SUPIR","SUPIR KERNET"].indexOf(t(s).standby_mst_.driver_asst_opt)>-1?(r(),u("div",kt,[gt,b(n,{arr:t(q),selected:t(p),pure:C,onSetSelected:l[3]||(l[3]=a=>p.value=a)},null,8,["arr","selected"]),e("p",St,c(t(w).supir_id),1)])):D("",!0),["KERNET","SUPIR KERNET"].indexOf(t(s).standby_mst_.driver_asst_opt)>-1?(r(),u("div",Nt,[Ct,b(n,{arr:t(q),selected:t(m),pure:C,onSetSelected:l[4]||(l[4]=a=>m.value=a)},null,8,["arr","selected"]),e("p",Ut,c(t(w).kernet_id),1)])):D("",!0)]),e("div",Vt,[e("div",It,[Dt,g(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":l[5]||(l[5]=a=>t(s).no_pol=a),disabled:t(s).pvr_no!=""},null,8,Tt),[[O,t(s).no_pol]]),e("datalist",At,[(r(!0),u(I,null,E(t(L),a=>(r(),u("option",{value:a.no_pol},c(a.no_pol),9,Ot))),256))]),e("p",Et,c(t(w).no_pol),1)]),e("div",Jt,[Pt,g(e("input",{type:"text",list:"xto","onUpdate:modelValue":l[6]||(l[6]=a=>t(s).xto=a),disabled:t(s).pvr_no!=""},null,8,$t),[[O,t(s).xto]]),e("datalist",jt,[(r(!0),u(I,null,E(t(H),a=>(r(),u("option",null,c(a),1))),256))]),e("p",Ft,c(t(w).xto),1)]),e("div",Rt,[Mt,g(e("textarea",{"onUpdate:modelValue":l[7]||(l[7]=a=>t(s).note_for_remarks=a),disabled:t(s).pvr_no!=""}," ",8,Bt),[[O,t(s).note_for_remarks]]),e("p",zt,c(t(w).note_for_remarks),1)]),e("div",Kt,[qt,g(e("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=a=>t(s).trx_trp_id=a),disabled:t(s).pvr_no!=""},null,8,Ht),[[O,t(s).trx_trp_id]]),e("p",Lt,c(t(w).trx_trp_id),1)])]),e("div",Wt,[e("div",Yt,[e("table",Gt,[e("thead",null,[e("tr",Xt,[e("td",{colspan:t(T)?6:7,class:"!bg-slate-800 text-white font-bold"}," Detail Transaction ",8,Qt)]),e("tr",Zt,[t(T)?D("",!0):(r(),u("th",es)),ts,ss,ls,as,os,ns])]),e("tbody",is,[(r(!0),u(I,null,E(t(d),(a,P)=>(r(),u(I,{key:P},[a.p_status!="Remove"?(r(),u("tr",{key:0,"data-index":P},[t(T)?D("",!0):(r(),u("td",rs,[e("div",ds,[e("button",{type:"button",name:"button",onClick:y=>ue(y,P)},[b(U)],8,us)])])),e("td",null,c(P+1)+".",1),e("td",cs,[e("div",ps,[b(V,null,{default:ae(()=>[b(v,{modelValue:a.tanggal,"onUpdate:modelValue":y=>a.tanggal=y,type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),e("td",ms,[e("div",vs,[b(V,null,{default:ae(()=>[b(v,{modelValue:a.waktu,"onUpdate:modelValue":y=>a.waktu=y,type:"time",format:"HH:mm","text-input":"","teleport-center":"","time-picker":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),e("td",fs,[e("div",ws,[b(_,{value:a.attachment_1_preview,onSetFile:y=>a.attachment_1=y,onSetPreview:y=>a.attachment_1_preview=y,can_remove:!0},null,8,["value","onSetFile","onSetPreview"])])]),e("td",hs,[e("div",xs,[g(e("textarea",{class:"h-full","onUpdate:modelValue":y=>a.note=y},null,8,ys),[[O,a.note]])])]),e("td",{class:Ae(["cell",(!("useUtils"in o?o.useUtils:t(ne))().checkPermissions(["standby_trx.detail.decide_paid"])||t(T),"unselectable")])},[e("div",bs,[a.be_paid==0?(r(),oe(A,{key:0,class:"text-red-800"})):(r(),oe(fe,{key:1,class:"text-green-800"}))])],2)],8,_s)):D("",!0)],64))),128)),t(T)?D("",!0):(r(),u("tr",ks,[e("td",gs,[e("button",{type:"button",name:"button",onClick:l[9]||(l[9]=a=>ce())},[b(we)])])]))],512)])])])])]),e("div",Ss,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[10]||(l[10]=a=>S.fnClose())}," Cancel "),t(T)?D("",!0):(r(),u("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[11]||(l[11]=Oe(a=>_e(),["prevent"]))}," Save "))])])])],512),[[Te,S.show]]),b(he,{show:t(J),coor:t(Y),fn:pe,data:t(d),data_index:t(h),onReplyAct:l[12]||(l[12]=a=>me(a))},null,8,["show","coor","data","data_index"])],64)}}},Ms=$e(Ns,[["__scopeId","data-v-f757ddf2"]]);export{Ms as default};
