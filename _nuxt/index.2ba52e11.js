import{_ as st}from"./Header.93ab892d.js";import{_ as nt,u as it,a as rt}from"./useDownload.b13204fb.js";import{_ as ut}from"./client-only.d07a5606.js";import{_ as dt}from"./Search.ff0b3543.js";import{_ as ct}from"./PopupMini.vue.8772b81e.js";import{_ as _t}from"./Times.6f4aadd9.js";import{r as i,u as pt,K as ft,I as vt,N as U,O as mt,P as ht,c as k,b as _,a as t,w as E,n as z,s as gt,x as l,q as yt,y as R,z as kt,F as wt,A as bt,M as Tt,L as xt,D as v,E as j,o as w,B as Dt,t as a,U as At,C as Mt}from"./entry.d2d88809.js";import{u as $t}from"./useUtils.100f5b4a.js";import{u as A}from"./useMyFetch.b699b9a2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.453d386b.js";const Bt={class:"w-full h-full flex flex-col"},Ct={class:"w-full flex grow flex-col overflow-auto h-0"},Vt={class:"w-full flex"},jt={action:"#",class:"w-full flex p-1"},Nt=t("div",{class:"font-bold"}," Tgl Dari ",-1),St=t("div",{class:"font-bold"}," Tgl Sampai ",-1),zt={class:"grow"},Pt=t("div",{class:"font-bold"}," Keyword ",-1),Yt={class:"pl-1"},Ft=t("div",{class:"font-bold"}," Sort By ",-1),Ht=At('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Lt=[Ht],Ot={class:"pl-1"},Ut=t("div",{class:"font-bold"}," Sort Order ",-1),Et=t("option",{value:"asc"},"Asc",-1),Rt=t("option",{value:"desc"},"Desc",-1),It=[Et,Rt],Kt={class:"flex items-end pl-1"},Jt={class:"w-full flex justify-center items-center grow h-0 p-1"},Zt={key:0,class:""},qt={class:"tacky"},Gt=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Supir"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),Qt=["onClick"],Wt={class:"bold"},Xt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},te={class:"relative",style:{width:"95%",height:"90%"}},ee={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},le=["src"],he={__name:"index",async setup(oe){let M,P;const{$moment:b}=Mt(),{pointFormat:p}=$t(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="created_at:desc";const Y=i({}),T=pt("token"),f=i({from:new Date,to:new Date}),{data:$}=([M,P]=ft(async()=>xt(async()=>{v().loading_full=!0;let s=[],o=[],c=[],g=[],D=[];const[y,h]=await Promise.all([A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0}),A("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0})]);return y.status.value!=="error"&&(s=y.data.value.data),y.status.value==="error"?(j().trigger(error),[]):(h.status.value!=="error"&&(o=h.data.value.list_ujalan,c=h.data.value.list_tipe,g=h.data.value.list_ticket,D=h.data.value.list_pv),v().loading_full=!1,{trx_trps:s,list_ujalan:o,list_tipe:c,list_ticket:g,list_pv:D})},"$8KmJHfPiB5")),M=await M,P(),M),d=i($.value.trx_trps||[]),I=i($.value.list_ujalan),K=i($.value.list_ticket),J=i($.value.list_pv),u=i(""),m=i({field:"created_at",by:"desc"}),x=i(-1),r=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),F=()=>{n.like="",u.value!=""&&(n.like=`id:%${u.value}%,warehouse_name:%${u.value}%,warehouse_source_name:%${u.value}%,warehouse_target_name:%${u.value}%,item_name:%${u.value}%,status:%${u.value}%,type:%${u.value}%`),n.sort="",m.value.field&&(n.sort=m.value.field+":"+m.value.by),n._TimeZoneOffset=new Date().getTimezoneOffset(),n.date_from=f.value.from?b(f.value.from).format("YYYY-MM-DD"):"",n.date_to=f.value.to?b(f.value.to).format("YYYY-MM-DD"):""},B=i(null),H=async()=>{v().loading_full=!0,Y.value={},r.value.may_get_data=!1,n.page=r.value.page,n.page==1&&(d.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(d.value[0]));const{data:s,error:o,status:c}=await A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:n,retry:0});if(v().loading_full=!1,r.value.may_get_data=!0,c.value==="error"){j().trigger(o,Y);return}r.value.page==1?(d.value=s.value.data,B.value&&(B.value.scrollTop=0)):r.value.page>1&&(d.value=[...d.value,...s.value.data]),s.value.data.length==0&&(r.value.is_last_record=!0)},Z=async()=>{if(!r.value.may_get_data)return;let s=B.value;if(s.scrollLeft!=r.value.scrollLeft){r.value.scrollLeft=s.scrollLeft;return}r.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(r.value.page++,await H())},q=()=>{r.value.page=1,r.value.is_last_record=!1,F(),H()};vt();const L=i(!1),G=i(0);U(),mt(U());const Q=i({}),C=i(!1),W=async()=>{C.value&&(C.value=!1)},X=async()=>{v().loading_full=!0;const s=new FormData;s.append("id",d.value[x.value].id),s.append("_method","DELETE");const{data:o,error:c,status:g}=await A("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:s,retry:0});if(v().loading_full=!1,g.value==="error"){j().trigger(c);return}d.value.splice(x.value,1),x.value=-1,C.value=!1},{downloadFile:tt,viewFile:ae}=it(),V=i(!1),N=i(""),O=async()=>{if(V.value==!0){V.value=!1;return}F(),v().loading_full=!0;const{data:s,error:o,status:c}=await A("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:n,retry:0});if(v().loading_full=!1,c.value==="error"){j().trigger(o);return}N.value=s.value,V.value=!0},et=()=>{tt(N.value)};return(s,o)=>{const c=st,g=rt,D=ht("vue-date-picker"),y=ut,h=dt,lt=ct,ot=nt,at=_t;return w(),k("div",Bt,[_(c,{title:"Report Transaction"}),t("div",Ct,[t("div",Vt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[0]||(o[0]=e=>O())},[_(g)])]),t("form",jt,[t("div",null,[Nt,_(y,null,{default:E(()=>[_(D,{modelValue:l(f).from,"onUpdate:modelValue":o[1]||(o[1]=e=>l(f).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})]),t("div",null,[St,_(y,null,{default:E(()=>[_(D,{modelValue:l(f).to,"onUpdate:modelValue":o[2]||(o[2]=e=>l(f).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})]),t("div",zt,[Pt,z(t("input",{class:"",type:"text","onUpdate:modelValue":o[3]||(o[3]=e=>yt(u)?u.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[gt,l(u)]])]),t("div",Yt,[Ft,z(t("select",{class:"","onUpdate:modelValue":o[4]||(o[4]=e=>l(m).field=e)},Lt,512),[[R,l(m).field]])]),t("div",Ot,[Ut,z(t("select",{class:"","onUpdate:modelValue":o[5]||(o[5]=e=>l(m).by=e)},It,512),[[R,l(m).by]])]),t("div",Kt,[t("button",{class:"",type:"submit",name:"button",onClick:o[6]||(o[6]=kt(e=>q(),["prevent"]))},[_(h,{class:"text-2xl"})])])]),t("div",Jt,[l(d).length==0?(w(),k("div",Zt," Maaf Tidak Ada Record ")):(w(),k("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:B,onScroll:Z},[t("table",qt,[Gt,t("tbody",null,[(w(!0),k(wt,null,bt(l(d),(e,S)=>(w(),k("tr",{key:S,onClick:se=>x.value=S,class:Dt(l(x)==S?"active":"")},[t("td",Wt,a(e.id),1),t("td",null,a(e.tanggal?l(b)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,a(e.xto),1),t("td",null,a(e.tipe),1),t("td",null,a(l(p)(e.amount)),1),t("td",null,a(e.pv_no),1),t("td",null,a(l(p)(e.pv_total)),1),t("td",null,a(e.ticket_a_no),1),t("td",null,a(l(p)(e.ticket_a_bruto)),1),t("td",null,a(l(p)(e.ticket_a_tara)),1),t("td",null,a(l(p)(e.ticket_a_netto)),1),t("td",null,a(e.ticket_a_supir),1),t("td",null,a(e.ticket_a_no_pol),1),t("td",null,a(e.ticket_b_no),1),t("td",null,a(l(p)(e.ticket_b_bruto)),1),t("td",null,a(l(p)(e.ticket_b_tara)),1),t("td",null,a(l(p)(e.ticket_b_netto)),1),t("td",null,a(e.ticket_b_supir),1),t("td",null,a(e.ticket_b_no_pol),1),t("td",null,a(e.supir),1),t("td",null,a(e.no_pol),1),t("td",null,a(e.created_at?l(b)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,a(e.updated_at?l(b)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Qt))),128))])])],544))])]),_(lt,{type:"delete",show:l(C),data:l(Q),fnClose:W,fnConfirm:X},null,8,["show","data"]),_(ot,{show:l(L),fnClose:()=>{L.value=!1},id:l(G),p_data:l(d),list_ujalan:l(I),list_ticket:l(K),list_pv:l(J)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(V)?(w(),k("div",Xt,[t("div",te,[t("div",ee,[_(at,{style:{color:"black",cursor:"pointer"},onClick:o[7]||(o[7]=e=>O())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(N).dataBase64},null,8,le),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[8]||(o[8]=e=>et())})])])):Tt("",!0)])}}};export{he as default};
