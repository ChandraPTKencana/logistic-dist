import P from"./PDFJsView.0eef4da3.js";import{Q as S,a4 as R,M as I,r as n,g as V,a2 as $,f as L,o as u,c as v,a as h,t as q,l as c,n as y,z as A,k as B,L as O}from"./entry.a1991699.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";function M(i,f,t,p){let a,m=!1;S(()=>{a=new IntersectionObserver(async([k])=>{k.isIntersecting&&!m&&(m=!0,await f())},{threshold:0,rootMargin:"300px",...p}),i.value&&a.observe(i.value)}),R(()=>{a==null||a.disconnect(),t==null||t()})}const z={class:"w-full"},N={for:""},E={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},J={class:"image-box"},Q={key:0},W=["src"],G={key:1,class:"skeleton"},H=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(i,{emit:f}){const t=i;n(!1);const p=n(null);n(null),n(null);const a=n(!1),m=e=>{const l=e.target.files;if(!l||!l.length)return;a.value=!0;const r=l[0];d.value=r,s&&URL.revokeObjectURL(s),s=URL.createObjectURL(r),o.value=s,f("setPreview","exist"),f("setFile",r)},k=()=>{w(!0);const e=p.value;e&&(e.value=""),f("setFile",null),f("setPreview",null)},b=n(null),o=n(null);let s=null;const F=V("token"),{apiBase:C}=$(),d=n();L(()=>t.link,e=>{e&&b.value&&g()},{immediate:!0});const _=n(!1);L(()=>t.show,e=>{w(!0),_.value=!1,a.value=!1},{immediate:!0});async function g(){if(!t.link||o.value||t.link=="exist"||a.value||_.value)return;const e=t.link.startsWith("http")?t.link:`${C}${t.link}`,l=await fetch(e,{headers:{Authorization:`Bearer ${F.value}`}});if(!l.ok){let r=p.value;r&&(r.value="");return}d.value=await l.blob(),s=URL.createObjectURL(d.value),o.value=s,_.value=!0}function w(e=!1){a.value&&e==!1||_.value&&e==!1||(s&&(URL.revokeObjectURL(s),s=null),o.value=null,d.value=null)}return M(b,g,w,{rootMargin:"300px 0px",threshold:0}),R(()=>{_.value=!1}),(e,l)=>{var x,U;const r=P;return u(),v("div",{ref_key:"wrapper",ref:b,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[h("div",z,[h("label",N,q(i.label),1)]),h("div",E,[h("div",J,[c(o)?(u(),v("div",Q,[(x=c(d))!=null&&x.type.match(/image/)?(u(),v("img",{key:0,src:c(o),class:"w-full h-full object-cover"},null,8,W)):y("",!0),(U=c(d))!=null&&U.type.match(/application\/pdf/)?(u(),A(r,{key:1,pdfObjUrl:c(s)},null,8,["pdfObjUrl"])):y("",!0)])):(u(),v("div",G))])]),i.can_remove?B((u(),v("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:l[0]||(l[0]=j=>k())},"Clear",512)),[[O,c(o)]]):y("",!0),i.can_remove?B((u(),v("input",{key:1,class:"w-full",onChange:l[1]||(l[1]=j=>m(j)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[O,!c(o)]]):y("",!0)],512)}}});const Y=D(H,[["__scopeId","data-v-0a136ad6"]]);export{Y as default};
