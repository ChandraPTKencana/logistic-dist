import ce from"./Header.3747b0a6.js";import me from"./Copy.22c435e2.js";import pe from"./Plus.6191db42.js";import fe from"./Edit.530bc107.js";import ve from"./Delete.8b611110.js";import ge from"./TableView.ddfe514a.js";import{_ as ye}from"./PopupMini.vue.19466ba8.js";import he from"./user.39a7c0dd.js";import{_ as be}from"./GAQR.vue.467d98d4.js";import{r,f as ke,g as xe,h as we,i as g,j as z,s as De,c as y,a as _,b as c,k as Ce,v as Se,l as o,m as Ae,n as S,w as H,F as $e,q as Te,x as u,y as A,o as h,d as V,t as J,p as Fe,e as Pe}from"./entry.bf605837.js";import{u as $}from"./useMyFetch.9c1d1cb2.js";import{u as T}from"./useUtils.fcb0bcb4.js";import{_ as Be}from"./_plugin-vue_export-helper.c27b6911.js";import"./Search.5bebc889.js";import"./Adjust.1c236050.js";import"./TableHeaderEye.2f1ff207.js";import"./Times.2afba606.js";import"./ClearAll.30a0aefc.js";import"./client-only.6510e0be.js";import"./ClearEach.ef65f15e.js";import"./CaretLeftDoubleBold.e7ba5515.js";import"./CaretLeftBold.34ff96cd.js";import"./CaretRightBold.ee8d2d47.js";import"./CaretRightDoubleBold.422c9d47.js";import"./Exclamation.3501db46.js";import"./HeaderPopup.vue.5964ff22.js";const O=b=>(Fe("data-v-a0b74cd4"),b=b(),Pe(),b),Ie={class:"w-full h-full flex flex-col"},Ne={class:"w-full flex grow flex-col overflow-auto h-0"},Oe={class:"w-full flex justify-between flex-wrap"},Ue={class:"grow flex"},je={class:"m-1"},Ee=O(()=>_("option",{value:"active"},"Active",-1)),Me=O(()=>_("option",{value:"nonactive"},"Nonactive",-1)),qe=O(()=>_("option",{value:"all"},"All",-1)),ze=[Ee,Me,qe],He={__name:"index",async setup(b){let k,U;const L=t=>t.is_active==0?"!bg-red-400":"",m=r("active");ke(()=>m.value,t=>{E()},{immediate:!1});const n={};n._TimeZoneOffset=new Date().getTimezoneOffset();const x=xe("token"),{data:s}=([k,U]=we(async()=>Te(async()=>{u().loading_full=!0;const{data:t,error:e,status:i}=await $("/users",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{filter_status:m},retry:0});return u().loading_full=!1,i.value==="error"?(A().trigger(e),[]):t.value.data},"$4SJ9UL5Y8i")),k=await k,U(),k);r("");const F=r({field:"",by:"desc"}),a=r(-1),d=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),P=g(()=>s.value[a.value]),R=()=>{n.like="";let t=JSON.parse(JSON.stringify(u()._tv.global_keyword));t!=""&&(n.like=`id:%${t}%,username:%${t}%`),n.sort="",F.value.field&&(n.sort=F.value.field+":"+F.value.by),n.filter_model=JSON.stringify(u()._tv.filter_model)},Y=t=>{let e=[];return t.permission_group_users&&t.permission_group_users.length>0&&t.permission_group_users.forEach(i=>{e.push(i.permission_group.name)}),e.join(",")};r(null);const j=async()=>{u().loading_full=!0,d.value.may_get_data=!1,n.page=d.value.page,n.page==1&&(s.value=[]),n.filter_status=m.value;const{data:t,error:e,status:i}=await $("/users",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(u().loading_full=!1,d.value.may_get_data=!0,i.value==="error"){A().trigger(e);return}d.value.page==1?s.value=t.value.data:d.value.page>1&&(s.value=[...s.value,...t.value.data]),t.value.data.length==0&&(d.value.is_last_record=!0),u()._tv.filter_box=!1},E=()=>{a.value=-1,d.value.page=1,d.value.is_last_record=!1,R(),j()},f=r(!1),w=r(0),D=r(0),B=r(!1),G=()=>{w.value=0,B.value=!1,D.value=!1,f.value=!0},{display:C}=z();De(z());const Q=()=>{a.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=s.value[a.value].id,B.value=!1,D.value=!1,f.value=!0)},Z=()=>{a.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=s.value[a.value].id,B.value=!1,D.value=!0,f.value=!0)},M=r({}),v=r(!1),K=async()=>{v.value&&(v.value=!1)},W=()=>{a.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value={id:s.value[a.value].id},v.value=!0)},X=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",s.value[a.value].id),t.append("_method","DELETE");const{data:e,error:i,status:N}=await $("/user",{method:"post",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,N.value==="error"){A().trigger(i);return}let p={...s.value[a.value]};p.deleted=e.value.deleted,p.deleted_user=e.value.deleted_user,p.deleted_at=e.value.deleted_at,p.deleted_by=e.value.deleted_by,p.deleted_reason=e.value.deleted_reason,m.value!="all"?s.value.splice(a.value,1):s.value.splice(a.value,1,{...p}),a.value=-1,v.value=!1},q=r(""),I=r(!1),ee=async()=>{if(a.value==-1){C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}n.id=s.value[a.value].id,u().loading_full=!0;const{data:t,error:e,status:i}=await $("/ga_qr",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(u().loading_full=!1,i.value==="error"){A().trigger(e);return}q.value=t.value,I.value=!0},te=r([{key:"no",label:"No",isai:!0},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"username",label:"Username",freeze:1,filter_on:1,type:"string",sort:{priority:1,type:"asc"}},{key:"hak_akses",label:"Hak Akses",filter_on:1,type:"string"},{key:"group",label:"Group",filter_on:1,type:"string"},{key:"is_active",label:"Status",filter_on:1,type:"select",select_item:[{k:"1",v:"Ya"},{k:"0",v:"Tidak"}]},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),ae=g(()=>a.value>-1&&[void 0,0].indexOf(P.value.deleted)>-1&&T().checkPermission("user.create")),oe=g(()=>["active","nonactive","all"].indexOf(m.value)>-1&&T().checkPermission("user.create")),se=g(()=>a.value>-1&&[void 0,0].indexOf(P.value.deleted)>-1&&T().checkPermissions(["user.modify"])),le=g(()=>a.value>-1&&T().checkPermission("user.remove")&&[void 0,0].indexOf(P.value.deleted)>-1);return(t,e)=>{const i=ce,N=me,p=pe,re=fe,ne=ve,ie=ge,ue=ye,de=he,_e=be;return h(),y($e,null,[_("div",Ie,[c(i,{title:"List User"}),_("div",Ne,[_("div",Oe,[_("div",Ue,[_("div",je,[Ce(_("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=l=>Ae(m)?m.value=l:null)},ze,512),[[Se,o(m)]])]),o(ae)?(h(),y("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=l=>Z())},[c(N)])):S("",!0),o(oe)?(h(),y("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=l=>G())},[c(p)])):S("",!0),o(se)?(h(),y("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=l=>Q())},[c(re)])):S("",!0),o(le)?(h(),y("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=l=>W())},[c(ne)])):S("",!0),_("button",{type:"button",name:"button",class:"m-1 text-xs",onClick:e[5]||(e[5]=l=>ee())}," SET 2FA ")])]),c(ie,{thead:o(te),selected:o(a),onSetSelected:e[6]||(e[6]=l=>a.value=l),tbody:o(s),fnCallData:j,scrolling:o(d),onSetScrollingPage:e[7]||(e[7]=l=>o(d).page=l),onDoFilter:e[8]||(e[8]=l=>E()),rowBgColor:L},{group:H(({item:l})=>[V(J(Y(l)),1)]),is_active:H(({item:l})=>[V(J(l.is_active==1?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["thead","selected","tbody","scrolling"])])]),c(ue,{type:"delete",show:o(v),data:o(M),fnClose:K,fnConfirm:X},null,8,["show","data"]),c(de,{show:o(f),fnClose:()=>{f.value=!1},id:o(w),p_data:o(s),is_copy:o(D)},null,8,["show","fnClose","id","p_data","is_copy"]),c(_e,{show:o(I),fnClose:()=>{I.value=!1},qrCodeUrl:o(q)},null,8,["show","fnClose","qrCodeUrl"])],64)}}},ft=Be(He,[["__scopeId","data-v-a0b74cd4"]]);export{ft as default};
