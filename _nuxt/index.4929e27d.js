import{_ as ut}from"./Header.8bafa6a1.js";import{_ as rt}from"./Plus.7c841810.js";import{_ as ct}from"./Edit.57352ac0.js";import{_ as dt}from"./Delete.0cd505a5.js";import{_ as _t,u as pt,a as ft}from"./useDownload.5ccc9e34.js";import{_ as mt}from"./Search.882b377f.js";import{_ as vt}from"./PopupMini.vue.f5da6157.js";import{_ as ht}from"./Times.2a5d20fa.js";import{u as kt,K as gt,r as n,I as yt,N as O,O as bt,c as b,b as p,a as t,n as z,s as wt,x as l,q as Tt,y as Y,z as Dt,F as At,A as xt,M as $t,L as Mt,D as m,E as j,o as w,B as Bt,t as o,U as Ct,C as jt}from"./entry.81e8bd84.js";import{u as St}from"./useUtils.100f5b4a.js";import{u as x}from"./useMyFetch.732ddcd9.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.e340ba41.js";import"./client-only.40f5b98a.js";import"./InputPointFormat.vue.4b94bebf.js";const Ht={class:"w-full h-full flex flex-col"},Nt={class:"w-full flex grow flex-col overflow-auto h-0"},Pt={class:"w-full flex"},zt={action:"#",class:"w-full flex p-1"},Ft={class:"grow"},It=t("div",{class:"font-bold"}," Keyword ",-1),Lt={class:"pl-1"},Vt=t("div",{class:"font-bold"}," Sort By ",-1),Et=Ct('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Ot=[Et],Yt={class:"pl-1"},Rt=t("div",{class:"font-bold"}," Sort Order ",-1),Ut=t("option",{value:"asc"},"Asc",-1),Kt=t("option",{value:"desc"},"Desc",-1),Jt=[Ut,Kt],qt={class:"flex items-end pl-1"},Zt={class:"w-full flex justify-center items-center grow h-0 p-1"},Gt={key:0,class:""},Qt={class:"tacky"},Wt=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Jenis"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket A In At"),t("th",null,"Ticket A Out At"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Ticket B In At"),t("th",null,"Ticket B Out At"),t("th",null,"Supir"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),Xt=["onClick"],te={class:"bold"},ee={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},le={class:"relative",style:{width:"95%",height:"90%"}},ae={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},oe=["src"],we={__name:"index",async setup(se){let $,F;const{$moment:v}=jt(),{pointFormat:f}=St(),i={};i._TimeZoneOffset=new Date().getTimezoneOffset(),i.sort="created_at:desc";const T=kt("token"),{data:M}=([$,F]=gt(async()=>Mt(async()=>{m().loading_full=!0;let s=[],a=[],_=[],k=[],A=[];const[y,g]=await Promise.all([x("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0}),x("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0})]);return y.status.value!=="error"&&(s=y.data.value.data),y.status.value==="error"?(j().trigger(y.error),{trx_trps:s,list_ujalan:a,list_tipe:_,list_ticket:k,list_pv:A}):(g.status.value!=="error"&&(a=g.data.value.list_ujalan,_=g.data.value.list_tipe,k=g.data.value.list_ticket,A=g.data.value.list_pv),m().loading_full=!1,{trx_trps:s,list_ujalan:a,list_tipe:_,list_ticket:k,list_pv:A})},"$pFLmKcrKj9")),$=await $,F(),$),u=n(M.value.trx_trps||[]),R=n(M.value.list_ujalan),U=n(M.value.list_ticket),K=n(M.value.list_pv),c=n(""),h=n({field:"created_at",by:"desc"}),d=n(-1),r=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),J=()=>{i.like="",c.value!=""&&(i.like=`id:%${c.value}%,warehouse_name:%${c.value}%,warehouse_source_name:%${c.value}%,warehouse_target_name:%${c.value}%,item_name:%${c.value}%,status:%${c.value}%,type:%${c.value}%`),i.sort="",h.value.field&&(i.sort=h.value.field+":"+h.value.by)},B=n(null),I=async()=>{m().loading_full=!0,r.value.may_get_data=!1,i.page=r.value.page,i.page==1&&(u.value=[]),i.first_row&&delete i.first_row,i.page>1&&(i.first_row=JSON.stringify(u.value[0]));const{data:s,error:a,status:_}=await x("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:i,retry:0});if(m().loading_full=!1,r.value.may_get_data=!0,_.value==="error"){j().trigger(a);return}r.value.page==1?(u.value=s.value.data,B.value&&(B.value.scrollTop=0)):r.value.page>1&&(u.value=[...u.value,...s.value.data]),s.value.data.length==0&&(r.value.is_last_record=!0)},q=async()=>{if(!r.value.may_get_data)return;let s=B.value;if(s.scrollLeft!=r.value.scrollLeft){r.value.scrollLeft=s.scrollLeft;return}r.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(r.value.page++,await I())},Z=()=>{r.value.page=1,r.value.is_last_record=!1,J(),I()};yt();const C=n(!1),S=n(0),G=()=>{S.value=0,C.value=!0},{display:H}=O();bt(O());const Q=()=>{d.value==-1?H({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=u.value[d.value].id,C.value=!0)},L=n({}),D=n(!1),W=async()=>{D.value&&(D.value=!1)},X=()=>{d.value==-1?H({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value={id:u.value[d.value].id},D.value=!0)},tt=async()=>{m().loading_full=!0;const s=new FormData;s.append("id",u.value[d.value].id),s.append("_method","DELETE");const{data:a,error:_,status:k}=await x("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:s,retry:0});if(m().loading_full=!1,k.value==="error"){j().trigger(_);return}u.value.splice(d.value,1),d.value=-1,D.value=!1},{downloadFile:et,printHtml:lt}=pt(),N=n(!1),V=n(""),E=async()=>{if(N.value==!0){N.value=!1;return}if(d.value==-1){H({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}m().loading_full=!0;const{data:s,error:a,status:_}=await x("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{id:u.value[d.value].id},retry:0});if(m().loading_full=!1,_.value==="error"){j().trigger(a);return}lt(s.value.html,318)},at=()=>{et(V.value)};return(s,a)=>{const _=ut,k=rt,A=ct,y=dt,g=ft,ot=mt,st=vt,nt=_t,it=ht;return w(),b("div",Ht,[p(_,{title:"List Transaction"}),t("div",Nt,[t("div",Pt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=e=>G())},[p(k)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=e=>Q())},[p(A)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=e=>X())},[p(y)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=e=>E())},[p(g)])]),t("form",zt,[t("div",Ft,[It,z(t("input",{class:"",type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>Tt(c)?c.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[wt,l(c)]])]),t("div",Lt,[Vt,z(t("select",{class:"","onUpdate:modelValue":a[5]||(a[5]=e=>l(h).field=e)},Ot,512),[[Y,l(h).field]])]),t("div",Yt,[Rt,z(t("select",{class:"","onUpdate:modelValue":a[6]||(a[6]=e=>l(h).by=e)},Jt,512),[[Y,l(h).by]])]),t("div",qt,[t("button",{class:"",type:"submit",name:"button",onClick:a[7]||(a[7]=Dt(e=>Z(),["prevent"]))},[p(ot,{class:"text-2xl"})])])]),t("div",Zt,[l(u).length==0?(w(),b("div",Gt," Maaf Tidak Ada Record ")):(w(),b("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:B,onScroll:q},[t("table",Qt,[Wt,t("tbody",null,[(w(!0),b(At,null,xt(l(u),(e,P)=>(w(),b("tr",{key:P,onClick:ne=>d.value=P,class:Bt(l(d)==P?"active":"")},[t("td",te,o(e.id),1),t("td",null,o(e.tanggal?l(v)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,o(e.xto),1),t("td",null,o(e.tipe),1),t("td",null,o(e.jenis),1),t("td",null,o(l(f)(e.amount)),1),t("td",null,o(e.pv_no),1),t("td",null,o(l(f)(e.pv_total)),1),t("td",null,o(e.ticket_a_no),1),t("td",null,o(l(f)(e.ticket_a_bruto)),1),t("td",null,o(l(f)(e.ticket_a_tara)),1),t("td",null,o(l(f)(e.ticket_a_netto)),1),t("td",null,o(e.ticket_a_supir),1),t("td",null,o(e.ticket_a_no_pol),1),t("td",null,o(l(v)(e.ticket_a_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(v)(e.ticket_a_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.ticket_b_no),1),t("td",null,o(l(f)(e.ticket_b_bruto)),1),t("td",null,o(l(f)(e.ticket_b_tara)),1),t("td",null,o(l(f)(e.ticket_b_netto)),1),t("td",null,o(e.ticket_b_supir),1),t("td",null,o(e.ticket_b_no_pol),1),t("td",null,o(l(v)(e.ticket_b_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(v)(e.ticket_b_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.supir),1),t("td",null,o(e.no_pol),1),t("td",null,o(e.created_at?l(v)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,o(e.updated_at?l(v)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Xt))),128))])])],544))])]),p(st,{type:"delete",show:l(D),data:l(L),fnClose:W,fnConfirm:tt},null,8,["show","data"]),p(nt,{show:l(C),fnClose:()=>{C.value=!1},id:l(S),p_data:l(u),list_ujalan:l(R),list_ticket:l(U),list_pv:l(K)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(N)?(w(),b("div",ee,[t("div",le,[t("div",ae,[p(it,{style:{color:"black",cursor:"pointer"},onClick:a[8]||(a[8]=e=>E())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(V).dataBase64},null,8,oe),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:a[9]||(a[9]=e=>at())})])])):$t("",!0)])}}};export{we as default};
