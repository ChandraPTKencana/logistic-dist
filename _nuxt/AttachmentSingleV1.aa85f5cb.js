import S from"./PDFJsView.a1eeae34.js";import{Q as I,a4 as O,M as V,r as n,g as $,a2 as q,f as L,o as c,c as v,a as y,t as A,l as i,n as m,z as D,k as j,L as B}from"./entry.1cfac804.js";import{_ as M}from"./_plugin-vue_export-helper.c27b6911.js";function z(u,f,l,p){let o,a=!1;I(()=>{o=new IntersectionObserver(async([t])=>{t.isIntersecting&&!a&&(a=!0,await f())},{threshold:0,rootMargin:"300px",...p}),u.value&&o.observe(u.value)}),O(()=>{o==null||o.disconnect(),l==null||l()})}const N={class:"w-full"},E={for:""},J={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},Q={class:"image-box"},W={key:0,class:"skeleton w-full"},G={key:1},H=["src"],K=V({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(u,{emit:f}){const l=u;n(!1);const p=n(null);n(null),n(null);const o=n(null),a=n(null);let t=null;const R=$("token"),{apiBase:F}=q(),d=n(),_=n(!1),h=n(!1),b=n(!1),C=e=>{const s=e.target.files;if(!s||!s.length)return;h.value=!0;const r=s[0];d.value=r,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(r),a.value=t,f("setPreview","exist"),f("setFile",r)},P=()=>{k(!0);const e=p.value;e&&(e.value=""),f("setFile",null),f("setPreview",null)};L(()=>l.show,e=>{k(!0),_.value=!1,h.value=!1},{immediate:!0,deep:!0}),L(()=>l.link,e=>{e&&o.value&&w()},{immediate:!0});async function w(){if(!(!l.link||a.value||l.link=="exist"||h.value||_.value)){b.value=!0;try{const e=l.link.startsWith("http")?l.link:`${F}${l.link}`,s=await fetch(e,{headers:{Authorization:`Bearer ${R.value}`}});if(!s.ok){let r=p.value;r&&(r.value="");return}d.value=await s.blob(),t=URL.createObjectURL(d.value),a.value=t,_.value=!0}finally{b.value=!1}}}function k(e=!1){h.value&&e==!1||_.value&&e==!1||(t&&(URL.revokeObjectURL(t),t=null),a.value=null,d.value=null)}return z(o,w,k,{rootMargin:"300px 0px",threshold:0}),O(()=>{_.value=!1}),(e,s)=>{var g,x;const r=S;return c(),v("div",{ref_key:"wrapper",ref:o,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[y("div",N,[y("label",E,A(u.label),1)]),y("div",J,[y("div",Q,[i(b)?(c(),v("div",W)):i(a)?(c(),v("div",G,[(g=i(d))!=null&&g.type.match(/image/)?(c(),v("img",{key:0,src:i(a),class:"w-full h-full object-cover"},null,8,H)):m("",!0),(x=i(d))!=null&&x.type.match(/application\/pdf/)?(c(),D(r,{key:1,pdfObjUrl:i(t)},null,8,["pdfObjUrl"])):m("",!0)])):m("",!0)])]),u.can_remove?j((c(),v("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:s[0]||(s[0]=U=>P())},"Clear",512)),[[B,i(a)]]):m("",!0),u.can_remove?j((c(),v("input",{key:1,class:"w-full",onChange:s[1]||(s[1]=U=>C(U)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[B,!i(a)]]):m("",!0)],512)}}});const Z=M(K,[["__scopeId","data-v-9dcf4bdc"]]);export{Z as default};
