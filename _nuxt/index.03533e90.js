import{_ as st}from"./Header.b7b87a35.js";import{_ as nt,u as it,a as ut}from"./useDownload.9e1f86a5.js";import{_ as rt}from"./client-only.5b12dc95.js";import{_ as dt}from"./Search.39a8cd39.js";import{_ as ct}from"./PopupMini.vue.e83feceb.js";import{_ as _t}from"./Times.e4c9053e.js";import{r as i,u as pt,K as ft,I as vt,N as U,O as mt,P as ht,c as w,b as _,a as t,w as E,t as a,x as l,n as P,s as gt,q as kt,y as R,z as yt,F as wt,A as bt,M as Tt,L as xt,D as v,E as j,o as b,B as At,U as Dt,C as Mt}from"./entry.4eb77489.js";import{u as Bt}from"./useUtils.100f5b4a.js";import{u as D}from"./useMyFetch.0bfbf252.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.d6ed9c87.js";import"./InputPointFormat.vue.b3f0ae22.js";const $t={class:"w-full h-full flex flex-col"},Ct={class:"w-full flex grow flex-col overflow-auto h-0"},Nt={class:"w-full flex"},Vt={action:"#",class:"w-full flex p-1"},jt=t("div",{class:"font-bold"}," Tgl Dari ",-1),St={class:"text-red-500"},zt=t("div",{class:"font-bold"}," Tgl Sampai ",-1),Pt={class:"text-red-500"},Yt={class:"grow"},Ft=t("div",{class:"font-bold"}," Keyword ",-1),Ht={class:"pl-1"},Lt=t("div",{class:"font-bold"}," Sort By ",-1),Ot=Dt('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option><option value="pv_no">PV No</option><option value="ticket_a_no">Ticket A No</option><option value="ticket_b_no">Ticket B No</option>',8),Ut=[Ot],Et={class:"pl-1"},Rt=t("div",{class:"font-bold"}," Sort Order ",-1),It=t("option",{value:"asc"},"Asc",-1),Kt=t("option",{value:"desc"},"Desc",-1),Jt=[It,Kt],Zt={class:"flex items-end pl-1"},qt={class:"w-full flex justify-center items-center grow h-0 p-1"},Gt={key:0,class:""},Qt={class:"tacky"},Wt=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Jenis"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Supir"),t("th",null,"Kernet"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),Xt=["onClick"],te={class:"bold"},ee={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},le={class:"relative",style:{width:"95%",height:"90%"}},oe={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},ae=["src"],ye={__name:"index",async setup(se){let M,Y;const{$moment:T}=Mt(),{pointFormat:p}=Bt(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="created_at:desc";const B=i({}),x=pt("token"),f=i({from:"",to:""}),{data:$}=([M,Y]=ft(async()=>xt(async()=>{v().loading_full=!0;let s=[],o=[],d=[],h=[],y=[];const[g,k]=await Promise.all([D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},retry:0}),D("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},retry:0})]);return g.status.value!=="error"&&(s=g.data.value.data),g.status.value==="error"?(j().trigger(g.error),{trx_trps:s,list_ujalan:o,list_tipe:d,list_ticket:h,list_pv:y}):(k.status.value!=="error"&&(o=k.data.value.list_ujalan,d=k.data.value.list_tipe,h=k.data.value.list_ticket,y=k.data.value.list_pv),v().loading_full=!1,{trx_trps:s,list_ujalan:o,list_tipe:d,list_ticket:h,list_pv:y})},"$8KmJHfPiB5")),M=await M,Y(),M),c=i($.value.trx_trps||[]),I=i($.value.list_ujalan),K=i($.value.list_ticket),J=i($.value.list_pv),r=i(""),m=i({field:"created_at",by:"desc"}),A=i(-1),u=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),F=()=>{n.like="",r.value!=""&&(n.like=`id:%${r.value}%,warehouse_name:%${r.value}%,warehouse_source_name:%${r.value}%,warehouse_target_name:%${r.value}%,item_name:%${r.value}%,status:%${r.value}%,type:%${r.value}%`),n.sort="",m.value.field&&(n.sort=m.value.field+":"+m.value.by),n._TimeZoneOffset=new Date().getTimezoneOffset(),n.date_from=f.value.from?T(f.value.from).format("YYYY-MM-DD"):"",n.date_to=f.value.to?T(f.value.to).format("YYYY-MM-DD"):""},C=i(null),H=async()=>{v().loading_full=!0,B.value={},u.value.may_get_data=!1,n.page=u.value.page,n.page==1&&(c.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(c.value[0]));const{data:s,error:o,status:d}=await D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(v().loading_full=!1,u.value.may_get_data=!0,d.value==="error"){j().trigger(o,B);return}u.value.page==1?(c.value=s.value.data,C.value&&(C.value.scrollTop=0)):u.value.page>1&&(c.value=[...c.value,...s.value.data]),s.value.data.length==0&&(u.value.is_last_record=!0)},Z=async()=>{if(!u.value.may_get_data)return;let s=C.value;if(s.scrollLeft!=u.value.scrollLeft){u.value.scrollLeft=s.scrollLeft;return}u.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(u.value.page++,await H())},q=()=>{u.value.page=1,u.value.is_last_record=!1,F(),H()};vt();const L=i(!1),G=i(0);U(),mt(U());const Q=i({}),N=i(!1),W=async()=>{N.value&&(N.value=!1)},X=async()=>{v().loading_full=!0;const s=new FormData;s.append("id",c.value[A.value].id),s.append("_method","DELETE");const{data:o,error:d,status:h}=await D("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:s,retry:0});if(v().loading_full=!1,h.value==="error"){j().trigger(d);return}c.value.splice(A.value,1),A.value=-1,N.value=!1},{downloadFile:tt,viewFile:ne}=it(),V=i(!1),S=i(""),O=async()=>{if(V.value==!0){V.value=!1;return}F(),v().loading_full=!0;const{data:s,error:o,status:d}=await D("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(v().loading_full=!1,d.value==="error"){j().trigger(o);return}S.value=s.value,V.value=!0},et=()=>{tt(S.value)};return(s,o)=>{const d=st,h=ut,y=ht("vue-date-picker"),g=rt,k=dt,lt=ct,ot=nt,at=_t;return b(),w("div",$t,[_(d,{title:"Report Transaction"}),t("div",Ct,[t("div",Nt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[0]||(o[0]=e=>O())},[_(h)])]),t("form",Vt,[t("div",null,[jt,_(g,null,{default:E(()=>[_(y,{modelValue:l(f).from,"onUpdate:modelValue":o[1]||(o[1]=e=>l(f).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",St,a(l(B).date_from),1)]),t("div",null,[zt,_(g,null,{default:E(()=>[_(y,{modelValue:l(f).to,"onUpdate:modelValue":o[2]||(o[2]=e=>l(f).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),t("p",Pt,a(l(B).date_to),1)]),t("div",Yt,[Ft,P(t("input",{class:"",type:"text","onUpdate:modelValue":o[3]||(o[3]=e=>kt(r)?r.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[gt,l(r)]])]),t("div",Ht,[Lt,P(t("select",{class:"","onUpdate:modelValue":o[4]||(o[4]=e=>l(m).field=e)},Ut,512),[[R,l(m).field]])]),t("div",Et,[Rt,P(t("select",{class:"","onUpdate:modelValue":o[5]||(o[5]=e=>l(m).by=e)},Jt,512),[[R,l(m).by]])]),t("div",Zt,[t("button",{class:"",type:"submit",name:"button",onClick:o[6]||(o[6]=yt(e=>q(),["prevent"]))},[_(k,{class:"text-2xl"})])])]),t("div",qt,[l(c).length==0?(b(),w("div",Gt," Maaf Tidak Ada Record ")):(b(),w("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:C,onScroll:Z},[t("table",Qt,[Wt,t("tbody",null,[(b(!0),w(wt,null,bt(l(c),(e,z)=>(b(),w("tr",{key:z,onClick:ie=>A.value=z,class:At(l(A)==z?"active":"")},[t("td",te,a(e.id),1),t("td",null,a(e.tanggal?l(T)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,a(e.xto),1),t("td",null,a(e.tipe),1),t("td",null,a(e.jenis),1),t("td",null,a(l(p)(e.amount)),1),t("td",null,a(e.pv_no),1),t("td",null,a(l(p)(e.pv_total)),1),t("td",null,a(e.ticket_a_no),1),t("td",null,a(l(p)(e.ticket_a_bruto)),1),t("td",null,a(l(p)(e.ticket_a_tara)),1),t("td",null,a(l(p)(e.ticket_a_netto)),1),t("td",null,a(e.ticket_a_supir),1),t("td",null,a(e.ticket_a_no_pol),1),t("td",null,a(e.ticket_b_no),1),t("td",null,a(l(p)(e.ticket_b_bruto)),1),t("td",null,a(l(p)(e.ticket_b_tara)),1),t("td",null,a(l(p)(e.ticket_b_netto)),1),t("td",null,a(e.ticket_b_supir),1),t("td",null,a(e.ticket_b_no_pol),1),t("td",null,a(e.supir),1),t("td",null,a(e.kernet),1),t("td",null,a(e.no_pol),1),t("td",null,a(e.created_at?l(T)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,a(e.updated_at?l(T)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Xt))),128))])])],544))])]),_(lt,{type:"delete",show:l(N),data:l(Q),fnClose:W,fnConfirm:X},null,8,["show","data"]),_(ot,{show:l(L),fnClose:()=>{L.value=!1},id:l(G),p_data:l(c),list_ujalan:l(I),list_ticket:l(K),list_pv:l(J)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(V)?(b(),w("div",ee,[t("div",le,[t("div",oe,[_(at,{style:{color:"black",cursor:"pointer"},onClick:o[7]||(o[7]=e=>O())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(S).dataBase64},null,8,ae),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[8]||(o[8]=e=>et())})])])):Tt("",!0)])}}};export{ye as default};
