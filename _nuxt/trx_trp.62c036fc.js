import{_ as te}from"./HeaderPopup.vue.e89b6351.js";import{_ as le}from"./client-only.3a98aa86.js";import{_ as oe}from"./WidthMiniList.vue.4d71c993.js";import{r as w,f as ae,i as se,G as T,j as V,I as ne,m as g,J as ie,o as _,c as u,a as t,b as y,k as o,w as re,C as de,t as i,q as J,F as C,y as j,v as E,l as $,x as _e,E as ue,A as k,B as F}from"./entry.b8f45e1d.js";import{u as O}from"./useUtils.02680300.js";import{u as M}from"./useMyFetch.882d4718.js";import"./Times.eee7fe9a.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.5f50fb99.js";const ce={class:"box-fixed"},pe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ve={class:"w-full flex flex-col items-center grow overflow-auto"},me={class:"w-full flex flex-row flex-wrap"},fe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},he=t("label",{for:""},"U.Jalan Per",-1),we={key:0,class:"grow"},xe={key:1,class:"grow"},ge={class:"text-red-500"},ke={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},be=t("label",{for:""},"Jenis",-1),ye=["disabled"],Ce=t("option",{value:"TBS"},"TBS",-1),je=t("option",{value:"TBSK"},"TBSK",-1),Se=t("option",{value:"CPO"},"CPO",-1),Ne=t("option",{value:"PK"},"PK",-1),Be=[Ce,je,Se,Ne],De={class:"text-red-500"},Te={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Ve=t("label",{for:""},"Payment Method",-1),Je=["disabled"],Oe=["value"],Pe={class:"text-red-500"},Ae={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},$e=t("label",{for:""},"No Pol",-1),Fe=["disabled"],Me={id:"vehicle"},Ue=["value"],qe={class:"text-red-500"},Ie={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ke=t("label",{for:""},"Supir",-1),Le={class:"text-red-500"},Ee={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ye=t("label",{for:""},"Kernet",-1),ze={class:"text-red-500"},Re={key:0,class:"w-full flex flex-wrap"},Ge={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},He=t("label",{for:""},"Tujuan",-1),We=["disabled"],Qe={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ze=t("label",{for:""},"Tipe",-1),et=["disabled"],tt=["value","selected"],lt={class:"text-red-500"},ot={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},at=t("label",{for:""},"Total Dari U.Jalan",-1),st={class:"card-border disabled"},nt={key:1,class:"w-full flex flex-wrap"},it={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},rt=t("label",{for:""},"Cost Center Code",-1),dt=["disabled"],_t={id:"cost_center"},ut=["value"],ct={class:"text-red-500"},pt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},vt=t("label",{for:""},"Cost Center Desc",-1),mt={class:"card-border disabled"},ft={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},ht=t("label",{for:""},"PVR No",-1),wt={class:"card-border disabled"},xt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},gt=t("label",{for:""},"PVR Total",-1),kt={class:"card-border disabled"},bt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},yt=t("label",{for:""},"PV",-1),Ct={class:"card-border disabled"},jt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},St=t("label",{for:""},"PV Amount",-1),Nt={class:"card-border disabled"},Bt={class:"w-full flex items-center justify-end"},Mt={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const d=b,{$moment:U}=ue(),{pointFormat:P}=O(),S={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",payment_method_id:1,payment_method:{id:0,name:""}};let h={...S};const e=w({...S}),A=ae("token"),m=w({}),Y=a=>{let l=a.target.value;if(!l){e.value.cost_center_code="",e.value.cost_center_desc="";return}d.list_cost_center.filter(s=>s.CostCenter==l).length==0&&(e.value.cost_center_code="112",e.value.cost_center_desc="Transport")},z=a=>{e.value.transition_target=a.target.value=="TBS"?e.value.transition_target:""};se();const R=async()=>{k().loading_full=!0,m.value={};const a=new FormData;a.append("tanggal",U(e.value.tanggal).format("Y-MM-DD")),a.append("jenis",e.value.jenis),a.append("id_uj",e.value.id_uj),a.append("xto",e.value.xto),a.append("cost_center_code",e.value.cost_center_code),a.append("online_status",d.online_status),a.append("transition_target",e.value.transition_target),a.append("payment_method_id",e.value.payment_method_id),a.append("no_pol",e.value.no_pol),a.append("supir_id",c.value.id),a.append("kernet_id",p.value.id);let l="post",r=d.id;r==0||(a.append("id",r),a.append("_method","PUT"));const{data:s,error:v,status:f}=await M("/trx_trp",{method:l,headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},body:a,retry:0});if(k().loading_full=!1,f.value==="error"){F().trigger(v,m);return}e.value.supir=c.value.name,e.value.supir_rek_no=c.value._.rek_no.val,e.value.supir_rek_name=c.value._.rek_name.val,e.value.kernet=p.value.name,e.value.kernet_rek_no=p.value._.rek_no.val,e.value.kernet_rek_name=p.value._.rek_name.val;let n=B.value.map(D=>D.id).indexOf(e.value.payment_method_id);if(e.value.payment_method={...B.value[n]},e.value.updated_at=s.value.updated_at,d.id<=0)e.value.id=s.value.id,e.value.created_at=s.value.created_at,d.p_data.unshift(e.value);else{let D=d.p_data.map(ee=>ee.id).indexOf(d.id);D>=-1&&d.p_data.splice(D,1,{...e.value})}d.fnClose()},G=T(()=>{let a=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(N.value.filter(l=>l.jenis==a).map(l=>l.xto))]}),H=T(()=>{let a=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return N.value.filter(l=>l.xto==e.value.xto&&l.jenis==a)}),x={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},c=w(JSON.parse(JSON.stringify(x))),p=w(JSON.parse(JSON.stringify(x))),q=T(()=>{let a=[];return K.value.forEach((l,r)=>{let s=JSON.parse(JSON.stringify(x));s._.id.val=l.id,s._.name.val=l.name,s._.rek_no.val=l.rek_no,s._.rek_name.val=l.rek_name,s.id=l.id,s.name=l.name,s.title=(l.rek_no||"")+" "+(l.rek_name||""),s.note=W(l),s._raw=l,a.push(JSON.parse(JSON.stringify(s)))}),a}),W=a=>a.potongan?"Akan ada potong sebesar :"+O().pointFormat(a.potongan.nominal_cut):"",Q=T(()=>!1),X=async()=>{k().loading_full=!0;const{data:a,error:l,status:r}=await M("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(k().loading_full=!1,r.value==="error"){F().trigger(l);return}let s=a.value.data;e.value=s,h={...s},c.value._.id.val=s.supir_id,c.value._.name.val=s.supir,c.value._.rek_no.val=s.supir_rek_no,c.value._.rek_name.val=s.supir_rek_name,c.value.id=s.supir_id,c.value.name=s.supir,c.value.rek_no=(s.supir_rek_no||"")+" "+(s.supir_rek_name||""),p.value._.id.val=s.kernet_id,p.value._.name.val=s.kernet,p.value._.rek_no.val=s.kernet_rek_no,p.value._.rek_name.val=s.kernet_rek_name,p.value.id=s.kernet_id,p.value.name=s.kernet,p.value.rek_no=(s.kernet_rek_no||"")+" "+(s.kernet_rek_name||"");let v=0,f=0;s.potongan.forEach(n=>{n.potongan_mst.employee_id==s.supir_id&&(v+=parseInt(n.nominal_cut)),n.potongan_mst.employee_id==s.kernet_id&&(f+=parseInt(n.nominal_cut))}),v>0&&(c.value.note="Telah di potong sebesar :"+O().pointFormat(v)),f>0&&(p.value.note="Telah di potong sebesar :"+O().pointFormat(f)),d.fnLoadDBData()},N=w([]),I=w([]),K=w([]),B=w([]),Z=async()=>{k().loading_full=!0;const{data:a,error:l,status:r}=await M("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},retry:0});if(k().loading_full=!1,r.value==="error"){F().trigger(l);return}N.value=a.value.list_ujalan,I.value=a.value.list_vehicle,K.value=a.value.list_employee,B.value=a.value.list_payment_methods};V(()=>d.show,async(a,l)=>{a==!0&&(await Z(),await d.fnLoadDBData(),e.value={...S},h={...S},c.value=JSON.parse(JSON.stringify(x)),p.value=JSON.parse(JSON.stringify(x)),m.value={},d.id!=0&&X())},{immediate:!0}),V(()=>e.value.cost_center_code,(a,l)=>{let r="";if(a==""||a){let s=d.list_cost_center.filter(v=>v.CostCenter==e.value.cost_center_code);s.length>0?r=s[0].Description:e.value.cost_center_code==h.cost_center_code&&(r=h.cost_center_desc),e.value.cost_center_desc=r}},{deep:!0,immediate:!0});const L=(a,l)=>{let r=0,s="";if(a==""||a){let v=N.value.filter(f=>f.id==e.value.id_uj);v.length>0?(r=v[0].harga,s=v[0].tipe):e.value.id_uj==h.id_uj&&(r=h.amount,s=h.tipe),e.value.tipe=s,e.value.amount=r}};return V(()=>e.value.xto,(a,l)=>{d.show&&L(a)},{deep:!0,immediate:!0}),V(()=>e.value.id_uj,(a,l)=>{d.show&&L(a)},{deep:!0,immediate:!0}),(a,l)=>{const r=te,s=ne("vue-date-picker"),v=le,f=oe;return g((_(),u("section",ce,[t("div",null,[y(r,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",pe,[t("div",ve,[t("div",me,[t("div",fe,[he,o(e).val!==1?(_(),u("div",we,[y(v,null,{default:re(()=>[y(s,{modelValue:o(e).tanggal,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(_(),u("div",xe,[t("div",{class:de(["card-border disabled",o(e).pvr_no!=""?"unselectable":""])},i(o(e).tanggal?o(U)(o(e).tanggal).format("DD-MM-YYYY"):""),3)])),t("p",ge,i(o(m).tanggal),1)]),t("div",ke,[be,g(t("select",{"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).jenis=n),onChange:l[2]||(l[2]=n=>z(n)),disabled:o(e).val==1},Be,40,ye),[[J,o(e).jenis]]),t("p",De,i(o(m).jenis),1)]),t("div",Te,[Ve,g(t("select",{"onUpdate:modelValue":l[3]||(l[3]=n=>o(e).payment_method_id=n),disabled:o(e).val==1},[(_(!0),u(C,null,j(o(B),n=>(_(),u("option",{value:n.id},i(n.name),9,Oe))),256))],8,Je),[[J,o(e).payment_method_id]]),t("p",Pe,i(o(m).payment_method_id),1)]),t("div",Ae,[$e,g(t("input",{type:"text",list:"vehicle","onUpdate:modelValue":l[4]||(l[4]=n=>o(e).no_pol=n),disabled:o(e).val==1},null,8,Fe),[[E,o(e).no_pol]]),t("datalist",Me,[(_(!0),u(C,null,j(o(I),n=>(_(),u("option",{value:n.no_pol},i(n.no_pol),9,Ue))),256))]),t("p",qe,i(o(m).no_pol),1)]),t("div",Ie,[Ke,y(f,{arr:o(q),selected:o(c),pure:x,onSetSelected:l[5]||(l[5]=n=>c.value=n),disabled:o(h).supir_id>1},null,8,["arr","selected","disabled"]),t("p",Le,i(o(m).supir_id),1)]),t("div",Ee,[Ye,y(f,{arr:o(q),selected:o(p),pure:x,onSetSelected:l[6]||(l[6]=n=>p.value=n),disabled:o(h).kernet_id>1},null,8,["arr","selected","disabled"]),t("p",ze,i(o(m).kernet_id),1)]),o(e).jenis!=""?(_(),u("div",Re,[t("div",Ge,[He,g(t("select",{"onUpdate:modelValue":l[7]||(l[7]=n=>o(e).xto=n),disabled:o(e).val==1},[(_(!0),u(C,null,j(o(G),n=>(_(),u("option",null,i(n),1))),256))],8,We),[[J,o(e).xto]]),t("p",Qe,i(o(m).xto),1)]),t("div",Xe,[Ze,g(t("select",{"onUpdate:modelValue":l[8]||(l[8]=n=>o(e).id_uj=n),disabled:o(e).val==1},[(_(!0),u(C,null,j(o(H),n=>(_(),u("option",{value:n.id,selected:n.id==o(e).id_uj},i(n.tipe),9,tt))),256))],8,et),[[J,o(e).id_uj]]),t("p",lt,i(o(m).id_uj),1)]),t("div",ot,[at,t("div",st,i(o(P)(o(e).amount)),1)])])):$("",!0),o(e).jenis!=""?(_(),u("div",nt,[t("div",it,[rt,g(t("input",{list:"cost_center","onUpdate:modelValue":l[9]||(l[9]=n=>o(e).cost_center_code=n),onBlur:l[10]||(l[10]=n=>Y(n)),disabled:o(e).pvr_no!=""},null,40,dt),[[E,o(e).cost_center_code]]),t("datalist",_t,[(_(!0),u(C,null,j(b.list_cost_center,n=>(_(),u("option",{value:n.CostCenter},i(n.CostCenter+"-"+n.Description),9,ut))),256))]),t("p",ct,i(o(m).cost_center_code),1)]),t("div",pt,[vt,t("div",mt,i(o(e).cost_center_desc),1)]),t("div",ft,[ht,t("div",wt,i(o(e).pvr_no),1)]),t("div",xt,[gt,t("div",kt,i(o(P)(o(e).pvr_total||0)),1)]),t("div",bt,[yt,t("div",Ct,i(o(e).pv_no),1)]),t("div",jt,[St,t("div",Nt,i(o(P)(o(e).pv_total)),1)])])):$("",!0)])]),t("div",Bt,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[11]||(l[11]=n=>b.fnClose())}," Cancel "),o(Q)?$("",!0):(_(),u("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[12]||(l[12]=_e(n=>R(),["prevent"]))}," Save "))])])])],512)),[[ie,b.show]])}}};export{Mt as default};
