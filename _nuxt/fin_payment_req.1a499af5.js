import{j as et,r as N,g as st,i as A,f as lt,o as j,c as k,k as v,L as y,a as t,b as C,l as o,t as n,n as F,d as w,F as T,E as O,D as q,m as at,v as ot,x as c,y as b,B as nt,_ as it}from"./entry.068b8f27.js";import{_ as rt}from"./HeaderPopup.vue.3c3f2d26.js";import ut from"./Plus.73794bbd.js";import dt from"./Send.97d305a7.js";import ct from"./CloudDownload.76d0bc54.js";import _t from"./Times.b79dae0f.js";import{u as ft}from"./useUtils.a09a7649.js";import{u as g}from"./useMyFetch.99cb06aa.js";import"./_plugin-vue_export-helper.c27b6911.js";const pt=nt(()=>it(()=>import("./fin_payment_req_trx_trps.4c1e0089.js"),["./fin_payment_req_trx_trps.4c1e0089.js","./HeaderPopup.vue.3c3f2d26.js","./Times.b79dae0f.js","./_plugin-vue_export-helper.c27b6911.js","./entry.068b8f27.js","./entry.ac1ecdba.css","./useUtils.a09a7649.js","./useMyFetch.99cb06aa.js"],import.meta.url).then(h=>h.default||h)),ht={class:"box-fixed"},mt={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},vt={class:"w-full flex flex-col items-center grow overflow-auto"},wt={class:"w-full flex"},xt=["disabled"],yt={class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},bt={class:"w-full",role:"sticky"},gt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Et=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),St={class:"sticky top-7 !z-[2]"},jt=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),kt=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),Ct=t("th",null,"No Trx",-1),Rt=t("th",null,"Tujuan",-1),Dt=t("th",null,"Produk",-1),Nt=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),At=t("th",null,"Jabatan",-1),It=t("th",null,"Nama",-1),Pt=t("br",null,null,-1),Tt=t("br",null,null,-1),$t=t("br",null,null,-1),Bt=t("th",null,null,-1),Ft=t("th",null,"No Rek",-1),Ot=t("th",null,"Nama Di Bank",-1),qt=t("br",null,null,-1),Ut=t("th",null,"Status ",-1),zt=t("th",null,"Aksi ",-1),Lt=t("th",null,"Alasan Gagal ",-1),Yt={ref:"to_move"},Vt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Kt={class:"w-full h-full flex items-center justify-center"},Qt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Mt={class:"w-full h-full flex items-center justify-center"},Jt={class:"cell"},Wt={class:"w-full h-full flex items-center justify-center p-2"},Gt={class:"pointer p-0 bg-red-500 text-white rounded flex items-center justify-center"},Ht={class:"px-2"},Xt={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},Zt={class:"w-full h-full flex items-center justify-center"},te={class:"cell"},ee={class:"w-full h-full flex items-center justify-center"},se={class:"cell"},le={class:"w-full h-full flex items-center justify-center"},ae={class:"cell"},oe={class:"w-full h-full flex items-center justify-center"},ne={class:"cell"},ie={class:"w-full h-full flex items-center justify-center"},re={class:"cell"},ue={class:"w-full h-full flex items-center justify-end p-2"},de={class:"cell"},ce={class:"w-full h-full flex items-center justify-end p-2"},_e={class:"cell"},fe={class:"w-full h-full flex items-center justify-end p-2"},pe=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),he={class:"cell"},me={class:"w-full h-full flex items-center justify-center"},ve={class:"cell"},we={class:"w-full h-full flex items-center justify-center"},xe={class:"cell"},ye={class:"w-full h-full flex items-center justify-end p-1"},be={class:"cell"},ge={class:"w-full h-full flex items-center justify-end p-1"},Ee={class:"cell"},Se={class:"w-full h-full flex items-center justify-end p-1"},je=["onClick"],ke={class:"cell"},Ce={class:"w-full h-full flex items-center justify-end p-1"},Re={class:"w-full flex items-center justify-end"},De={class:"bg-white w-[250px] sm:w-1/2 md:w-1/3 lg:w-1/4 fixed z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-slate-700 shadow-2xl shadow-black p-2"},Ne=t("label",{for:""},"Select Batch No",-1),Ae=["value"],Ie={class:"flex justify-end pt-2"},Le={__name:"fin_payment_req",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(h){const p=h,{pointFormat:m}=ft(),{display:R}=et(),$={id:0,batch_no:0,details:[]},l=N({...$}),x=st("token"),U=A(()=>{let s=0;return l.value.details.forEach(e=>{s+=parseInt(e.nominal)}),s}),z=A(()=>{let s=0;return l.value.details.forEach(e=>{s+=parseInt(e.potongan_trx_ttl)}),s}),L=A(()=>{let s=0;return l.value.details.forEach(e=>{s+=parseInt(e.extra_money_trx_ttl)}),s}),Y=A(()=>{let s=0;return l.value.details.forEach(e=>{s+=parseInt(e.jumlah)}),s}),E=s=>l.value.details.length==0&&s=="READY"?!0:l.value.details.filter(i=>i.status==s).length==l.value.details.length,V=A(()=>{let s=0;return l.value.details.every(e=>e.status=="READY"?(s=1,!1):e.status=="INQUIRY_PROCESS"?(s=2,!1):e.status=="INQUIRY_FAILED"?(s=3,!1):e.status=="TRANSFER_PROCESS"?(s=4,!1):e.status=="DONE"?(s=5,!1):!0),s}),K=async()=>{c().loading_full=!0;const{data:s,error:e,status:i}=await g("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{id:p.id},retry:0});if(c().loading_full=!1,i.value==="error"){b().trigger(e);return}l.value=s.value.data,p.is_copy&&(l.value.val=0,l.value.val1=0)},f=N({}),Q=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",l.value.id),s.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await g("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}R({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),l.value.details.forEach(r=>{r.status="INQUIRY_PROCESS"})},M=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",l.value.id),s.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await g("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}R({show:!0,status:"Success",message:"Update Data Berhasil"}),i.value.details.forEach(r=>{let d=l.value.details.map(D=>D.id).indexOf(r.id);d>-1&&(l.value.details[d].status=r.status,l.value.details[d].failed_reason=r.failed_reason)}),l.value.status="WAIT"},J=async(s,e)=>{c().loading_full=!0,f.value={};const i=new FormData;i.append("detail_id",s),i.append("_method","PUT");let _="post";const{data:u,error:r,status:d}=await g("/fin_payment_req_dtl/renew_data",{method:_,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(c().loading_full=!1,d.value==="error"){b().trigger(r,f);return}l.value.details[e].rek_no=u.value.employee_rek_no,l.value.details[e].rek_name=u.value.employee_rek_name,l.value.details[e].bank_code=u.value.employee_bank_code,l.value.details[e].status=u.value.status,l.value.details[e].failed_reason=u.value.failed_reason,R({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"})};lt(()=>p.show,(s,e)=>{s==!0&&(p.id==0&&(l.value={...$}),p.id!=0&&K())},{immediate:!0});const P=N(!1),W=()=>{P.value=!0},G=async(s,e)=>{c().loading_full=!0,f.value={};const i=new FormData;i.append("trx_trp_id",e),i.append("_method","DELETE");let _="post";const{data:u,error:r,status:d}=await g("/fin_payment_req_dtl/delete_data",{method:_,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(c().loading_full=!1,d.value==="error"){b().trigger(r,f);return}l.value.details=l.value.details.filter(D=>D.trx_trp_id!=e)},I=N(!1),S=N(0),H=()=>{I.value=!0,S.value=l.value.batch_no},X=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",l.value.id),s.append("batch_no",S.value),s.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await g("/fin_payment_req/set_batch_no",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}l.value.batch_no=S.value;let r=p.p_data.map(d=>d.id).indexOf(l.value.id);r>-1&&p.p_data.splice(r,1,{...l.value}),I.value=!1,R({show:!0,status:"Success",message:"No Batch Berhasil Diperbaharui"})},Z=async()=>{c().loading_full=!0,f.value={};const s=new FormData;s.append("id",l.value.id),s.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await g("/fin_payment_req/set_paid_done",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,u.value==="error"){b().trigger(_,f);return}l.value.status="CLOSE",l.value.details.forEach(d=>{d.status="DONE"});let r=p.p_data.map(d=>d.id).indexOf(l.value.id);r>-1&&p.p_data.splice(r,1,{...l.value}),R({show:!0,status:"Success",message:"PAID IS DONE"})};return(s,e)=>{const i=rt,_=ut,u=dt,r=ct,d=_t,D=pt;return j(),k(T,null,[v(t("section",ht,[t("div",null,[C(i,{title:"Finance Payment Request",fn:h.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",mt,[t("div",vt,[t("div",wt,[v(t("button",{type:"button",name:"button",class:"m-1",disabled:o(l).status=="CLOSE",onClick:e[0]||(e[0]=a=>H())}," Batch No : "+n(o(l).batch_no),9,xt),[[y,E("TRANSFER_PROCESS")&&o(l).status=="WAIT"]]),v(t("button",{type:"button",name:"button",class:"m-1 bg-violet-600 text-white",onClick:e[1]||(e[1]=a=>Z())}," Set Paid Done ",512),[[y,E("TRANSFER_PROCESS")]]),E("TRANSFER_PROCESS")||E("INQUIRY_PROCESS")?F("",!0):(j(),k("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=a=>W())},[C(_)])),v(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=a=>Q())},[C(u)],512),[[y,E("READY")]]),v(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=a=>M())},[C(r)],512),[[y,E("INQUIRY_PROCESS")]])]),t("div",yt,[t("div",bt,[t("table",gt,[t("thead",null,[Et,t("tr",St,[jt,kt,Ct,Rt,Dt,Nt,At,It,t("th",null,[w("Jumlah "),Pt,w(" ("+n(o(m)(o(U)||0))+") ",1)]),t("th",null,[w("Potongan "),Tt,w(" ("+n(o(m)(o(z)))+")",1)]),t("th",null,[w("ExtraMoney "),$t,w(" ("+n(o(m)(o(L)))+")",1)]),Bt,Ft,Ot,t("th",null,[w("Nominal Transfer "),qt,w(" ("+n(o(m)(o(Y)||0))+")",1)]),Ut,zt,Lt])]),t("tbody",Yt,[(j(!0),k(T,null,O(o(l).details,(a,B)=>(j(),k("tr",{key:B},[t("td",Vt,[t("div",Kt,n(a.no),1)]),t("td",Qt,[t("div",Mt,n(a.id),1)]),t("td",Jt,[t("div",Wt,[t("div",Gt,[t("span",Ht,n(a.trx_trp_id),1),v(C(d,{onClick:q(tt=>G(a.id,a.trx_trp_id),["prevent"]),class:"cursor-pointer text-3xl font-bold p-0 border-l-2 border-red-300"},null,8,["onClick"]),[[y,[0,1,3].indexOf(o(V))>-1]])])])]),t("td",Xt,[t("div",Zt,n(a.jabatan!="KERNET"?a.tujuan:""),1)]),t("td",te,[t("div",ee,n(a.jabatan!="KERNET"?a.produk:""),1)]),t("td",se,[t("div",le,n(a.jabatan!="KERNET"?a.no_pol:""),1)]),t("td",ae,[t("div",oe,n(a.jabatan),1)]),t("td",ne,[t("div",ie,n(a.nama),1)]),t("td",re,[t("div",ue,n(o(m)(a.jumlah||0)),1)]),t("td",de,[t("div",ce,n(o(m)(a.potongan_trx_ttl)),1)]),t("td",_e,[t("div",fe,n(o(m)(a.extra_money_trx_ttl)),1)]),pe,t("td",he,[t("div",me,n(a.rek_no),1)]),t("td",ve,[t("div",we,n(a.rek_name),1)]),t("td",xe,[t("div",ye,n(o(m)(a.jumlah||0)),1)]),t("td",be,[t("div",ge,n(a.status),1)]),t("td",Ee,[t("div",Se,[a.status=="INQUIRY_FAILED"?(j(),k("button",{key:0,class:"bg-yellow-400 rounded",onClick:q(tt=>J(a.id,B),["prevent"])}," Renew Data ",8,je)):F("",!0)])]),t("td",ke,[t("div",Ce,n(a.failed_reason),1)])]))),128))],512)])])])]),t("div",Re,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[5]||(e[5]=a=>h.fnClose())}," Cancel ")])])])],512),[[y,h.show]]),C(D,{show:o(P),fnClose:()=>{P.value=!1},id:o(l).id,onSetKData:e[6]||(e[6]=a=>l.value=a),onSetIsNew:e[7]||(e[7]=a=>{a&&h.p_data.push(o(l))})},null,8,["show","fnClose","id"]),v(t("div",De,[Ne,v(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>at(S)?S.value=a:null)},[(j(),k(T,null,O(5,a=>t("option",{value:a-1},n(a-1),9,Ae)),64))],512),[[ot,o(S)]]),t("div",Ie,[t("button",{type:"button",class:"bg-blue-500 text-white",onClick:e[9]||(e[9]=a=>X())},"Save"),t("button",{type:"button",class:"bg-yellow-500 text-white ml-2",onClick:e[10]||(e[10]=a=>I.value=!1)},"Cancel")])],512),[[y,o(I)]])],64)}}};export{Le as default};
