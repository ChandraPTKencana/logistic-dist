import Be from"./Header.6fa5cf29.js";import Ue from"./Copy.6ff40af6.js";import Fe from"./Plus.f1841fb8.js";import Ie from"./Edit.9954f1ef.js";import Me from"./Eyes.de85b1f0.js";import Ne from"./Delete.150adb06.js";import Ee from"./Signature.b5f3831b.js";import He from"./SignatureOff.810096aa.js";import Ve from"./Table2Column.2008b7a4.js";import ze from"./Line.d901bea8.js";import Je from"./Check.c70dcedd.js";import Le from"./TableView.56609574.js";import{_ as Ke}from"./PopupMini.vue.778aa9bb.js";import Re from"./ujalan.69134e7f.js";import Ye from"./ujalan_batas_persen_susut.b51a3fe4.js";import Ge from"./ujalan_validasi.481f3a2b.js";import{r as n,f as Q,g as qe,h as Ze,i as w,j as W,s as Qe,x as _,c as f,b as r,a as i,k as X,v as We,l,m as ee,n as g,d as H,w as $,q as Xe,y as B,o as d,z as U,t as te,A as et}from"./entry.fb632158.js";import{u as m}from"./useUtils.8f10d844.js";import{u as F}from"./useMyFetch.14298027.js";import{u as tt}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.2ab3408c.js";import"./Adjust.fa7b152f.js";import"./TableHeaderEye.769d3a7b.js";import"./Times.2162c804.js";import"./ClearAll.909c7c18.js";import"./client-only.848f5223.js";import"./ClearEach.5ea03f59.js";import"./CaretLeftDoubleBold.044fb663.js";import"./CaretLeftBold.08b290a3.js";import"./CaretRightBold.2d974661.js";import"./CaretRightDoubleBold.b4a3f28c.js";import"./Exclamation.6fd04b7b.js";import"./HeaderPopup.vue.0c89d567.js";import"./InputPointFormat.vue.66f4dea8.js";import"./Tools.1025d1bf.js";import"./ToolsPopup.259981b3.js";import"./ac_accs.3867689e.js";const at={class:"w-full h-full flex flex-col"},lt={class:"w-full flex grow flex-col overflow-auto h-0"},ot={class:"w-full flex justify-between flex-wrap"},st={class:"grow flex"},nt={class:"m-1"},ut=i("option",{value:"available"},"Available",-1),rt=i("option",{value:"unapprove"},"Unapprove",-1),it=i("option",{value:"deleted"},"Trash",-1),dt=i("option",{value:"all"},"All",-1),_t=[ut,rt,it,dt],mt=i("span",{class:"text-xs ml-1"}," Download ",-1),vt={class:"whitespace-pre-wrap"},ct={class:"grow mb-5"},ta={__name:"index",async setup(pt){let A,V;const ae=t=>t.deleted==1?"!bg-red-400":t.val==0||t.val1==0?"!bg-gray-300":"",y=n("available");Q(()=>y.value,t=>{K()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const z=n({}),O=qe("token"),{data:le}=([A,V]=Ze(async()=>Xe(async()=>{_().loading_full=!0;let t=[];const[e,k]=await Promise.all([F("/ujalan",{method:"get",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return e.status.value!=="error"&&(t=e.data.value.data),e.status.value==="error"?(B().trigger(e.error),{ujalans:t}):(_().loading_full=!1,{ujalans:t})},"$SN3C927rLk")),A=await A,V(),A),s=n(le.value.ujalans||[]),I=n({field:"tanggal",by:"desc"}),a=n(-1),v=w(()=>s.value[a.value]),c=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),J=()=>{u.like="";let t=JSON.parse(JSON.stringify(_()._tv.global_keyword));t!=""&&(u.like=`id:%${t}%,xto:%${t}%,tipe:%${t}%,jenis:%${t}%,harga:%${t}%`),u.sort="",I.value.field&&(u.sort=I.value.field+":"+I.value.by),u.filter_model=JSON.stringify(_()._tv.filter_model)},L=async()=>{_().loading_full=!0,z.value={},c.value.may_get_data=!1,u.page=c.value.page,u.page==1&&(s.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(s.value[0])),u.filter_status=y.value;const{data:t,error:e,status:k}=await F("/ujalan",{method:"get",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},params:u,retry:0});if(_().loading_full=!1,c.value.may_get_data=!0,k.value==="error"){B().trigger(e,z);return}c.value.page==1?s.value=t.value.data:c.value.page>1&&(s.value=[...s.value,...t.value.data]),t.value.data.length==0&&(c.value.is_last_record=!0),_()._tv.filter_box=!1},K=()=>{a.value=-1,c.value.page=1,c.value.is_last_record=!1,J(),L()},C=n(!1),M=n(!1),j=n(0),p=n(0),b=n(-1),oe=()=>{j.value=0,b.value=-1,p.value=!1,C.value=!0},{display:x}=W();Qe(W());const se=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value=s.value[a.value].id,b.value=-1,p.value=!1,C.value=!0)},ne=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value=s.value[a.value].id,b.value=-1,p.value=!1,M.value=!0)},ue=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value=s.value[a.value].id,b.value=-1,p.value=!0,C.value=!0)},P=n(!1),T=n(0),re=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=s.value[a.value].id,b.value=1,p.value=!1,P.value=!0)},ie=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=s.value[a.value].id,b.value=0,p.value=!1,P.value=!0)},de=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=s.value[a.value].id,p.value=!1,b.value=-1,P.value=!0)},N=n(!1),R=n({}),S=n(!1),D=n(""),_e=async()=>{S.value&&(S.value=!1)},me=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(D.value="",R.value={id:s.value[a.value].id,tujuan:s.value[a.value].xto},S.value=!0)};Q(()=>D.value,t=>{t.trim().length>0?N.value=!0:N.value=!1},{immediate:!1});const ve=async()=>{_().loading_full=!0;const t=new FormData;t.append("id",s.value[a.value].id),t.append("deleted_reason",D.value),t.append("_method","DELETE");const{data:e,error:k,status:E}=await F("/ujalan",{method:"post",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},body:t,retry:0});if(_().loading_full=!1,E.value==="error"){B().trigger(k);return}let h={...s.value[a.value]};h.deleted=e.value.deleted,h.deleted_user=e.value.deleted_user,h.deleted_at=e.value.deleted_at,h.deleted_by=e.value.deleted_by,h.deleted_reason=e.value.deleted_reason,y.value!="all"?s.value.splice(a.value,1):s.value.splice(a.value,1,{...h}),a.value=-1,S.value=!1},ce=n([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"asst_opt",label:"Info",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"km_range",label:"Jarak KM",filter_on:1,type:"number"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"batas_persen_susut",label:"Batas Persen Susut",class:" justify-end",type:"number",tbl_show:m().checkPermission("ujalan.batas_persen_susut.full_act")},{key:"bonus_trip_supir",label:"Bonus Trip Supir",class:" justify-end",type:"number"},{key:"bonus_trip_kernet",label:"Bonus Trip Kernet",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:_().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),pe=w(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&m().checkPermission("ujalan.create")),fe=w(()=>["available","all","unapprove"].indexOf(y.value)>-1&&m().checkPermission("ujalan.create")),ye=w(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&(m().checkPermission("ujalan.val")&&[void 0,0].indexOf(v.value.val)>-1||m().checkPermission("ujalan.val1")&&[void 0,0].indexOf(v.value.val1)>-1)&&m().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),be=w(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&(m().checkPermission("ujalan.val")&&[void 0,0].indexOf(v.value.val)>-1||m().checkPermission("ujalan.val1")&&[void 0,0].indexOf(v.value.val1)>-1)),ke=w(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&(m().checkPermission("ujalan.unval")&&[1].indexOf(v.value.val)>-1||m().checkPermission("ujalan.unval1")&&[1].indexOf(v.value.val1)>-1)),he=w(()=>a.value>-1&&m().checkPermission("ujalan.remove")&&[void 0,0].indexOf(v.value.deleted)>-1),{downloadFile:ge,viewFile:ft}=tt(),xe=async()=>{J(),_().loading_full=!0;const{data:t,error:e,status:k}=await F("/ujalan/download_excel",{method:"get",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},params:u,retry:0});if(_().loading_full=!1,k.value==="error"){B().trigger(e);return}ge(t.value)};return(t,e)=>{const k=Be,E=Ue,h=Fe,Y=Ie,we=Me,je=Ne,De=Ee,Ce=He,Pe=Ve,G=ze,q=Je,Se=Le,$e=Ke,Ae=Re,Oe=Ye,Te=Ge;return d(),f("div",at,[r(k,{title:"List Ujalan"}),i("div",lt,[i("div",ot,[i("div",st,[i("div",nt,[X(i("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>ee(y)?y.value=o:null)},_t,512),[[We,l(y)]])]),l(pe)?(d(),f("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>ue())},[r(E)])):g("",!0),l(fe)?(d(),f("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>oe())},[r(h)])):g("",!0),l(ye)?(d(),f("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>se())},[r(Y)])):g("",!0),l(a)>-1?(d(),f("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>de())},[r(we)])):g("",!0),l(he)?(d(),f("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>me())},[r(je)])):g("",!0),l(be)?(d(),f("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>re())},[r(De)])):g("",!0),l(ke)?(d(),f("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>ie())},[r(Ce)])):g("",!0),i("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:e[8]||(e[8]=o=>xe())},[r(Pe),H(),mt]),l(a)>-1&&("useUtils"in t?t.useUtils:l(m))().checkPermission("ujalan.batas_persen_susut.full_act")?(d(),f("button",{key:7,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[9]||(e[9]=o=>ne())},[r(Y)])):g("",!0)])]),r(Se,{thead:l(ce),selected:l(a),onSetSelected:e[10]||(e[10]=o=>a.value=o),tbody:l(s),fnCallData:L,scrolling:l(c),onSetScrollingPage:e[11]||(e[11]=o=>l(c).page=o),onDoFilter:e[12]||(e[12]=o=>K()),rowBgColor:ae},{val:$(({item:o})=>[o.val?(d(),U(q,{key:1})):(d(),U(G,{key:0}))]),val1:$(({item:o})=>[o.val1?(d(),U(q,{key:1})):(d(),U(G,{key:0}))]),xto:$(({item:o})=>[i("div",vt,te(o.xto),1)]),deleted_by_username:$(({item:o})=>{var Z;return[H(te((Z=o.deleted_by)==null?void 0:Z.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),r($e,{type:"delete",show:l(S),data:l(R),fnClose:_e,fnConfirm:ve,enabledOk:l(N)},{footer:$(()=>[H(" Masukkan Alasan Penghapusan: "),i("div",ct,[X(i("textarea",{"onUpdate:modelValue":e[13]||(e[13]=o=>ee(D)?D.value=o:null)},null,512),[[et,l(D)]])])]),_:1},8,["show","data","enabledOk"]),r(Ae,{show:l(C),fnClose:()=>{C.value=!1},id:l(j),p_data:l(s),is_copy:l(p)},null,8,["show","fnClose","id","p_data","is_copy"]),r(Oe,{show:l(M),fnClose:()=>{M.value=!1},id:l(j),p_data:l(s),is_copy:l(p)},null,8,["show","fnClose","id","p_data","is_copy"]),r(Te,{show:l(P),fnClose:()=>{P.value=!1},id:l(T),p_data:l(s),it_state:l(b)},null,8,["show","fnClose","id","p_data","it_state"])])}}};export{ta as default};
