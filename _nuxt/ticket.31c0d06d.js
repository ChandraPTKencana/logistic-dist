import je from"./Header.83359143.js";import Ne from"./Edit.612e1063.js";import Ve from"./Eyes.8b3df5d8.js";import Ye from"./Void.1b32562f.js";import He from"./Signature.428f1b30.js";import Oe from"./Cog.25cfc990.js";import Fe from"./Image.1357050a.js";import Ie from"./Line.4c297753.js";import Ue from"./Check.e772a580.js";import ze from"./TableView.c502ebba.js";import{_ as Re}from"./PopupMini.vue.fd82988c.js";import Ee from"./trx_trp_ticket.ef65bd95.js";import Je from"./trx_trp_ticket_validasi.2487550f.js";import Le from"./trx_absen.8b4ca514.js";import Ke from"./Times.8fb6f413.js";import{_ as Ge}from"./client-only.1bd91c15.js";import{r as _,j as Xe,f as Ze,g as Qe,G as B,h as We,i as se,s as et,A as c,I as tt,c as w,b as p,a as i,m as at,q as ot,k as r,n as lt,l as D,w as g,z as rt,B as A,o as m,D as $,d as Y,t as ne,H as st,E as nt}from"./entry.628a243a.js";import{u as T}from"./useMyFetch.338f42c4.js";import{u as H}from"./useUtils.949eecfb.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.f2e5da1b.js";import"./Adjust.90e4f195.js";import"./TableHeaderEye.0dbdd745.js";import"./ClearAll.faf3569a.js";import"./ClearEach.5cc916c5.js";import"./CaretLeftDoubleBold.bbecdfe6.js";import"./CaretLeftBold.8914b710.js";import"./CaretRightBold.5f867fc3.js";import"./CaretRightDoubleBold.7d09a174.js";import"./Exclamation.ce61087f.js";import"./HeaderPopup.vue.e9ec3fd3.js";import"./InputPointFormat.vue.ad892291.js";const it={class:"w-full h-full flex flex-col"},_t={class:"w-full flex grow flex-col overflow-auto h-0"},ut={class:"w-full flex justify-between flex-wrap"},dt={class:"grow flex"},ct={class:"m-1"},pt=st('<option value="ticket_not_done">Undone</option><option value="ticket_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),mt=[pt],ft={class:"flex"},vt=i("b",null,"tidak dapat dibatalkan lagi",-1),kt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},bt={class:"relative",style:{width:"95%",height:"90%"}},yt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},gt={class:"w-full h-full flex flex-col items-center justify-content-center bg-white"},xt={class:"w-full p-1"},ht={class:"w-full p-1 bg-gray-200"},wt=i("div",{class:"w-full text-blue-600 font-bold"}," Set Date For Load Data ",-1),Dt={class:"w-full grid grid-cols-2 grid-rows-1 gap-1"},$t={class:"flex flex-col flex-wrap p-1"},Ct=i("label",{for:""},"From",-1),At={class:"grow"},Tt={class:"flex flex-col flex-wrap p-1"},Mt=i("label",{for:""},"To",-1),St={class:"grow"},da={__name:"ticket",async setup(Bt){let q,K;const{$moment:P}=nt(),G=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":["CPO","PK"].indexOf(e.jenis)>-1&&e.ticket_a_id!=""&&e.ticket_b_bruto!=""&&e.ticket_b_tara!=""&&e.ticket_b_netto!=""&&e.ticket_b_in_at!=""&&e.ticket_b_out_at!=""||e.jenis=="TBS"&&e.ticket_a_id!=""&&e.ticket_b_id!=""||e.jenis=="TBSK"&&e.ticket_b_id!=""?"!bg-blue-300":"",O=e=>(e.map(t=>{t.class_h=G(t)}),e),x=_("ticket_not_done");Xe(()=>x.value,e=>{W()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const X=_({}),j=_({from:"",to:""}),C=Ze("token"),{data:ie}=([q,K]=Qe(async()=>rt(async()=>{c().loading_full=!0;let e=[];const[t,f]=await Promise.all([T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{filter_status:x},retry:0})]);return t.status.value!=="error"&&(e=O(t.data.value.data)),t.status.value==="error"?(A().trigger(t.error),{trx_trps:e}):(c().loading_full=!1,{trx_trps:e})},"$X4xCu6yBOs")),q=await q,K(),q),s=_(ie.value.trx_trps||[]),Z=_([]),_e=async(e,t="")=>{c().loading_full=!0;let f=d.value.from?P(d.value.from).format("Y-MM-DD"):"",y=d.value.to?P(d.value.to).format("Y-MM-DD"):"";const{data:a,error:v,status:l}=await T("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{jenis:e,from:f,to:y,transition_target:t},retry:0});if(c().loading_full=!1,l.value==="error"){A().trigger(v);return}Z.value=a.value.list_ticket},F=_({field:"tanggal",by:"desc"}),n=_(-1),b=B(()=>s.value[n.value]),k=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ue=()=>{u.like="";let e=JSON.parse(JSON.stringify(c()._tv.global_keyword));e!=""&&(u.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),u.sort="",F.value.field&&(u.sort=F.value.field+":"+F.value.by),u.date_from=j.value.from?P(j.value.from).format("YYYY-MM-DD"):"",u.date_to=j.value.to?P(j.value.to).format("YYYY-MM-DD"):"",u.filter_model=JSON.stringify(c()._tv.filter_model)},Q=async()=>{c().loading_full=!0,X.value={},k.value.may_get_data=!1,u.page=k.value.page,u.page==1&&(s.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(s.value[0])),u.filter_status=x.value;const{data:e,error:t,status:f}=await T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:u,retry:0});if(c().loading_full=!1,k.value.may_get_data=!0,f.value==="error"){A().trigger(t,X);return}k.value.page==1?s.value=O(e.value.data):k.value.page>1&&(s.value=[...s.value,...O(e.value.data)]),e.value.data.length==0&&(k.value.is_last_record=!0),c()._tv.filter_box=!1},W=()=>{n.value=-1,k.value.page=1,k.value.is_last_record=!1,ue(),Q()};We();const I=_(!1),ee=_(0),{display:M}=se();et(se());const de=()=>{n.value==-1?M({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(ee.value=s.value[n.value].id,I.value=!0)},N=_(!1),U=_(0),z=_(!1),ce=()=>{n.value==-1?M({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=s.value[n.value].id,N.value=!0,z.value=!1)},pe=()=>{n.value==-1?M({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=s.value[n.value].id,N.value=!0,z.value=!0)},R=_(!1),te=_(0),me=e=>{te.value=e,R.value=!0},ae=_({}),S=_(!1),fe=_(""),ve=async()=>{S.value&&(S.value=!1)},ke=()=>{var e;n.value==-1?M({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(fe.value="",ae.value={id:s.value[n.value].id,"no pol":s.value[n.value].no_pol,tujuan:s.value[n.value].xto,permintaan:(e=s.value[n.value].req_deleted_by)==null?void 0:e.username,alasan:s.value[n.value].req_deleted_reason},S.value=!0)},be=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",s.value[n.value].id),e.append("_method","DELETE");const{data:t,error:f,status:y}=await T("/trx_trp_approve_req_delete",{method:"post",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){A().trigger(f);return}let a={...s.value[n.value]};a.deleted=t.value.deleted,a.deleted_user=t.value.deleted_user,a.deleted_at=t.value.deleted_at,a.deleted_by=t.value.deleted_by,a.deleted_reason=t.value.deleted_reason,a.class_h=G(a),x.value!="all"?s.value.splice(n.value,1):s.value.splice(n.value,1,{...a}),n.value=-1,S.value=!1},ye=async()=>{c().loading_full=!0;const e=new FormData;e.append("ids",JSON.stringify(E.value)),e.append("_method","PUT");const{data:t,error:f,status:y}=await T("/trx_trp_val_tickets",{method:"post",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){A().trigger(f);return}t.value.val_lists.forEach(a=>{let v=s.value.map(l=>l.id).indexOf(a.id);if(v>-1){let l=s.value[v];l.val_ticket=a.val_ticket,l.val_ticket_by=a.val_ticket_by,l.val_ticket_at=a.val_ticket_at,s.value.splice(v,1,{...l})}})},V=_(!1),d=_({from:new Date().setDate(new Date().getDate()-3),to:new Date}),oe=e=>{e=="from"?d.value.from-d.value.to>0&&(d.value.from=d.value.to):d.value.to-d.value.from<0&&(d.value.to=d.value.from)},ge=async()=>{c().loading_full=!0;const e=new FormData,{data:t,error:f,status:y}=await T("/trx_trp_do_update_ticket",{method:"post",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,y.value==="error"){A().trigger(f);return}t.value.data.forEach(a=>{let v=s.value.map(l=>l.id).indexOf(a.id);if(v!==-1){let l=s.value[v];l.ticket_a_id=a.ticket_a_id,l.ticket_a_no=a.ticket_a_no,l.ticket_a_bruto=a.ticket_a_bruto,l.ticket_a_tara=a.ticket_a_tara,l.ticket_a_netto=a.ticket_a_netto,l.ticket_a_supir=a.ticket_a_supir,l.ticket_a_no_pol=a.ticket_a_no_pol,l.ticket_a_in_at=a.ticket_a_in_at,l.ticket_a_out_at=a.ticket_a_out_at,l.ticket_b_id=a.ticket_b_id,l.ticket_b_no=a.ticket_b_no,l.ticket_b_bruto=a.ticket_b_bruto,l.ticket_b_tara=a.ticket_b_tara,l.ticket_b_netto=a.ticket_b_netto,l.ticket_b_supir=a.ticket_b_supir,l.ticket_b_no_pol=a.ticket_b_no_pol,l.ticket_b_in_at=a.ticket_b_in_at,l.ticket_b_out_at=a.ticket_b_out_at,l.updated_at=a.updated_at,s.value.splice(v,1,{...l})}}),M({show:!0,status:"Success",message:"Update PV Done"})},E=_([]),xe=_([{key:"cb",label:"",checkbox:"id"},{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val_ticket",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:c().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"pv_no",label:"PV No",type:"string"},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:1,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:1},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:1,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:1,type:"string",filter_on:1}]),he=B(()=>n.value>-1&&H().checkPermission("trp_trx.ticket.view")),we=B(()=>n.value>-1&&b.value.deleted==0&&b.value.req_deleted==0&&b.value.val_ticket==0&&H().checkPermission("trp_trx.ticket.modify")),De=B(()=>n.value>-1&&b.value.deleted==0&&b.value.req_deleted==0&&b.value.val_ticket==0&&H().checkPermission("trp_trx.ticket.val_ticket")),$e=B(()=>n.value>-1&&b.value.deleted==0&&b.value.req_deleted==1&&b.value.val_ticket==0&&H().checkPermission("trp_trx.approve_request_remove"));return(e,t)=>{const f=je,y=Ne,a=Ve,v=Ye,l=He,Ce=Oe,Ae=Fe,J=Ie,L=Ue,Te=ze,Me=Re,Se=Ee,Be=Je,qe=Le,Pe=Ke,le=tt("vue-date-picker"),re=Ge;return m(),w("div",it,[p(f,{title:"List Transaction"}),i("div",_t,[i("div",ut,[i("div",dt,[i("div",ct,[at(i("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=o=>lt(x)?x.value=o:null)},mt,512),[[ot,r(x)]])]),r(we)?(m(),w("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=o=>de())},[p(y)])):D("",!0),r(he)?(m(),w("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=o=>pe())},[p(a)])):D("",!0),r($e)?(m(),w("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=o=>ke())},[p(v)])):D("",!0),r(De)?(m(),w("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=o=>ce())},[p(l)])):D("",!0)]),i("div",ft,[r(E).length>0?(m(),w("button",{key:0,type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[5]||(t[5]=o=>ye())}," Multi Val ")):D("",!0),i("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[6]||(t[6]=o=>V.value=!0)},[p(Ce)]),i("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[7]||(t[7]=o=>ge())}," Update Ticket ")])]),p(Te,{thead:r(xe),selected:r(n),onSetSelected:t[8]||(t[8]=o=>n.value=o),tbody:r(s),fnCallData:Q,scrolling:r(k),onSetScrollingPage:t[9]||(t[9]=o=>r(k).page=o),onDoFilter:t[10]||(t[10]=o=>W()),onSetCheckbox:t[11]||(t[11]=o=>E.value=o)},{absen:g(({item:o,index:h})=>[o.trx_absens&&o.trx_absens.length>0?(m(),$(Ae,{key:0,class:"cursor-pointer",onClick:qt=>me(h)},null,8,["onClick"])):D("",!0)]),val:g(({item:o})=>[o.val?(m(),$(L,{key:1})):(m(),$(J,{key:0}))]),val1:g(({item:o})=>[o.val1?(m(),$(L,{key:1})):(m(),$(J,{key:0}))]),val_ticket:g(({item:o})=>[o.val_ticket?(m(),$(L,{key:1})):(m(),$(J,{key:0}))]),deleted_by_username:g(({item:o})=>{var h;return[Y(ne((h=o.deleted_by)==null?void 0:h.username),1)]}),req_deleted_by_username:g(({item:o})=>{var h;return[Y(ne((h=o.req_deleted_by)==null?void 0:h.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),p(Me,{type:"custome",show:r(S),data:r(ae),fnClose:ve,fnConfirm:be},{words:g(()=>[Y(" Data akan diproses dan "),vt,Y(", apakah Anda menyetujui permintaan penghapusan data berikut? ")]),_:1},8,["show","data"]),p(Se,{show:r(I),fnClose:()=>{I.value=!1},fnLoadDBData:_e,id:r(ee),p_data:r(s),list_ticket:r(Z)},null,8,["show","fnClose","id","p_data","list_ticket"]),p(Be,{show:r(N),fnClose:()=>{N.value=!1},id:r(U),p_data:r(s),is_view:r(z)},null,8,["show","fnClose","id","p_data","is_view"]),p(qe,{show:r(R),fnClose:()=>{R.value=!1},index:r(te),p_data:r(s)},null,8,["show","fnClose","index","p_data"]),r(V)?(m(),w("div",kt,[i("div",bt,[i("div",yt,[p(Pe,{style:{color:"black",cursor:"pointer"},onClick:t[12]||(t[12]=o=>V.value=!1)})]),i("div",gt,[i("div",xt,[i("div",ht,[wt,i("div",Dt,[i("div",$t,[Ct,i("div",At,[p(re,null,{default:g(()=>[p(le,{modelValue:r(d).from,"onUpdate:modelValue":t[13]||(t[13]=o=>r(d).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[14]||(t[14]=o=>oe("from"))},null,8,["modelValue"])]),_:1})])]),i("div",Tt,[Mt,i("div",St,[p(re,null,{default:g(()=>[p(le,{modelValue:r(d).to,"onUpdate:modelValue":t[15]||(t[15]=o=>r(d).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[16]||(t[16]=o=>oe("to"))},null,8,["modelValue"])]),_:1})])])])])])]),i("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[17]||(t[17]=o=>V.value=!1)})])])):D("",!0)])}}};export{da as default};
