import re from"./Header.961df900.js";import se from"./Eyes.e24736dc.js";import ne from"./Image.39ed87b1.js";import _e from"./Line.3f1a26cc.js";import ie from"./Check.5e3bf0df.js";import pe from"./TableView.ba8e1332.js";import de from"./trx_trp_nolog.ac6abf9b.js";import me from"./trx_trp_validasi.b8617c12.js";import ce from"./trx_absen.d193fc99.js";import{r,j as ue,g as fe,G as H,i as ye,A as m,c as B,b as k,a as b,m as ve,q as ke,k as o,n as be,l as O,w as i,z as ge,B as j,o as s,D as n,d as C,t as M,H as he,E as we}from"./entry.1af0e639.js";import{u as K}from"./useMyFetch.6a27c764.js";import{u as xe}from"./useUtils.06e9219f.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.cc3e9938.js";import"./Adjust.a58c92aa.js";import"./TableHeaderEye.faec307a.js";import"./Times.7c581167.js";import"./ClearAll.1cadf685.js";import"./client-only.af2e1d10.js";import"./ClearEach.ca0d49e9.js";import"./CaretLeftDoubleBold.ca0993e4.js";import"./CaretLeftBold.03f31950.js";import"./CaretRightBold.05e46cf0.js";import"./CaretRightDoubleBold.f76003f2.js";import"./HeaderPopup.vue.e8f8ba03.js";import"./WidthMiniList.vue.e5d10589.js";import"./WidthMiniPart.vue.8e326ce1.js";import"./PopupMini.vue.825a823e.js";import"./Exclamation.7b071e27.js";const De={class:"w-full h-full flex flex-col"},Te={class:"w-full flex grow flex-col overflow-auto h-0"},Ce={class:"w-full flex justify-between flex-wrap"},Me={class:"grow flex"},Se={class:"m-1"},$e=he('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ae=[$e],_t={__name:"index",async setup(Ne){let g,S;const{$moment:$}=we(),F=e=>e.deleted==1?"!bg-red-400":e.pvr_id>0&&e.req_deleted==1?"!bg-yellow-300":e.pv_id>0?"!bg-blue-300":"",w=e=>(e.map(l=>{l.class_h=F(l)}),e),v=r("pv_not_done");ue(()=>v.value,e=>{V.value.map(l=>{let u=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(l.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?u&&(l.tbl_show=1):u&&(l.tbl_show=0),l}),q()},{immediate:!1});const a={};a._TimeZoneOffset=new Date().getTimezoneOffset(),a.sort="tanggal:desc";const A=r({}),h=r({from:"",to:""}),{data:I}=([g,S]=fe(async()=>ge(async()=>{m().loading_full=!0;let e=[];const[l,u]=await Promise.all([K("/trx_trp_nologs",{method:"get",params:{filter_status:v},retry:0})]);return l.status.value!=="error"&&(e=w(l.data.value.data)),l.status.value==="error"?(j().trigger(l.error),{trx_trps:e}):(m().loading_full=!1,{trx_trps:e})},"$MmURKklrhv")),g=await g,S(),g),_=r(I.value.trx_trps||[]),J=r([]),L=r(!1),x=r({field:"tanggal",by:"desc"}),c=r(-1);H(()=>_.value[c.value]);const p=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),E=()=>{a.like="";let e=JSON.parse(JSON.stringify(m()._tv.global_keyword));e!=""&&(a.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),a.sort="",x.value.field&&(a.sort=x.value.field+":"+x.value.by),a.date_from=h.value.from?$(h.value.from).format("YYYY-MM-DD"):"",a.date_to=h.value.to?$(h.value.to).format("YYYY-MM-DD"):"",a.filter_model=JSON.stringify(m()._tv.filter_model)},N=async()=>{m().loading_full=!0,A.value={},p.value.may_get_data=!1,a.page=p.value.page,a.page==1&&(_.value=[]),a.first_row&&delete a.first_row,a.page>1&&(a.first_row=JSON.stringify(_.value[0])),a.filter_status=v.value;const{data:e,error:l,status:u}=await K("/trx_trp_nologs",{method:"get",params:a,retry:0});if(m().loading_full=!1,p.value.may_get_data=!0,u.value==="error"){j().trigger(l,A);return}p.value.page==1?_.value=w(e.value.data):p.value.page>1&&(_.value=[..._.value,...w(e.value.data)]),e.value.data.length==0&&(p.value.is_last_record=!0),m()._tv.filter_box=!1},q=()=>{c.value=-1,p.value.page=1,p.value.is_last_record=!1,E(),N()},P=r(!1),z=r(0),{display:G}=ye(),D=r(!1),U=r(0),Y=r(!1),W=()=>{c.value==-1?G({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=_.value[c.value].id,D.value=!0,Y.value=!0)},T=r(!1),R=r(0),Z=e=>{R.value=e,T.value=!0},V=r([{key:"no",label:"No",isai:!0},{key:"val",label:"APP",childs:[{key:"val",label:"Kasir",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"Mandor",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"KTU/W",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val3",label:"Marketing",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val4",label:"Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val5",label:"SPV Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"transition",label:"Peralihan",childs:[{key:"transition_type",label:"Type",type:"select",filter_on:1,select_item:["To","From"]},{key:"transition_target",label:"Target",type:"select",filter_on:1,select_item:m().list_pabrik}]},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"payment_method_name",label:"Payment Method Name",type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),Q=H(()=>c.value>-1&&xe().checkPermission("trp_trx.view"));return(e,l)=>{const u=re,X=se,ee=ne,f=_e,y=ie,te=pe,le=de,oe=me,ae=ce;return s(),B("div",De,[k(u,{title:"List Transaction"}),b("div",Te,[b("div",Ce,[b("div",Me,[b("div",Se,[ve(b("select",{class:"","onUpdate:modelValue":l[0]||(l[0]=t=>be(v)?v.value=t:null)},Ae,512),[[ke,o(v)]])]),o(Q)?(s(),B("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:l[1]||(l[1]=t=>W())},[k(X)])):O("",!0)])]),k(te,{thead:o(V),selected:o(c),onSetSelected:l[2]||(l[2]=t=>c.value=t),tbody:o(_),fnCallData:N,scrolling:o(p),onSetScrollingPage:l[3]||(l[3]=t=>o(p).page=t),onDoFilter:l[4]||(l[4]=t=>q())},{absen:i(({item:t,index:d})=>[t.trx_absens&&t.trx_absens.length>0?(s(),n(ee,{key:0,class:"cursor-pointer",onClick:qe=>Z(d)},null,8,["onClick"])):O("",!0)]),val:i(({item:t})=>[t.val?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),val1:i(({item:t})=>[t.val1?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),val2:i(({item:t})=>[t.val2?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),val3:i(({item:t})=>[t.val3?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),val4:i(({item:t})=>[t.val4?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),val5:i(({item:t})=>[t.val5?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),payment_method_name:i(({item:t})=>{var d;return[C(M((d=t.payment_method)==null?void 0:d.name),1)]}),pvr_had_detail:i(({item:t})=>[t.pvr_had_detail?(s(),n(y,{key:1})):(s(),n(f,{key:0}))]),deleted_by_username:i(({item:t})=>{var d;return[C(M((d=t.deleted_by)==null?void 0:d.username),1)]}),req_deleted_by_username:i(({item:t})=>{var d;return[C(M((d=t.req_deleted_by)==null?void 0:d.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),k(le,{show:o(P),fnClose:()=>{P.value=!1},id:o(z),p_data:o(_),list_cost_center:o(J),online_status:o(L)},null,8,["show","fnClose","id","p_data","list_cost_center","online_status"]),k(oe,{show:o(D),fnClose:()=>{D.value=!1},id:o(U),p_data:o(_),is_view:o(Y)},null,8,["show","fnClose","id","p_data","is_view"]),k(ae,{show:o(T),fnClose:()=>{T.value=!1},index:o(R),p_data:o(_)},null,8,["show","fnClose","index","p_data"])])}}};export{_t as default};
