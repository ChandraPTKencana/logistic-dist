import{_ as j}from"./HeaderPopup.vue.ecee69f7.js";import{_ as F}from"./client-only.f26caab1.js";import{_ as T}from"./WidthMiniList.vue.c8446b32.js";import{_ as E}from"./InputPointFormat.vue.817b463f.js";import U from"./AttachmentSingle.9130bfc7.js";import{r as _,f as z,G as A,j as K,I as L,m as $,J as G,o as B,c as O,a as l,b as m,w as H,k as n,t as y,v as W,x as Y,l as Q,A as p,B as b,E as R}from"./entry.b6c67327.js";import{u as D}from"./useUtils.f7c671d4.js";import{u as k}from"./useMyFetch.b2963c33.js";import"./Times.75e988b5.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.3175bc08.js";import"./PDFJsView.1e7cf701.js";const X={class:"box-fixed"},Z={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ee={class:"w-full flex flex-col items-center grow overflow-auto"},te={class:"w-full flex flex-row flex-wrap"},ae={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},le=l("label",{for:""},"Tanggal",-1),oe={class:"text-red-500"},ne={class:"w-full sm:w-8/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},se=l("label",{for:""},"Pekerja",-1),ie={class:"text-red-500"},re={class:"w-full sm:w-6/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ue=l("label",{for:""},"Nominal",-1),de={class:"text-red-500"},me={class:"w-full sm:w-6/12 md:w-full lg:w-full flex flex-col flex-wrap p-1"},pe=l("label",{for:""},"Note",-1),_e={class:"text-red-500"},ce={class:"p-1 w-full"},ve={class:"w-full flex items-center justify-end"},$e={__name:"salary_bonus",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(c){const u=c,{$moment:I}=R(),S={id:"",tanggal:new Date,type:"Kerajinan",nominal:0,note:"",attachment_1:"",attachment_1_preview:""},e=_({...S}),w=z("token"),d=_({}),v={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},ktp_no:{tcon:"IconsNumber",text:"No KTP",val:""},sim_no:{tcon:"IconsCreditCard",text:"No SIM",val:""}},id:"",name:"",title:""},s=_(JSON.parse(JSON.stringify(v))),N=_([]),J=async()=>{p().loading_full=!0;const{data:o,error:t,status:r}=await k("/salary_bonus_load_local",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},retry:0});if(p().loading_full=!1,r.value==="error"){b().trigger(t);return}N.value=o.value.list_employee},M=A(()=>{let o=[];return N.value.forEach((t,r)=>{let a=JSON.parse(JSON.stringify(v));a._.id.val=t.id,a._.name.val=t.name,a._.ktp_no.val=t.ktp_no,a._.sim_no.val=t.sim_no,a.id=t.id,a.name=t.name,a.title=(t.ktp_no||"")+" "+(t.sim_no||""),o.push(JSON.parse(JSON.stringify(a)))}),o}),C=_([]),P=async()=>{p().loading_full=!0,d.value={};const o=new FormData;o.append("type",e.value.type),o.append("tanggal",e.value.tanggal?I(e.value.tanggal).format("Y-MM-DD"):""),o.append("employee_id",s.value.id),o.append("nominal",e.value.nominal),o.append("note",e.value.note),o.append("attachment_1",e.value.attachment_1),o.append("attachment_1_preview",e.value.attachment_1_preview);let t="post",r=e.value.id;r==""||(o.append("id",r),o.append("_method","PUT"));const{data:a,error:g,status:h}=await k("/salary_bonus",{method:t,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:o,retry:0});if(p().loading_full=!1,h.value==="error"){b().trigger(g,d);return}if(e.value.employee={name:s.value._.name.val,ktp_no:s.value._.ktp_no.val,sim_no:s.value._.sim_no.val},C.value=a.value.details,r<=0)e.value.id=a.value.id,e.value.created_at=a.value.created_at,e.value.updated_at=a.value.updated_at,u.p_data.unshift(e.value);else{e.value.updated_at=a.value.updated_at;let f=u.p_data.map(x=>x.id).indexOf(r);f>=-1&&u.p_data.splice(f,1,{...e.value})}u.fnClose()},q=A(()=>e.value.val&&e.value.val1||D().checkPermission("salary_bonus.val")&&e.value.val||D().checkPermission("salary_bonus.val1")&&e.value.val1),V=async()=>{p().loading_full=!0;const{data:o,error:t,status:r}=await k("/salary_bonus",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:u.id},retry:0});if(p().loading_full=!1,r.value==="error"){b().trigger(t);return}u.is_copy&&(e.value.val=0,e.value.val1=0);let a=o.value.data;e.value=a,s.value._.id.val=a.employee.id,s.value._.name.val=a.employee.name,s.value._.ktp_no.val=a.employee.ktp_no,s.value._.sim_no.val=a.employee.sim_no,s.value.id=a.employee.id,s.value.name=a.employee.name,s.value.ktp_no=(a.employee.ktp_no||"")+" "+(a.employee.sim_no||"")};return K(()=>u.show,async(o,t)=>{o==!0&&(await J(),e.value={...S},s.value=JSON.parse(JSON.stringify(v)),C.value=[],d.value={},u.id!=0&&V())},{immediate:!0}),(o,t)=>{const r=j,a=L("vue-date-picker"),g=F,h=T,f=E,x=U;return $((B(),O("section",X,[l("div",null,[m(r,{title:"Form Salary Additional",fn:c.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),l("form",Z,[l("div",ee,[l("div",te,[l("div",ae,[le,m(g,null,{default:H(()=>[m(a,{modelValue:n(e).tanggal,"onUpdate:modelValue":t[0]||(t[0]=i=>n(e).tanggal=i),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),l("p",oe,y(n(d).tanggal),1)]),l("div",ne,[se,m(h,{arr:n(M),selected:n(s),pure:v,onSetSelected:t[1]||(t[1]=i=>s.value=i)},null,8,["arr","selected"]),l("p",ie,y(n(d).employee_id),1)]),l("div",re,[ue,l("div",null,[m(f,{class:"w-full h-full p-1",type:"text",value:n(e).nominal||0,onInput:t[2]||(t[2]=i=>n(e).nominal=i)},null,8,["value"])]),l("p",de,y(n(d).nominal),1)]),l("div",me,[pe,l("div",null,[$(l("textarea",{"onUpdate:modelValue":t[3]||(t[3]=i=>n(e).note=i)},null,512),[[W,n(e).note]])]),l("p",_e,y(n(d).nominal),1)]),l("div",ce,[m(x,{label:"Attachment",value:n(e).attachment_1_preview,onSetFile:t[4]||(t[4]=i=>n(e).attachment_1=i),onSetPreview:t[5]||(t[5]=i=>n(e).attachment_1_preview=i),can_remove:!0},null,8,["value"])])])]),l("div",ve,[l("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[6]||(t[6]=i=>c.fnClose())}," Cancel "),n(q)?Q("",!0):(B(),O("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[7]||(t[7]=Y(i=>P(),["prevent"]))}," Save "))])])])],512)),[[G,c.show]])}}};export{$e as default};
