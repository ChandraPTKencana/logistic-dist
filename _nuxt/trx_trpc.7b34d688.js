import{_ as W}from"./HeaderPopup.vue.132f678e.js";import{_ as X}from"./client-only.c5cffc6d.js";import{r as y,h as Z,z as ee,K as j,I as C,M as te,n as h,v as oe,o as d,c as _,a as t,b as U,m as o,w as le,E as se,t as n,C as P,q as V,F as x,D as w,G as N,s as ae,H as ne,x as g,y as F,p as ie,e as re}from"./entry.9b8fbe30.js";import{u as de}from"./useUtils.f37c7c08.js";import{u as M}from"./useMyFetch.a6b0cb71.js";import{_ as _e}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.30ad854a.js";const c=f=>(ie("data-v-1ed6bb4c"),f=f(),re(),f),ue={class:"box-fixed"},ce={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},pe={class:"w-full flex flex-col items-center grow overflow-auto"},ve={class:"w-full flex flex-row flex-wrap"},fe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},me=c(()=>t("label",{for:""},"U.Jalan Per",-1)),he={key:0,class:"grow"},xe={key:1,class:"grow"},we={class:"text-red-500"},ge={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},be=c(()=>t("label",{for:""},"Jenis",-1)),ye=["disabled"],je=c(()=>t("option",{value:"TBS"},"TBS",-1)),Ce=c(()=>t("option",{value:"TBSK"},"TBSK",-1)),Ve=c(()=>t("option",{value:"CPO"},"CPO",-1)),ke=c(()=>t("option",{value:"PK"},"PK",-1)),Se=[je,Ce,Ve,ke],De={class:"text-red-500"},Be={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Te=c(()=>t("label",{for:""},"Supir",-1)),Ae=["disabled"],Ue={id:"supir"},Pe=["value"],Ne={class:"text-red-500"},Fe={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Me=c(()=>t("label",{for:""},"Kernet",-1)),$e=["disabled"],qe={id:"kernet"},Ke=["value"],Ie={class:"text-red-500"},ze={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Le=c(()=>t("label",{for:""},"No Pol",-1)),Ye=["disabled"],Je={id:"vehicle"},Oe=["value"],Ee={class:"text-red-500"},He={key:0,class:"w-full flex flex-wrap"},Re={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ge=c(()=>t("label",{for:""},"Tujuan",-1)),Qe=["disabled"],We={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ze=c(()=>t("label",{for:""},"Tipe",-1)),et=["disabled"],tt=["value","selected"],ot={class:"text-red-500"},lt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},st=c(()=>t("label",{for:""},"Total Dari U.Jalan",-1)),at={class:"card-border disabled"},nt={key:1,class:"w-full flex flex-wrap"},it={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},rt=c(()=>t("label",{for:""},"Cost Center Code",-1)),dt=["disabled"],_t={id:"cost_center"},ut=["value"],ct={class:"text-red-500"},pt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},vt=c(()=>t("label",{for:""},"Cost Center Desc",-1)),ft={class:"card-border disabled"},mt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},ht=c(()=>t("label",{for:""},"PVR No",-1)),xt={class:"card-border disabled"},wt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},gt=c(()=>t("label",{for:""},"PVR Total",-1)),bt={class:"card-border disabled"},yt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},jt=c(()=>t("label",{for:""},"PV",-1)),Ct=["disabled"],Vt={id:"pv"},kt=["value"],St=c(()=>t("div",null,null,-1)),Dt={class:"text-red-500"},Bt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Tt=c(()=>t("label",{for:""},"PV Amount",-1)),At={class:"card-border disabled"},Ut={class:"w-full flex items-center justify-end"},Pt={__name:"trx_trpc",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_pv:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(f){const u=f,{$moment:$}=ne(),{pointFormat:S}=de(),D={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:""};let m={...D};const e=y({...D}),B=Z("token"),p=y({}),I=l=>{let a=l.target.value;if(!a){e.value.cost_center_code="",e.value.cost_center_desc="";return}u.list_cost_center.filter(r=>r.CostCenter==a).length==0&&(e.value.cost_center_code="112",e.value.cost_center_desc="Transport")},z=l=>{e.value.transition_target=l.target.value=="TBS"?e.value.transition_target:"",u.fnLoadDBData(l.target.value,e.value.transition_target)},{display:L}=ee(),Y=async()=>{if(e.value.pv_no&&parseInt(e.value.pv_total)!=parseInt(e.value.amount)){L({show:!0,status:"Failed",message:"Total dari Ujalan dan PV tidak cocok"});return}g().loading_full=!0,p.value={};const l=new FormData;if(l.append("tanggal",$(e.value.tanggal).format("Y-MM-DD")),l.append("jenis",e.value.jenis),l.append("id_uj",e.value.id_uj),l.append("xto",e.value.xto),l.append("cost_center_code",e.value.cost_center_code),l.append("online_status",u.online_status),l.append("transition_target",e.value.transition_target),e.value.pv_no){let b=u.list_pv.filter(A=>A.VoucherNo==e.value.pv_no);b.length==0&&e.value.pv_no==m.pv_no?l.append("pv_id",m.pv_id):l.append("pv_id",b[0].VoucherID)}l.append("supir",e.value.supir),l.append("kernet",e.value.kernet),l.append("no_pol",e.value.no_pol);let a="post",i=u.id;i==0||(l.append("id",i),l.append("_method","PUT"));const{data:r,error:v,status:s}=await M("/trx_trp",{method:a,headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:l,retry:0});if(g().loading_full=!1,s.value==="error"){F().trigger(v,p);return}if(e.value.pvr_id=r.value.pvr_id,e.value.pvr_no=r.value.pvr_no,e.value.pvr_total=r.value.pvr_total,e.value.pvr_had_detail=r.value.pvr_had_detail,e.value.updated_at=r.value.updated_at,u.id<=0)e.value.id=r.value.id,e.value.created_at=r.value.created_at,u.p_data.unshift(e.value);else{let b=u.p_data.map(A=>A.id).indexOf(u.id);b>=-1&&u.p_data.splice(b,1,{...e.value})}u.fnClose()},J=j(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(k.value.filter(a=>a.jenis==l).map(a=>a.xto))]}),O=j(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return k.value.filter(a=>a.xto==e.value.xto&&a.jenis==l)}),E=j(()=>[...new Set(T.value.filter(l=>l.role=="Supir"))]),H=j(()=>[...new Set(T.value.filter(l=>l.role=="Kernet"))]),R=j(()=>!1),G=async()=>{g().loading_full=!0;const{data:l,error:a,status:i}=await M("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{id:u.id},retry:0});if(g().loading_full=!1,i.value==="error"){F().trigger(a);return}e.value=l.value.data,m={...l.value.data},u.fnLoadDBData(e.value.jenis,e.value.transition_target)},k=y([]),q=y([]),T=y([]),Q=async()=>{g().loading_full=!0;const{data:l,error:a,status:i}=await M("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},retry:0});if(g().loading_full=!1,i.value==="error"){F().trigger(a);return}k.value=l.value.list_ujalan,q.value=l.value.list_vehicle,T.value=l.value.list_employee};C(()=>u.show,(l,a)=>{l==!0&&(Q(),e.value={...D},p.value={},u.id!=0&&G())},{immediate:!0}),C(()=>e.value.pv_no,(l,a)=>{let i=0;if(l==""||l){let r=u.list_pv.filter(v=>v.VoucherNo==e.value.pv_no);r.length>0?i=r[0].total_amount:e.value.pv_no==m.pv_no&&(i=m.pv_total),e.value.pv_total=i}},{deep:!0,immediate:!0}),C(()=>e.value.cost_center_code,(l,a)=>{let i="";if(l==""||l){let r=u.list_cost_center.filter(v=>v.CostCenter==e.value.cost_center_code);r.length>0?i=r[0].Description:e.value.cost_center_code==m.cost_center_code&&(i=m.cost_center_desc),e.value.cost_center_desc=i}},{deep:!0,immediate:!0});const K=(l,a)=>{let i=0,r="";if(l==""||l){let v=k.value.filter(s=>s.id==e.value.id_uj);v.length>0?(i=v[0].harga,r=v[0].tipe):e.value.id_uj==m.id_uj&&(i=m.amount,r=m.tipe),e.value.tipe=r,e.value.amount=i}};return C(()=>e.value.xto,(l,a)=>{u.show&&K(l)},{deep:!0,immediate:!0}),C(()=>e.value.id_uj,(l,a)=>{u.show&&K(l)},{deep:!0,immediate:!0}),(l,a)=>{const i=W,r=te("vue-date-picker"),v=X;return h((d(),_("section",ue,[t("div",null,[U(i,{title:"Form Transaction",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",ce,[t("div",pe,[t("div",ve,[t("div",fe,[me,o(e).pvr_no==""?(d(),_("div",he,[U(v,null,{default:le(()=>[U(r,{modelValue:o(e).tanggal,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).tanggal=s),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(d(),_("div",xe,[t("div",{class:se(["card-border",o(e).pvr_no!=""?"unselectable":""])},n(o(e).tanggal?o($)(o(e).tanggal).format("DD-MM-YYYY"):""),3)])),t("p",we,n(o(p).tanggal),1)]),t("div",ge,[be,h(t("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>o(e).jenis=s),onChange:a[2]||(a[2]=s=>z(s)),disabled:o(e).pvr_no!=""},Se,40,ye),[[P,o(e).jenis]]),t("p",De,n(o(p).jenis),1)]),t("div",Be,[Te,h(t("input",{type:"text",list:"supir","onUpdate:modelValue":a[3]||(a[3]=s=>o(e).supir=s),disabled:o(e).pvr_no!=""},null,8,Ae),[[V,o(e).supir]]),t("datalist",Ue,[(d(!0),_(x,null,w(o(E),s=>(d(),_("option",{value:s.name},n(s.name),9,Pe))),256))]),t("p",Ne,n(o(p).supir),1)]),t("div",Fe,[Me,h(t("input",{type:"text",list:"kernet","onUpdate:modelValue":a[4]||(a[4]=s=>o(e).kernet=s),disabled:o(e).pvr_no!=""},null,8,$e),[[V,o(e).kernet]]),t("datalist",qe,[(d(!0),_(x,null,w(o(H),s=>(d(),_("option",{value:s.name},n(s.name),9,Ke))),256))]),t("p",Ie,n(o(p).kernet),1)]),t("div",ze,[Le,h(t("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=s=>o(e).no_pol=s),disabled:o(e).pvr_no!=""},null,8,Ye),[[V,o(e).no_pol]]),t("datalist",Je,[(d(!0),_(x,null,w(o(q),s=>(d(),_("option",{value:s.no_pol},n(s.no_pol),9,Oe))),256))]),t("p",Ee,n(o(p).no_pol),1)]),o(e).jenis!=""?(d(),_("div",He,[t("div",Re,[Ge,h(t("select",{"onUpdate:modelValue":a[6]||(a[6]=s=>o(e).xto=s),disabled:o(e).pvr_no!=""},[(d(!0),_(x,null,w(o(J),s=>(d(),_("option",null,n(s),1))),256))],8,Qe),[[P,o(e).xto]]),t("p",We,n(o(p).xto),1)]),t("div",Xe,[Ze,h(t("select",{"onUpdate:modelValue":a[7]||(a[7]=s=>o(e).id_uj=s),disabled:o(e).pvr_no!=""},[(d(!0),_(x,null,w(o(O),s=>(d(),_("option",{value:s.id,selected:s.id==o(e).id_uj},n(s.tipe),9,tt))),256))],8,et),[[P,o(e).id_uj]]),t("p",ot,n(o(p).id_uj),1)]),t("div",lt,[st,t("div",at,n(o(S)(o(e).amount)),1)])])):N("",!0),o(e).jenis!=""?(d(),_("div",nt,[t("div",it,[rt,h(t("input",{list:"cost_center","onUpdate:modelValue":a[8]||(a[8]=s=>o(e).cost_center_code=s),onBlur:a[9]||(a[9]=s=>I(s)),disabled:o(e).pvr_no!=""},null,40,dt),[[V,o(e).cost_center_code]]),t("datalist",_t,[(d(!0),_(x,null,w(f.list_cost_center,s=>(d(),_("option",{value:s.CostCenter},n(s.CostCenter+"-"+s.Description),9,ut))),256))]),t("p",ct,n(o(p).cost_center_code),1)]),t("div",pt,[vt,t("div",ft,n(o(e).cost_center_desc),1)]),t("div",mt,[ht,t("div",xt,n(o(e).pvr_no),1)]),t("div",wt,[gt,t("div",bt,n(o(S)(o(e).pvr_total||0)),1)]),t("div",yt,[jt,h(t("input",{type:"text",list:"pv","onUpdate:modelValue":a[10]||(a[10]=s=>o(e).pv_no=s),disabled:o(e).pvr_no!=""},null,8,Ct),[[V,o(e).pv_no]]),t("datalist",Vt,[(d(!0),_(x,null,w(f.list_pv,s=>(d(),_("option",{value:s.VoucherNo},n(s.VoucherNo+"-"+s.AssociateName),9,kt))),256))]),St,t("p",Dt,n(o(p).pv),1)]),t("div",Bt,[Tt,t("div",At,n(o(S)(o(e).pv_total)),1)])])):N("",!0)])]),t("div",Ut,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[11]||(a[11]=s=>f.fnClose())}," Cancel "),o(R)?N("",!0):(d(),_("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[12]||(a[12]=ae(s=>Y(),["prevent"]))}," Save "))])])])],512)),[[oe,f.show]])}}},zt=_e(Pt,[["__scopeId","data-v-1ed6bb4c"]]);export{zt as default};
