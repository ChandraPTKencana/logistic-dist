import{j as st,r as N,g as lt,i as $,f as at,o as D,c as C,k as p,L as v,a as t,b as E,l as o,t as n,n as q,d as b,F as I,E as F,D as O,m as ot,v as nt,x as d,y as g,B as it,_ as rt}from"./entry.53fce88d.js";import{_ as ut}from"./HeaderPopup.vue.2a33db0a.js";import dt from"./Plus.92044684.js";import ct from"./Send.cd3ddf4a.js";import _t from"./CloudDownload.6c9b1c0d.js";import ft from"./History.7bf96fbd.js";import pt from"./Times.afe9e524.js";import{u as ht}from"./useUtils.483f3866.js";import{u as k}from"./useMyFetch.bdb404b5.js";import"./_plugin-vue_export-helper.c27b6911.js";const mt=it(()=>rt(()=>import("./fin_payment_req_trx_trps.ea5cb694.js"),["./fin_payment_req_trx_trps.ea5cb694.js","./HeaderPopup.vue.2a33db0a.js","./Times.afe9e524.js","./_plugin-vue_export-helper.c27b6911.js","./entry.53fce88d.js","./entry.c5f8f180.css","./useUtils.483f3866.js","./useMyFetch.bdb404b5.js"],import.meta.url).then(w=>w.default||w)),vt={class:"box-fixed"},wt={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},yt={class:"w-full flex flex-col items-center grow overflow-auto"},xt={class:"w-full flex"},bt={key:0,class:"w-full flex p-2"},gt=["disabled"],kt={class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},Et={class:"w-full",role:"sticky"},jt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},St=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),Dt={class:"sticky top-7 !z-[2]"},Ct=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),At=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),Nt=t("th",null,"No Trx",-1),Rt=t("th",null,"Tujuan",-1),$t=t("th",null,"Produk",-1),Bt=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),It=t("th",null,"Jabatan",-1),Pt=t("th",null,"Nama",-1),Tt=t("br",null,null,-1),qt=t("br",null,null,-1),Ft=t("br",null,null,-1),Ot=t("th",null,null,-1),Ut=t("th",null,"No Rek",-1),zt=t("th",null,"Nama Di Bank",-1),Lt=t("br",null,null,-1),Vt=t("th",null,"Status ",-1),Yt=t("th",null,"Aksi ",-1),Kt=t("th",null,"Alasan Gagal ",-1),Mt={ref:"to_move"},Qt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Ht={class:"w-full h-full flex items-center justify-center"},Jt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Wt={class:"w-full h-full flex items-center justify-center"},Gt={class:"cell"},Xt={class:"w-full h-full flex items-center justify-center p-2"},Zt={class:"pointer p-0 bg-red-500 text-white rounded flex items-center justify-center"},te={class:"px-2"},ee={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},se={class:"w-full h-full flex items-center justify-center"},le={class:"cell"},ae={class:"w-full h-full flex items-center justify-center"},oe={class:"cell"},ne={class:"w-full h-full flex items-center justify-center"},ie={class:"cell"},re={class:"w-full h-full flex items-center justify-center"},ue={class:"cell"},de={class:"w-full h-full flex items-center justify-center"},ce={class:"cell"},_e={class:"w-full h-full flex items-center justify-end p-2"},fe={class:"cell"},pe={class:"w-full h-full flex items-center justify-end p-2"},he={class:"cell"},me={class:"w-full h-full flex items-center justify-end p-2"},ve=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),we={class:"cell"},ye={class:"w-full h-full flex items-center justify-center"},xe={class:"cell"},be={class:"w-full h-full flex items-center justify-center"},ge={class:"cell"},ke={class:"w-full h-full flex items-center justify-end p-1"},Ee={class:"cell"},je={class:"w-full h-full flex items-center justify-end p-1"},Se={class:"cell"},De={class:"w-full h-full flex items-center justify-end p-1"},Ce=["onClick"],Ae={class:"cell"},Ne={class:"w-full h-full flex items-center justify-end p-1"},Re={class:"w-full flex items-center justify-end"},$e={class:"bg-white w-[250px] sm:w-1/2 md:w-1/3 lg:w-1/4 fixed z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-slate-700 shadow-2xl shadow-black p-2"},Be=t("label",{for:""},"Select Batch No",-1),Ie=["value"],Pe={class:"flex justify-end pt-2"},Me={__name:"fin_payment_req",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(w){const h=w,{pointFormat:y}=ht(),{display:j}=st(),P={id:0,batch_no:0,details:[]},s=N({...P}),x=lt("token"),U=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.nominal)}),l}),z=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.potongan_trx_ttl)}),l}),L=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.extra_money_trx_ttl)}),l}),V=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.jumlah)}),l}),m=l=>s.value.details.length==0?l=="":s.value.details.filter(i=>i.status==l).length==s.value.details.length,Y=async()=>{d().loading_full=!0;const{data:l,error:e,status:i}=await k("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{id:h.id},retry:0});if(d().loading_full=!1,i.value==="error"){g().trigger(e);return}s.value=l.value.data,h.is_copy&&(s.value.val=0,s.value.val1=0)},f=N({}),K=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),s.value.details.forEach(r=>{r.status="INQUIRY_PROCESS"})},M=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Update Data Berhasil"}),i.value.details.forEach(r=>{let _=s.value.details.map(A=>A.id).indexOf(r.id);_>-1&&(s.value.details[_].status=r.status,s.value.details[_].failed_reason=r.failed_reason)}),s.value.status="WAIT"},Q=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_to_ready",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Update Data Berhasil"}),s.value.details.forEach(r=>{r.status="READY"}),s.value.status="OPEN"},H=async(l,e)=>{d().loading_full=!0,f.value={};const i=new FormData;i.append("detail_id",l),i.append("_method","PUT");let c="post";const{data:u,error:r,status:_}=await k("/fin_payment_req_dtl/renew_data",{method:c,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(d().loading_full=!1,_.value==="error"){g().trigger(r,f);return}s.value.details[e].rek_no=u.value.employee_rek_no,s.value.details[e].rek_name=u.value.employee_rek_name,s.value.details[e].bank_code=u.value.employee_bank_code,s.value.details[e].status=u.value.status,s.value.details[e].failed_reason=u.value.failed_reason,j({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"})};at(()=>h.show,(l,e)=>{l==!0&&(h.id==0&&(s.value={...P}),h.id!=0&&Y())},{immediate:!0});const B=N(!1),J=()=>{B.value=!0},W=async(l,e)=>{d().loading_full=!0,f.value={};const i=new FormData;i.append("trx_trp_id",e),i.append("_method","DELETE");let c="post";const{data:u,error:r,status:_}=await k("/fin_payment_req_dtl/delete_data",{method:c,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(d().loading_full=!1,_.value==="error"){g().trigger(r,f);return}s.value.details=s.value.details.filter(A=>A.trx_trp_id!=e)},R=N(!1),S=N(0),G=()=>{R.value=!0,S.value=s.value.batch_no},X=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("batch_no",S.value),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_batch_no",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}s.value.batch_no=S.value;let r=h.p_data.map(_=>_.id).indexOf(s.value.id);r>-1&&h.p_data.splice(r,1,{...s.value}),R.value=!1,j({show:!0,status:"Success",message:"No Batch Berhasil Diperbaharui"})},Z=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_paid_done",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}s.value.status="CLOSE",s.value.details.forEach(_=>{_.status="DONE"});let r=h.p_data.map(_=>_.id).indexOf(s.value.id);r>-1&&h.p_data.splice(r,1,{...s.value}),j({show:!0,status:"Success",message:"PAID IS DONE"})};return(l,e)=>{const i=ut,c=dt,u=ct,r=_t,_=ft,A=pt,tt=mt;return D(),C(I,null,[p(t("section",vt,[t("div",null,[E(i,{title:"Finance Payment Request",fn:w.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",wt,[t("div",yt,[t("div",xt,[o(s).status=="CLOSE"?(D(),C("div",bt," Batch No : "+n(o(s).batch_no),1)):q("",!0),p(t("button",{type:"button",name:"button",class:"m-1",disabled:o(s).status=="CLOSE",onClick:e[0]||(e[0]=a=>G())}," Batch No : "+n(o(s).batch_no),9,gt),[[v,m("TRANSFER_PROCESS")&&o(s).status=="WAIT"]]),p(t("button",{type:"button",name:"button",class:"m-1 bg-violet-600 text-white",onClick:e[1]||(e[1]=a=>Z())}," Set Paid Done ",512),[[v,m("TRANSFER_PROCESS")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=a=>J())},[E(c)],512),[[v,m("")||m("READY")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=a=>K())},[E(u)],512),[[v,m("READY")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=a=>M())},[E(r)],512),[[v,m("INQUIRY_PROCESS")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=a=>Q())},[E(_)],512),[[v,m("INQUIRY_PROCESS")]])]),t("div",kt,[t("div",Et,[t("table",jt,[t("thead",null,[St,t("tr",Dt,[Ct,At,Nt,Rt,$t,Bt,It,Pt,t("th",null,[b("Jumlah "),Tt,b(" ("+n(o(y)(o(U)||0))+") ",1)]),t("th",null,[b("Potongan "),qt,b(" ("+n(o(y)(o(z)))+")",1)]),t("th",null,[b("ExtraMoney "),Ft,b(" ("+n(o(y)(o(L)))+")",1)]),Ot,Ut,zt,t("th",null,[b("Nominal Transfer "),Lt,b(" ("+n(o(y)(o(V)||0))+")",1)]),Vt,Yt,Kt])]),t("tbody",Mt,[(D(!0),C(I,null,F(o(s).details,(a,T)=>(D(),C("tr",{key:T},[t("td",Qt,[t("div",Ht,n(a.no),1)]),t("td",Jt,[t("div",Wt,n(a.id),1)]),t("td",Gt,[t("div",Xt,[t("div",Zt,[t("span",te,n(a.trx_trp_id),1),p(E(A,{onClick:O(et=>W(a.id,a.trx_trp_id),["prevent"]),class:"cursor-pointer text-3xl font-bold p-0 border-l-2 border-red-300"},null,8,["onClick"]),[[v,m("")||m("READY")]])])])]),t("td",ee,[t("div",se,n(a.jabatan!="KERNET"?a.tujuan:""),1)]),t("td",le,[t("div",ae,n(a.jabatan!="KERNET"?a.produk:""),1)]),t("td",oe,[t("div",ne,n(a.jabatan!="KERNET"?a.no_pol:""),1)]),t("td",ie,[t("div",re,n(a.jabatan),1)]),t("td",ue,[t("div",de,n(a.nama),1)]),t("td",ce,[t("div",_e,n(o(y)(a.nominal||0)),1)]),t("td",fe,[t("div",pe,n(o(y)(a.potongan_trx_ttl)),1)]),t("td",he,[t("div",me,n(o(y)(a.extra_money_trx_ttl)),1)]),ve,t("td",we,[t("div",ye,n(a.rek_no),1)]),t("td",xe,[t("div",be,n(a.rek_name),1)]),t("td",ge,[t("div",ke,n(o(y)(a.jumlah||0)),1)]),t("td",Ee,[t("div",je,n(a.status),1)]),t("td",Se,[t("div",De,[a.status=="INQUIRY_FAILED"?(D(),C("button",{key:0,class:"bg-yellow-400 rounded",onClick:O(et=>H(a.id,T),["prevent"])}," Renew Data ",8,Ce)):q("",!0)])]),t("td",Ae,[t("div",Ne,n(a.failed_reason),1)])]))),128))],512)])])])]),t("div",Re,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[6]||(e[6]=a=>w.fnClose())}," Cancel ")])])])],512),[[v,w.show]]),E(tt,{show:o(B),fnClose:()=>{B.value=!1},id:o(s).id,onSetKData:e[7]||(e[7]=a=>s.value=a),onSetIsNew:e[8]||(e[8]=a=>{a&&w.p_data.push(o(s))})},null,8,["show","fnClose","id"]),p(t("div",$e,[Be,p(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>ot(S)?S.value=a:null)},[(D(),C(I,null,F(5,a=>t("option",{value:a-1},n(a-1),9,Ie)),64))],512),[[nt,o(S)]]),t("div",Pe,[t("button",{type:"button",class:"bg-blue-500 text-white",onClick:e[10]||(e[10]=a=>X())},"Save"),t("button",{type:"button",class:"bg-yellow-500 text-white ml-2",onClick:e[11]||(e[11]=a=>R.value=!1)},"Cancel")])],512),[[v,o(R)]])],64)}}};export{Me as default};
