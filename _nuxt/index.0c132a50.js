import{_ as Ze}from"./Header.896a3c07.js";import{_ as Qe}from"./Plus.9908923f.js";import{_ as We}from"./Edit.e11d1336.js";import{_ as Xe}from"./Eyes.e2b00e02.js";import{_ as et}from"./Delete.c0976863.js";import{_ as tt}from"./Void.56fc50a2.js";import{_ as at}from"./Signature.9b5d9f3f.js";import{u as lt,_ as ot}from"./useDownload.42781f0e.js";import{_ as st}from"./client-only.1081a465.js";import{_ as nt}from"./useUtils.cab915b1.js";import{_ as rt,a as dt}from"./trx_absen.102b77a5.js";import{_ as ut,a as it}from"./Check.a22c9b54.js";import{_ as _t}from"./TableView.69ac0948.js";import{_ as pt}from"./PopupMini.vue.455ed07b.js";import{_ as vt,a as ct}from"./trx_trp_validasi.cc2f9b7b.js";import{r as d,g as ae,f as ft,D as mt,J as B,H as bt,L as yt,c as q,b as p,a as s,h as F,l as le,k as a,i as K,G as A,d as S,q as xt,t as U,w as b,j as oe,m as gt,E as ht,x as m,y as O,o as v,K as w,M as be,s as wt}from"./entry.1bfb00b4.js";import{u as T}from"./useMyFetch.d9d711ae.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.33173401.js";import"./Times.f09964d9.js";const kt={class:"w-full h-full flex flex-col"},Dt={class:"w-full flex grow flex-col overflow-auto h-0"},$t={class:"w-full flex justify-between flex-wrap"},Ct={class:"grow flex"},qt={class:"m-1"},At=be('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ot=[At],Tt={class:"flex"},Mt=s("span",{class:"text-xs"},"Mode",-1),Vt={action:"#",class:"w-full flex flex-wrap text-xs"},St={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},Pt=s("div",{class:"font-bold"}," Tgl Dari ",-1),jt={class:"text-red-500"},Bt={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},Ft=s("div",{class:"font-bold"}," Tgl Sampai ",-1),Et={class:"text-red-500"},It={class:"w-6/12 p-1 sm:w-4/12 md:w-2/12 lg:w-4/12 flex flex-col"},Ut=s("div",{class:"font-bold"}," Keyword ",-1),Nt={class:"w-6/12 p-1 sm:w-4/12 md:w-1/12 lg:w-2/12 flex flex-col"},Yt=s("div",{class:"font-bold"}," Sort By ",-1),Rt=be('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),zt=[Rt],Ht={class:"w-6/12 p-1 sm:w-4/12 md:w-2/12 lg:w-1/12 flex flex-col"},Lt=s("div",{class:"font-bold"}," Sort Order ",-1),Kt=s("option",{value:"asc"},"Asc",-1),Jt=s("option",{value:"desc"},"Desc",-1),Gt=[Kt,Jt],Zt={class:"w-2/12 md:w-1/12 lg:w-1/12 p-1 flex items-end"},Qt={class:"grow mb-5"},Wt=s("b",null,"tidak dapat dibatalkan lagi",-1),Xt={class:"grow mb-5"},wa={__name:"index",async setup(ea){let N,se;const{$moment:ne}=wt(),J=t=>t.deleted==1?"!bg-red-400":t.pvr_id>0&&t.req_deleted==1?"!bg-yellow-300":t.pv_id>0?"!bg-blue-300":"",G=t=>(t.map(e=>{e.class_h=J(e)}),t),x=d("pv_not_done");ae(()=>x.value,t=>{ve.value.map(e=>{let i=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(e.key)>-1;return["all","deleted","req_deleted"].indexOf(t)>-1?i&&(e.tbl_show=1):i&&(e.tbl_show=0),e}),ue()},{immediate:!1});const c={};c._TimeZoneOffset=new Date().getTimezoneOffset(),c.sort="tanggal:desc";const Y=d({}),k=d({from:"",to:""}),D=ft("token"),{data:ye}=([N,se]=mt(async()=>ht(async()=>{m().loading_full=!0;let t=[];const[e,i]=await Promise.all([T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:{filter_status:x},retry:0})]);return e.status.value!=="error"&&(t=G(e.data.value.data)),e.status.value==="error"?(O().trigger(e.error),{trx_trps:t}):(m().loading_full=!1,{trx_trps:t})},"$pFLmKcrKj9")),N=await N,se(),N),n=d(ye.value.trx_trps||[]),re=d([]),$=d(!1),xe=async()=>{m().loading_full=!0;const{data:t,error:e,status:i}=await T("/trx_load_cost_center",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:{online_status:$.value},retry:0});if(m().loading_full=!1,i.value==="error"){O().trigger(e);return}re.value=t.value.list_cost_center},u=d(""),M=d({field:"tanggal",by:"desc"}),o=d(-1),f=B(()=>n.value[o.value]),y=d({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ge=()=>{c.like="",u.value!=""&&(c.like=`id:%${u.value}%,xto:%${u.value}%,jenis:%${u.value}%,pv_no:%${u.value}%,ticket_a_no:%${u.value}%,ticket_b_no:%${u.value}%,no_pol:%${u.value}%,supir:%${u.value}%,kernet:%${u.value}%,cost_center_code:%${u.value}%,cost_center_desc:%${u.value}%,pvr_id:%${u.value}%,pvr_no:%${u.value}%,tanggal:%${u.value}%,transition_to:%${u.value}%`),c.sort="",M.value.field&&(c.sort=M.value.field+":"+M.value.by),c.date_from=k.value.from?ne(k.value.from).format("YYYY-MM-DD"):"",c.date_to=k.value.to?ne(k.value.to).format("YYYY-MM-DD"):""},de=async()=>{m().loading_full=!0,Y.value={},y.value.may_get_data=!1,c.page=y.value.page,c.page==1&&(n.value=[]),c.first_row&&delete c.first_row,c.page>1&&(c.first_row=JSON.stringify(n.value[0])),c.filter_status=x.value;const{data:t,error:e,status:i}=await T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:c,retry:0});if(m().loading_full=!1,y.value.may_get_data=!0,i.value==="error"){O().trigger(e,Y);return}y.value.page==1?n.value=G(t.value.data):y.value.page>1&&(n.value=[...n.value,...G(t.value.data)]),t.value.data.length==0&&(y.value.is_last_record=!0)},ue=()=>{o.value=-1,y.value.page=1,y.value.is_last_record=!1,ge(),de()},R=d(!1),Z=d(0),he=()=>{Z.value=0,R.value=!0},{display:C}=bt(),we=()=>{o.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(Z.value=n.value[o.value].id,R.value=!0)},z=d(!1),Q=d(0),W=d(!1),ke=()=>{o.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(Q.value=n.value[o.value].id,z.value=!0,W.value=!1)},De=()=>{o.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(Q.value=n.value[o.value].id,z.value=!0,W.value=!0)},X=d(!1),ie=d(0),$e=t=>{ie.value=t,X.value=!0},ee=d(!1),_e=d({}),E=d(!1),P=d(""),Ce=async()=>{E.value&&(E.value=!1)},qe=()=>{o.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value="",_e.value={id:n.value[o.value].id,"no pol":n.value[o.value].no_pol,tujuan:n.value[o.value].xto},E.value=!0)};ae(()=>P.value,t=>{t.trim().length>0?ee.value=!0:ee.value=!1},{immediate:!1});const Ae=async()=>{m().loading_full=!0;const t=new FormData;t.append("id",n.value[o.value].id),t.append("deleted_reason",P.value),t.append("_method","DELETE");const{data:e,error:i,status:g}=await T("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,g.value==="error"){O().trigger(i);return}let r={...n.value[o.value]};r.deleted=e.value.deleted,r.deleted_user=e.value.deleted_user,r.deleted_at=e.value.deleted_at,r.deleted_by=e.value.deleted_by,r.deleted_reason=e.value.deleted_reason,r.class_h=J(r),x.value!="all"?n.value.splice(o.value,1):n.value.splice(o.value,1,{...r}),o.value=-1,E.value=!1},te=d(!1),pe=d({}),I=d(!1),j=d(""),Oe=async()=>{I.value&&(I.value=!1)},Te=()=>{o.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value="",pe.value={id:n.value[o.value].id,"no pol":n.value[o.value].no_pol,tujuan:n.value[o.value].xto},I.value=!0)};ae(()=>j.value,t=>{t.trim().length>0?te.value=!0:te.value=!1},{immediate:!1});const Me=async()=>{m().loading_full=!0;const t=new FormData;t.append("id",n.value[o.value].id),t.append("req_deleted_reason",j.value),t.append("_method","DELETE");const{data:e,error:i,status:g}=await T("/trx_trp_req_delete",{method:"post",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,g.value==="error"){O().trigger(i);return}let r={...n.value[o.value]};r.req_deleted=e.value.req_deleted,r.req_deleted_user=e.value.req_deleted_user,r.req_deleted_by=e.value.req_deleted_by,r.req_deleted_at=e.value.req_deleted_at,r.req_deleted_reason=e.value.req_deleted_reason,r.class_h=J(r),x.value!="all"?n.value.splice(o.value,1):n.value.splice(o.value,1,{...r}),o.value=-1,I.value=!1},{printHtml:Ve}=lt(),Se=async()=>{if(o.value==-1){C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}m().loading_full=!0;const{data:t,error:e,status:i}=await T("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:{id:n.value[o.value].id},retry:0});if(m().loading_full=!1,i.value==="error"){O().trigger(e);return}Ve(t.value.html,318)},Pe=async()=>{m().loading_full=!0;const t=new FormData;t.append("online_status",$.value);const{data:e,error:i,status:g}=await T("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,g.value==="error"){O().trigger(i);return}e.value.forEach(r=>{let h=n.value.map(_=>_.id).indexOf(r.id);if(h!==-1){let _=n.value[h];_.pvr_id=r.pvr_id,_.pvr_no=r.pvr_no,_.pvr_total=r.pvr_total,_.pvr_had_detail=r.pvr_had_detail,_.updated_at=r.updated_at,n.value.splice(h,1,{..._})}}),C({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},je=async()=>{m().loading_full=!0;const t=new FormData;t.append("online_status",$.value);const{data:e,error:i,status:g}=await T("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,g.value==="error"){O().trigger(i);return}e.value.data.forEach(r=>{let h=n.value.map(_=>_.id).indexOf(r.id);if(h!==-1){let _=n.value[h];_.pv_id=r.pv_id,_.pv_no=r.pv_no,_.pv_total=r.pv_total,_.pv_datetime=r.pv_datetime,_.updated_at=r.updated_at,n.value.splice(h,1,{..._})}}),C({show:!0,status:"Success",message:"Update PV Done"})},ve=d([{key:"no",label:"No",isai:!0},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"app3",label:"App 3"},{key:"id",label:"ID"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol",freeze:1},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"default",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",dateformat:"DD-MM-Y"},{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"default"}]),Be=B(()=>o.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&[void 0,0].indexOf(f.value.req_deleted)>-1&&[void 0,0].indexOf(f.value.val1)>-1&&[void 0,""].indexOf(f.value.pvr_id)>-1),Fe=B(()=>o.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&[void 0,0].indexOf(f.value.req_deleted)>-1&&[void 0,0].indexOf(f.value.val)>-1&&[void 0,""].indexOf(f.value.pvr_id)>-1),Ee=B(()=>o.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&[void 0,0].indexOf(f.value.req_deleted)>-1&&[void 0,""].indexOf(f.value.pvr_id)>-1),Ie=B(()=>o.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&[void 0,0].indexOf(f.value.req_deleted)>-1&&f.value.pvr_id!=""),Ue=B(()=>o.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&[void 0,0].indexOf(f.value.req_deleted)>-1);return(t,e)=>{const i=Ze,g=Qe,r=We,h=Xe,_=et,Ne=tt,Ye=at,Re=ot,ce=yt("vue-date-picker"),fe=st,ze=nt,He=dt,H=ut,L=it,Le=_t,me=pt,Ke=vt,Je=ct,Ge=rt;return v(),q("div",kt,[p(i,{title:"List Transaction"}),s("div",Dt,[s("div",$t,[s("div",Ct,[s("div",qt,[F(s("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=l=>K(x)?x.value=l:null)},Ot,512),[[le,a(x)]])]),["pv_not_done","all"].indexOf(a(x))>-1?(v(),q("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=l=>he())},[p(g)])):A("",!0),a(Be)?(v(),q("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=l=>we())},[p(r)])):A("",!0),a(o)>-1?(v(),q("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=l=>De())},[p(h)])):A("",!0),a(Ee)?(v(),q("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=l=>qe())},[p(_)])):A("",!0),a(Ie)?(v(),q("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=l=>Te())},[p(Ne)])):A("",!0),a(Fe)?(v(),q("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=l=>ke())},[p(Ye)])):A("",!0),a(Ue)?(v(),q("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=l=>Se())},[p(Re)])):A("",!0)]),s("div",Tt,[s("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[8]||(e[8]=l=>Pe())}," Gen/Update PVR "),s("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[9]||(e[9]=l=>je())}," Update PV "),s("div",{class:"m-1 card-border cursor-pointer",onClick:e[10]||(e[10]=l=>$.value=!a($))},[Mt,S(" : "),s("span",{class:xt(["font-bold",a($)?"text-green-600":"text-red-600"])},U(a($)?"ONLINE":"OFFLINE"),3)])])]),s("form",Vt,[s("div",St,[Pt,p(fe,null,{default:b(()=>[p(ce,{modelValue:a(k).from,"onUpdate:modelValue":e[11]||(e[11]=l=>a(k).from=l),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),s("p",jt,U(a(Y).date_from),1)]),s("div",Bt,[Ft,p(fe,null,{default:b(()=>[p(ce,{modelValue:a(k).to,"onUpdate:modelValue":e[12]||(e[12]=l=>a(k).to=l),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),s("p",Et,U(a(Y).date_to),1)]),s("div",It,[Ut,F(s("input",{class:"flex-grow",type:"text","onUpdate:modelValue":e[13]||(e[13]=l=>K(u)?u.value=l:null),name:"search",placeholder:"Keyword"},null,512),[[oe,a(u)]])]),s("div",Nt,[Yt,F(s("select",{class:"flex-grow","onUpdate:modelValue":e[14]||(e[14]=l=>a(M).field=l)},zt,512),[[le,a(M).field]])]),s("div",Ht,[Lt,F(s("select",{class:"flex-grow","onUpdate:modelValue":e[15]||(e[15]=l=>a(M).by=l)},Gt,512),[[le,a(M).by]])]),s("div",Zt,[s("button",{class:"",type:"submit",name:"button",onClick:e[16]||(e[16]=gt(l=>ue(),["prevent"]))},[p(ze,{class:"text-2xl"})])])]),p(Le,{thead:a(ve),selected:a(o),onSetSelected:e[17]||(e[17]=l=>o.value=l),tbody:a(n),fnCallData:de,scrolling:a(y),onSetScrollingPage:e[18]||(e[18]=l=>a(y).page=l)},{absen:b(({item:l,index:V})=>[l.trx_absens&&l.trx_absens.length>0?(v(),w(He,{key:0,class:"cursor-pointer",onClick:ta=>$e(V)},null,8,["onClick"])):A("",!0)]),app1:b(({item:l})=>[l.val?(v(),w(L,{key:1})):(v(),w(H,{key:0}))]),app2:b(({item:l})=>[l.val1?(v(),w(L,{key:1})):(v(),w(H,{key:0}))]),app3:b(({item:l})=>[l.val2?(v(),w(L,{key:1})):(v(),w(H,{key:0}))]),pvr_completed:b(({item:l})=>[l.pvr_had_detail?(v(),w(L,{key:1})):(v(),w(H,{key:0}))]),deleted_by_username:b(({item:l})=>{var V;return[S(U((V=l.deleted_by)==null?void 0:V.username),1)]}),req_deleted_by_username:b(({item:l})=>{var V;return[S(U((V=l.req_deleted_by)==null?void 0:V.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),p(me,{type:"delete",show:a(E),data:a(_e),fnClose:Ce,fnConfirm:Ae,enabledOk:a(ee)},{footer:b(()=>[S(" Masukkan Alasan Penghapusan: "),s("div",Qt,[F(s("textarea",{"onUpdate:modelValue":e[19]||(e[19]=l=>K(P)?P.value=l:null)},null,512),[[oe,a(P)]])])]),_:1},8,["show","data","enabledOk"]),p(me,{type:"custome",show:a(I),data:a(pe),fnClose:Oe,fnConfirm:Me,enabledOk:a(te)},{words:b(()=>[S(" Data akan diproses dan "),Wt,S(", yakin untuk melanjutkan ? ")]),footer:b(()=>[S(" Masukkan Alasan Permintaan Penghapusan: "),s("div",Xt,[F(s("textarea",{"onUpdate:modelValue":e[20]||(e[20]=l=>K(j)?j.value=l:null)},null,512),[[oe,a(j)]])])]),_:1},8,["show","data","enabledOk"]),p(Ke,{show:a(R),fnClose:()=>{R.value=!1},fnLoadDBData:xe,id:a(Z),p_data:a(n),list_cost_center:a(re),online_status:a($)},null,8,["show","fnClose","id","p_data","list_cost_center","online_status"]),p(Je,{show:a(z),fnClose:()=>{z.value=!1},id:a(Q),p_data:a(n),is_view:a(W)},null,8,["show","fnClose","id","p_data","is_view"]),p(Ge,{show:a(X),fnClose:()=>{X.value=!1},index:a(ie),p_data:a(n)},null,8,["show","fnClose","index","p_data"])])}}};export{wa as default};
