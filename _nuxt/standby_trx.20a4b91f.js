import{_ as ve}from"./HeaderPopup.vue.e17b4467.js";import{_ as fe}from"./WidthMiniList.vue.220eec7d.js";import me from"./Tools.391f52d4.js";import{_ as we}from"./client-only.3f3eeb49.js";import he from"./AttachmentSingle.c23d7766.js";import xe from"./Plus.2e2bac04.js";import be from"./ToolsPopup.1e645377.js";import{r as w,f as ye,i as ge,G as se,j as R,A as S,I as ke,o as d,c as r,m as y,J as Se,a as e,b as g,k as s,v as V,F as N,y as O,t as _,q as oe,l as I,w as Ne,x as Ce,B as E,p as De,e as Ae,E as Ve}from"./entry.92b11eb7.js";import{u as Oe}from"./useUtils.e6218bed.js";import{u as L}from"./useMyFetch.dbdd839c.js";import{_ as Je}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.691ca0bc.js";import"./WidthMiniPart.vue.b7e27855.js";import"./PDFJsView.bcb89109.js";const i=b=>(De("data-v-12632398"),b=b(),Ae(),b),Te={class:"box-fixed"},Fe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Ie={class:"w-full flex flex-col items-center grow overflow-auto"},$e={class:"w-full flex flex-row flex-wrap"},Be={class:"w-full sm:w-9/12 flex px-2 py-3"},Pe={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},Ue=i(()=>e("div",{class:"absolute bg-white -top-3"}," Standby ",-1)),je={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},Me=i(()=>e("label",{for:""},"ID",-1)),qe=["disabled"],Re={id:"standby_mst"},Ee=["value"],Le={class:"text-red-500"},ze={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Ke=i(()=>e("label",{for:""},"Name",-1)),Ye={class:"card-border disabled"},Ge={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},He=i(()=>e("label",{for:""},"Type",-1)),We={class:"card-border disabled"},Xe={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},Qe=i(()=>e("label",{for:""},"Amount",-1)),Ze={class:"card-border disabled"},et={class:"w-full sm:w-3/12 flex px-2 py-3"},tt={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative items-end"},st=i(()=>e("div",{class:"absolute bg-white -top-3"}," Peralihan ",-1)),ot={class:"w-6/12 flex flex-col flex-wrap p-1"},lt=["disabled"],at=i(()=>e("option",{value:""},null,-1)),nt=i(()=>e("option",{value:"From"},"Dari",-1)),it=i(()=>e("option",{value:"To"},"Ke",-1)),_t=[at,nt,it],dt={class:"text-red-500"},rt={class:"w-6/12 flex flex-col flex-wrap p-1"},ct=["disabled"],ut=i(()=>e("option",{value:""},null,-1)),pt=["value"],vt={class:"text-red-500"},ft={class:"w-full flex flex-wrap"},mt={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},wt=i(()=>e("label",{for:""},"Supir",-1)),ht={class:"text-red-500"},xt={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},bt=i(()=>e("label",{for:""},"Kernet",-1)),yt={class:"text-red-500"},gt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},kt=i(()=>e("label",{for:""},"No Pol",-1)),St=["disabled"],Nt={id:"vehicle"},Ct=["value"],Dt={class:"text-red-500"},At={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Vt=i(()=>e("label",{for:""},"Tujuan",-1)),Ot=["disabled"],Jt={id:"xto"},Tt={class:"text-red-500"},Ft={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},It=i(()=>e("label",{for:""},"Note For Remarks",-1)),$t=["disabled"],Bt={class:"text-red-500"},Pt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ut=i(()=>e("label",{for:""},"Referensi",-1)),jt=["disabled"],Mt={class:"text-red-500"},qt={class:"w-full sm:w-6/12 md:w-6/12 lg:w-4/12 flex px-2 py-3"},Rt={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},Et=i(()=>e("div",{class:"absolute bg-white -top-3"}," Cost Center ",-1)),Lt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},zt=i(()=>e("label",{for:""}," Code",-1)),Kt=["disabled"],Yt={id:"cost_center"},Gt=["value"],Ht={class:"text-red-500"},Wt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},Xt=i(()=>e("label",{for:""},"Desc",-1)),Qt={class:"card-border disabled"},Zt={class:"w-full sm:w-6/12 md:w-6/12 lg:w-4/12 flex px-2 py-3"},es={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},ts=i(()=>e("div",{class:"absolute bg-white -top-3"}," PVR ",-1)),ss={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},os=i(()=>e("label",{for:""},"No",-1)),ls={class:"card-border disabled"},as={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ns=i(()=>e("label",{for:""},"Total",-1)),is={class:"card-border disabled"},_s={class:"w-full sm:w-6/12 md:w-6/12 lg:w-4/12 flex px-2 py-3"},ds={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},rs=i(()=>e("div",{class:"absolute bg-white -top-3"}," PV ",-1)),cs={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},us=i(()=>e("label",{for:""},"No",-1)),ps={class:"card-border disabled"},vs={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},fs=i(()=>e("label",{for:""},"Total",-1)),ms={class:"card-border disabled"},ws={class:"w-full flex grow p-1 overflow-auto 2xl:overflow-hidden justify-between flex-wrap"},hs={class:"w-full",role:"sticky"},xs={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},bs={class:"sticky -top-1 !z-[2]"},ys=["colspan"],gs={class:"sticky top-7 !z-[2]"},ks={key:0,class:"!min-w-[30px] !w-[30px] !max-w-[30px]"},Ss=i(()=>e("th",{class:"!min-w-[50px] !w-[50px] !max-w-[50px]"},"No",-1)),Ns=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Tanggal",-1)),Cs=i(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Foto",-1)),Ds={ref:"to_move"},As=["data-index"],Vs={key:0,class:"tools cell"},Os={class:"w-full h-full flex items-center justify-center"},Js=["onClick"],Ts={class:"cell"},Fs={class:"w-full h-full flex items-center justify-center relative"},Is={class:"cell"},$s={style:{width:"70vw"},class:"h-full flex items-center justify-center"},Bs={key:0},Ps={class:"tools cell"},Us={class:"w-full flex items-center justify-end"},js={__name:"standby_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const f=b,{$moment:le}=Ve(),{pointFormat:$}=Oe(),U={id:-1,transition_target:"",transition_type:"",standby_mst_id:"",standby_mst_:{name:"",tipe:"",amount:0,is_transition:0},supir:"",kernet:"",no_pol:"",xto:"",note_for_remarks:"",ref:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:0,pv_id:"",pv_no:"",pv_total:0,pv_datetime:"",rv_id:"",rv_no:"",rv_total:0,rv_had_detail:"",details:[]},c=w([]),z=w({ordinal:0,id:"",tanggal:new Date,note:"",p_status:"",attachment_1:"",attachment_1_preview:""});let J={...U};const t=w({...U}),j=ye("token"),m=w({});ge();const ae=async()=>{S().loading_full=!0,m.value={};const a=new FormData;a.append("transition_target",t.value.transition_target),a.append("transition_type",t.value.transition_type),a.append("standby_mst_id",t.value.standby_mst_id),a.append("supir_id",u.value.id),a.append("kernet_id",p.value.id),a.append("no_pol",t.value.no_pol),a.append("xto",t.value.xto),a.append("note_for_remarks",t.value.note_for_remarks),a.append("ref",t.value.ref),a.append("cost_center_code",t.value.cost_center_code),a.append("online_status",f.online_status);let o=[...c.value];o=o.map((x,F)=>(x.tanggal=x.tanggal?le(x.tanggal).format("Y-MM-DD"):"",x.attachment_1_preview=x.attachment_1_preview?"Exists":null,a.append(`attachments[${F}]`,x.attachment_1),x)),a.append("details",JSON.stringify(o));let v="post",n=f.id;n==0||(a.append("id",n),a.append("_method","PUT"));const{data:D,error:k,status:q}=await L("/standby_trx",{method:v,headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},body:a,retry:0});if(S().loading_full=!1,q.value==="error"){E().trigger(k,m);return}if(t.value.supir=u.value.name,t.value.supir_rek_no=u.value._.rek_no.val,t.value.supir_rek_name=u.value._.rek_name.val,t.value.kernet=p.value.name,t.value.kernet_rek_no=p.value._.rek_no.val,t.value.kernet_rek_name=p.value._.rek_name.val,t.value.updated_at=D.value.updated_at,f.id<=0)t.value.id=D.value.id,t.value.created_at=D.value.created_at,f.p_data.unshift(t.value);else{let x=f.p_data.map(F=>F.id).indexOf(f.id);x>=-1&&f.p_data.splice(x,1,{...t.value})}f.fnClose()},C={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},u=w(JSON.parse(JSON.stringify(C))),p=w(JSON.parse(JSON.stringify(C))),K=se(()=>{let a=[];return H.value.forEach((o,v)=>{let n=JSON.parse(JSON.stringify(C));n._.id.val=o.id,n._.name.val=o.name,n._.rek_no.val=o.rek_no,n._.rek_name.val=o.rek_name,n.id=o.id,n.name=o.name,n.title=(o.rek_no||"")+" "+(o.rek_name||""),a.push(JSON.parse(JSON.stringify(n)))}),a}),T=se(()=>!1),ne=async()=>{S().loading_full=!0;const{data:a,error:o,status:v}=await L("/standby_trx",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},params:{id:f.id},retry:0});if(S().loading_full=!1,v.value==="error"){E().trigger(o);return}let n=a.value.data;t.value=n,J={...n},u.value._.id.val=n.supir_id,u.value._.name.val=n.supir,u.value._.rek_no.val=n.supir_rek_no,u.value._.rek_name.val=n.supir_rek_name,u.value.id=n.supir_id,u.value.name=n.supir,u.value.rek_no=(n.supir_rek_no||"")+" "+(n.supir_rek_name||""),p.value._.id.val=n.kernet_id,p.value._.name.val=n.kernet,p.value._.rek_no.val=n.kernet_rek_no,p.value._.rek_name.val=n.kernet_rek_name,p.value.id=n.kernet_id,p.value.name=n.kernet,p.value.rek_no=(n.kernet_rek_no||"")+" "+(n.kernet_rek_name||"");let D="Edit";c.value=a.value.data.details.map(k=>(k.p_status=D,k.key=k.ordinal,k))},M=w([]),Y=w([]),G=w([]),H=w([]),ie=async()=>{S().loading_full=!0;const{data:a,error:o,status:v}=await L("/standby_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},retry:0});if(S().loading_full=!1,v.value==="error"){E().trigger(o);return}M.value=a.value.list_standby_mst,Y.value=a.value.list_xto,G.value=a.value.list_vehicle,H.value=a.value.list_employee},h=w(-1),B=w(!1),W=w({left:0,top:0}),_e=(a,o)=>{h.value=o,B.value=!0,W.value={left:a.clientX,top:a.clientY}},de=()=>{c.value.push({...z.value,p_status:"Add"})},re=()=>{B.value=!1},ce=(a="")=>{if(a=="insert")c.value.splice(h.value,0,{...z.value,p_status:"Add"});else if(a=="delete")c.value[h.value].p_status=="Edit"?c.value[h.value].p_status="Remove":c.value.splice(h.value,1);else if(a=="move_top"){let o=c.value[h.value];c.value.splice(h.value,1),c.value.splice(h.value-1,0,{...o})}else if(a=="move_bottom"){let o=c.value[h.value];c.value.splice(h.value,1),c.value.splice(h.value+1,0,{...o})}B.value=!1};R(()=>f.show,async(a,o)=>{a==!0&&(await ie(),await f.fnLoadDBData(),t.value={...U},u.value=JSON.parse(JSON.stringify(C)),p.value=JSON.parse(JSON.stringify(C)),c.value=[],m.value={},f.id!=0&&ne())},{immediate:!0});let ue={name:"",tipe:"",amount:0,is_transition:0};return R(()=>t.value.standby_mst_id,(a,o)=>{if(S().loading_full==!1&&(a==""||a!="")){let v=M.value.filter(n=>n.id==a);v.length>0?t.value.standby_mst_={...v[0]}:t.value.standby_mst_id==J.standby_mst_id?t.value.standby_mst_={...J.standby_mst_}:t.value.standby_mst_={...ue},t.value.standby_mst_.is_transition||(t.value.transition_target="",t.value.transition_type="")}},{}),R(()=>t.value.cost_center_code,(a,o)=>{if(a==""&&(t.value.cost_center_desc=""),a){let v=f.list_cost_center.filter(n=>n.CostCenter==a);v.length>0?t.value.cost_center_desc=v[0].Description:t.value.cost_center_code==J.cost_center_code&&(t.value.cost_center_desc=J.cost_center_desc)}},{deep:!0,immediate:!0}),(a,o)=>{var X,Q,Z,ee,te;const v=ve,n=fe,D=me,k=ke("vue-date-picker"),q=we,x=he,F=xe,pe=be;return d(),r(N,null,[y(e("section",Te,[e("div",null,[g(v,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Fe,[e("div",Ie,[e("div",$e,[e("div",Be,[e("div",Pe,[Ue,e("div",je,[Me,y(e("input",{type:"text",list:"standby_mst","onUpdate:modelValue":o[0]||(o[0]=l=>s(t).standby_mst_id=l),disabled:s(t).pvr_no!=""},null,8,qe),[[V,s(t).standby_mst_id]]),e("datalist",Re,[(d(!0),r(N,null,O(s(M),l=>(d(),r("option",{value:l.id},_(l.name+"-"+l.tipe+"-"+s($)(l.amount||0)),9,Ee))),256))]),e("p",Le,_(s(m).standby_mst_id),1)]),e("div",ze,[Ke,e("div",Ye,_((X=s(t).standby_mst_)==null?void 0:X.name),1)]),e("div",Ge,[He,e("div",We,_((Q=s(t).standby_mst_)==null?void 0:Q.tipe),1)]),e("div",Xe,[Qe,e("div",Ze,_(s($)((Z=s(t).standby_mst_)==null?void 0:Z.amount)),1)])])]),e("div",et,[e("div",tt,[st,e("div",ot,[y(e("select",{"onUpdate:modelValue":o[1]||(o[1]=l=>s(t).transition_type=l),disabled:((ee=s(t).standby_mst_)==null?void 0:ee.is_transition)==0},_t,8,lt),[[oe,s(t).transition_type]]),e("p",dt,_(s(m).transition_type),1)]),e("div",rt,[y(e("select",{"onUpdate:modelValue":o[2]||(o[2]=l=>s(t).transition_target=l),disabled:((te=s(t).standby_mst_)==null?void 0:te.is_transition)==0},[ut,(d(!0),r(N,null,O(s(S)().list_pabrik,l=>(d(),r("option",{value:l},_(l),9,pt))),256))],8,ct),[[oe,s(t).transition_target]]),e("p",vt,_(s(m).transition_target),1)])])]),e("div",ft,[e("div",mt,[wt,g(n,{arr:s(K),selected:s(u),pure:C,onSetSelected:o[3]||(o[3]=l=>u.value=l)},null,8,["arr","selected"]),e("p",ht,_(s(m).supir_id),1)]),e("div",xt,[bt,g(n,{arr:s(K),selected:s(p),pure:C,onSetSelected:o[4]||(o[4]=l=>p.value=l)},null,8,["arr","selected"]),e("p",yt,_(s(m).kernet_id),1)]),e("div",gt,[kt,y(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":o[5]||(o[5]=l=>s(t).no_pol=l),disabled:s(t).pvr_no!=""},null,8,St),[[V,s(t).no_pol]]),e("datalist",Nt,[(d(!0),r(N,null,O(s(G),l=>(d(),r("option",{value:l.no_pol},_(l.no_pol),9,Ct))),256))]),e("p",Dt,_(s(m).no_pol),1)]),e("div",At,[Vt,y(e("input",{type:"text",list:"xto","onUpdate:modelValue":o[6]||(o[6]=l=>s(t).xto=l),disabled:s(t).pvr_no!=""},null,8,Ot),[[V,s(t).xto]]),e("datalist",Jt,[(d(!0),r(N,null,O(s(Y),l=>(d(),r("option",null,_(l),1))),256))]),e("p",Tt,_(s(m).xto),1)]),e("div",Ft,[It,y(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=l=>s(t).note_for_remarks=l),disabled:s(t).pvr_no!=""}," ",8,$t),[[V,s(t).note_for_remarks]]),e("p",Bt,_(s(m).note_for_remarks),1)]),e("div",Pt,[Ut,y(e("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=l=>s(t).ref=l),disabled:s(t).pvr_no!=""},null,8,jt),[[V,s(t).ref]]),e("p",Mt,_(s(m).ref),1)])]),e("div",qt,[e("div",Rt,[Et,e("div",Lt,[zt,y(e("input",{list:"cost_center","onUpdate:modelValue":o[9]||(o[9]=l=>s(t).cost_center_code=l),disabled:s(t).pvr_no!=""},null,8,Kt),[[V,s(t).cost_center_code]]),e("datalist",Yt,[(d(!0),r(N,null,O(b.list_cost_center,l=>(d(),r("option",{value:l.CostCenter},_(l.CostCenter+"-"+l.Description),9,Gt))),256))]),e("p",Ht,_(s(m).cost_center_code),1)]),e("div",Wt,[Xt,e("div",Qt,_(s(t).cost_center_desc),1)])])]),e("div",Zt,[e("div",es,[ts,e("div",ss,[os,e("div",ls,_(s(t).pvr_no),1)]),e("div",as,[ns,e("div",is,_(s($)(s(t).pvr_total||0)),1)])])]),e("div",_s,[e("div",ds,[rs,e("div",cs,[us,e("div",ps,_(s(t).pv_no),1)]),e("div",vs,[fs,e("div",ms,_(s($)(s(t).pv_total)),1)])])]),e("div",ws,[e("div",hs,[e("table",xs,[e("thead",null,[e("tr",bs,[e("td",{colspan:s(T)?3:4,class:"!bg-slate-800 text-white font-bold"}," Detail Transaction ",8,ys)]),e("tr",gs,[s(T)?I("",!0):(d(),r("th",ks)),Ss,Ns,Cs])]),e("tbody",Ds,[(d(!0),r(N,null,O(s(c),(l,P)=>(d(),r(N,{key:P},[l.p_status!="Remove"?(d(),r("tr",{key:0,"data-index":P},[s(T)?I("",!0):(d(),r("td",Vs,[e("div",Os,[e("button",{type:"button",name:"button",onClick:A=>_e(A,P)},[g(D)],8,Js)])])),e("td",null,_(P+1)+".",1),e("td",Ts,[e("div",Fs,[g(q,null,{default:Ne(()=>[g(k,{modelValue:l.tanggal,"onUpdate:modelValue":A=>l.tanggal=A,type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),e("td",Is,[e("div",$s,[g(x,{value:l.attachment_1_preview,onSetFile:A=>l.attachment_1=A,onSetPreview:A=>l.attachment_1_preview=A,can_remove:!0},null,8,["value","onSetFile","onSetPreview"])])])],8,As)):I("",!0)],64))),128)),s(T)?I("",!0):(d(),r("tr",Bs,[e("td",Ps,[e("button",{type:"button",name:"button",onClick:o[10]||(o[10]=l=>de())},[g(F)])])]))],512)])])])])]),e("div",Us,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:o[11]||(o[11]=l=>b.fnClose())}," Cancel "),s(T)?I("",!0):(d(),r("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:o[12]||(o[12]=Ce(l=>ae(),["prevent"]))}," Save "))])])])],512),[[Se,b.show]]),g(pe,{show:s(B),coor:s(W),fn:re,data:s(c),data_index:s(h),onReplyAct:o[13]||(o[13]=l=>ce(l))},null,8,["show","coor","data","data_index"])],64)}}},eo=Je(js,[["__scopeId","data-v-12632398"]]);export{eo as default};
