import{_ as H}from"./HeaderPopup.vue.3ed81de8.js";import{_ as I}from"./client-only.c6736ce6.js";import{r as k,f as K,G as f,j as Q,I as W,m as C,J as X,o as r,c as d,a as e,b as B,k as t,t as n,w as Z,q as ee,n as te,v as ae,l as x,d as y,F as R,y as se,x as le,E as oe,A as g,B as G}from"./entry.bfc4a585.js";import{u as S}from"./useUtils.e5d08feb.js";import{u as L}from"./useMyFetch.f0cb27d3.js";import"./Times.0568650d.js";import"./_plugin-vue_export-helper.c27b6911.js";const ne={class:"box-fixed"},re={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},de={class:"w-full flex flex-col items-center grow overflow-auto"},ie={class:"w-full flex flex-row flex-wrap"},ue={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},_e=e("label",{for:""},"Period End",-1),ce={key:0,class:"card-border"},pe={key:1},me={class:"text-red-500"},fe={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ve=e("label",{for:""},"Period Part",-1),he={key:0,class:"card-border"},ye={key:1},we=e("option",{value:"1"},"1",-1),be=e("option",{value:"2"},"2",-1),ke=[we,be],xe={class:"text-red-500"},ge={key:0,class:"w-full p-1"},Fe=e("div",{class:"font-bold"}," Filter Nama ",-1),Ne={key:1,class:"w-full flex p-1 justify-between flex-wrap"},Ce={class:"w-full",role:"sticky"},Be={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Se=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"12",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),je={class:"sticky top-7 !z-[2]"},Me=e("th",null,"No",-1),Pe=e("th",null,"Jabatan",-1),Ve=e("th",null,"Nama Pekerja",-1),qe=e("th",null,"No KTP",-1),Ae=e("th",null,"Rek No",-1),Ee=e("th",null,"Rek Nama",-1),De=e("th",null,"Bank Name",-1),$e={class:"text-sm"},Te={class:"text-sm"},Ue={class:"text-sm"},ze={class:"text-sm"},Re={class:"text-sm"},Ge={ref:"to_move"},Le=["data-index"],Je={class:"w-full flex items-center justify-end"},Xe={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(w){const c=w,{$moment:j}=oe(),{pointFormat:i}=S(),M={id:"",period_end:new Date,period_part:1},a=k({...M}),P=K("token"),v=k({}),u=k([]),J=async()=>{g().loading_full=!0,v.value={};const s=new FormData;s.append("period_end",a.value.period_end?j(a.value.period_end).format("Y-MM"):""),s.append("period_part",a.value.period_part);let o="post",_=a.value.id;_==""||(s.append("id",_),s.append("_method","PUT"));const{data:p,error:N,status:l}=await L("/salary_paid",{method:o,headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},body:s,retry:0});if(g().loading_full=!1,l.value==="error"){G().trigger(N,v);return}if(u.value=p.value.details,_<=0)a.value.id=p.value.id,a.value.created_at=p.value.created_at,a.value.updated_at=p.value.updated_at,c.p_data.unshift(a.value);else{a.value.updated_at=p.value.updated_at;let m=c.p_data.map(b=>b.id).indexOf(_);m>=-1&&c.p_data.splice(m,1,{...a.value})}};f(()=>{let s=0;return u.value.forEach(o=>{s+=parseFloat(o.standby_nominal)}),s});const V=f(()=>{let s=0;return u.value.forEach(o=>{s+=parseFloat(o.sb_gaji)}),s}),q=f(()=>{let s=0;return u.value.forEach(o=>{s+=parseFloat(o.sb_makan)}),s}),A=f(()=>{let s=0;return u.value.forEach(o=>{s+=parseFloat(o.salary_bonus_nominal)}),s}),O=f(()=>a.value.val&&a.value.val1||S().checkPermission("salary_paid.val")&&a.value.val||S().checkPermission("salary_paid.val1")&&a.value.val1),Y=async()=>{g().loading_full=!0;const{data:s,error:o,status:_}=await L("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},params:{id:c.id},retry:0});if(g().loading_full=!1,_.value==="error"){G().trigger(o);return}a.value=s.value.data,c.is_copy&&(a.value.val=0,a.value.val1=0),u.value=s.value.data.details},h=k(""),F=f(()=>h.value!=""?u.value.filter(s=>s.employee.name.toLowerCase().includes(h.value.toLowerCase())):u.value);return Q(()=>c.show,(s,o)=>{s==!0&&(a.value={...M},u.value=[],v.value={},c.id!=0&&Y())},{immediate:!0}),(s,o)=>{const _=H,p=W("vue-date-picker"),N=I;return C((r(),d("section",ne,[e("div",null,[B(_,{title:"Form Salary Paid",fn:w.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",re,[e("div",de,[e("div",ie,[e("div",ue,[_e,t(a).id?(r(),d("div",ce,n(t(j)(t(a).period_end).format("MM-Y")),1)):(r(),d("div",pe,[B(N,null,{default:Z(()=>[B(p,{modelValue:t(a).period_end,"onUpdate:modelValue":o[0]||(o[0]=l=>t(a).period_end=l),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",me,n(t(v).period_end),1)]),e("div",fe,[ve,t(a).id?(r(),d("div",he,n(t(a).period_part),1)):(r(),d("div",ye,[C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=l=>t(a).period_part=l)},ke,512),[[ee,t(a).period_part]])])),e("p",xe,n(t(v).period_part),1)])]),t(F).length?(r(),d("div",ge,[Fe,C(e("input",{class:"",type:"text","onUpdate:modelValue":o[2]||(o[2]=l=>te(h)?h.value=l:null),name:"search",placeholder:"Nama"},null,512),[[ae,t(h)]])])):x("",!0),t(F).length?(r(),d("div",Ne,[e("div",Ce,[e("table",Be,[e("thead",null,[Se,e("tr",je,[Me,Pe,Ve,qe,Ae,Ee,De,e("th",null,[y("SB.Gaji "),e("span",$e,"("+n(t(i)(t(V)||0))+")",1)]),e("th",null,[y("SB.Makan "),e("span",Te,"("+n(t(i)(t(q)||0))+")",1)]),e("th",null,[y("SB.Dinas "),e("span",Ue,"("+n(t(i)(s.ttl_sb_dinas||0))+")",1)]),e("th",null,[y("Nominal Bonus "),e("span",ze,"("+n(t(i)(t(A)||0))+")",1)]),e("th",null,[y("Total "),e("span",Re,"("+n(t(i)(t(V)+t(q)+s.ttl_sb_dinas+t(A)||0))+")",1)])])]),e("tbody",Ge,[(r(!0),d(R,null,se(t(F),(l,m)=>{var b,E,D,$,T,U,z;return r(),d(R,{key:m},[l.p_status!="Remove"?(r(),d("tr",{key:0,"data-index":m},[e("td",null,n(m+1)+".",1),e("td",null,n((b=l.employee)==null?void 0:b.role),1),e("td",null,n((E=l.employee)==null?void 0:E.name),1),e("td",null,n((D=l.employee)==null?void 0:D.ktp_no),1),e("td",null,n(($=l.employee)==null?void 0:$.rek_no),1),e("td",null,n((T=l.employee)==null?void 0:T.rek_name),1),e("td",null,n((z=(U=l.employee)==null?void 0:U.bank)==null?void 0:z.code),1),e("td",null,n(t(i)(l.sb_gaji)),1),e("td",null,n(t(i)(l.sb_makan)),1),e("td",null,n(t(i)(l.sb_dinas)),1),e("td",null,n(t(i)(l.salary_bonus_nominal)),1),e("td",null,n(t(i)(parseFloat(l.sb_gaji)+parseFloat(l.sb_makan)+parseFloat(l.sb_dinas)+parseFloat(l.salary_bonus_nominal))),1)],8,Le)):x("",!0)],64)}),128))],512)])])])):x("",!0)]),e("div",Je,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:o[3]||(o[3]=l=>w.fnClose())}," Cancel "),t(O)?x("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:o[4]||(o[4]=le(l=>J(),["prevent"]))}," Generate "+n(t(a).id==""?"& Save":""),1))])])])],512)),[[X,w.show]])}}};export{Xe as default};
