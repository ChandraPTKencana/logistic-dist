import{j as tt,r as N,g as et,i as $,f as st,o as E,c as S,k as h,L as x,a as t,b as C,l as o,t as n,n as q,d as y,F as I,E as F,D as O,m as lt,v as at,x as c,y as g,B as ot,_ as nt}from"./entry.a326582a.js";import{_ as it}from"./HeaderPopup.vue.b5856aa7.js";import rt from"./Plus.6a2f1f50.js";import ut from"./Send.8af1486a.js";import dt from"./CloudDownload.b7d5cf3f.js";import ct from"./Times.eaea60b2.js";import{u as _t}from"./useUtils.bcd2e7ad.js";import{u as j}from"./useMyFetch.7138c4a8.js";import"./_plugin-vue_export-helper.c27b6911.js";const ft=ot(()=>nt(()=>import("./fin_payment_req_trx_trps.6de8ea9d.js"),["./fin_payment_req_trx_trps.6de8ea9d.js","./HeaderPopup.vue.b5856aa7.js","./Times.eaea60b2.js","./_plugin-vue_export-helper.c27b6911.js","./entry.a326582a.js","./entry.c5f8f180.css","./useUtils.bcd2e7ad.js","./useMyFetch.7138c4a8.js"],import.meta.url).then(m=>m.default||m)),pt={class:"box-fixed"},ht={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},mt={class:"w-full flex flex-col items-center grow overflow-auto"},vt={class:"w-full flex"},wt={key:0,class:"w-full flex p-2"},xt=["disabled"],yt={class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},bt={class:"w-full",role:"sticky"},gt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},jt=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),kt={class:"sticky top-7 !z-[2]"},Et=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),St=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),Ct=t("th",null,"No Trx",-1),Dt=t("th",null,"Tujuan",-1),At=t("th",null,"Produk",-1),Nt=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),Rt=t("th",null,"Jabatan",-1),$t=t("th",null,"Nama",-1),Bt=t("br",null,null,-1),It=t("br",null,null,-1),Pt=t("br",null,null,-1),Tt=t("th",null,null,-1),qt=t("th",null,"No Rek",-1),Ft=t("th",null,"Nama Di Bank",-1),Ot=t("br",null,null,-1),zt=t("th",null,"Status ",-1),Ut=t("th",null,"Aksi ",-1),Lt=t("th",null,"Alasan Gagal ",-1),Vt={ref:"to_move"},Kt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Yt={class:"w-full h-full flex items-center justify-center"},Mt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Qt={class:"w-full h-full flex items-center justify-center"},Jt={class:"cell"},Wt={class:"w-full h-full flex items-center justify-center p-2"},Gt={class:"pointer p-0 bg-red-500 text-white rounded flex items-center justify-center"},Ht={class:"px-2"},Xt={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},Zt={class:"w-full h-full flex items-center justify-center"},te={class:"cell"},ee={class:"w-full h-full flex items-center justify-center"},se={class:"cell"},le={class:"w-full h-full flex items-center justify-center"},ae={class:"cell"},oe={class:"w-full h-full flex items-center justify-center"},ne={class:"cell"},ie={class:"w-full h-full flex items-center justify-center"},re={class:"cell"},ue={class:"w-full h-full flex items-center justify-end p-2"},de={class:"cell"},ce={class:"w-full h-full flex items-center justify-end p-2"},_e={class:"cell"},fe={class:"w-full h-full flex items-center justify-end p-2"},pe=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),he={class:"cell"},me={class:"w-full h-full flex items-center justify-center"},ve={class:"cell"},we={class:"w-full h-full flex items-center justify-center"},xe={class:"cell"},ye={class:"w-full h-full flex items-center justify-end p-1"},be={class:"cell"},ge={class:"w-full h-full flex items-center justify-end p-1"},je={class:"cell"},ke={class:"w-full h-full flex items-center justify-end p-1"},Ee=["onClick"],Se={class:"cell"},Ce={class:"w-full h-full flex items-center justify-end p-1"},De={class:"w-full flex items-center justify-end"},Ae={class:"bg-white w-[250px] sm:w-1/2 md:w-1/3 lg:w-1/4 fixed z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-slate-700 shadow-2xl shadow-black p-2"},Ne=t("label",{for:""},"Select Batch No",-1),Re=["value"],$e={class:"flex justify-end pt-2"},Le={__name:"fin_payment_req",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(m){const p=m,{pointFormat:v}=_t(),{display:D}=tt(),P={id:0,batch_no:0,details:[]},s=N({...P}),b=et("token"),z=$(()=>{let a=0;return s.value.details.forEach(e=>{a+=parseInt(e.nominal)}),a}),U=$(()=>{let a=0;return s.value.details.forEach(e=>{a+=parseInt(e.potongan_trx_ttl)}),a}),L=$(()=>{let a=0;return s.value.details.forEach(e=>{a+=parseInt(e.extra_money_trx_ttl)}),a}),V=$(()=>{let a=0;return s.value.details.forEach(e=>{a+=parseInt(e.jumlah)}),a}),w=a=>s.value.details.length==0?a=="":s.value.details.filter(i=>i.status==a).length==s.value.details.length,K=async()=>{c().loading_full=!0;const{data:a,error:e,status:i}=await j("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},params:{id:p.id},retry:0});if(c().loading_full=!1,i.value==="error"){g().trigger(e);return}s.value=a.value.data,p.is_copy&&(s.value.val=0,s.value.val1=0)},f=N({}),Y=async()=>{c().loading_full=!0,f.value={};const a=new FormData;a.append("id",s.value.id),a.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await j("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:a,retry:0});if(c().loading_full=!1,u.value==="error"){g().trigger(_,f);return}D({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),s.value.details.forEach(r=>{r.status="INQUIRY_PROCESS"})},M=async()=>{c().loading_full=!0,f.value={};const a=new FormData;a.append("id",s.value.id),a.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await j("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:a,retry:0});if(c().loading_full=!1,u.value==="error"){g().trigger(_,f);return}D({show:!0,status:"Success",message:"Update Data Berhasil"}),i.value.details.forEach(r=>{let d=s.value.details.map(A=>A.id).indexOf(r.id);d>-1&&(s.value.details[d].status=r.status,s.value.details[d].failed_reason=r.failed_reason)}),s.value.status="WAIT"},Q=async(a,e)=>{c().loading_full=!0,f.value={};const i=new FormData;i.append("detail_id",a),i.append("_method","PUT");let _="post";const{data:u,error:r,status:d}=await j("/fin_payment_req_dtl/renew_data",{method:_,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:i,retry:0});if(c().loading_full=!1,d.value==="error"){g().trigger(r,f);return}s.value.details[e].rek_no=u.value.employee_rek_no,s.value.details[e].rek_name=u.value.employee_rek_name,s.value.details[e].bank_code=u.value.employee_bank_code,s.value.details[e].status=u.value.status,s.value.details[e].failed_reason=u.value.failed_reason,D({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"})};st(()=>p.show,(a,e)=>{a==!0&&(p.id==0&&(s.value={...P}),p.id!=0&&K())},{immediate:!0});const B=N(!1),J=()=>{B.value=!0},W=async(a,e)=>{c().loading_full=!0,f.value={};const i=new FormData;i.append("trx_trp_id",e),i.append("_method","DELETE");let _="post";const{data:u,error:r,status:d}=await j("/fin_payment_req_dtl/delete_data",{method:_,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:i,retry:0});if(c().loading_full=!1,d.value==="error"){g().trigger(r,f);return}s.value.details=s.value.details.filter(A=>A.trx_trp_id!=e)},R=N(!1),k=N(0),G=()=>{R.value=!0,k.value=s.value.batch_no},H=async()=>{c().loading_full=!0,f.value={};const a=new FormData;a.append("id",s.value.id),a.append("batch_no",k.value),a.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await j("/fin_payment_req/set_batch_no",{method:e,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:a,retry:0});if(c().loading_full=!1,u.value==="error"){g().trigger(_,f);return}s.value.batch_no=k.value;let r=p.p_data.map(d=>d.id).indexOf(s.value.id);r>-1&&p.p_data.splice(r,1,{...s.value}),R.value=!1,D({show:!0,status:"Success",message:"No Batch Berhasil Diperbaharui"})},X=async()=>{c().loading_full=!0,f.value={};const a=new FormData;a.append("id",s.value.id),a.append("_method","PUT");let e="post";const{data:i,error:_,status:u}=await j("/fin_payment_req/set_paid_done",{method:e,headers:{Authorization:`Bearer ${b.value}`,Accept:"application/json"},body:a,retry:0});if(c().loading_full=!1,u.value==="error"){g().trigger(_,f);return}s.value.status="CLOSE",s.value.details.forEach(d=>{d.status="DONE"});let r=p.p_data.map(d=>d.id).indexOf(s.value.id);r>-1&&p.p_data.splice(r,1,{...s.value}),D({show:!0,status:"Success",message:"PAID IS DONE"})};return(a,e)=>{const i=it,_=rt,u=ut,r=dt,d=ct,A=ft;return E(),S(I,null,[h(t("section",pt,[t("div",null,[C(i,{title:"Finance Payment Request",fn:m.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",ht,[t("div",mt,[t("div",vt,[o(s).status=="CLOSE"?(E(),S("div",wt," Batch No : "+n(o(s).batch_no),1)):q("",!0),h(t("button",{type:"button",name:"button",class:"m-1",disabled:o(s).status=="CLOSE",onClick:e[0]||(e[0]=l=>G())}," Batch No : "+n(o(s).batch_no),9,xt),[[x,w("TRANSFER_PROCESS")&&o(s).status=="WAIT"]]),h(t("button",{type:"button",name:"button",class:"m-1 bg-violet-600 text-white",onClick:e[1]||(e[1]=l=>X())}," Set Paid Done ",512),[[x,w("TRANSFER_PROCESS")]]),h(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=l=>J())},[C(_)],512),[[x,w("")||w("READY")]]),h(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=l=>Y())},[C(u)],512),[[x,w("READY")]]),h(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=l=>M())},[C(r)],512),[[x,w("INQUIRY_PROCESS")]])]),t("div",yt,[t("div",bt,[t("table",gt,[t("thead",null,[jt,t("tr",kt,[Et,St,Ct,Dt,At,Nt,Rt,$t,t("th",null,[y("Jumlah "),Bt,y(" ("+n(o(v)(o(z)||0))+") ",1)]),t("th",null,[y("Potongan "),It,y(" ("+n(o(v)(o(U)))+")",1)]),t("th",null,[y("ExtraMoney "),Pt,y(" ("+n(o(v)(o(L)))+")",1)]),Tt,qt,Ft,t("th",null,[y("Nominal Transfer "),Ot,y(" ("+n(o(v)(o(V)||0))+")",1)]),zt,Ut,Lt])]),t("tbody",Vt,[(E(!0),S(I,null,F(o(s).details,(l,T)=>(E(),S("tr",{key:T},[t("td",Kt,[t("div",Yt,n(l.no),1)]),t("td",Mt,[t("div",Qt,n(l.id),1)]),t("td",Jt,[t("div",Wt,[t("div",Gt,[t("span",Ht,n(l.trx_trp_id),1),h(C(d,{onClick:O(Z=>W(l.id,l.trx_trp_id),["prevent"]),class:"cursor-pointer text-3xl font-bold p-0 border-l-2 border-red-300"},null,8,["onClick"]),[[x,w("")||w("READY")]])])])]),t("td",Xt,[t("div",Zt,n(l.jabatan!="KERNET"?l.tujuan:""),1)]),t("td",te,[t("div",ee,n(l.jabatan!="KERNET"?l.produk:""),1)]),t("td",se,[t("div",le,n(l.jabatan!="KERNET"?l.no_pol:""),1)]),t("td",ae,[t("div",oe,n(l.jabatan),1)]),t("td",ne,[t("div",ie,n(l.nama),1)]),t("td",re,[t("div",ue,n(o(v)(l.jumlah||0)),1)]),t("td",de,[t("div",ce,n(o(v)(l.potongan_trx_ttl)),1)]),t("td",_e,[t("div",fe,n(o(v)(l.extra_money_trx_ttl)),1)]),pe,t("td",he,[t("div",me,n(l.rek_no),1)]),t("td",ve,[t("div",we,n(l.rek_name),1)]),t("td",xe,[t("div",ye,n(o(v)(l.jumlah||0)),1)]),t("td",be,[t("div",ge,n(l.status),1)]),t("td",je,[t("div",ke,[l.status=="INQUIRY_FAILED"?(E(),S("button",{key:0,class:"bg-yellow-400 rounded",onClick:O(Z=>Q(l.id,T),["prevent"])}," Renew Data ",8,Ee)):q("",!0)])]),t("td",Se,[t("div",Ce,n(l.failed_reason),1)])]))),128))],512)])])])]),t("div",De,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[5]||(e[5]=l=>m.fnClose())}," Cancel ")])])])],512),[[x,m.show]]),C(A,{show:o(B),fnClose:()=>{B.value=!1},id:o(s).id,onSetKData:e[6]||(e[6]=l=>s.value=l),onSetIsNew:e[7]||(e[7]=l=>{l&&m.p_data.push(o(s))})},null,8,["show","fnClose","id"]),h(t("div",Ae,[Ne,h(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>lt(k)?k.value=l:null)},[(E(),S(I,null,F(5,l=>t("option",{value:l-1},n(l-1),9,Re)),64))],512),[[at,o(k)]]),t("div",$e,[t("button",{type:"button",class:"bg-blue-500 text-white",onClick:e[9]||(e[9]=l=>H())},"Save"),t("button",{type:"button",class:"bg-yellow-500 text-white ml-2",onClick:e[10]||(e[10]=l=>R.value=!1)},"Cancel")])],512),[[x,o(R)]])],64)}}};export{Le as default};
