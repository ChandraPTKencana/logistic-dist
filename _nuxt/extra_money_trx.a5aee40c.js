import{_ as H}from"./HeaderPopup.vue.108c9d97.js";import{_ as W}from"./client-only.e6b357bf.js";import{_ as Y}from"./WidthMiniList.vue.17702964.js";import{r as p,f as K,G as J,j as I,I as Q,m as S,J as X,o as v,c as f,a as o,b as h,w as Z,k as s,t as c,v as D,F as P,y as F,x as ee,l as te,A as x,B,E as oe}from"./entry.9645ef05.js";import{u as ae}from"./useUtils.9bbeec39.js";import{u as V}from"./useMyFetch.787bc913.js";import"./Times.d5d32c69.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.69a9266d.js";const le={class:"box-fixed"},se={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ne={class:"w-full flex flex-col items-center grow overflow-auto"},re={class:"w-full flex flex-row flex-wrap"},ie={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},de=o("label",{for:""},"Tanggal",-1),_e={class:"grow"},ce={class:"text-red-500"},ue={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},pe=o("label",{for:""},"No Pol",-1),me=["disabled"],ve={id:"vehicle"},fe=["value"],xe={class:"text-red-500"},we={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ye=o("label",{for:""},"Pekerja",-1),he={class:"text-red-500"},ge={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},be=o("label",{for:""},"Uang Tambahan",-1),Ne={class:"text-red-500"},ke={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ce=o("label",{for:""},"Note",-1),Se={class:"text-red-500"},Oe={class:"w-full flex flex-wrap"},Je={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},De=o("label",{for:""},"Cost Center Code",-1),Be=["disabled"],Ve={id:"cost_center"},Ae=["value"],Te={class:"text-red-500"},$e={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},Ie=o("label",{for:""},"Cost Center Desc",-1),Pe={class:"card-border disabled"},Fe={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},Me=o("label",{for:""},"PVR No",-1),je={class:"card-border disabled"},qe={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Le=o("label",{for:""},"PVR Total",-1),Ue={class:"card-border disabled"},Ee={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},Re=o("label",{for:""},"PV",-1),ze={class:"card-border disabled"},Ge={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},He=o("label",{for:""},"PV Amount",-1),We={class:"card-border disabled"},Ye={class:"w-full flex items-center justify-end"},st={__name:"extra_money_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(w){const r=w,{$moment:M}=oe(),{pointFormat:m}=ae(),g={id:-1,tanggal:new Date,employee:{id:0},extra_money:{id:0},pv_id:-1,pv_no:"",pv_total:0,no_pol:"",note:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_complete:""};let b={...g};const a=p({...g}),O=K("token"),u=p({}),j=l=>{let t=l.target.value;if(!t){a.value.cost_center_code="",a.value.cost_center_desc="";return}r.list_cost_center.filter(e=>e.CostCenter==t).length==0&&(a.value.cost_center_code="112",a.value.cost_center_desc="Transport")},q=async()=>{x().loading_full=!0,u.value={};const l=new FormData;l.append("tanggal",M(a.value.tanggal).format("Y-MM-DD")),l.append("cost_center_code",a.value.cost_center_code),l.append("online_status",r.online_status),l.append("no_pol",a.value.no_pol),l.append("note",a.value.note),l.append("employee_id",d.value.id),l.append("extra_money_id",_.value.id);let t="post",i=r.id;i==0||(l.append("id",i),l.append("_method","PUT"));const{data:e,error:y,status:C}=await V("/extra_money_trx",{method:t,headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},body:l,retry:0});if(x().loading_full=!1,C.value==="error"){B().trigger(y,u);return}if(a.value.employee=JSON.parse(JSON.stringify(d.value._raw)),a.value.extra_money=JSON.parse(JSON.stringify(_.value._raw)),a.value.updated_at=e.value.updated_at,r.id<=0)a.value.id=e.value.id,a.value.created_at=e.value.created_at,r.p_data.unshift(a.value);else{let n=r.p_data.map(G=>G.id).indexOf(r.id);n>=-1&&r.p_data.splice(n,1,{...a.value})}r.fnClose()},N={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},xto:{tcon:"IconsLocationOn",text:"Tujuan",val:""},description:{tcon:"",text:"Deskripsi",val:""},total:{tcon:"",text:"Total",val:""}},id:"",name:"",title:"",note:""},k={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},d=p(JSON.parse(JSON.stringify(k))),_=p(JSON.parse(JSON.stringify(N))),L=J(()=>{let l=[];return T.value.forEach((t,i)=>{let e=JSON.parse(JSON.stringify(k));e._.id.val=t.id,e._.name.val=t.name,e._.rek_no.val=t.rek_no,e._.rek_name.val=t.rek_name,e.id=t.id,e.name=t.name,e.title=(t.rek_no||"")+" "+(t.rek_name||""),e._raw=t,l.push(JSON.parse(JSON.stringify(e)))}),l}),U=J(()=>{let l=[];return $.value.forEach((t,i)=>{let e=JSON.parse(JSON.stringify(N));e._.id.val=t.id,e._.xto.val=t.xto,e._.description.val=t.description,e._.total.val=m(t.total),e.id=t.id,e.name=t.xto,e.title=(m(t.total)||"")+" "+(t.description||""),e._raw=t,l.push(JSON.parse(JSON.stringify(e)))}),l}),E=J(()=>!1),R=async()=>{x().loading_full=!0;const{data:l,error:t,status:i}=await V("/extra_money_trx",{method:"get",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},params:{id:r.id},retry:0});if(x().loading_full=!1,i.value==="error"){B().trigger(t);return}let e=l.value.data;a.value=e,b={...e},d.value._raw=e.employee,d.value._.id.val=e.employee.id,d.value._.name.val=e.employee.name,d.value._.rek_no.val=e.employee_rek_no,d.value._.rek_name.val=e.employee_rek_name,d.value.id=e.employee.id,d.value.name=e.employee.name,d.value.rek_no=(e.employee_rek_no||"")+" "+(e.employee_rek_name||""),_.value._raw=e.extra_money,_.value._.id.val=e.extra_money.id,_.value._.xto.val=e.extra_money.xto,_.value._.description.val=e.extra_money.description,_.value._.total.val=m(e.extra_money.total),_.value.id=e.extra_money.id,_.value.name=e.extra_money.xto,_.value.title=(m(e.extra_money.total)||"")+" "+(e.extra_money.description||""),r.fnLoadDBData()},A=p([]),T=p([]),$=p([]),z=async()=>{x().loading_full=!0;const{data:l,error:t,status:i}=await V("/extra_money_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${O.value}`,Accept:"application/json"},retry:0});if(x().loading_full=!1,i.value==="error"){B().trigger(t);return}A.value=l.value.list_vehicle,T.value=l.value.list_employee,$.value=l.value.list_extra_money};return I(()=>r.show,async(l,t)=>{l==!0&&(await z(),await r.fnLoadDBData(),a.value={...g},b={...g},d.value=JSON.parse(JSON.stringify(k)),_.value=JSON.parse(JSON.stringify(N)),u.value={},r.id!=0&&R())},{immediate:!0}),I(()=>a.value.cost_center_code,(l,t)=>{let i="";if(l==""||l){let e=r.list_cost_center.filter(y=>y.CostCenter==a.value.cost_center_code);e.length>0?i=e[0].Description:a.value.cost_center_code==b.cost_center_code&&(i=b.cost_center_desc),a.value.cost_center_desc=i}},{deep:!0,immediate:!0}),(l,t)=>{const i=H,e=Q("vue-date-picker"),y=W,C=Y;return S((v(),f("section",le,[o("div",null,[h(i,{title:"Form Transaction",fn:w.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),o("form",se,[o("div",ne,[o("div",re,[o("div",ie,[de,o("div",_e,[h(y,null,{default:Z(()=>[h(e,{modelValue:s(a).tanggal,"onUpdate:modelValue":t[0]||(t[0]=n=>s(a).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})]),o("p",ce,c(s(u).tanggal),1)]),o("div",ue,[pe,S(o("input",{type:"text",list:"vehicle","onUpdate:modelValue":t[1]||(t[1]=n=>s(a).no_pol=n),disabled:s(a).val==1},null,8,me),[[D,s(a).no_pol]]),o("datalist",ve,[(v(!0),f(P,null,F(s(A),n=>(v(),f("option",{value:n.no_pol},c(n.no_pol),9,fe))),256))]),o("p",xe,c(s(u).no_pol),1)]),o("div",we,[ye,h(C,{arr:s(L),selected:s(d),pure:k,onSetSelected:t[2]||(t[2]=n=>d.value=n)},null,8,["arr","selected"]),o("p",he,c(s(u).employee_id),1)]),o("div",ge,[be,h(C,{arr:s(U),selected:s(_),pure:N,onSetSelected:t[3]||(t[3]=n=>_.value=n)},null,8,["arr","selected"]),o("p",Ne,c(s(u).extra_money_id),1)]),o("div",ke,[Ce,S(o("textarea",{"onUpdate:modelValue":t[4]||(t[4]=n=>s(a).note=n)},null,512),[[D,s(a).note]]),o("p",Se,c(s(u).note),1)]),o("div",Oe,[o("div",Je,[De,S(o("input",{list:"cost_center","onUpdate:modelValue":t[5]||(t[5]=n=>s(a).cost_center_code=n),onBlur:t[6]||(t[6]=n=>j(n)),disabled:s(a).pvr_no!=""},null,40,Be),[[D,s(a).cost_center_code]]),o("datalist",Ve,[(v(!0),f(P,null,F(w.list_cost_center,n=>(v(),f("option",{value:n.CostCenter},c(n.CostCenter+"-"+n.Description),9,Ae))),256))]),o("p",Te,c(s(u).cost_center_code),1)]),o("div",$e,[Ie,o("div",Pe,c(s(a).cost_center_desc),1)]),o("div",Fe,[Me,o("div",je,c(s(a).pvr_no),1)]),o("div",qe,[Le,o("div",Ue,c(s(m)(s(a).pvr_total||0)),1)]),o("div",Ee,[Re,o("div",ze,c(s(a).pv_no),1)]),o("div",Ge,[He,o("div",We,c(s(m)(s(a).pv_total)),1)])])])]),o("div",Ye,[o("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[7]||(t[7]=n=>w.fnClose())}," Cancel "),s(E)?te("",!0):(v(),f("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[8]||(t[8]=ee(n=>q(),["prevent"]))}," Save "))])])])],512)),[[X,w.show]])}}};export{st as default};
