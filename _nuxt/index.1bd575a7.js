import{_ as _e}from"./Header.f3bd7a1f.js";import{u as ue,_ as ce}from"./useDownload.d99e835b.js";import{_ as de}from"./Table2Column.13fcda22.js";import{_ as pe}from"./client-only.9f017154.js";import{u as R,_ as be}from"./useUtils.822c33d9.js";import{_ as fe,a as ke}from"./Check.2489f4b0.js";import{_ as me}from"./TableView.0879ccdb.js";import{_ as ve}from"./PopupMini.vue.3a309fc5.js";import{_ as ye}from"./Times.d1d5fe03.js";import{r as i,f as ge,D as he,B as xe,H as L,I as we,J as De,c as Z,b as d,a as o,w as r,t as _,k as l,h as H,j as Te,i as $e,l as q,m as Se,G as Me,E as Ae,x as b,y as D,o as m,q as Ce,N as h,d as c,O as Be,s as Ne}from"./entry.f54fa281.js";import{u as T}from"./useMyFetch.a4b6fe0f.js";import"./_plugin-vue_export-helper.c27b6911.js";const Ve={class:"w-full h-full flex flex-col"},je={class:"w-full flex grow flex-col overflow-auto h-0"},Pe={class:"w-full flex"},He={action:"#",class:"w-full flex p-1"},Ye=o("div",{class:"font-bold"}," Tgl Dari ",-1),Oe={class:"text-red-500"},Fe=o("div",{class:"font-bold"}," Tgl Sampai ",-1),Ie={class:"text-red-500"},ze={class:"grow"},Ke=o("div",{class:"font-bold"}," Keyword ",-1),Ee={class:"pl-1"},Ue=o("div",{class:"font-bold"}," Sort By ",-1),Je=Be('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option><option value="pv_no">PV No</option><option value="ticket_a_no">Ticket A No</option><option value="ticket_b_no">Ticket B No</option>',8),Re=[Je],Le={class:"pl-1"},Ze=o("div",{class:"font-bold"}," Sort Order ",-1),qe=o("option",{value:"asc"},"Asc",-1),Ge=o("option",{value:"desc"},"Desc",-1),Qe=[qe,Ge],We={class:"flex items-end pl-1"},Xe={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},et={class:"relative",style:{width:"95%",height:"90%"}},tt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},at=["src"],mt={__name:"index",async setup(ot){let $,Y;const{$moment:O}=Ne(),{pointFormat:y}=R(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="tanggal:desc";const S=i({}),x=ge("token"),f=i({from:"",to:""}),{data:G}=([$,Y]=he(async()=>Ae(async()=>{b().loading_full=!0;let a=[];const[t,u]=await Promise.all([T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},retry:0})]);return t.status.value!=="error"&&(a=t.data.value.data),t.status.value==="error"?(D().trigger(t.error),{trx_trps:a}):(b().loading_full=!1,{trx_trps:a})},"$8KmJHfPiB5")),$=await $,Y(),$),k=i(G.value.trx_trps||[]),s=i(""),v=i({field:"tanggal",by:"desc"}),w=i(-1),p=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),C=()=>{n.like="",s.value!=""&&(n.like=`id:%${s.value}%,xto:%${s.value}%,jenis:%${s.value}%,pv_no:%${s.value}%,ticket_a_no:%${s.value}%,ticket_b_no:%${s.value}%,no_pol:%${s.value}%,supir:%${s.value}%,kernet:%${s.value}%,cost_center_code:%${s.value}%,cost_center_desc:%${s.value}%,pvr_id:%${s.value}%,pvr_no:%${s.value}%,tanggal:%${s.value}%,transition_to:%${s.value}%`),n.sort="",v.value.field&&(n.sort=v.value.field+":"+v.value.by),n._TimeZoneOffset=new Date().getTimezoneOffset(),n.date_from=f.value.from?O(f.value.from).format("YYYY-MM-DD"):"",n.date_to=f.value.to?O(f.value.to).format("YYYY-MM-DD"):""},F=i(null),I=async()=>{b().loading_full=!0,S.value={},p.value.may_get_data=!1,n.page=p.value.page,n.page==1&&(k.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(k.value[0]));const{data:a,error:t,status:u}=await T("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,p.value.may_get_data=!0,u.value==="error"){D().trigger(t,S);return}p.value.page==1?(k.value=a.value.data,F.value&&(F.value.scrollTop=0)):p.value.page>1&&(k.value=[...k.value,...a.value.data]),a.value.data.length==0&&(p.value.is_last_record=!0)},Q=()=>{p.value.page=1,p.value.is_last_record=!1,C(),I()};xe(),i(!1),i(0),L(),we(L());const W=i({}),M=i(!1),X=async()=>{M.value&&(M.value=!1)},ee=async()=>{b().loading_full=!0;const a=new FormData;a.append("id",k.value[w.value].id),a.append("_method","DELETE");const{data:t,error:u,status:g}=await T("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:a,retry:0});if(b().loading_full=!1,g.value==="error"){D().trigger(u);return}k.value.splice(w.value,1),w.value=-1,M.value=!1},{downloadFile:z,viewFile:lt}=ue(),A=i(!1),B=i(""),K=async()=>{if(A.value==!0){A.value=!1;return}C(),b().loading_full=!0;const{data:a,error:t,status:u}=await T("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,u.value==="error"){D().trigger(t);return}B.value=a.value,A.value=!0},te=async()=>{C(),b().loading_full=!0;const{data:a,error:t,status:u}=await T("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,u.value==="error"){D().trigger(t);return}z(a.value)},ae=()=>{z(B.value)},E=a=>a.pv_id<=0||["CPO","PK"].indexOf(a.jenis)>-1&&(a.ticket_a_id<=0||a.ticket_b_bruto<=0||a.ticket_b_tara<=0||a.ticket_b_netto<=0||a.ticket_b_in_at==""||a.ticket_b_out_at=="")||a.jenis=="TBS"&&(a.ticket_a_id<=0||a.ticket_b_id<=0)||a.jenis=="TBSK"&&a.ticket_b_id<=0?0:1,oe=i([{key:"status",label:"Status"},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"id",label:"ID"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol"},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"default",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"transition_to",label:"Peralihan"},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No"},{key:"ticket_a_bruto",label:"Bruto"},{key:"ticket_a_tara",label:"Tara"},{key:"ticket_a_netto",label:"Netto"},{key:"ticket_a_supir",label:"Supir"},{key:"ticket_a_no_pol",label:"No Pol"},{key:"ticket_a_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_a_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No"},{key:"ticket_b_bruto",label:"Bruto"},{key:"ticket_b_tara",label:"Tara"},{key:"ticket_b_netto",label:"Netto"},{key:"ticket_b_supir",label:"Supir"},{key:"ticket_b_no_pol",label:"No Pol"},{key:"ticket_b_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_b_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"}]),N=(a,t)=>{a=parseFloat(a)||0,t=parseFloat(t)||0;let u=parseFloat(t-a),g=u>0?t:a;return g==0?0:R().round(u/g*100,2)},V=(a,t)=>(a=parseFloat(a)||0,t=parseFloat(t)||0,parseFloat(t-a));return(a,t)=>{const u=_e,g=ce,le=de,U=De("vue-date-picker"),J=pe,se=be,j=fe,P=ke,ne=me,re=ve,ie=ye;return m(),Z("div",Ve,[d(u,{title:"Report Transaction"}),o("div",je,[o("div",Pe,[o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=e=>K())},[d(g)]),o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=e=>te())},[d(le)])]),o("form",He,[o("div",null,[Ye,d(J,null,{default:r(()=>[d(U,{modelValue:l(f).from,"onUpdate:modelValue":t[2]||(t[2]=e=>l(f).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),o("p",Oe,_(l(S).date_from),1)]),o("div",null,[Fe,d(J,null,{default:r(()=>[d(U,{modelValue:l(f).to,"onUpdate:modelValue":t[3]||(t[3]=e=>l(f).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),o("p",Ie,_(l(S).date_to),1)]),o("div",ze,[Ke,H(o("input",{class:"",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>$e(s)?s.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[Te,l(s)]])]),o("div",Ee,[Ue,H(o("select",{class:"","onUpdate:modelValue":t[5]||(t[5]=e=>l(v).field=e)},Re,512),[[q,l(v).field]])]),o("div",Le,[Ze,H(o("select",{class:"","onUpdate:modelValue":t[6]||(t[6]=e=>l(v).by=e)},Qe,512),[[q,l(v).by]])]),o("div",We,[o("button",{class:"",type:"submit",name:"button",onClick:t[7]||(t[7]=Se(e=>Q(),["prevent"]))},[d(se,{class:"text-2xl"})])])]),d(ne,{thead:l(oe),selected:l(w),onSetSelected:t[8]||(t[8]=e=>w.value=e),tbody:l(k),fnCallData:I,scrolling:l(p),onSetScrollingPage:t[9]||(t[9]=e=>l(p).page=e)},{status:r(({item:e})=>[o("div",{class:Ce(["text-white text-xs px-2 py-1 rounded-lg",E(e)?"bg-green-600":"bg-red-600"])},_(E(e)?"Done":"Not Done"),3)]),app1:r(({item:e})=>[e.val?(m(),h(P,{key:1})):(m(),h(j,{key:0}))]),app2:r(({item:e})=>[e.val1?(m(),h(P,{key:1})):(m(),h(j,{key:0}))]),pvr_completed:r(({item:e})=>[e.pvr_had_detail?(m(),h(P,{key:1})):(m(),h(j,{key:0}))]),susut_bruto_a:r(({item:e})=>[c(_(l(y)(e.ticket_a_bruto)),1)]),susut_tara_a:r(({item:e})=>[c(_(l(y)(e.ticket_a_tara)),1)]),susut_netto_a:r(({item:e})=>[c(_(l(y)(e.ticket_a_netto)),1)]),susut_bruto_b:r(({item:e})=>[c(_(l(y)(e.ticket_b_bruto)),1)]),susut_tara_b:r(({item:e})=>[c(_(l(y)(e.ticket_b_tara)),1)]),susut_netto_b:r(({item:e})=>[c(_(l(y)(e.ticket_b_netto)),1)]),susut_bruto_b_a:r(({item:e})=>[c(_(V(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a:r(({item:e})=>[c(_(V(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a:r(({item:e})=>[c(_(V(e.ticket_a_netto,e.ticket_b_netto)),1)]),susut_bruto_b_a_persen:r(({item:e})=>[c(_(N(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a_persen:r(({item:e})=>[c(_(N(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a_persen:r(({item:e})=>[c(_(N(e.ticket_a_netto,e.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),d(re,{type:"delete",show:l(M),data:l(W),fnClose:X,fnConfirm:ee},null,8,["show","data"]),l(A)?(m(),Z("div",Xe,[o("div",et,[o("div",tt,[d(ie,{style:{color:"black",cursor:"pointer"},onClick:t[10]||(t[10]=e=>K())})]),o("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(B).dataBase64},null,8,at),o("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[11]||(t[11]=e=>ae())})])])):Me("",!0)])}}};export{mt as default};
