import de from"./Header.c2c28600.js";import ue from"./Edit.29f305f9.js";import pe from"./Eyes.700e2729.js";import fe from"./Signature.e1841d71.js";import me from"./Line.9d27ce35.js";import ce from"./Check.cd1baed7.js";import ve from"./TableView.ca45b65a.js";import ye from"./trx_trp_absen.533d8187.js";import be from"./trx_trp_absen_validasi.b0301988.js";import ge from"./trx_absen.bd6ccdc0.js";import{r as s,j as xe,f as ke,g as he,G as x,i as we,c as k,b as _,a as v,m as De,q as $e,k as a,n as Se,l as C,w as h,z as Ae,A as f,B as R,o as d,D as w,d as z,t as I,H as Te,E as qe}from"./entry.6a371a02.js";import{u as E}from"./useMyFetch.debc51ec.js";import{u as M}from"./useUtils.33aa71b3.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.3d242cff.js";import"./Adjust.11db5cb0.js";import"./TableHeaderEye.19b8e75b.js";import"./Times.eb95a29f.js";import"./ClearAll.20d35b5e.js";import"./client-only.f34d5537.js";import"./ClearEach.1f709cef.js";import"./CaretLeftDoubleBold.20148b0e.js";import"./CaretLeftBold.f54aec39.js";import"./CaretRightBold.54d74bcf.js";import"./CaretRightDoubleBold.55e08ac3.js";import"./HeaderPopup.vue.d8e5a038.js";import"./AttachmentSingle.ed320fb6.js";import"./PDFJsView.58fc7ee9.js";import"./PopupMini.vue.4ab8c07c.js";import"./Exclamation.858e539e.js";const Ce={class:"w-full h-full flex flex-col"},Me={class:"w-full flex grow flex-col overflow-auto h-0"},Oe={class:"w-full flex justify-between flex-wrap"},Ye={class:"grow flex"},Ne={class:"m-1"},Pe=Te('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Be=[Pe],mt={__name:"absen",async setup(He){let y,O;const{$moment:Y}=qe(),K=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.ritase_leave_at!=""&&e.ritase_arrive_at!=""&&e.ritase_return_at!=""&&e.ritase_till_at!=""?"!bg-blue-300":"",D=e=>(e.map(t=>{t.class_h=K(t)}),e),m=s("Undone");xe(()=>m.value,e=>{F.value.map(t=>{let p=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?p&&(t.tbl_show=1):p&&(t.tbl_show=0),t}),H()},{immediate:!1});const l={};l._TimeZoneOffset=new Date().getTimezoneOffset(),l.sort="tanggal:desc";const N=s({}),b=s({from:"",to:""}),P=ke("token"),{data:L}=([y,O]=he(async()=>Ae(async()=>{f().loading_full=!0;let e=[];const[t,p]=await Promise.all([E("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},params:{filter_status:m},retry:0})]);return t.status.value!=="error"&&(e=D(t.data.value.data)),t.status.value==="error"?(R().trigger(t.error),{trx_trps:e}):(f().loading_full=!1,{trx_trps:e})},"$Tkqpaz2JeJ")),y=await y,O(),y),r=s(L.value.trx_trps||[]);s([]),s(!1);const $=s({field:"tanggal",by:"desc"}),n=s(-1),u=x(()=>r.value[n.value]),i=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),G=()=>{l.like="";let e=JSON.parse(JSON.stringify(f()._tv.global_keyword));e!=""&&(l.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),l.sort="",$.value.field&&(l.sort=$.value.field+":"+$.value.by),l.date_from=b.value.from?Y(b.value.from).format("YYYY-MM-DD"):"",l.date_to=b.value.to?Y(b.value.to).format("YYYY-MM-DD"):"",l.filter_model=JSON.stringify(f()._tv.filter_model)},B=async()=>{f().loading_full=!0,N.value={},i.value.may_get_data=!1,l.page=i.value.page,l.page==1&&(r.value=[]),l.first_row&&delete l.first_row,l.page>1&&(l.first_row=JSON.stringify(r.value[0])),l.filter_status=m.value;const{data:e,error:t,status:p}=await E("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},params:l,retry:0});if(f().loading_full=!1,i.value.may_get_data=!0,p.value==="error"){R().trigger(t,N);return}i.value.page==1?r.value=D(e.value.data):i.value.page>1&&(r.value=[...r.value,...D(e.value.data)]),e.value.data.length==0&&(i.value.is_last_record=!0),f()._tv.filter_box=!1},H=()=>{n.value=-1,i.value.page=1,i.value.is_last_record=!1,G(),B()},S=s(!1),U=s(0),{display:A}=we(),Z=()=>{n.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=r.value[n.value].id,S.value=!0)},g=s(!1),T=s(0),q=s(!1),Q=()=>{n.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=r.value[n.value].id,g.value=!0,q.value=!1)},W=()=>{n.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=r.value[n.value].id,g.value=!0,q.value=!0)},j=s(!1),X=s(0),F=s([{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ee=x(()=>n.value>-1&&M().checkPermission("trp_trx.absen.view")),te=x(()=>n.value>-1&&[void 0,0].indexOf(u.value.deleted)>-1&&[void 0,0].indexOf(u.value.req_deleted)>-1&&[void 0,0].indexOf(u.value.ritase_val)>-1&&M().checkPermission("trp_trx.absen.modify")),ae=x(()=>n.value>-1&&[void 0,0].indexOf(u.value.deleted)>-1&&[void 0,0].indexOf(u.value.req_deleted)>-1&&[void 0,0].indexOf(u.value.ritase_val)>-1&&[void 0,0].indexOf(u.value.ritase_val1)>-1&&M().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1"]));return(e,t)=>{const p=de,le=ue,oe=pe,se=fe,J=me,V=ce,re=ve,ne=ye,ie=be,_e=ge;return d(),k("div",Ce,[_(p,{title:"List Transaction"}),v("div",Me,[v("div",Oe,[v("div",Ye,[v("div",Ne,[De(v("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=o=>Se(m)?m.value=o:null)},Be,512),[[$e,a(m)]])]),a(te)?(d(),k("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=o=>Z())},[_(le)])):C("",!0),a(ee)?(d(),k("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=o=>W())},[_(oe)])):C("",!0),a(ae)?(d(),k("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=o=>Q())},[_(se)])):C("",!0)])]),_(re,{thead:a(F),selected:a(n),onSetSelected:t[4]||(t[4]=o=>n.value=o),tbody:a(r),fnCallData:B,scrolling:a(i),onSetScrollingPage:t[5]||(t[5]=o=>a(i).page=o),onDoFilter:t[6]||(t[6]=o=>H())},{ritase_val:h(({item:o})=>[o.ritase_val?(d(),w(V,{key:1})):(d(),w(J,{key:0}))]),ritase_val1:h(({item:o})=>[o.ritase_val1?(d(),w(V,{key:1})):(d(),w(J,{key:0}))]),deleted_by_username:h(({item:o})=>{var c;return[z(I((c=o.deleted_by)==null?void 0:c.username),1)]}),req_deleted_by_username:h(({item:o})=>{var c;return[z(I((c=o.req_deleted_by)==null?void 0:c.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),_(ne,{show:a(S),fnClose:()=>{S.value=!1},id:a(U),p_data:a(r)},null,8,["show","fnClose","id","p_data"]),_(ie,{show:a(g),fnClose:()=>{g.value=!1},id:a(T),p_data:a(r),is_view:a(q)},null,8,["show","fnClose","id","p_data","is_view"]),_(_e,{show:a(j),fnClose:()=>{j.value=!1},index:a(X),p_data:a(r)},null,8,["show","fnClose","index","p_data"])])}}};export{mt as default};
