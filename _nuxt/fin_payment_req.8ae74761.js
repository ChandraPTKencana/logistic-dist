import{j as lt,r as C,g as at,i as $,f as ot,o as D,c as A,k as p,L as v,a as t,b as E,l as o,t as n,n as F,d as b,F as P,E as O,D as U,m as nt,v as it,x as d,y as g,B as rt,_ as ut}from"./entry.d9b45284.js";import{_ as dt}from"./HeaderPopup.vue.d6400a7b.js";import ct from"./Plus.654db134.js";import _t from"./Send.36e494b6.js";import ft from"./CloudDownload.46b02ea2.js";import pt from"./History.ff85188d.js";import ht from"./Times.6df50bd1.js";import{u as mt}from"./useUtils.ab60562a.js";import{u as k}from"./useMyFetch.405cdccc.js";import"./_plugin-vue_export-helper.c27b6911.js";const vt=rt(()=>ut(()=>import("./fin_payment_req_trx_trps.4bc1b201.js"),["./fin_payment_req_trx_trps.4bc1b201.js","./HeaderPopup.vue.d6400a7b.js","./Times.6df50bd1.js","./_plugin-vue_export-helper.c27b6911.js","./entry.d9b45284.js","./entry.683d558b.css","./useUtils.ab60562a.js","./useMyFetch.405cdccc.js"],import.meta.url).then(w=>w.default||w)),wt={class:"box-fixed"},yt={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},xt={class:"w-full flex flex-col items-center grow overflow-auto"},bt={class:"w-full flex justify-evenly"},gt={key:0,class:"w-full flex p-2"},kt=["disabled"],Et={class:"w-full flex p-1 overflow-auto flex-wrap"},jt={class:"w-full",role:"sticky"},St={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Ct=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),Dt={class:"sticky top-7 !z-[2]"},At=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),Nt=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),Rt=t("th",null,"No Trx",-1),$t=t("th",null,"Tujuan",-1),Bt=t("th",null,"Produk",-1),It=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),Pt=t("th",null,"Jabatan",-1),Tt=t("th",null,"Nama",-1),qt=t("br",null,null,-1),Ft=t("br",null,null,-1),Ot=t("br",null,null,-1),Ut=t("th",null,null,-1),zt=t("th",null,"No Rek",-1),Lt=t("th",null,"Nama Di Bank",-1),Vt=t("br",null,null,-1),Yt=t("th",null,"Status ",-1),Kt=t("th",null,"Aksi ",-1),Mt=t("th",null,"Alasan Gagal ",-1),Qt={ref:"to_move"},Ht={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Jt={class:"w-full h-full flex items-center justify-center"},Wt={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},Gt={class:"w-full h-full flex items-center justify-center"},Xt={class:"cell"},Zt={class:"w-full h-full flex items-center justify-center p-2"},te={class:"pointer p-0 bg-red-500 text-white rounded flex items-center justify-center"},ee={class:"px-2"},se={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},le={class:"w-full h-full flex items-center justify-center"},ae={class:"cell"},oe={class:"w-full h-full flex items-center justify-center"},ne={class:"cell"},ie={class:"w-full h-full flex items-center justify-center"},re={class:"cell"},ue={class:"w-full h-full flex items-center justify-center"},de={class:"cell"},ce={class:"w-full h-full flex items-center justify-center"},_e={class:"cell"},fe={class:"w-full h-full flex items-center justify-end p-2"},pe={class:"cell"},he={class:"w-full h-full flex items-center justify-end p-2"},me={class:"cell"},ve={class:"w-full h-full flex items-center justify-end p-2"},we=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),ye={class:"cell"},xe={class:"w-full h-full flex items-center justify-center"},be={class:"cell"},ge={class:"w-full h-full flex items-center justify-center"},ke={class:"cell"},Ee={class:"w-full h-full flex items-center justify-end p-1"},je={class:"cell"},Se={class:"w-full h-full flex items-center justify-end p-1"},Ce={class:"cell"},De={class:"w-full h-full flex items-center justify-end p-1"},Ae=["onClick"],Ne={class:"cell"},Re={class:"w-full h-full flex items-center justify-end p-1"},$e={class:"w-full flex items-center justify-end"},Be={class:"bg-white w-[250px] sm:w-1/2 md:w-1/3 lg:w-1/4 fixed z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-slate-700 shadow-2xl shadow-black p-2"},Ie=t("label",{for:""},"Select Batch No",-1),Pe=["value"],Te={class:"flex justify-end pt-2"},Qe={__name:"fin_payment_req",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(w){const h=w,{pointFormat:y}=mt(),{display:j}=lt(),T={id:0,batch_no:0,details:[]},s=C({...T}),x=at("token"),z=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.nominal)}),l}),L=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.potongan_trx_ttl)}),l}),V=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.extra_money_trx_ttl)}),l}),Y=$(()=>{let l=0;return s.value.details.forEach(e=>{l+=parseInt(e.jumlah)}),l}),m=l=>s.value.details.length==0?l=="":s.value.details.filter(i=>i.status==l).length==s.value.details.length,K=async()=>{d().loading_full=!0;const{data:l,error:e,status:i}=await k("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{id:h.id},retry:0});if(d().loading_full=!1,i.value==="error"){g().trigger(e);return}s.value=l.value.data,h.is_copy&&(s.value.val=0,s.value.val1=0)},f=C({}),B=C(!1),M=async()=>{if(B.value)return;B.value=!0,d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),s.value.details.forEach(r=>{r.status="INQUIRY_PROCESS"}),B.value=!1},Q=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Update Data Berhasil"}),i.value.details.forEach(r=>{let _=s.value.details.map(N=>N.id).indexOf(r.id);_>-1&&(s.value.details[_].status=r.status,s.value.details[_].failed_reason=r.failed_reason)}),s.value.status="WAIT"},H=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_to_ready",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}j({show:!0,status:"Success",message:"Update Data Berhasil"}),s.value.details.forEach(r=>{r.status="READY"}),s.value.status="OPEN"},J=async(l,e)=>{d().loading_full=!0,f.value={};const i=new FormData;i.append("detail_id",l),i.append("_method","PUT");let c="post";const{data:u,error:r,status:_}=await k("/fin_payment_req_dtl/renew_data",{method:c,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(d().loading_full=!1,_.value==="error"){g().trigger(r,f);return}s.value.details[e].rek_no=u.value.employee_rek_no,s.value.details[e].rek_name=u.value.employee_rek_name,s.value.details[e].bank_code=u.value.employee_bank_code,s.value.details[e].status=u.value.status,s.value.details[e].failed_reason=u.value.failed_reason,j({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"})};ot(()=>h.show,(l,e)=>{l==!0&&(h.id==0&&(s.value={...T}),h.id!=0&&K())},{immediate:!0});const I=C(!1),W=()=>{I.value=!0},G=async(l,e)=>{d().loading_full=!0,f.value={};const i=new FormData;i.append("trx_trp_id",e),i.append("_method","DELETE");let c="post";const{data:u,error:r,status:_}=await k("/fin_payment_req_dtl/delete_data",{method:c,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:i,retry:0});if(d().loading_full=!1,_.value==="error"){g().trigger(r,f);return}s.value.details=s.value.details.filter(N=>N.trx_trp_id!=e)},R=C(!1),S=C(0),X=()=>{R.value=!0,S.value=s.value.batch_no},Z=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("batch_no",S.value),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_batch_no",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}s.value.batch_no=S.value;let r=h.p_data.map(_=>_.id).indexOf(s.value.id);r>-1&&h.p_data.splice(r,1,{...s.value}),R.value=!1,j({show:!0,status:"Success",message:"No Batch Berhasil Diperbaharui"})},tt=async()=>{d().loading_full=!0,f.value={};const l=new FormData;l.append("id",s.value.id),l.append("_method","PUT");let e="post";const{data:i,error:c,status:u}=await k("/fin_payment_req/set_paid_done",{method:e,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:l,retry:0});if(d().loading_full=!1,u.value==="error"){g().trigger(c,f);return}s.value.status="CLOSE",s.value.details.forEach(_=>{_.status="DONE"});let r=h.p_data.map(_=>_.id).indexOf(s.value.id);r>-1&&h.p_data.splice(r,1,{...s.value}),j({show:!0,status:"Success",message:"PAID IS DONE"})};return(l,e)=>{const i=dt,c=ct,u=_t,r=ft,_=pt,N=ht,et=vt;return D(),A(P,null,[p(t("section",wt,[t("div",null,[E(i,{title:"Finance Payment Request",fn:w.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",yt,[t("div",xt,[t("div",bt,[t("div",null,[o(s).status=="CLOSE"?(D(),A("div",gt," Batch No : "+n(o(s).batch_no),1)):F("",!0),p(t("button",{type:"button",name:"button",class:"m-1",disabled:o(s).status=="CLOSE",onClick:e[0]||(e[0]=a=>X())}," Batch No : "+n(o(s).batch_no),9,kt),[[v,m("TRANSFER_PROCESS")&&o(s).status=="WAIT"]]),p(t("button",{type:"button",name:"button",class:"m-1 bg-violet-600 text-white",onClick:e[1]||(e[1]=a=>tt())}," Set Paid Done ",512),[[v,m("TRANSFER_PROCESS")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=a=>W())},[E(c)],512),[[v,m("")||m("READY")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=a=>M())},[E(u)],512),[[v,m("READY")]]),p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=a=>Q())},[E(r)],512),[[v,m("INQUIRY_PROCESS")]])]),t("div",null,[p(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=a=>H())},[E(_)],512),[[v,m("INQUIRY_PROCESS")]])])]),t("div",Et,[t("div",jt,[t("table",St,[t("thead",null,[Ct,t("tr",Dt,[At,Nt,Rt,$t,Bt,It,Pt,Tt,t("th",null,[b("Jumlah "),qt,b(" ("+n(o(y)(o(z)||0))+") ",1)]),t("th",null,[b("Potongan "),Ft,b(" ("+n(o(y)(o(L)))+")",1)]),t("th",null,[b("ExtraMoney "),Ot,b(" ("+n(o(y)(o(V)))+")",1)]),Ut,zt,Lt,t("th",null,[b("Nominal Transfer "),Vt,b(" ("+n(o(y)(o(Y)||0))+")",1)]),Yt,Kt,Mt])]),t("tbody",Qt,[(D(!0),A(P,null,O(o(s).details,(a,q)=>(D(),A("tr",{key:q},[t("td",Ht,[t("div",Jt,n(a.no),1)]),t("td",Wt,[t("div",Gt,n(a.id),1)]),t("td",Xt,[t("div",Zt,[t("div",te,[t("span",ee,n(a.trx_trp_id),1),p(E(N,{onClick:U(st=>G(a.id,a.trx_trp_id),["prevent"]),class:"cursor-pointer text-3xl font-bold p-0 border-l-2 border-red-300"},null,8,["onClick"]),[[v,m("")||m("READY")]])])])]),t("td",se,[t("div",le,n(a.jabatan!="KERNET"?a.tujuan:""),1)]),t("td",ae,[t("div",oe,n(a.jabatan!="KERNET"?a.produk:""),1)]),t("td",ne,[t("div",ie,n(a.jabatan!="KERNET"?a.no_pol:""),1)]),t("td",re,[t("div",ue,n(a.jabatan),1)]),t("td",de,[t("div",ce,n(a.nama),1)]),t("td",_e,[t("div",fe,n(o(y)(a.nominal||0)),1)]),t("td",pe,[t("div",he,n(o(y)(a.potongan_trx_ttl)),1)]),t("td",me,[t("div",ve,n(o(y)(a.extra_money_trx_ttl)),1)]),we,t("td",ye,[t("div",xe,n(a.rek_no),1)]),t("td",be,[t("div",ge,n(a.rek_name),1)]),t("td",ke,[t("div",Ee,n(o(y)(a.jumlah||0)),1)]),t("td",je,[t("div",Se,n(a.status),1)]),t("td",Ce,[t("div",De,[a.status=="INQUIRY_FAILED"?(D(),A("button",{key:0,class:"bg-yellow-400 rounded",onClick:U(st=>J(a.id,q),["prevent"])}," Renew Data ",8,Ae)):F("",!0)])]),t("td",Ne,[t("div",Re,n(a.failed_reason),1)])]))),128))],512)])])])]),t("div",$e,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[6]||(e[6]=a=>w.fnClose())}," Cancel ")])])])],512),[[v,w.show]]),E(et,{show:o(I),fnClose:()=>{I.value=!1},id:o(s).id,onSetKData:e[7]||(e[7]=a=>s.value=a),onSetIsNew:e[8]||(e[8]=a=>{a&&w.p_data.push(o(s))})},null,8,["show","fnClose","id"]),p(t("div",Be,[Ie,p(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>nt(S)?S.value=a:null)},[(D(),A(P,null,O(5,a=>t("option",{value:a-1},n(a-1),9,Pe)),64))],512),[[it,o(S)]]),t("div",Te,[t("button",{type:"button",class:"bg-blue-500 text-white",onClick:e[10]||(e[10]=a=>Z())},"Save"),t("button",{type:"button",class:"bg-yellow-500 text-white ml-2",onClick:e[11]||(e[11]=a=>R.value=!1)},"Cancel")])],512),[[v,o(R)]])],64)}}};export{Qe as default};
