import{_ as V}from"./HeaderPopup.vue.9016828c.js";import{_ as F}from"./client-only.96445a07.js";import{_ as P}from"./WidthMiniList.vue.62fbc21b.js";import{_ as T}from"./InputPointFormat.vue.6d1f77ba.js";import E from"./AttachmentSingle.ffdc8a9e.js";import{r as v,f as K,G as O,j as L,I as U,m as k,J as z,o as S,c as N,a,b as p,k as o,q as Y,t as _,w as G,v as H,x as W,E as Q,A as m,B as C}from"./entry.5c8858ab.js";import"./useUtils.146c08c5.js";import{u as A}from"./useMyFetch.f6def584.js";import"./Times.dfbe592b.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.fbc49bfc.js";import"./PDFJsView.48c17618.js";const R={class:"box-fixed"},X={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Z={class:"w-full flex flex-col items-center grow overflow-auto"},ee={class:"w-full flex flex-row flex-wrap"},te={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ae=a("label",{for:""},"Tipe",-1),le=["disabled"],oe=a("option",{value:"Lainnya"},"Lainnya",-1),ne=a("option",{value:"Kerajinan"},"Kerajinan",-1),se=[oe,ne],ie={class:"text-red-500"},re={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},de=a("label",{for:""},"Tanggal",-1),ue={key:0,class:"card-border"},pe={key:1},_e={class:"text-red-500"},me={class:"w-full sm:w-8/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ce=a("label",{for:""},"Pekerja",-1),ve={class:"text-red-500"},fe={class:"w-full sm:w-6/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ye=a("label",{for:""},"Nominal",-1),we={class:"text-red-500"},he={class:"w-full sm:w-6/12 md:w-full lg:w-full flex flex-col flex-wrap p-1"},ge=a("label",{for:""},"Note",-1),xe=["disabled"],be={class:"text-red-500"},ke={class:"p-1 w-full"},Se={class:"w-full flex items-center justify-end"},Ve={__name:"salary_bonus",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(f){const d=f,{$moment:M}=Q(),D={id:"",tanggal:new Date,type:"Kerajinan",nominal:0,note:"",attachment_1:"",attachment_1_preview:"",attachment_1_type:""},t=v({...D}),h=K("token"),u=v({}),y={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},ktp_no:{tcon:"IconsNumber",text:"No KTP",val:""},sim_no:{tcon:"IconsCreditCard",text:"No SIM",val:""}},id:"",name:"",title:""},i=v(JSON.parse(JSON.stringify(y))),$=v([]),j=async()=>{m().loading_full=!0;const{data:n,error:e,status:r}=await A("/salary_bonus_load_local",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0});if(m().loading_full=!1,r.value==="error"){C().trigger(e);return}$.value=n.value.list_employee},q=O(()=>{let n=[];return $.value.forEach((e,r)=>{let l=JSON.parse(JSON.stringify(y));l._.id.val=e.id,l._.name.val=e.name,l._.ktp_no.val=e.ktp_no,l._.sim_no.val=e.sim_no,l.id=e.id,l.name=e.name,l.title=(e.ktp_no||"")+" "+(e.sim_no||""),n.push(JSON.parse(JSON.stringify(l)))}),n}),B=v([]),I=async()=>{m().loading_full=!0,u.value={};const n=new FormData;n.append("type",t.value.type),n.append("tanggal",t.value.tanggal?M(t.value.tanggal).format("Y-MM-DD"):""),n.append("employee_id",i.value.id),n.append("nominal",t.value.nominal),n.append("note",t.value.note),n.append("attachment_1",t.value.attachment_1),n.append("attachment_1_preview",t.value.attachment_1_preview);let e="post",r=t.value.id;r==""||(n.append("id",r),n.append("_method","PUT"));const{data:l,error:g,status:x}=await A("/salary_bonus",{method:e,headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:n,retry:0});if(m().loading_full=!1,x.value==="error"){C().trigger(g,u);return}if(t.value.employee={name:i.value._.name.val,ktp_no:i.value._.ktp_no.val,sim_no:i.value._.sim_no.val},t.value.attachment_1_type=l.value.attachment_1_type,B.value=l.value.details,r<=0)t.value.id=l.value.id,t.value.created_at=l.value.created_at,t.value.updated_at=l.value.updated_at,d.p_data.unshift(t.value);else{t.value.updated_at=l.value.updated_at;let w=d.p_data.map(b=>b.id).indexOf(r);w>=-1&&d.p_data.splice(w,1,{...t.value})}d.fnClose()},c=O(()=>!!t.value.val1),J=async()=>{m().loading_full=!0;const{data:n,error:e,status:r}=await A("/salary_bonus",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(m().loading_full=!1,r.value==="error"){C().trigger(e);return}d.is_copy&&(t.value.val=0,t.value.val1=0);let l=n.value.data;t.value=l,i.value._.id.val=l.employee.id,i.value._.name.val=l.employee.name,i.value._.ktp_no.val=l.employee.ktp_no,i.value._.sim_no.val=l.employee.sim_no,i.value.id=l.employee.id,i.value.name=l.employee.name,i.value.ktp_no=(l.employee.ktp_no||"")+" "+(l.employee.sim_no||"")};return L(()=>d.show,async(n,e)=>{n==!0&&(await j(),t.value={...D},i.value=JSON.parse(JSON.stringify(y)),B.value=[],u.value={},d.id!=0&&J())},{immediate:!0}),(n,e)=>{const r=V,l=U("vue-date-picker"),g=F,x=P,w=T,b=E;return k((S(),N("section",R,[a("div",null,[p(r,{title:"Form Salary Additional",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),a("form",X,[a("div",Z,[a("div",ee,[a("div",te,[ae,k(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).type=s),disabled:o(c)},se,8,le),[[Y,o(t).type]]),a("p",ie,_(o(u).type),1)]),a("div",re,[de,o(c)?(S(),N("div",ue,_(o(M)(o(t).tanggal).format("DD-MM-Y")),1)):(S(),N("div",pe,[p(g,null,{default:G(()=>[p(l,{modelValue:o(t).tanggal,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).tanggal=s),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])),a("p",_e,_(o(u).tanggal),1)]),a("div",me,[ce,p(x,{arr:o(q),selected:o(i),pure:y,onSetSelected:e[2]||(e[2]=s=>i.value=s),disabled:o(c)},null,8,["arr","selected","disabled"]),a("p",ve,_(o(u).employee_id),1)]),a("div",fe,[ye,a("div",null,[p(w,{class:"w-full h-full p-1",type:"text",value:o(t).nominal||0,onInput:e[3]||(e[3]=s=>o(t).nominal=s),disabled:o(c)},null,8,["value","disabled"])]),a("p",we,_(o(u).nominal),1)]),a("div",he,[ge,a("div",null,[k(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).note=s),disabled:o(c)},null,8,xe),[[H,o(t).note]])]),a("p",be,_(o(u).nominal),1)]),a("div",ke,[p(b,{label:"Attachment",value:o(t).attachment_1_preview,onSetFile:e[5]||(e[5]=s=>o(t).attachment_1=s),onSetPreview:e[6]||(e[6]=s=>o(t).attachment_1_preview=s),can_remove:!0},null,8,["value"])])])]),a("div",Se,[a("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[7]||(e[7]=s=>f.fnClose())}," Cancel "),a("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:e[8]||(e[8]=W(s=>I(),["prevent"]))}," Save ")])])])],512)),[[z,f.show]])}}};export{Ve as default};
