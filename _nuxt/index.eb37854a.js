import{r as s,f as U,g as Oe,h as $e,i as y,C as Te,j as ee,s as je,c as k,b as d,a as i,k as te,v as ze,l,m as ae,n as w,w as D,q as Be,x as _,y as N,o as m,z as I,d as P,t as H,A as Ee,B as R,_ as J}from"./entry.aab07f9f.js";import Ne from"./Header.ca2f02f7.js";import Ie from"./Plus.0489f412.js";import Me from"./Edit.b4d432af.js";import Fe from"./Eyes.9f760706.js";import Ve from"./Delete.5ce407c0.js";import Le from"./DeleteOff.9bb6536a.js";import Ue from"./Signature.f94486d8.js";import He from"./Line.a54bf290.js";import Re from"./Check.acb99e89.js";import Je from"./TableView.c3727f9e.js";import{u as g}from"./useUtils.9fa3f6cd.js";import{u as M}from"./useMyFetch.cb965b1e.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.79709d1f.js";import"./Adjust.69ff5410.js";import"./TableHeaderEye.530bc726.js";import"./Times.b9004b7b.js";import"./ClearAll.9b9ae5da.js";import"./client-only.a1dffc96.js";import"./ClearEach.8dca629a.js";import"./CaretLeftDoubleBold.772c8b01.js";import"./CaretLeftBold.d939b229.js";import"./CaretRightBold.9b39d0d1.js";import"./CaretRightDoubleBold.25a3f3a4.js";const Ye=R(()=>J(()=>import("./PopupMini.41da9559.js"),["./PopupMini.41da9559.js","./PopupMini.vue.064584de.js","./Times.b9004b7b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.aab07f9f.js","./entry.c5f8f180.css","./Exclamation.cfb6ed30.js"],import.meta.url).then(p=>p.default||p)),Ke=R(()=>J(()=>import("./mst.cc38fd45.js"),["./mst.cc38fd45.js","./HeaderPopup.vue.d7e465de.js","./Times.b9004b7b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.aab07f9f.js","./entry.c5f8f180.css","./WidthMiniList.vue.16991579.js","./WidthMiniPart.vue.f3ab5403.js","./InputPointFormat.vue.2f0e98c5.js","./AttachmentSingle.15ff6d93.js","./part.727bee70.js","./Plus.0489f412.js","./Edit.b4d432af.js","./Delete.5ce407c0.js","./Signature.f94486d8.js","./Calculator.a8d383b8.js","./Search.79709d1f.js","./Line.a54bf290.js","./Check.acb99e89.js","./trx.9bbfda32.js","./client-only.a1dffc96.js","./useMyFetch.cb965b1e.js","./trx_validasi.7f7174db.js","./useUtils.9fa3f6cd.js"],import.meta.url).then(p=>p.default||p)),qe=R(()=>J(()=>import("./validasi.e049323f.js"),["./validasi.e049323f.js","./HeaderPopup.vue.d7e465de.js","./Times.b9004b7b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.aab07f9f.js","./entry.c5f8f180.css","./WidthMiniPart.vue.f3ab5403.js","./AttachmentSingle.15ff6d93.js","./useUtils.9fa3f6cd.js","./useMyFetch.cb965b1e.js"],import.meta.url).then(p=>p.default||p)),Ze={class:"w-full h-full flex flex-col"},Ge={class:"w-full flex grow flex-col overflow-auto h-0"},Qe={class:"w-full flex justify-between flex-wrap"},We={class:"grow flex"},Xe={class:"m-1"},et=i("option",{value:"undone"},"Undone",-1),tt=i("option",{value:"done"},"Done",-1),at=i("option",{value:"deleted"},"Trash",-1),lt=i("option",{value:"all"},"All",-1),ot=[et,tt,at,lt],nt={class:"grow mb-5"},st={class:"text-red-500"},rt=i("br",null,null,-1),ut=i("b",{class:"text-green-500"},"Aktifkan Kembali ",-1),Bt={__name:"index",async setup(p){let j,Y;const le=e=>e.deleted==1?"!bg-red-400":e.val>0&&e.val1>0&&e.remaining_cut==0?"!bg-blue-300":"",v=s("undone");U(()=>v.value,e=>{q()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="created_at:desc";const z=Oe("token"),{data:oe}=([j,Y]=$e(async()=>Be(async()=>{let e=[];_().loading_full=!0;const{data:t,error:f,status:h}=await M("/potongan_msts",{method:"get",headers:{Authorization:`Bearer ${z.value}`,Accept:"application/json"},params:{filter_status:v},retry:0});return _().loading_full=!1,h.value==="error"?(N().trigger(f),{potongan_msts:e}):(e=t.value.data,{potongan_msts:e})},{lazy:!0,server:!1,default:()=>({potongan_msts:[]})},"$4H5grU4zhJ")),j=await j,Y(),j),o=s([]);U(()=>{var e;return(e=oe.value)==null?void 0:e.potongan_msts},e=>{e&&(o.value=[...e])},{immediate:!0}),s("");const F=s({field:"created_at",by:"desc"}),a=s(-1),c=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),b=y(()=>o.value[a.value]),ne=()=>{r.like="";let e=JSON.parse(JSON.stringify(_()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,employee_name:%${e}%,no_pol:%${e}%,kejadian:%${e}%,status:%${e}%`),r.sort="",F.value.field&&(r.sort=F.value.field+":"+F.value.by),r.filter_model=JSON.stringify(_()._tv.filter_model)};s(null);const K=async()=>{_().loading_full=!0,c.value.may_get_data=!1,r.page=c.value.page,r.page==1&&(o.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(o.value[0])),r.filter_status=v.value;const{data:e,error:t,status:f}=await M("/potongan_msts",{method:"get",headers:{Authorization:`Bearer ${z.value}`,Accept:"application/json"},params:r,retry:0});if(_().loading_full=!1,c.value.may_get_data=!0,f.value==="error"){N().trigger(t);return}c.value.page==1?o.value=e.value.data:c.value.page>1&&(o.value=[...o.value,...e.value.data]),e.value.data.length==0&&(c.value.is_last_record=!0),_()._tv.filter_box=!1},q=()=>{a.value=-1,c.value.page=1,c.value.is_last_record=!1,ne(),K()};Te();const A=s(!1),B=s(0),C=s(0),S=s(!1),se=()=>{B.value=0,S.value=!1,C.value=!1,A.value=!0},{display:O}=ee();je(ee());const re=()=>{a.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(B.value=o.value[a.value].id,S.value=!1,C.value=!1,A.value=!0)},V=s(!1),Z=s(0),ue=()=>{a.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(Z.value=o.value[a.value].id,S.value=!0,C.value=!1,V.value=!0)},ie=()=>{a.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(B.value=o.value[a.value].id,S.value=!0,C.value=!1,A.value=!0)},L=s(!1),G=s({}),$=s(!1),x=s(""),de=async()=>{$.value&&($.value=!1)},_e=()=>{a.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(x.value="",G.value={id:o.value[a.value].id},$.value=!0)};U(()=>x.value,e=>{e.trim().length>0?L.value=!0:L.value=!1},{immediate:!1});const me=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",o.value[a.value].id),e.append("deleted_reason",x.value),e.append("_method","DELETE");const{data:t,error:f,status:h}=await M("/potongan_mst",{method:"post",headers:{Authorization:`Bearer ${z.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,h.value==="error"){N().trigger(f);return}let u={...o.value[a.value]};u.deleted=t.value.deleted,u.deleted_user=t.value.deleted_user,u.deleted_at=t.value.deleted_at,u.deleted_by=t.value.deleted_by,u.deleted_reason=t.value.deleted_reason,v.value!="all"?o.value.splice(a.value,1):o.value.splice(a.value,1,{...u}),a.value=-1,$.value=!1},ce=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",o.value[a.value].id),e.append("_method","PUT");const{data:t,error:f,status:h}=await M("/potongan_mst_unremove",{method:"post",headers:{Authorization:`Bearer ${z.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,h.value==="error"){N().trigger(f);return}let u={...o.value[a.value]};u.deleted=t.value.deleted,u.deleted_user=t.value.deleted_user,u.deleted_at=t.value.deleted_at,u.deleted_by=t.value.deleted_by,u.deleted_reason=t.value.deleted_reason,v.value!="all"?o.value.splice(a.value,1):o.value.splice(a.value,1,{...u}),a.value=-1,E.value=!1},pe=s([{key:"no",label:"No",isai:!0},{key:"valx",label:"APP",childs:[{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]}]},{key:"id",label:"ID",filter_on:1,type:"number",sort:{priority:1,type:"desc"}},{key:"employee_name",label:"Nama Pekerja",freeze:1,filter_on:1,type:"string"},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"kejadian",label:"Kejadian",filter_on:1,type:"string"},{key:"nominal",label:"Nominal",class:" justify-end",type:"number"},{key:"nominal_cut",label:"Nominal Potongan",class:" justify-end",type:"number"},{key:"remaining_cut",label:"Sisa Potongan",class:" justify-end",type:"number"},{key:"status",label:"Status",class:" justify-end",type:"number"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]);y(()=>a.value>-1&&[void 0,0].indexOf(b.value.deleted)>-1&&g().checkPermission("potongan_mst.create"));const ve=y(()=>["undone","done","deleted","all"].indexOf(v.value)>-1&&g().checkPermission("potongan_mst.create")),fe=y(()=>a.value>-1&&g().checkPermission("potongan_mst.view")),ye=y(()=>a.value>-1&&[void 0,0].indexOf(b.value.deleted)>-1&&g().checkPermissions(["potongan_mst.modify","potongan_trx.create","potongan_trx.modify","potongan_trx.remove"])),ge=y(()=>a.value>-1&&[void 0,0].indexOf(b.value.deleted)>-1&&(g().checkPermission("potongan_mst.val")&&[void 0,0].indexOf(b.value.val)>-1||g().checkPermission("potongan_mst.val1")&&[void 0,0].indexOf(b.value.val1)>-1)),be=y(()=>a.value>-1&&g().checkPermission("potongan_mst.remove")&&[void 0,0].indexOf(b.value.deleted)>-1),he=y(()=>a.value>-1&&g().checkPermission("potongan_mst.unremove")&&[1].indexOf(b.value.deleted)>-1),E=s(!1),ke=()=>{a.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):E.value=!0};return(e,t)=>{const f=Ne,h=Ie,u=Me,xe=Fe,we=Ve,De=Le,Pe=Ue,Q=He,W=Re,Ae=Je,X=Ye,Ce=Ke,Se=qe;return m(),k("div",Ze,[d(f,{title:"List Potongan"}),i("div",Ge,[i("div",Qe,[i("div",We,[i("div",Xe,[te(i("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=n=>ae(v)?v.value=n:null)},ot,512),[[ze,l(v)]])]),l(ve)?(m(),k("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=n=>se())},[d(h)])):w("",!0),l(ye)?(m(),k("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=n=>re())},[d(u)])):w("",!0),l(fe)?(m(),k("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=n=>ie())},[d(xe)])):w("",!0),l(be)?(m(),k("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=n=>_e())},[d(we)])):w("",!0),l(he)?(m(),k("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[5]||(t[5]=n=>ke())},[d(De)])):w("",!0),l(ge)?(m(),k("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[6]||(t[6]=n=>ue())},[d(Pe)])):w("",!0)])]),d(Ae,{thead:l(pe),selected:l(a),onSetSelected:t[7]||(t[7]=n=>a.value=n),tbody:l(o),fnCallData:K,scrolling:l(c),onSetScrollingPage:t[8]||(t[8]=n=>l(c).page=n),onDoFilter:t[9]||(t[9]=n=>q()),rowBgColor:le},{val:D(({item:n})=>[n.val?(m(),I(W,{key:1})):(m(),I(Q,{key:0}))]),val1:D(({item:n})=>[n.val1?(m(),I(W,{key:1})):(m(),I(Q,{key:0}))]),employee_name:D(({item:n})=>{var T;return[P(H((T=n.employee)==null?void 0:T.name),1)]}),deleted_by_username:D(({item:n})=>{var T;return[P(H((T=n.deleted_by)==null?void 0:T.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),d(X,{type:"delete",show:l($),data:l(G),fnClose:de,fnConfirm:me,enabledOk:l(L)},{footer:D(()=>[P(" Masukkan Alasan Penghapusan: "),i("div",nt,[te(i("textarea",{"onUpdate:modelValue":t[10]||(t[10]=n=>ae(x)?x.value=n:null)},null,512),[[Ee,l(x)]])])]),_:1},8,["show","data","enabledOk"]),d(X,{type:"custome",show:l(E),fnClose:()=>E.value=!1,fnConfirm:ce},{words:D(()=>[P(" Alasan hapus Sebelumnya : "),i("b",st,H(l(o)[l(a)].deleted_reason),1),P(". "),rt,ut,P(" , yakin untuk melanjutkan ? ")]),_:1},8,["show","fnClose"]),d(Ce,{show:l(A),fnClose:()=>{A.value=!1},id:l(B),p_data:l(o),is_copy:l(C),is_view:l(S)},null,8,["show","fnClose","id","p_data","is_copy","is_view"]),d(Se,{show:l(V),fnClose:()=>{V.value=!1},id:l(Z),p_data:l(o)},null,8,["show","fnClose","id","p_data"])])}}};export{Bt as default};
