import{_ as re}from"./Header.cf358cbb.js";import{_ as ee}from"./Plus.3bff62e3.js";import{_ as de}from"./Edit.c94d7655.js";import{_ as ce}from"./Eyes.0b113b85.js";import{_ as _e}from"./Delete.52c6b88f.js";import{_ as pe}from"./Search.8d56bd99.js";import{_ as fe}from"./PopupMini.vue.8890bc1b.js";import{_ as ve}from"./HeaderPopup.vue.00b960d2.js";import{_ as me}from"./InputPointFormat.vue.c3ca39ba.js";import{_ as he,a as we}from"./ToolsPopup.4de81985.js";import{r as c,u as te,R as ye,g as xe,o as _,c as y,n as I,v as ge,a as e,b,x as t,s as E,t as g,y as Z,M as F,F as O,A as le,B as G,T as J,z as se,D as j,E as L,p as be,e as $e,K as ke,I as je,N as W,O as Ce,q as Ae,L as Se,U as De,C as Te}from"./entry.5974d7e2.js";import{u as N}from"./useMyFetch.688def5e.js";import{_ as Ie}from"./_plugin-vue_export-helper.c27b6911.js";import{u as Be}from"./useUtils.100f5b4a.js";import"./Times.8b3c5c72.js";const C=A=>(be("data-v-9b72f248"),A=A(),$e(),A),Ue={class:"box-fixed"},qe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Fe={class:"w-full flex flex-col items-center justify-center grow overflow-auto"},Me={class:"w-full flex flex-row flex-wrap"},Ve={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Pe=C(()=>e("label",{for:""},"To",-1)),He={class:"text-red-500"},Le={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ne=C(()=>e("label",{for:""},"Tipe",-1)),Re={class:"text-red-500"},ze={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ee=C(()=>e("label",{for:""},"Jenis",-1)),Oe=C(()=>e("option",{value:"CPO"},"CPO",-1)),Je=C(()=>e("option",{value:"TBS"},"TBS",-1)),Ke=[Oe,Je],Ye={class:"text-red-500"},Qe={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Xe=C(()=>e("label",{for:""},"Harga",-1)),Ze={class:"text-red-500"},Ge={class:"w-full flex grow p-1 overflow-auto"},We={role:"sticky",ref:"loadRef"},et={class:"tacky w-full",style:{"white-space":"normal"}},tt={class:"sticky top-0 !z-[2]"},lt={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},st=C(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1)),ot=C(()=>e("th",null,"Desc",-1)),at=C(()=>e("th",{class:"min-w-[100px] !w-[100px] max-w-[100px]"},"Harga @",-1)),nt=C(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"Qty",-1)),ut={ref:"to_move"},it=["data-index"],rt={key:0,class:"tools cell"},dt={class:"w-full h-full flex items-center justify-center"},ct=["onClick"],_t={key:1,class:"cell"},pt={class:"w-full h-full flex items-center justify-center"},ft=["disabled","onUpdate:modelValue"],vt={class:"w-full h-full flex items-center justify-center"},mt={class:"w-full h-full flex items-center justify-center"},ht={key:0},wt={class:"tools cell"},yt={class:"w-full flex items-center justify-end"},xt={__name:"ujalan",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(A){const m=A,M={id:-1,xto:"",tipe:"",jenis:"",harga:0,details:[]},n=c({...M}),R=te("token"),u=c({}),i=c([]),V=c({ordinal:0,id:-1,xdesc:"",qty:1,harga:0,p_status:""}),f=async()=>{j().loading_full=!0,u.value={};const s=new FormData;s.append("xto",n.value.xto),s.append("tipe",n.value.tipe),s.append("jenis",n.value.jenis),s.append("harga",n.value.harga),s.append("details",JSON.stringify(i.value));let l="post",D=m.id;D==0||(s.append("id",D),s.append("_method","PUT"));const{data:v,error:P,status:q}=await N("/ujalan",{method:l,headers:{Authorization:`Bearer ${R.value}`,Accept:"application/json"},body:s,retry:0});if(j().loading_full=!1,q.value==="error"){L().trigger(P,u);return}if(m.id<=0)n.value.id=v.value.id,n.value.created_at=v.value.created_at,n.value.updated_at=v.value.updated_at,m.p_data.unshift(n.value);else{n.value.updated_at=v.value.updated_at;let k=m.p_data.map(a=>a.id).indexOf(m.id);k>=-1&&m.p_data.splice(k,1,{...n.value})}m.fnClose()},o=c(-1),x=c(!1),h=c({left:0,top:0}),w=(s,l)=>{o.value=l,x.value=!0,h.value={left:s.clientX,top:s.clientY}},K=()=>{i.value.push({...V.value,p_status:"Add"})},U=()=>{x.value=!1},z=(s="")=>{if(s=="insert")i.value.splice(o.value,0,{...V.value,p_status:"Add"});else if(s=="delete")i.value[o.value].p_status=="Edit"?i.value[o.value].p_status="Remove":i.value.splice(o.value,1);else if(s=="move_top"){let l=i.value[o.value];i.value.splice(o.value,1),i.value.splice(o.value-1,0,{...l})}else if(s=="move_bottom"){let l=i.value[o.value];i.value.splice(o.value,1),i.value.splice(o.value+1,0,{...l})}x.value=!1},$=ye(()=>!1),Y=async()=>{j().loading_full=!0;const{data:s,error:l,status:D}=await N("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${R.value}`,Accept:"application/json"},params:{id:m.id},retry:0});if(j().loading_full=!1,D.value==="error"){L().trigger(l);return}n.value=s.value.data,i.value=s.value.data.details.map(v=>(v.p_status="Edit",v.key=v.ordinal,v))};return xe(()=>m.show,(s,l)=>{s==!0&&(n.value={...M},i.value=[],m.id!=0&&Y())},{immediate:!0}),(s,l)=>{const D=ve,v=me,P=he,q=ee,k=we;return _(),y(O,null,[I(e("section",Ue,[e("div",null,[b(D,{title:"Form Ujalan",fn:A.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",qe,[e("div",Fe,[e("div",Me,[e("div",Ve,[Pe,I(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>t(n).xto=a)},null,512),[[E,t(n).xto]]),e("p",He,g(t(u).xto),1)]),e("div",Le,[Ne,I(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=a=>t(n).tipe=a)},null,512),[[E,t(n).tipe]]),e("p",Re,g(t(u).tipe),1)]),e("div",ze,[Ee,I(e("select",{"onUpdate:modelValue":l[2]||(l[2]=a=>t(n).jenis=a)},Ke,512),[[Z,t(n).jenis]]),e("p",Ye,g(t(u).jenis),1)]),e("div",Qe,[Xe,e("div",null,[b(v,{class:"w-full h-full p-1",type:"text",value:t(n).harga||0,onInput:l[3]||(l[3]=a=>t(n).harga=a)},null,8,["value"])]),e("p",Ze,g(t(u).harga),1)])]),e("div",Ge,[e("div",We,[e("table",et,[e("thead",null,[e("tr",tt,[t($)?F("",!0):(_(),y("th",lt)),st,ot,at,nt])]),e("tbody",ut,[(_(!0),y(O,null,le(t(i),(a,T)=>(_(),y(O,{key:T},[a.p_status!="Remove"?(_(),y("tr",{key:0,"data-index":T},[t($)?F("",!0):(_(),y("td",rt,[e("div",dt,[e("button",{type:"button",name:"button",onClick:S=>w(S,T)},[b(P)],8,ct)])])),e("td",null,g(T+1)+".",1),t($)?F("",!0):(_(),y("td",_t,[e("div",pt,[I(e("textarea",{disabled:t($),class:"p-1 w-full","onUpdate:modelValue":S=>a.xdesc=S,cols:"7",rows:"2"},null,8,ft),[[E,a.xdesc]])])])),e("td",{class:G(["cell bold",t($)?"unselectable":""])},[e("div",vt,[(_(),J(v,{key:T,class:"w-full h-full p-1",type:"text",value:a.harga||0,onInput:S=>a.harga=S},null,8,["value","onInput"]))])],2),e("td",{class:G(["cell",t($)?"unselectable":""])},[e("div",mt,[(_(),J(v,{key:T,class:"w-full h-full p-1",type:"text",value:a.qty||0,onInput:S=>a.qty=S},null,8,["value","onInput"]))])],2)],8,it)):F("",!0)],64))),128)),t($)?F("",!0):(_(),y("tr",ht,[e("td",wt,[e("button",{type:"button",name:"button",onClick:l[4]||(l[4]=a=>K())},[b(q)])])]))],512)])],512)])]),e("div",yt,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[5]||(l[5]=a=>A.fnClose())}," Cancel "),t($)?F("",!0):(_(),y("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[6]||(l[6]=se(a=>f(),["prevent"]))}," Save "))])])])],512),[[ge,A.show]]),b(k,{show:t(x),coor:t(h),fn:U,data:t(i),data_index:t(o),onReplyAct:l[7]||(l[7]=a=>z(a))},null,8,["show","coor","data","data_index"])],64)}}},gt=Ie(xt,[["__scopeId","data-v-9b72f248"]]),bt={class:"w-full h-full flex flex-col"},$t={class:"w-full flex grow flex-col overflow-auto h-0"},kt={class:"w-full flex"},jt={action:"#",class:"w-full flex p-1"},Ct={class:"grow"},At=e("div",{class:"font-bold"}," Keyword ",-1),St={class:"pl-1"},Dt=e("div",{class:"font-bold"}," Sort By ",-1),Tt=De('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),It=[Tt],Bt={class:"pl-1"},Ut=e("div",{class:"font-bold"}," Sort Order ",-1),qt=e("option",{value:"asc"},"Asc",-1),Ft=e("option",{value:"desc"},"Desc",-1),Mt=[qt,Ft],Vt={class:"flex items-end pl-1"},Pt={class:"w-full flex justify-center items-center grow h-0 p-1"},Ht={key:0,class:""},Lt={class:"tacky"},Nt=e("thead",null,[e("tr",{class:"sticky top-0 !z-[2]"},[e("th",null,"ID"),e("th",null,"To"),e("th",null,"Tipe"),e("th",null,"Jenis"),e("th",null,"Harga"),e("th",null,"Created At"),e("th",null,"Updated At")])],-1),Rt=["onClick"],zt={class:"bold"},nl={__name:"index",async setup(A){let m,M;const{$moment:n}=Te(),{pointFormat:R}=Be(),u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="created_at:desc";const i=te("token"),{data:V}=([m,M]=ke(async()=>Se(async()=>{j().loading_full=!0;const{data:p,error:r,status:B}=await N("/ujalan",{method:"get",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},params:u,retry:0});if(j().loading_full=!1,B.value==="error")return L().trigger(r),[];let H=p.value.data,Q=p.value.request_notif;return{ujalans:H,request_notif:Q}},"$SN3C927rLk")),m=await m,M(),m),f=c(V.value.ujalans);c(V.value.request_notif);const o=c(""),x=c({field:"created_at",by:"desc"}),h=c(-1),w=c({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),K=()=>{u.like="",o.value!=""&&(u.like=`id:%${o.value}%,warehouse_name:%${o.value}%,warehouse_source_name:%${o.value}%,warehouse_target_name:%${o.value}%,item_name:%${o.value}%,status:%${o.value}%,type:%${o.value}%`),u.sort="",x.value.field&&(u.sort=x.value.field+":"+x.value.by)},U=c(null),z=async()=>{j().loading_full=!0,w.value.may_get_data=!1,u.page=w.value.page,u.page==1&&(f.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(f.value[0]));const{data:p,error:r,status:B}=await N("/ujalan",{method:"get",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},params:u,retry:0});if(j().loading_full=!1,w.value.may_get_data=!0,B.value==="error"){L().trigger(r);return}w.value.page==1?(f.value=p.value.data,U.value&&(U.value.scrollTop=0)):w.value.page>1&&(f.value=[...f.value,...p.value.data]),p.value.data.length==0&&(w.value.is_last_record=!0)},$=async()=>{if(!w.value.may_get_data)return;let p=U.value;if(p.scrollLeft!=w.value.scrollLeft){w.value.scrollLeft=p.scrollLeft;return}w.value.is_last_record||!(Math.round(p.scrollTop)+p.clientHeight>=p.scrollHeight-1)||(w.value.page++,await z())},Y=()=>{w.value.page=1,w.value.is_last_record=!1,K(),z()};je();const s=c(!1),l=c(0),D=()=>{l.value=0,s.value=!0},{display:v}=W();Ce(W());const P=()=>{h.value==-1?v({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(l.value=f.value[h.value].id,s.value=!0)},q=c({}),k=c(!1),a=async()=>{k.value&&(k.value=!1)},T=()=>{h.value==-1?v({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(q.value={id:f.value[h.value].id},k.value=!0)},S=async()=>{j().loading_full=!0;const p=new FormData;p.append("id",f.value[h.value].id),p.append("_method","DELETE");const{data:r,error:B,status:H}=await N("/ujalan",{method:"post",headers:{Authorization:`Bearer ${i.value}`,Accept:"application/json"},body:p,retry:0});if(j().loading_full=!1,H.value==="error"){L().trigger(B);return}f.value.splice(h.value,1),h.value=-1,k.value=!1};return(p,r)=>{const B=re,H=ee,Q=de,oe=ce,ae=_e,ne=pe,ue=fe,ie=gt;return _(),y("div",bt,[b(B,{title:"List Ujalan"}),e("div",$t,[e("div",kt,[e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[0]||(r[0]=d=>D())},[b(H)]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[1]||(r[1]=d=>P())},[t(h)==-1||t(f)[t(h)].ref_id==null&&t(f)[t(h)].confirmed_by==null?(_(),J(Q,{key:0})):(_(),J(oe,{key:1}))]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:r[2]||(r[2]=d=>T())},[b(ae)])]),e("form",jt,[e("div",Ct,[At,I(e("input",{class:"",type:"text","onUpdate:modelValue":r[3]||(r[3]=d=>Ae(o)?o.value=d:null),name:"search",placeholder:"Keyword"},null,512),[[E,t(o)]])]),e("div",St,[Dt,I(e("select",{class:"","onUpdate:modelValue":r[4]||(r[4]=d=>t(x).field=d)},It,512),[[Z,t(x).field]])]),e("div",Bt,[Ut,I(e("select",{class:"","onUpdate:modelValue":r[5]||(r[5]=d=>t(x).by=d)},Mt,512),[[Z,t(x).by]])]),e("div",Vt,[e("button",{class:"",type:"submit",name:"button",onClick:r[6]||(r[6]=se(d=>Y(),["prevent"]))},[b(ne,{class:"text-2xl"})])])]),e("div",Pt,[t(f).length==0?(_(),y("div",Ht," Maaf Tidak Ada Record ")):(_(),y("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:U,onScroll:$},[e("table",Lt,[Nt,e("tbody",null,[(_(!0),y(O,null,le(t(f),(d,X)=>(_(),y("tr",{key:X,onClick:Et=>h.value=X,class:G(t(h)==X?"active":"")},[e("td",zt,g(d.id),1),e("td",null,g(d.xto),1),e("td",null,g(d.tipe),1),e("td",null,g(d.jenis),1),e("td",null,g(t(R)(d.harga)),1),e("td",null,g(d.created_at?t(n)(d.created_at).format("DD-MM-Y HH:mm:ss"):""),1),e("td",null,g(d.updated_at?t(n)(d.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Rt))),128))])])],544))])]),b(ue,{type:"delete",show:t(k),data:t(q),fnClose:a,fnConfirm:S},null,8,["show","data"]),b(ie,{show:t(s),fnClose:()=>{s.value=!1},id:t(l),p_data:t(f)},null,8,["show","fnClose","id","p_data"])])}}};export{nl as default};
