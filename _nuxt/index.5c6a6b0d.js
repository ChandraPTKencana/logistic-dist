import Ce from"./Header.92bef80d.js";import Pe from"./Copy.bb6cb195.js";import Se from"./Plus.ea561277.js";import Oe from"./Edit.36eb429e.js";import $e from"./Eyes.07c4a6cc.js";import Ae from"./Delete.6eab903e.js";import Te from"./Signature.4bfdbcdf.js";import Be from"./SignatureOff.9c7f3e7e.js";import Ie from"./Line.9a204fd8.js";import Fe from"./Check.d18969bc.js";import Me from"./TableView.3594f19b.js";import{_ as Ne}from"./PopupMini.vue.19be3733.js";import Ue from"./ujalan.c065449b.js";import He from"./ujalan_validasi.6e7740c0.js";import{r as s,f as Y,g as Ve,h as Ee,i as g,j as q,s as ze,x as m,c as y,b as u,a as _,k as Z,v as Le,l,m as G,n as h,w as A,q as Je,y as N,o as i,z as T,d as Q,t as Re,A as Ke}from"./entry.d64aed09.js";import{u as c}from"./useUtils.a58b009f.js";import{u as U}from"./useMyFetch.fbe83a0e.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.373b54b5.js";import"./Adjust.43de922d.js";import"./TableHeaderEye.b1b571c7.js";import"./Times.0d81c238.js";import"./ClearAll.3f6088cb.js";import"./client-only.0c7cff59.js";import"./ClearEach.fe87d82f.js";import"./CaretLeftDoubleBold.19582455.js";import"./CaretLeftBold.41b55a87.js";import"./CaretRightBold.055c5ef9.js";import"./CaretRightDoubleBold.dc06bb55.js";import"./Exclamation.860e7697.js";import"./HeaderPopup.vue.c1f6249c.js";import"./Tools.cfa67a64.js";import"./InputPointFormat.vue.bb30d1be.js";import"./ToolsPopup.9283154a.js";import"./ac_accs.9cb78554.js";const Ye={class:"w-full h-full flex flex-col"},qe={class:"w-full flex grow flex-col overflow-auto h-0"},Ze={class:"w-full flex justify-between flex-wrap"},Ge={class:"grow flex"},Qe={class:"m-1"},We=_("option",{value:"available"},"Available",-1),Xe=_("option",{value:"unapprove"},"Unapprove",-1),et=_("option",{value:"deleted"},"Trash",-1),tt=_("option",{value:"all"},"All",-1),at=[We,Xe,et,tt],lt={class:"grow mb-5"},Vt={__name:"index",async setup(ot){let S,H;const W=t=>t.deleted==1?"!bg-red-400":t.val==0||t.val1==0?"!bg-gray-300":"",f=s("available");Y(()=>f.value,t=>{z()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const V=s({}),B=Ve("token"),{data:X}=([S,H]=Ee(async()=>Je(async()=>{m().loading_full=!0;let t=[];const[e,j]=await Promise.all([U("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{filter_status:f},retry:0})]);return e.status.value!=="error"&&(t=e.data.value.data),e.status.value==="error"?(N().trigger(e.error),{ujalans:t}):(m().loading_full=!1,{ujalans:t})},"$SN3C927rLk")),S=await S,H(),S),n=s(X.value.ujalans||[]),I=s({field:"tanggal",by:"desc"}),a=s(-1),d=g(()=>n.value[a.value]),v=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ee=()=>{r.like="";let t=JSON.parse(JSON.stringify(m()._tv.global_keyword));t!=""&&(r.like=`id:%${t}%,xto:%${t}%,tipe:%${t}%,jenis:%${t}%,harga:%${t}%`),r.sort="",I.value.field&&(r.sort=I.value.field+":"+I.value.by),r.filter_model=JSON.stringify(m()._tv.filter_model)},E=async()=>{m().loading_full=!0,V.value={},v.value.may_get_data=!1,r.page=v.value.page,r.page==1&&(n.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(n.value[0])),r.filter_status=f.value;const{data:t,error:e,status:j}=await U("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:r,retry:0});if(m().loading_full=!1,v.value.may_get_data=!0,j.value==="error"){N().trigger(e,V);return}v.value.page==1?n.value=t.value.data:v.value.page>1&&(n.value=[...n.value,...t.value.data]),t.value.data.length==0&&(v.value.is_last_record=!0),m()._tv.filter_box=!1},z=()=>{a.value=-1,v.value.page=1,v.value.is_last_record=!1,ee(),E()},D=s(!1),O=s(0),b=s(0),k=s(-1),te=()=>{O.value=0,k.value=-1,b.value=!1,D.value=!0},{display:x}=q();ze(q());const ae=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(O.value=n.value[a.value].id,k.value=-1,b.value=!1,D.value=!0)},le=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(O.value=n.value[a.value].id,k.value=-1,b.value=!0,D.value=!0)},C=s(!1),$=s(0),oe=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):($.value=n.value[a.value].id,k.value=1,b.value=!1,C.value=!0)},ne=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):($.value=n.value[a.value].id,k.value=0,b.value=!1,C.value=!0)},se=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):($.value=n.value[a.value].id,b.value=!1,k.value=-1,C.value=!0)},F=s(!1),L=s({}),P=s(!1),w=s(""),re=async()=>{P.value&&(P.value=!1)},ue=()=>{a.value==-1?x({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value="",L.value={id:n.value[a.value].id,tujuan:n.value[a.value].xto},P.value=!0)};Y(()=>w.value,t=>{t.trim().length>0?F.value=!0:F.value=!1},{immediate:!1});const ie=async()=>{m().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",w.value),t.append("_method","DELETE");const{data:e,error:j,status:M}=await U("/ujalan",{method:"post",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,M.value==="error"){N().trigger(j);return}let p={...n.value[a.value]};p.deleted=e.value.deleted,p.deleted_user=e.value.deleted_user,p.deleted_at=e.value.deleted_at,p.deleted_by=e.value.deleted_by,p.deleted_reason=e.value.deleted_reason,f.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...p}),a.value=-1,P.value=!1},de=s([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"asst_opt",label:"Info",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:m().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),_e=g(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&c().checkPermission("ujalan.create")),ve=g(()=>["available","all","unapprove"].indexOf(f.value)>-1&&c().checkPermission("ujalan.create")),me=g(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&(c().checkPermission("ujalan.val")&&[void 0,0].indexOf(d.value.val)>-1||c().checkPermission("ujalan.val1")&&[void 0,0].indexOf(d.value.val1)>-1)&&c().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),ce=g(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&(c().checkPermission("ujalan.val")&&[void 0,0].indexOf(d.value.val)>-1||c().checkPermission("ujalan.val1")&&[void 0,0].indexOf(d.value.val1)>-1)),fe=g(()=>a.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&(c().checkPermission("ujalan.unval")&&[1].indexOf(d.value.val)>-1||c().checkPermission("ujalan.unval1")&&[1].indexOf(d.value.val1)>-1)),pe=g(()=>a.value>-1&&c().checkPermission("ujalan.remove")&&[void 0,0].indexOf(d.value.deleted)>-1);return(t,e)=>{const j=Ce,M=Pe,p=Se,ye=Oe,be=$e,ke=Ae,ge=Te,he=Be,J=Ie,R=Fe,xe=Me,we=Ne,je=Ue,De=He;return i(),y("div",Ye,[u(j,{title:"List Ujalan"}),_("div",qe,[_("div",Ze,[_("div",Ge,[_("div",Qe,[Z(_("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>G(f)?f.value=o:null)},at,512),[[Le,l(f)]])]),l(_e)?(i(),y("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>le())},[u(M)])):h("",!0),l(ve)?(i(),y("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>te())},[u(p)])):h("",!0),l(me)?(i(),y("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>ae())},[u(ye)])):h("",!0),l(a)>-1?(i(),y("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>se())},[u(be)])):h("",!0),l(pe)?(i(),y("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>ue())},[u(ke)])):h("",!0),l(ce)?(i(),y("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>oe())},[u(ge)])):h("",!0),l(fe)?(i(),y("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>ne())},[u(he)])):h("",!0)])]),u(xe,{thead:l(de),selected:l(a),onSetSelected:e[8]||(e[8]=o=>a.value=o),tbody:l(n),fnCallData:E,scrolling:l(v),onSetScrollingPage:e[9]||(e[9]=o=>l(v).page=o),onDoFilter:e[10]||(e[10]=o=>z()),rowBgColor:W},{val:A(({item:o})=>[o.val?(i(),T(R,{key:1})):(i(),T(J,{key:0}))]),val1:A(({item:o})=>[o.val1?(i(),T(R,{key:1})):(i(),T(J,{key:0}))]),deleted_by_username:A(({item:o})=>{var K;return[Q(Re((K=o.deleted_by)==null?void 0:K.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),u(we,{type:"delete",show:l(P),data:l(L),fnClose:re,fnConfirm:ie,enabledOk:l(F)},{footer:A(()=>[Q(" Masukkan Alasan Penghapusan: "),_("div",lt,[Z(_("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>G(w)?w.value=o:null)},null,512),[[Ke,l(w)]])])]),_:1},8,["show","data","enabledOk"]),u(je,{show:l(D),fnClose:()=>{D.value=!1},id:l(O),p_data:l(n),is_copy:l(b)},null,8,["show","fnClose","id","p_data","is_copy"]),u(De,{show:l(C),fnClose:()=>{C.value=!1},id:l($),p_data:l(n),it_state:l(k)},null,8,["show","fnClose","id","p_data","it_state"])])}}};export{Vt as default};
