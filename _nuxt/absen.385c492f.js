import de from"./Header.f0cd6036.js";import ue from"./Edit.a0a1d9df.js";import pe from"./Eyes.2d5bdde5.js";import me from"./Signature.a1e71ee3.js";import fe from"./Line.fd68db2c.js";import ce from"./Check.915cf02f.js";import ve from"./TableView.a18cfa94.js";import ye from"./trx_trp_absen.0d281e36.js";import be from"./trx_trp_absen_validasi.10454553.js";import ke from"./trx_absen.2be0860f.js";import{r as s,j as ge,f as xe,g as we,G as h,i as he,c as D,b as d,a as y,m as De,q as Se,k as l,n as $e,l as O,w as b,z as Ae,A as p,B as V,o as _,D as f,d as R,t as z,H as Te,E as qe}from"./entry.e212c805.js";import{u as E}from"./useMyFetch.f4b08708.js";import{u as Y}from"./useUtils.80394a87.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.cd51d8fb.js";import"./Adjust.22149529.js";import"./TableHeaderEye.16236a92.js";import"./Times.7f466a98.js";import"./ClearAll.1c609c7d.js";import"./client-only.2334d4d0.js";import"./ClearEach.de3c1258.js";import"./CaretLeftDoubleBold.dd693cd9.js";import"./CaretLeftBold.a9fe22ac.js";import"./CaretRightBold.c7c1d0b7.js";import"./CaretRightDoubleBold.6f27df9c.js";import"./HeaderPopup.vue.13746444.js";import"./AttachmentSingle.c7eb3c10.js";import"./PDFJsView.9b8635f9.js";import"./CaretTop.4d1b0913.js";import"./CaretDown.5063067e.js";import"./PopupMini.vue.401c0c8f.js";import"./Exclamation.95312a4e.js";const Ce={class:"w-full h-full flex flex-col"},Me={class:"w-full flex grow flex-col overflow-auto h-0"},Oe={class:"w-full flex justify-between flex-wrap"},Ye={class:"grow flex"},Ne={class:"m-1"},Pe=Te('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Be=[Pe],vt={__name:"absen",async setup(He){let k,N;const{$moment:P}=qe(),K=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.ritase_val2==1?"!bg-blue-300":"",S=e=>(e.map(t=>{t.class_h=K(t)}),e),m=s("Undone");ge(()=>m.value,e=>{J.value.map(t=>{let u=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?u&&(t.tbl_show=1):u&&(t.tbl_show=0),t}),j()},{immediate:!1});const o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const B=s({}),g=s({from:"",to:""}),H=xe("token"),{data:L}=([k,N]=we(async()=>Ae(async()=>{p().loading_full=!0;let e=[];const[t,u]=await Promise.all([E("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${H.value}`,Accept:"application/json"},params:{filter_status:m},retry:0})]);return t.status.value!=="error"&&(e=S(t.data.value.data)),t.status.value==="error"?(V().trigger(t.error),{trx_trps:e}):(p().loading_full=!1,{trx_trps:e})},"$Tkqpaz2JeJ")),k=await k,N(),k),n=s(L.value.trx_trps||[]);s([]),s(!1);const $=s({field:"tanggal",by:"desc"}),r=s(-1),c=h(()=>n.value[r.value]),i=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),G=()=>{o.like="";let e=JSON.parse(JSON.stringify(p()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),o.sort="",$.value.field&&(o.sort=$.value.field+":"+$.value.by),o.date_from=g.value.from?P(g.value.from).format("YYYY-MM-DD"):"",o.date_to=g.value.to?P(g.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(p()._tv.filter_model)},U=async()=>{p().loading_full=!0,B.value={},i.value.may_get_data=!1,o.page=i.value.page,o.page==1&&(n.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(n.value[0])),o.filter_status=m.value;const{data:e,error:t,status:u}=await E("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${H.value}`,Accept:"application/json"},params:o,retry:0});if(p().loading_full=!1,i.value.may_get_data=!0,u.value==="error"){V().trigger(t,B);return}i.value.page==1?n.value=S(e.value.data):i.value.page>1&&(n.value=[...n.value,...S(e.value.data)]),e.value.data.length==0&&(i.value.is_last_record=!0),p()._tv.filter_box=!1},j=()=>{r.value=-1,i.value.page=1,i.value.is_last_record=!1,G(),U()},A=s(!1),F=s(0),{display:T}=he(),Z=()=>{r.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(F.value=n.value[r.value].id,A.value=!0)},x=s(!1),w=s(0),q=s(!1),Q=()=>{r.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=n.value[r.value].id,x.value=!0,q.value=!1)},W=()=>{r.value==-1?T({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(w.value=n.value[r.value].id,x.value=!0,q.value=!0)},I=s(!1),X=s(0),J=s([{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ee=h(()=>r.value>-1&&Y().checkPermission("trp_trx.absen.view")),te=h(()=>r.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&[void 0,0].indexOf(c.value.ritase_val)>-1&&Y().checkPermission("trp_trx.absen.modify")),ae=h(()=>r.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&Y().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1","trp_trx.absen.val2"]));return(e,t)=>{const u=de,le=ue,oe=pe,se=me,C=fe,M=ce,re=ve,ne=ye,ie=be,_e=ke;return _(),D("div",Ce,[d(u,{title:"List Transaction"}),y("div",Me,[y("div",Oe,[y("div",Ye,[y("div",Ne,[De(y("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=a=>$e(m)?m.value=a:null)},Be,512),[[Se,l(m)]])]),l(te)?(_(),D("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>Z())},[d(le)])):O("",!0),l(ee)?(_(),D("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>W())},[d(oe)])):O("",!0),l(ae)?(_(),D("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>Q())},[d(se)])):O("",!0)])]),d(re,{thead:l(J),selected:l(r),onSetSelected:t[4]||(t[4]=a=>r.value=a),tbody:l(n),fnCallData:U,scrolling:l(i),onSetScrollingPage:t[5]||(t[5]=a=>l(i).page=a),onDoFilter:t[6]||(t[6]=a=>j())},{ritase_val:b(({item:a})=>[a.ritase_val?(_(),f(M,{key:1})):(_(),f(C,{key:0}))]),ritase_val1:b(({item:a})=>[a.ritase_val1?(_(),f(M,{key:1})):(_(),f(C,{key:0}))]),ritase_val2:b(({item:a})=>[a.ritase_val2?(_(),f(M,{key:1})):(_(),f(C,{key:0}))]),deleted_by_username:b(({item:a})=>{var v;return[R(z((v=a.deleted_by)==null?void 0:v.username),1)]}),req_deleted_by_username:b(({item:a})=>{var v;return[R(z((v=a.req_deleted_by)==null?void 0:v.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),d(ne,{show:l(A),fnClose:()=>{A.value=!1},id:l(F),p_data:l(n)},null,8,["show","fnClose","id","p_data"]),d(ie,{show:l(x),fnClose:()=>{x.value=!1},id:l(w),p_data:l(n),is_view:l(q),onSetID:t[7]||(t[7]=a=>w.value=a),onSetIndex:t[8]||(t[8]=a=>r.value=a)},null,8,["show","fnClose","id","p_data","is_view"]),d(_e,{show:l(I),fnClose:()=>{I.value=!1},index:l(X),p_data:l(n)},null,8,["show","fnClose","index","p_data"])])}}};export{vt as default};
