import{r as o,f as se,g as ge,h as he,i as O,j as we,c as u,b as i,a as x,k as De,v as Te,l,m as Ae,n as P,d as b,w as d,q as $e,x as p,y as H,o as r,z as T,t as w,B as J,I as Se,H as Ye,_ as K}from"./entry.a326582a.js";import Ce from"./Header.8cd6a725.js";import Me from"./Edit.93a793b4.js";import Ne from"./Eyes.f463a88f.js";import qe from"./Signature.10c41692.js";import Oe from"./Table2Column.28b3cd4a.js";import Pe from"./Line.d9078ca4.js";import He from"./Check.e931478d.js";import Be from"./Times.eaea60b2.js";import Ee from"./TableView.600d64c7.js";import{u as B}from"./useMyFetch.7138c4a8.js";import{u as L}from"./useUtils.bcd2e7ad.js";import{u as Ie}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.6c12ba80.js";import"./Adjust.5f9d09ef.js";import"./TableHeaderEye.d1790fd9.js";import"./ClearAll.58df6832.js";import"./client-only.b9222e1a.js";import"./ClearEach.8e7193f0.js";import"./CaretLeftDoubleBold.da716ecf.js";import"./CaretLeftBold.ac389239.js";import"./CaretRightBold.7d81864a.js";import"./CaretRightDoubleBold.80327950.js";const ze=J(()=>K(()=>import("./trx_trp_absen.311fa26e.js"),["./trx_trp_absen.311fa26e.js","./HeaderPopup.vue.b5856aa7.js","./Times.eaea60b2.js","./_plugin-vue_export-helper.c27b6911.js","./entry.a326582a.js","./entry.c5f8f180.css","./client-only.b9222e1a.js","./AttachmentSingle.88a4fbda.js","./PDFJsView.72d314eb.js","./PDFJsView.4e9fad9f.css","./useMyFetch.7138c4a8.js","./trx_trp_absen.aee1895f.css"],import.meta.url).then(f=>f.default||f)),Ue=J(()=>K(()=>import("./trx_trp_absen_validasi.e12a0904.js"),["./trx_trp_absen_validasi.e12a0904.js","./HeaderPopup.vue.b5856aa7.js","./Times.eaea60b2.js","./_plugin-vue_export-helper.c27b6911.js","./entry.a326582a.js","./entry.c5f8f180.css","./CaretTop.154bf072.js","./CaretDown.329cd14b.js","./useMyFetch.7138c4a8.js","./trx_trp_absen_validasi.a2d28854.css"],import.meta.url).then(f=>f.default||f)),je=J(()=>K(()=>import("./trx_absen.b357214c.js"),["./trx_absen.b357214c.js","./HeaderPopup.vue.b5856aa7.js","./Times.eaea60b2.js","./_plugin-vue_export-helper.c27b6911.js","./entry.a326582a.js","./entry.c5f8f180.css","./Check.e931478d.js","./PopupMini.vue.9ac436a5.js","./Exclamation.681f9fa9.js","./useUtils.bcd2e7ad.js","./useMyFetch.7138c4a8.js"],import.meta.url).then(f=>f.default||f)),Ve={class:"w-full h-full flex flex-col"},Re={class:"w-full flex grow flex-col overflow-auto h-0"},Fe={class:"w-full flex justify-between flex-wrap"},Le={class:"grow flex"},Je={class:"m-1"},Ke=Se('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ge=[Ke],Ze=x("span",{class:"text-xs ml-1"}," Download ",-1),Qe={class:"flex"},We={key:0,class:"bg-red-700 rounded-sm"},Xe={key:1,class:"bg-green-500 rounded-sm"},et={key:0,class:"bg-red-700 rounded-sm"},tt={key:1,class:"bg-green-500 rounded-sm"},at={key:0,class:"bg-red-700 rounded-sm"},lt={key:1,class:"bg-green-500 rounded-sm"},st={key:0,class:"bg-red-700 rounded-sm"},ot={key:1,class:"bg-green-500 rounded-sm"},Mt={__name:"absen",async setup(f){let S,G;const{$moment:D}=Ye(),oe=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.ritase_val2==1?"!bg-blue-300":"",E=e=>(e.map(a=>{a.class_h=oe(a)}),e);let Z=o({clearCheckBox:!1});const k=o("Undone");se(()=>k.value,e=>{le.value.map(a=>{let c=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(a.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?c&&(a.tbl_show=1):c&&(a.tbl_show=0),a}),ee()},{immediate:!1});const s={};s._TimeZoneOffset=new Date().getTimezoneOffset(),s.sort="tanggal:desc";const Q=o({}),Y=o({from:"",to:""}),C=ge("token"),{data:re}=([S,G]=he(async()=>$e(async()=>{p().loading_full=!0;let e=[];const[a,c]=await Promise.all([B("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:{filter_status:k},retry:0})]);return a.status.value!=="error"&&(e=E(a.data.value.data)),a.status.value==="error"?(H().trigger(a.error),{trx_trps:e}):(p().loading_full=!1,{trx_trps:e})},{lazy:!0,server:!1,default:()=>({trx_trps:[]})},"$Tkqpaz2JeJ")),S=await S,G(),S),n=o([]);se(()=>{var e;return(e=re.value)==null?void 0:e.trx_trps},e=>{e&&(n.value=[...e])},{immediate:!0}),o([]),o(!1);const I=o({field:"tanggal",by:"desc"}),_=o(-1),A=O(()=>n.value[_.value]),m=o({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),W=()=>{s.like="";let e=JSON.parse(JSON.stringify(p()._tv.global_keyword));e!=""&&(s.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%,uj_asst_opt:%${e}%`),s.sort="",I.value.field&&(s.sort=I.value.field+":"+I.value.by),s.date_from=Y.value.from?D(Y.value.from).format("YYYY-MM-DD"):"",s.date_to=Y.value.to?D(Y.value.to).format("YYYY-MM-DD"):"",s.filter_model=JSON.stringify(p()._tv.filter_model)},X=async()=>{p().loading_full=!0,Q.value={},m.value.may_get_data=!1,s.page=m.value.page,s.page==1&&(n.value=[]),s.first_row&&delete s.first_row,s.page>1&&(s.first_row=JSON.stringify(n.value[0])),s.filter_status=k.value;const{data:e,error:a,status:c}=await B("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:s,retry:0});if(p().loading_full=!1,m.value.may_get_data=!0,c.value==="error"){H().trigger(a,Q);return}m.value.page==1?n.value=E(e.value.data):m.value.page>1&&(n.value=[...n.value,...E(e.value.data)]),e.value.data.length==0&&(m.value.is_last_record=!0),p()._tv.filter_box=!1},ee=()=>{_.value=-1,m.value.page=1,m.value.is_last_record=!1,W(),X()},z=o(!1),te=o(0),{display:U}=we(),ne=()=>{_.value==-1?U({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(te.value=n.value[_.value].id,z.value=!0)},M=o(!1),N=o(0),j=o(!1),ie=()=>{_.value==-1?U({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(N.value=n.value[_.value].id,M.value=!0,j.value=!1)},_e=()=>{_.value==-1?U({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(N.value=n.value[_.value].id,M.value=!0,j.value=!0)},ae=o(!1),de=o(0),V=o([]),ue=async()=>{p().loading_full=!0;const e=new FormData;e.append("ids",JSON.stringify(V.value)),e.append("_method","PUT");const{data:a,error:c,status:R}=await B("/trx_trp/absen/clear_valval1",{method:"post",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},body:e,retry:0});if(p().loading_full=!1,R.value==="error"){H().trigger(c);return}a.value.val_lists.forEach(g=>{let $=n.value.map(v=>v.id).indexOf(g.id);if($>-1){let v=n.value[$];v.ritase_val=g.ritase_val,v.ritase_val1=g.ritase_val1,v.ritase_val2=g.ritase_val2,v.updated_at=g.updated_at,n.value.splice($,1,{...v})}}),Z.value.clearCheckBox=!0},le=o([{key:"cb",label:"",checkbox:"id"},{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"Kasir",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"Mandor",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val2",label:"Staff Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"rla",label:"B"},{key:"raa",label:"T"},{key:"rra",label:"K"},{key:"rta",label:"S"},{key:"ritase_leave_at",label:"Berangkat"},{key:"ritase_arrive_at",label:"Tiba"},{key:"ritase_return_at",label:"Kembali"},{key:"ritase_till_at",label:"Sampai"},{key:"ritase_note",label:"Note"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"uj_asst_opt",label:"Info",filter_on:1,type:"select",select_item:["DENGAN KERNET","TANPA KERNET"]},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ce=O(()=>_.value>-1&&L().checkPermission("trp_trx.absen.view")),pe=O(()=>_.value>-1&&[void 0,0].indexOf(A.value.deleted)>-1&&[void 0,0].indexOf(A.value.req_deleted)>-1&&[void 0,0].indexOf(A.value.ritase_val)>-1&&L().checkPermission("trp_trx.absen.modify")),me=O(()=>_.value>-1&&[void 0,0].indexOf(A.value.deleted)>-1&&[void 0,0].indexOf(A.value.req_deleted)>-1&&L().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1","trp_trx.absen.val2"])),{downloadFile:fe,viewFile:rt}=Ie(),ve=async()=>{W(),p().loading_full=!0,s.filter_status=k.value;const{data:e,error:a,status:c}=await B("/trx_trp/absen/download_excel",{method:"get",headers:{Authorization:`Bearer ${C.value}`,Accept:"application/json"},params:s,retry:0});if(p().loading_full=!1,c.value==="error"){H().trigger(a);return}fe(e.value)};return(e,a)=>{const c=Ce,R=Me,g=Ne,$=qe,v=Oe,F=Pe,h=He,q=Be,ye=Ee,be=ze,xe=Ue,ke=je;return r(),u("div",Ve,[i(c,{title:"List Transaction"}),x("div",Re,[x("div",Fe,[x("div",Le,[x("div",Je,[De(x("select",{class:"","onUpdate:modelValue":a[0]||(a[0]=t=>Ae(k)?k.value=t:null)},Ge,512),[[Te,l(k)]])]),l(pe)?(r(),u("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=t=>ne())},[i(R)])):P("",!0),l(ce)?(r(),u("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=t=>_e())},[i(g)])):P("",!0),l(me)?(r(),u("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=t=>ie())},[i($)])):P("",!0),x("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:a[4]||(a[4]=t=>ve())},[i(v),b(),Ze])]),x("div",Qe,[l(V).length>0?(r(),u("button",{key:0,type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:a[5]||(a[5]=t=>ue())}," Multi UnVal ")):P("",!0)])]),i(ye,{thead:l(le),selected:l(_),onSetSelected:a[6]||(a[6]=t=>_.value=t),tbody:l(n),fnCallData:X,scrolling:l(m),onSetScrollingPage:a[7]||(a[7]=t=>l(m).page=t),onDoFilter:a[8]||(a[8]=t=>ee()),onSetCheckbox:a[9]||(a[9]=t=>V.value=t),deep_state:l(Z)},{ritase_val:d(({item:t})=>[t.ritase_val?(r(),T(h,{key:1})):(r(),T(F,{key:0}))]),ritase_val1:d(({item:t})=>[t.ritase_val1?(r(),T(h,{key:1})):(r(),T(F,{key:0}))]),ritase_val2:d(({item:t})=>[t.ritase_val2?(r(),T(h,{key:1})):(r(),T(F,{key:0}))]),uj_asst_opt:d(({item:t})=>{var y;return[b(w((y=t.uj)==null?void 0:y.asst_opt),1)]}),ritase_leave_at:d(({item:t})=>[b(w(t.ritase_leave_at?l(D)(t.ritase_leave_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rla:d(({item:t})=>[t.ritase_leave_at?(r(),u("div",Xe,[i(h,{class:"text-white text-xl font-bold"})])):(r(),u("div",We,[i(q,{class:"text-white text-xl font-bold"})]))]),ritase_arrive_at:d(({item:t})=>[b(w(t.ritase_arrive_at?l(D)(t.ritase_arrive_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),raa:d(({item:t})=>[t.ritase_arrive_at?(r(),u("div",tt,[i(h,{class:"text-white text-xl font-bold"})])):(r(),u("div",et,[i(q,{class:"text-white text-xl font-bold"})]))]),ritase_return_at:d(({item:t})=>[b(w(t.ritase_return_at?l(D)(t.ritase_return_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rra:d(({item:t})=>[t.ritase_return_at?(r(),u("div",lt,[i(h,{class:"text-white text-xl font-bold"})])):(r(),u("div",at,[i(q,{class:"text-white text-xl font-bold"})]))]),ritase_till_at:d(({item:t})=>[b(w(t.ritase_till_at?l(D)(t.ritase_till_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rta:d(({item:t})=>[t.ritase_till_at?(r(),u("div",ot,[i(h,{class:"text-white text-xl font-bold"})])):(r(),u("div",st,[i(q,{class:"text-white text-xl font-bold"})]))]),deleted_by_username:d(({item:t})=>{var y;return[b(w((y=t.deleted_by)==null?void 0:y.username),1)]}),req_deleted_by_username:d(({item:t})=>{var y;return[b(w((y=t.req_deleted_by)==null?void 0:y.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling","deep_state"])]),i(be,{show:l(z),fnClose:()=>{z.value=!1},id:l(te),p_data:l(n)},null,8,["show","fnClose","id","p_data"]),i(xe,{show:l(M),fnClose:()=>{M.value=!1},id:l(N),p_data:l(n),is_view:l(j),onSetID:a[10]||(a[10]=t=>N.value=t),onSetIndex:a[11]||(a[11]=t=>_.value=t)},null,8,["show","fnClose","id","p_data","is_view"]),i(ke,{show:l(ae),fnClose:()=>{ae.value=!1},index:l(de),p_data:l(n)},null,8,["show","fnClose","index","p_data"])])}}};export{Mt as default};
