import{r as s,f as ae,g as je,h as Fe,i as h,j as le,s as Ne,x as u,c as b,b as _,a as c,k as oe,v as ze,l,m as ne,n as k,w as T,q as Be,y as I,o as d,z as j,d as Y,t as se,A as Le,B as H,_ as U,H as Ve}from"./entry.2e8b78c1.js";import Ye from"./Header.47406e40.js";import He from"./Copy.52f5d7a9.js";import Ue from"./Plus.ea1f847d.js";import Re from"./Edit.4bc04498.js";import qe from"./Eyes.9c8ea0ca.js";import Je from"./Delete.6748c348.js";import Ke from"./Signature.b47902d0.js";import Ge from"./PrinterEye.47eb2eb0.js";import Qe from"./Line.1b972c78.js";import Ze from"./Check.5b0b2797.js";import We from"./TableView.75f53174.js";import{u as x}from"./useUtils.49acee3f.js";import{u as F}from"./useMyFetch.e6d47c09.js";import{u as Xe}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.480cfef4.js";import"./Adjust.65fd07b0.js";import"./TableHeaderEye.037a99c6.js";import"./Times.1251e55b.js";import"./ClearAll.2c34416b.js";import"./client-only.6c91716f.js";import"./ClearEach.e9fd5f89.js";import"./CaretLeftDoubleBold.e77d64fb.js";import"./CaretLeftBold.03bc9e2e.js";import"./CaretRightBold.2fbc70a0.js";import"./CaretRightDoubleBold.cfc13dcf.js";const et=H(()=>U(()=>import("./PopupMini.57a94d9a.js"),["./PopupMini.57a94d9a.js","./PopupMini.vue.a4277ca4.js","./Times.1251e55b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.2e8b78c1.js","./entry.493f9183.css","./Exclamation.fa922f3d.js"],import.meta.url).then(p=>p.default||p)),tt=H(()=>U(()=>import("./extra_money.a3efedc5.js"),["./extra_money.a3efedc5.js","./HeaderPopup.vue.f669f300.js","./Times.1251e55b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.2e8b78c1.js","./entry.493f9183.css","./WidthMiniList.vue.73a476d0.js","./WidthMiniPart.vue.87883edd.js","./InputPointFormat.vue.83c7d40a.js","./useUtils.49acee3f.js","./useMyFetch.e6d47c09.js"],import.meta.url).then(p=>p.default||p)),at=H(()=>U(()=>import("./extra_money_validasi.c1c4d975.js"),["./extra_money_validasi.c1c4d975.js","./HeaderPopup.vue.f669f300.js","./Times.1251e55b.js","./_plugin-vue_export-helper.c27b6911.js","./entry.2e8b78c1.js","./entry.493f9183.css","./WidthMiniPart.vue.87883edd.js","./useUtils.49acee3f.js","./useMyFetch.e6d47c09.js"],import.meta.url).then(p=>p.default||p)),lt={class:"w-full h-full flex flex-col"},ot={class:"w-full flex grow flex-col overflow-auto h-0"},nt={class:"w-full flex justify-between flex-wrap"},st={class:"grow flex"},rt={class:"m-1"},it=c("option",{value:"available"},"Available",-1),ut=c("option",{value:"unapprove"},"Unapprove",-1),_t=c("option",{value:"deleted"},"Trash",-1),dt=c("option",{value:"all"},"All",-1),mt=[it,ut,_t,dt],ct={class:"grow mb-5"},Vt={__name:"index",async setup(p){let C,R;const{$moment:q}=Ve(),{pointFormat:re}=x(),J=t=>t.deleted==1?"!bg-red-400":t.pv_id>0?"!bg-blue-300":"",N=t=>(t.map(e=>{e.class_h=J(e)}),t),y=s("available");ae(()=>y.value,t=>{W.value.map(e=>{let m=["deleted_by_username","deleted_at","deleted_reason"].indexOf(e.key)>-1;return["all","deleted"].indexOf(t)>-1?m&&(e.tbl_show=1):m&&(e.tbl_show=0),e}),Q()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const K=s({}),$=s({from:"",to:""}),S=je("token"),{data:ie}=([C,R]=Fe(async()=>Be(async()=>{u().loading_full=!0;let t=[];const[e,m]=await Promise.all([F("/extra_moneys",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return e.status.value!=="error"&&(t=N(e.data.value.data)),e.status.value==="error"?(I().trigger(e.error),{extra_moneys:t}):(u().loading_full=!1,{extra_moneys:t})},"$pjdlE6mDqg")),C=await C,R(),C),n=s(ie.value.extra_moneys||[]),z=s({field:"tanggal",by:"desc"}),a=s(-1),i=h(()=>n.value[a.value]),v=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),ue=()=>{r.like="";let t=JSON.parse(JSON.stringify(u()._tv.global_keyword));t!=""&&(r.like=`id:%${t}%,transition_target:%${t}%,transition_type:%${t}%,extra_money_name:%${t}%,extra_money_type:%${t}%,xto:%${t}%,transition_target:%${t}%`),r.sort="",z.value.field&&(r.sort=z.value.field+":"+z.value.by),r.date_from=$.value.from?q($.value.from).format("YYYY-MM-DD"):"",r.date_to=$.value.to?q($.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(u()._tv.filter_model)},G=async()=>{u().loading_full=!0,K.value={},v.value.may_get_data=!1,r.page=v.value.page,r.page==1&&(n.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(n.value[0])),r.filter_status=y.value;const{data:t,error:e,status:m}=await F("/extra_moneys",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:r,retry:0});if(u().loading_full=!1,v.value.may_get_data=!0,m.value==="error"){I().trigger(e,K);return}v.value.page==1?n.value=N(t.value.data):v.value.page>1&&(n.value=[...n.value,...N(t.value.data)]),t.value.data.length==0&&(v.value.is_last_record=!0),u()._tv.filter_box=!1},Q=()=>{a.value=-1,v.value.page=1,v.value.is_last_record=!1,ue(),G()},P=s(!1),E=s(0),g=s(0),w=s(!1),_e=()=>{E.value=0,w.value=!1,g.value=!1,P.value=!0},{display:D}=le();Ne(le());const de=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(E.value=n.value[a.value].id,w.value=!1,g.value=!1,P.value=!0)},me=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(E.value=n.value[a.value].id,w.value=!1,g.value=!0,P.value=!0)},M=s(!1),B=s(0),ce=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(B.value=n.value[a.value].id,w.value=!1,g.value=!1,M.value=!0)},ve=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(B.value=n.value[a.value].id,w.value=!0,g.value=!1,M.value=!0)},L=s(!1),Z=s({}),O=s(!1),A=s(""),fe=async()=>{O.value&&(O.value=!1)},pe=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(A.value="",Z.value={id:n.value[a.value].id,tujuan:n.value[a.value].xto},O.value=!0)};ae(()=>A.value,t=>{t.trim().length>0?L.value=!0:L.value=!1},{immediate:!1});const ye=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",A.value),t.append("_method","DELETE");const{data:e,error:m,status:V}=await F("/extra_money",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,V.value==="error"){I().trigger(m);return}let f={...n.value[a.value]};f.deleted=e.value.deleted,f.deleted_user=e.value.deleted_user,f.deleted_at=e.value.deleted_at,f.deleted_by=e.value.deleted_by,f.deleted_reason=e.value.deleted_reason,f.class_h=J(f),y.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...f}),a.value=-1,O.value=!1},{printHtml:be}=Xe(),xe=async()=>{if(a.value==-1){D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}u().loading_full=!0;const{data:t,error:e,status:m}=await F("/extra_money_preview_file",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{id:n.value[a.value].id},retry:0});if(u().loading_full=!1,m.value==="error"){I().trigger(e);return}be(t.value.html,318)},W=s([{key:"no",label:"No",isai:!0},{key:"val1",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"transition_target",label:"Pengalihan",filter_on:1,type:"select",select_item:u().list_pabrik},{key:"transition_type",label:"Tipe Pengalihan",type:"select",select_item:[{k:"From",v:"Dari"},{k:"To",v:"Ke"}]},{key:"ac_account",label:"Account",childs:[{key:"ac_account_id",label:"Account ID",filter_on:1,type:"string"},{key:"ac_account_code",label:"Account Code",filter_on:1,type:"string"},{key:"ac_account_name",label:"Account Name",filter_on:1,type:"string"}]},{key:"description",label:"Deskripsi",filter_on:1,type:"string"},{key:"qty",label:"Qty",class:" justify-end",type:"number"},{key:"nominal",label:"Nominal",class:" justify-end",type:"number"},{key:"qn_total",label:"Total",class:" justify-end",type:"number"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:0},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1}]),he=h(()=>a.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&x().checkPermission("extra_money.create")),ke=h(()=>["available","all"].indexOf(y.value)>-1&&x().checkPermission("extra_money.create")),ge=h(()=>a.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,0].indexOf(i.value.val1)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1&&x().checkPermission("extra_money.modify")),we=h(()=>a.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1&&(x().checkPermission("extra_money.val1")&&[void 0,0].indexOf(i.value.val1)>-1||x().checkPermission("extra_money.val2")&&[void 0,0].indexOf(i.value.val2)>-1)),De=h(()=>x().checkPermission("extra_money.remove")&&a.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&[void 0,""].indexOf(i.value.pvr_id)>-1),Ae=h(()=>x().checkPermission("extra_money.preview_file")&&a.value>-1&&[void 0,0].indexOf(i.value.deleted)>-1&&i.value.val==1);return(t,e)=>{const m=Ye,V=He,f=Ue,Pe=Re,Oe=qe,Te=Je,Ce=Ke,$e=Ge,X=Qe,ee=Ze,Se=We,Ee=et,Me=tt,Ie=at;return d(),b("div",lt,[_(m,{title:"List Transaction"}),c("div",ot,[c("div",nt,[c("div",st,[c("div",rt,[oe(c("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>ne(y)?y.value=o:null)},mt,512),[[ze,l(y)]])]),l(he)?(d(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>me())},[_(V)])):k("",!0),l(ke)?(d(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>_e())},[_(f)])):k("",!0),l(ge)?(d(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>de())},[_(Pe)])):k("",!0),l(a)>-1?(d(),b("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>ve())},[_(Oe)])):k("",!0),l(De)?(d(),b("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>pe())},[_(Te)])):k("",!0),l(we)?(d(),b("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>ce())},[_(Ce)])):k("",!0),l(Ae)?(d(),b("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>xe())},[_($e)])):k("",!0)])]),_(Se,{thead:l(W),selected:l(a),onSetSelected:e[8]||(e[8]=o=>a.value=o),tbody:l(n),fnCallData:G,scrolling:l(v),onSetScrollingPage:e[9]||(e[9]=o=>l(v).page=o),onDoFilter:e[10]||(e[10]=o=>Q())},{val1:T(({item:o})=>[o.val1?(d(),j(ee,{key:1})):(d(),j(X,{key:0}))]),val2:T(({item:o})=>[o.val2?(d(),j(ee,{key:1})):(d(),j(X,{key:0}))]),qn_total:T(({item:o})=>[Y(" Rp. "+se(l(re)(parseFloat(o.total)||0)),1)]),deleted_by_username:T(({item:o})=>{var te;return[Y(se((te=o.deleted_by)==null?void 0:te.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),_(Ee,{type:"delete",show:l(O),data:l(Z),fnClose:fe,fnConfirm:ye,enabledOk:l(L)},{footer:T(()=>[Y(" Masukkan Alasan Penghapusan: "),c("div",ct,[oe(c("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>ne(A)?A.value=o:null)},null,512),[[Le,l(A)]])])]),_:1},8,["show","data","enabledOk"]),_(Me,{show:l(P),fnClose:()=>{P.value=!1},id:l(E),p_data:l(n),is_copy:l(g)},null,8,["show","fnClose","id","p_data","is_copy"]),_(Ie,{show:l(M),fnClose:()=>{M.value=!1},id:l(B),p_data:l(n),is_view:l(w)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{Vt as default};
