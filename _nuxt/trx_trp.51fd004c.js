import{_ as Z}from"./HeaderPopup.vue.dfa4a78e.js";import{_ as ee}from"./client-only.34c93221.js";import{_ as te}from"./WidthMiniList.vue.9392ebe8.js";import{r as w,f as ae,i as le,G as C,j as D,I as oe,m as x,J as se,o as c,c as v,a as s,b as y,k as a,w as ne,C as ie,t as u,q as T,F as J,y as O,v as re,l as K,x as de,E as _e,A as k,B as A}from"./entry.19624010.js";import{u as V}from"./useUtils.e5e723a0.js";import{u as F}from"./useMyFetch.329f1277.js";import"./Times.bca2f595.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.e8cf499c.js";const ue={class:"box-fixed"},pe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ce={class:"w-full flex flex-col items-center grow overflow-auto"},ve={class:"w-full flex flex-row flex-wrap"},me={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},fe=s("label",{for:""},"U.Jalan Per",-1),he={key:0,class:"grow"},we={key:1,class:"grow"},ge={class:"text-red-500"},xe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ke=s("label",{for:""},"Jenis",-1),ye=["disabled"],be=s("option",{value:"TBS"},"TBS",-1),Se=s("option",{value:"TBSK"},"TBSK",-1),je=s("option",{value:"CPO"},"CPO",-1),Ne=s("option",{value:"PK"},"PK",-1),Be=[be,Se,je,Ne],Ce={class:"text-red-500"},De={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Te=s("label",{for:""},"Payment Method",-1),Je=["disabled"],Oe=["value"],Ve={class:"text-red-500"},$e={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Ae=s("label",{for:""},"No Pol",-1),Fe=["disabled"],Me={id:"vehicle"},Pe=["value"],Ue={class:"text-red-500"},qe={class:"w-full flex flex-wrap"},Ie={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ke=s("label",{for:""},"Supir",-1),Le={class:"text-red-500"},Ee={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ye=s("label",{for:""},"Kernet",-1),ze={class:"text-red-500"},Re={key:0,class:"w-full flex flex-wrap"},Ge={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},He=s("label",{for:""},"Tujuan",-1),We=["disabled"],Qe={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ze=s("label",{for:""},"Tipe",-1),et=["disabled"],tt=["value","selected"],at={class:"text-red-500"},lt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},ot=s("label",{for:""},"Total Dari U.Jalan",-1),st={class:"card-border disabled"},nt={class:"w-full flex items-center justify-end"},ft={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const r=b,{$moment:M}=_e(),{pointFormat:L}=V(),S={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",payment_method_id:1,payment_method:{id:0,name:""}};let h={...S};const e=w({...S}),$=ae("token"),m=w({}),E=l=>{e.value.transition_target=l.target.value=="TBS"?e.value.transition_target:""};le();const Y=async()=>{k().loading_full=!0,m.value={};const l=new FormData;l.append("tanggal",M(e.value.tanggal).format("Y-MM-DD")),l.append("jenis",e.value.jenis),l.append("id_uj",e.value.id_uj),l.append("xto",e.value.xto),l.append("cost_center_code",e.value.cost_center_code),l.append("online_status",r.online_status),l.append("transition_target",e.value.transition_target),l.append("payment_method_id",e.value.payment_method_id),l.append("no_pol",e.value.no_pol),l.append("supir_id",d.value.id),l.append("kernet_id",_.value.id);let t="post",i=r.id;i==0||(l.append("id",i),l.append("_method","PUT"));const{data:o,error:p,status:f}=await F("/trx_trp",{method:t,headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},body:l,retry:0});if(k().loading_full=!1,f.value==="error"){A().trigger(p,m);return}e.value.supir=d.value.name,e.value.supir_rek_no=d.value._.rek_no.val,e.value.supir_rek_name=d.value._.rek_name.val,e.value.kernet=_.value.name,e.value.kernet_rek_no=_.value._.rek_no.val,e.value.kernet_rek_name=_.value._.rek_name.val;let n=N.value.map(B=>B.id).indexOf(e.value.payment_method_id);if(e.value.payment_method={...N.value[n]},e.value.updated_at=o.value.updated_at,r.id<=0)e.value.id=o.value.id,e.value.created_at=o.value.created_at,r.p_data.unshift(e.value);else{let B=r.p_data.map(X=>X.id).indexOf(r.id);B>=-1&&r.p_data.splice(B,1,{...e.value})}r.fnClose()},z=C(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(j.value.filter(t=>t.jenis==l).map(t=>t.xto))]}),R=C(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return j.value.filter(t=>t.xto==e.value.xto&&t.jenis==l)}),g={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},d=w(JSON.parse(JSON.stringify(g))),_=w(JSON.parse(JSON.stringify(g))),P=C(()=>{let l=[];return q.value.forEach((t,i)=>{let o=JSON.parse(JSON.stringify(g));o._.id.val=t.id,o._.name.val=t.name,o._.rek_no.val=t.rek_no,o._.rek_name.val=t.rek_name,o.id=t.id,o.name=t.name,o.title=(t.rek_no||"")+" "+(t.rek_name||""),o.note=G(t),o._raw=t,l.push(JSON.parse(JSON.stringify(o)))}),l}),G=l=>l.potongan?"Akan ada potong sebesar :"+V().pointFormat(l.potongan.nominal_cut):"",H=C(()=>!1),W=async()=>{k().loading_full=!0;const{data:l,error:t,status:i}=await F("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},params:{id:r.id},retry:0});if(k().loading_full=!1,i.value==="error"){A().trigger(t);return}let o=l.value.data;e.value=o,h={...o},d.value._.id.val=o.supir_id,d.value._.name.val=o.supir,d.value._.rek_no.val=o.supir_rek_no,d.value._.rek_name.val=o.supir_rek_name,d.value.id=o.supir_id,d.value.name=o.supir,d.value.rek_no=(o.supir_rek_no||"")+" "+(o.supir_rek_name||""),_.value._.id.val=o.kernet_id,_.value._.name.val=o.kernet,_.value._.rek_no.val=o.kernet_rek_no,_.value._.rek_name.val=o.kernet_rek_name,_.value.id=o.kernet_id,_.value.name=o.kernet,_.value.rek_no=(o.kernet_rek_no||"")+" "+(o.kernet_rek_name||"");let p=0,f=0;o.potongan.forEach(n=>{n.potongan_mst.employee_id==o.supir_id&&(p+=parseInt(n.nominal_cut)),n.potongan_mst.employee_id==o.kernet_id&&(f+=parseInt(n.nominal_cut))}),p>0&&(d.value.note="Telah di potong sebesar :"+V().pointFormat(p)),f>0&&(_.value.note="Telah di potong sebesar :"+V().pointFormat(f)),r.fnLoadDBData()},j=w([]),U=w([]),q=w([]),N=w([]),Q=async()=>{k().loading_full=!0;const{data:l,error:t,status:i}=await F("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},retry:0});if(k().loading_full=!1,i.value==="error"){A().trigger(t);return}j.value=l.value.list_ujalan,U.value=l.value.list_vehicle,q.value=l.value.list_employee,N.value=l.value.list_payment_methods};D(()=>r.show,async(l,t)=>{l==!0&&(await Q(),await r.fnLoadDBData(),e.value={...S},h={...S},d.value=JSON.parse(JSON.stringify(g)),_.value=JSON.parse(JSON.stringify(g)),m.value={},r.id!=0&&W())},{immediate:!0}),D(()=>e.value.cost_center_code,(l,t)=>{let i="";if(l==""||l){let o=r.list_cost_center.filter(p=>p.CostCenter==e.value.cost_center_code);o.length>0?i=o[0].Description:e.value.cost_center_code==h.cost_center_code&&(i=h.cost_center_desc),e.value.cost_center_desc=i}},{deep:!0,immediate:!0});const I=(l,t)=>{let i=0,o="";if(l==""||l){let p=j.value.filter(f=>f.id==e.value.id_uj);p.length>0?(i=p[0].harga,o=p[0].tipe):e.value.id_uj==h.id_uj&&(i=h.amount,o=h.tipe),e.value.tipe=o,e.value.amount=i}};return D(()=>e.value.xto,(l,t)=>{r.show&&I(l)},{deep:!0,immediate:!0}),D(()=>e.value.id_uj,(l,t)=>{r.show&&I(l)},{deep:!0,immediate:!0}),(l,t)=>{const i=Z,o=oe("vue-date-picker"),p=ee,f=te;return x((c(),v("section",ue,[s("div",null,[y(i,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("form",pe,[s("div",ce,[s("div",ve,[s("div",me,[fe,a(e).val!==1?(c(),v("div",he,[y(p,null,{default:ne(()=>[y(o,{modelValue:a(e).tanggal,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(c(),v("div",we,[s("div",{class:ie(["card-border disabled",a(e).pvr_no!=""?"unselectable":""])},u(a(e).tanggal?a(M)(a(e).tanggal).format("DD-MM-YYYY"):""),3)])),s("p",ge,u(a(m).tanggal),1)]),s("div",xe,[ke,x(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>a(e).jenis=n),onChange:t[2]||(t[2]=n=>E(n)),disabled:a(e).val==1},Be,40,ye),[[T,a(e).jenis]]),s("p",Ce,u(a(m).jenis),1)]),s("div",De,[Te,x(s("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>a(e).payment_method_id=n),disabled:a(e).val==1},[(c(!0),v(J,null,O(a(N),n=>(c(),v("option",{value:n.id},u(n.name),9,Oe))),256))],8,Je),[[T,a(e).payment_method_id]]),s("p",Ve,u(a(m).payment_method_id),1)]),s("div",$e,[Ae,x(s("input",{type:"text",list:"vehicle","onUpdate:modelValue":t[4]||(t[4]=n=>a(e).no_pol=n),disabled:a(e).val==1},null,8,Fe),[[re,a(e).no_pol]]),s("datalist",Me,[(c(!0),v(J,null,O(a(U),n=>(c(),v("option",{value:n.no_pol},u(n.no_pol),9,Pe))),256))]),s("p",Ue,u(a(m).no_pol),1)]),s("div",qe,[s("div",Ie,[Ke,y(f,{arr:a(P),selected:a(d),pure:g,onSetSelected:t[5]||(t[5]=n=>d.value=n),disabled:a(h).supir_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",Le,u(a(m).supir_id),1)]),s("div",Ee,[Ye,y(f,{arr:a(P),selected:a(_),pure:g,onSetSelected:t[6]||(t[6]=n=>_.value=n),disabled:a(h).kernet_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",ze,u(a(m).kernet_id),1)])]),a(e).jenis!=""?(c(),v("div",Re,[s("div",Ge,[He,x(s("select",{"onUpdate:modelValue":t[7]||(t[7]=n=>a(e).xto=n),disabled:a(e).val==1},[(c(!0),v(J,null,O(a(z),n=>(c(),v("option",null,u(n),1))),256))],8,We),[[T,a(e).xto]]),s("p",Qe,u(a(m).xto),1)]),s("div",Xe,[Ze,x(s("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>a(e).id_uj=n),disabled:a(e).val==1},[(c(!0),v(J,null,O(a(R),n=>(c(),v("option",{value:n.id,selected:n.id==a(e).id_uj},u(n.tipe),9,tt))),256))],8,et),[[T,a(e).id_uj]]),s("p",at,u(a(m).id_uj),1)]),s("div",lt,[ot,s("div",st,u(a(L)(a(e).amount)),1)])])):K("",!0)])]),s("div",nt,[s("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[9]||(t[9]=n=>b.fnClose())}," Cancel "),a(H)?K("",!0):(c(),v("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[10]||(t[10]=de(n=>Y(),["prevent"]))}," Save "))])])])],512)),[[se,b.show]])}}};export{ft as default};
