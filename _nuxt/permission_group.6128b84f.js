import{_ as H}from"./HeaderPopup.vue.d93bfc8a.js";import{r as p,g as K,i as C,f as R,k as m,K as I,o as _,c as w,a as e,b as Q,l as s,A as j,t as g,E as $,m as z,F as B,D as N,J as q,C as W,x as d,y as A}from"./entry.10197a4c.js";import{u as D}from"./useMyFetch.ae9890da.js";import"./Times.41eb08b0.js";import"./_plugin-vue_export-helper.c27b6911.js";const X={class:"box-fixed"},Y={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Z={class:"w-full flex flex-col items-center grow overflow-auto"},ee={class:"w-full flex flex-row flex-wrap"},te={class:"w-full flex flex-col flex-wrap p-1"},le=e("label",{for:""},"Name",-1),ae={class:"text-red-500"},se={class:"w-full flex flex-col sm:flex-row grow p-1 justify-between flex-wrap 2xl:overflow-hidden"},oe={class:"w-full max-w-full p-0 2xl:pr-1 2xl:w-1/2 2xl:max-h-full 2xl:overflow-auto"},re={class:"w-full",role:"sticky"},ne={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ue=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission List ")],-1),ie={class:"sticky top-7 !z-[2]"},ce={class:"min-w-[20px] !w-[20px] max-w-[20px]"},de={class:"w-full flex items-center"},fe={ref:"to_move"},pe={class:"!w-[10px]"},me={class:"w-full h-full flex items-center justify-center"},he=["onUpdate:modelValue"],ve={class:"w-full h-full flex items-center justify-start"},_e={class:"w-full max-w-full max-h-full px-0 py-2 2xl:pl-1 2xl:py-0 2xl:w-1/2 2xl:overflow-auto"},we={class:"w-full",role:"sticky"},ge={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ye=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission User ")],-1),xe={class:"sticky top-7 !z-[2]"},be={class:"min-w-[10px] !w-[10px] max-w-[10px]"},ke={class:"w-full flex items-center"},Ce={ref:"to_move"},Ae={class:"!w-[10px]"},De={class:"w-full h-full flex items-center justify-center"},Ue=["onUpdate:modelValue"],je={class:"w-full h-full flex items-center justify-start"},Se={class:"w-full flex items-center justify-end"},qe={__name:"permission_group",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(y){const c=y,S={name:"",list:[]},r=p({...S}),x=K("token"),U=p({}),L=async()=>{d().loading_full=!0,U.value={};const a=new FormData;a.append("name",r.value.name),a.append("permission_list",JSON.stringify(b.value)),a.append("users",JSON.stringify(k.value));let t="post",i=c.is_copy?0:c.id;i==0||(a.append("id",i),a.append("_method","PUT"));const{data:l,error:f,status:u}=await D("/permission_group",{method:t,headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:a,retry:0});if(d().loading_full=!1,u.value==="error"){A().trigger(f,U);return}if(i<=0)r.value.id=l.value.id,r.value.created_at=l.value.created_at,r.value.updated_at=l.value.updated_at,c.p_data.unshift(r.value);else{r.value.updated_at=l.value.updated_at;let V=c.p_data.map(G=>G.id).indexOf(i);V>=-1&&c.p_data.splice(V,1,{...r.value})}c.fnClose()},P=async()=>{d().loading_full=!0;const{data:a,error:t,status:i}=await D("/permission_group",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{id:c.id},retry:0});if(d().loading_full=!1,i.value==="error"){A().trigger(t);return}r.value=a.value.data,c.is_copy&&(r.value.val=0,r.value.val1=0),a.value.data.details.forEach((l,f)=>{o.value=o.value.map(u=>(u.name==l.permission_list_name&&(u.checked=!0),u))}),a.value.data.users.forEach((l,f)=>{n.value=n.value.map(u=>(u.username==l.username&&(u.checked=!0),u))})},o=p([]),F=async()=>{d().loading_full=!0;const{data:a,error:t,status:i}=await D("/permission_lists",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{sort:"name:asc"},retry:0});if(d().loading_full=!1,i.value==="error"){A().trigger(t);return}o.value=a.value.data.map(l=>(l.checked=!1,l))},n=p([]),E=async()=>{d().loading_full=!0;const{data:a,error:t,status:i}=await D("/users",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{sort:"username:asc"},retry:0});if(d().loading_full=!1,i.value==="error"){A().trigger(t);return}n.value=a.value.data.map(l=>(l.checked=!1,l))},b=C(a=>o.value.filter(t=>t.checked)),M=a=>{b.value.length!=o.value.length?o.value=o.value.map(t=>(t.checked=!0,t)):o.value=o.value.map(t=>(t.checked=!1,t))},k=C(a=>n.value.filter(t=>t.checked)),J=a=>{k.value.length!=n.value.length?n.value=n.value.map(t=>(t.checked=!0,t)):n.value=n.value.map(t=>(t.checked=!1,t))},h=p(""),O=C(()=>h.value!=""?o.value.filter(a=>a.name.toLowerCase().includes(h.value.toLowerCase())):o.value),v=p(""),T=C(()=>v.value!=""?n.value.filter(a=>a.username.toLowerCase().includes(v.value.toLowerCase())):n.value);return R(()=>c.show,async(a,t)=>{a==!0&&(r.value={...S},o.value=[],await F(),await E(),c.id!=0&&await P())},{immediate:!0}),(a,t)=>{const i=H;return m((_(),w("section",X,[e("div",null,[Q(i,{title:"Form Permission Group",fn:y.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Y,[e("div",Z,[e("div",ee,[e("div",te,[le,m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s(r).name=l)},null,512),[[j,s(r).name]]),e("p",ae,g(s(U).name),1)])]),e("div",se,[e("div",oe,[e("div",re,[e("table",ne,[e("thead",null,[ue,e("tr",ie,[e("th",ce,[e("button",{type:"button",name:"button",class:$(["text-xs",s(b).length!=s(o).length?"bg-green-500":"bg-red-500"]),onClick:t[1]||(t[1]=l=>M())},g(s(b).length!=s(o).length?"Allow":"Deny"),3)]),e("th",null,[e("div",de,[m(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>z(h)?h.value=l:null),name:"search",placeholder:"Name"},null,512),[[j,s(h)]])])])])]),e("tbody",fe,[(_(!0),w(B,null,N(s(O),(l,f)=>(_(),w("tr",{key:f},[e("td",pe,[e("div",me,[m(e("input",{type:"checkbox","onUpdate:modelValue":u=>l.checked=u,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,he),[[q,l.checked]])])]),e("td",null,[e("div",ve,g(l.name),1)])]))),128))],512)])])]),e("div",_e,[e("div",we,[e("table",ge,[e("thead",null,[ye,e("tr",xe,[e("th",be,[e("button",{type:"button",name:"button",class:$(["text-xs",s(k).length!=s(n).length?"bg-green-500":"bg-red-500"]),onClick:t[3]||(t[3]=l=>J())},g(s(k).length!=s(n).length?"Allow":"Deny"),3)]),e("th",null,[e("div",ke,[m(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=l=>z(v)?v.value=l:null),name:"search",placeholder:"Name"},null,512),[[j,s(v)]])])])])]),e("tbody",Ce,[(_(!0),w(B,null,N(s(T),(l,f)=>(_(),w("tr",{key:f},[e("td",Ae,[e("div",De,[m(e("input",{type:"checkbox","onUpdate:modelValue":u=>l.checked=u,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,Ue),[[q,l.checked]])])]),e("td",null,[e("div",je,g(l.username),1)])]))),128))],512)])])])])]),e("div",Se,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[5]||(t[5]=l=>y.fnClose())}," Cancel "),e("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[6]||(t[6]=W(l=>L(),["prevent"]))}," Save ")])])])],512)),[[I,y.show]])}}};export{qe as default};
