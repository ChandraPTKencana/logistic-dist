import{_ as q}from"./HeaderPopup.vue.48611918.js";import{_ as L}from"./client-only.82d925c7.js";import{_ as J}from"./InputPointFormat.vue.5dca44f8.js";import{r as H,h as z,K as B,I as M,M as E,n as D,v as G,o as c,c as u,a as e,b as x,t as s,m as a,G as f,F as C,D as O,x as g,C as Q,q as I,w as A,s as R,H as W,y as F,p as X,e as Z}from"./entry.1cedbe8d.js";import{u as tt}from"./useUtils.11657bdd.js";import{u as K}from"./useMyFetch.82b8d51f.js";import{_ as et}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.068b4b36.js";const _=b=>(X("data-v-6356cb3f"),b=b(),Z(),b),at={class:"box-fixed"},ot={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},it={class:"w-full flex flex-col items-center grow overflow-auto"},st={class:"w-full flex flex-row flex-wrap"},lt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},_t=_(()=>e("label",{for:""},"U.Jalan Per",-1)),rt={class:"card-border"},nt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},dt=_(()=>e("label",{for:""},"Jenis",-1)),ct={class:"card-border"},ut={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},pt=_(()=>e("label",{for:""},"Supir",-1)),ft={class:"card-border"},bt={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},kt=_(()=>e("label",{for:""},"Kernet",-1)),wt={class:"card-border"},vt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},mt=_(()=>e("label",{for:""},"No Pol",-1)),xt={class:"card-border"},ht={key:0,class:"w-full flex flex-wrap"},gt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},yt=_(()=>e("label",{for:""},"Tujuan",-1)),Tt={class:"card-border"},Dt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},jt=_(()=>e("label",{for:""},"Tipe",-1)),Nt={class:"card-border"},St={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Bt=_(()=>e("label",{for:""},"Total Dari U.Jalan",-1)),Mt={class:"card-border"},Ct=_(()=>e("label",{for:""},"Peralihan",-1)),Ot=["disabled"],Pt=_(()=>e("option",{value:""},null,-1)),Ht=["value"],It={class:"text-red-500"},At={key:2,class:"w-full flex flex-col flex-wrap p-1"},Ft=_(()=>e("label",{for:""},"Tiket A",-1)),Kt={id:"ticket_a"},Vt=["value"],Yt={class:"text-red-500"},Ut={key:3,class:"w-full flex flex-wrap"},$t={class:"w-6/12 sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},qt=_(()=>e("label",{for:""},"In At",-1)),Lt={class:"card-border disabled"},Jt={class:"w-6/12 sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},zt=_(()=>e("label",{for:""},"Out At",-1)),Et={class:"card-border disabled"},Gt={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},Qt=_(()=>e("label",{for:""},"Bruto",-1)),Rt={class:"card-border disabled"},Wt={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},Xt=_(()=>e("label",{for:""},"Tara",-1)),Zt={class:"card-border disabled"},te={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},ee=_(()=>e("label",{for:""},"Netto",-1)),ae={class:"card-border disabled"},oe={class:"w-3/12 sm:w-2/12 md:w-2/12 lg:w-1/12 flex flex-col flex-wrap p-1"},ie=_(()=>e("label",{for:""},"No Pol",-1)),se={class:"card-border disabled"},le={class:"w-full sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},_e=_(()=>e("label",{for:""},"Supir",-1)),re={class:"card-border disabled"},ne={key:4,class:"w-full flex flex-col flex-wrap p-1"},de=_(()=>e("label",{for:""},"Tiket B",-1)),ce={id:"ticket_b"},ue=["value"],pe={class:"text-red-500"},fe={key:5,class:"w-full flex flex-wrap"},be={class:"w-6/12 sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ke=_(()=>e("label",{for:""},"In At",-1)),we={class:"card-border disabled"},ve={class:"w-6/12 sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},me=_(()=>e("label",{for:""},"Out At",-1)),xe={class:"card-border disabled"},he={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},ge=_(()=>e("label",{for:""},"Bruto ",-1)),ye={class:"card-border disabled"},Te={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},De=_(()=>e("label",{for:""},"Tara ",-1)),je={class:"card-border disabled"},Ne={class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},Se=_(()=>e("label",{for:""},"Netto ",-1)),Be={class:"card-border disabled"},Me={class:"w-3/12 sm:w-2/12 md:w-2/12 lg:w-1/12 flex flex-col flex-wrap p-1"},Ce=_(()=>e("label",{for:""},"No Pol",-1)),Oe={class:"card-border disabled"},Pe={class:"w-full sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},He=_(()=>e("label",{for:""},"Supir",-1)),Ie={class:"card-border disabled"},Ae={key:6,class:"w-full sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col p-1"},Fe=_(()=>e("label",{for:""},"In At",-1)),Ke={class:"text-red-500"},Ve={key:7,class:"w-full sm:w-6/12 md:w-3/12 lg:w-2/12 flex flex-col p-1"},Ye=_(()=>e("label",{for:""},"Out At",-1)),Ue={class:"text-red-500"},$e={key:8,class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},qe=_(()=>e("label",{for:""},"Bruto",-1)),Le={class:"text-red-500"},Je={key:9,class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},ze=_(()=>e("label",{for:""},"Tara",-1)),Ee={class:"text-red-500"},Ge={key:10,class:"w-3/12 sm:w-2/12 md:w-1/12 lg:w-1/12 flex flex-col flex-wrap p-1"},Qe=_(()=>e("label",{for:""},"Netto",-1)),Re={class:"card-border disabled"},We={class:"w-full flex items-center justify-end"},Xe={__name:"trx_trp_ticket",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_ticket:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const p=b,{$moment:v}=W(),{pointFormat:m}=tt(),j={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,ticket_a_id:-1,ticket_a_no:"",ticket_a_bruto:0,ticket_a_tara:0,ticket_a_netto:0,ticket_a_supir:"",ticket_a_no_pol:"",ticket_a_in_at:"",ticket_a_out_at:"",ticket_b_id:-1,ticket_b_no:"",ticket_b_bruto:0,ticket_b_tara:0,ticket_b_netto:0,ticket_b_supir:"",ticket_b_no_pol:"",ticket_b_in_at:"",ticket_b_out_at:"",supir:"",kernet:"",no_pol:"",transition_target:"",transition_type:""};let n={...j};const t=H({...j}),P=z("token"),k=H({}),V=o=>{t.value.jenis=="TBS"&&p.fnLoadDBData(t.value.jenis,o.target.value)},Y=async()=>{g().loading_full=!0,k.value={};const o=new FormData;if(o.append("tanggal",v(t.value.tanggal).format("Y-MM-DD")),o.append("jenis",t.value.jenis),o.append("id_uj",t.value.id_uj),o.append("xto",t.value.xto),o.append("online_status",p.online_status),o.append("transition_target",t.value.transition_target),t.value.ticket_a_no){let i=N.value.filter(h=>h.TicketNo==t.value.ticket_a_no);i.length==0&&t.value.ticket_a_no==n.ticket_a_no?o.append("ticket_a_id",n.ticket_a_id):o.append("ticket_a_id",i[0].TicketID)}if(t.value.ticket_b_no){let i=S.value.filter(h=>h.TicketNo==t.value.ticket_b_no);i.length==0&&t.value.ticket_b_no==n.ticket_b_no?o.append("ticket_b_id",n.ticket_b_id):o.append("ticket_b_id",i[0].TicketID)}o.append("ticket_a_no",t.value.ticket_a_no),o.append("ticket_b_no",t.value.ticket_b_no),o.append("ticket_b_bruto",t.value.ticket_b_bruto),o.append("ticket_b_tara",t.value.ticket_b_tara),t.value.ticket_b_in_at&&o.append("ticket_b_in_at",v(t.value.ticket_b_in_at).format("Y-MM-DD HH:mm:ss")),t.value.ticket_b_out_at&&o.append("ticket_b_out_at",v(t.value.ticket_b_out_at).format("Y-MM-DD HH:mm:ss")),o.append("supir",t.value.supir),o.append("kernet",t.value.kernet),o.append("no_pol",t.value.no_pol);let l="post",r=p.id;r==0||(o.append("id",r),o.append("_method","PUT"));const{data:w,error:y,status:T}=await K("/trx_trp_ticket",{method:l,headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},body:o,retry:0});if(g().loading_full=!1,T.value==="error"){F().trigger(y,k);return}if(t.value.ticket_a_netto=parseFloat(t.value.ticket_a_bruto)-parseFloat(t.value.ticket_a_tara),t.value.ticket_b_netto=parseFloat(t.value.ticket_b_bruto)-parseFloat(t.value.ticket_b_tara),t.value.updated_at=w.value.updated_at,p.id<=0)t.value.id=w.value.id,t.value.created_at=w.value.created_at,p.p_data.unshift(t.value);else{let i=p.p_data.map(h=>h.id).indexOf(p.id);i>=-1&&p.p_data.splice(i,1,{...t.value})}p.fnClose()},N=B(()=>{let o=[];return t.value.jenis=="CPO"?o=["cpo"]:t.value.jenis=="PK"?o=["kernel"]:o=["mtbs"],p.list_ticket.filter(l=>o.indexOf(l.ProductName.toLowerCase())>-1)}),S=B(()=>{let o=[];return t.value.transition_target!=""?o=["tbs","rtbs"]:t.value.jenis=="TBSK"?o=["tbs"]:t.value.jenis=="TBS"&&(o=["rtbs"]),p.list_ticket.filter(l=>o.indexOf(l.ProductName.toLowerCase())>-1)}),U=B(()=>!1),$=async()=>{g().loading_full=!0;const{data:o,error:l,status:r}=await K("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${P.value}`,Accept:"application/json"},params:{id:p.id},retry:0});if(g().loading_full=!1,r.value==="error"){F().trigger(l);return}t.value=o.value.data,n={...o.value.data},p.fnLoadDBData(t.value.jenis,t.value.transition_target)};M(()=>p.show,(o,l)=>{o==!0&&(t.value={...j},k.value={},p.id!=0&&$())},{immediate:!0});let d={id:-1,bruto:0,tara:0,netto:0,supir:"-",no_pol:"-",in_at:"",out_at:""};return M(()=>t.value.ticket_a_no,(o,l)=>{if(o==""||o){if(o){let r=N.value.filter(w=>w.TicketNo==t.value.ticket_a_no);r.length>0?d={id:r[0].TicketID,bruto:r[0].Bruto,tara:r[0].Tara,netto:r[0].Netto,supir:r[0].NamaSupir,no_pol:r[0].VehicleNo,in_at:r[0].DateTimeIn,out_at:r[0].DateTimeOut}:t.value.ticket_a_no==n.ticket_a_no&&(d={id:n.ticket_a_id,bruto:n.ticket_a_bruto,tara:n.ticket_a_tara,netto:n.ticket_a_netto,supir:n.ticket_a_supir,no_pol:n.ticket_a_no_pol,in_at:n.ticket_a_in_at,out_at:n.ticket_a_out_at})}o==""&&(d={id:-1,bruto:0,tara:0,netto:0,supir:"-",no_pol:"-",in_at:"",out_at:""}),t.value.ticket_a_id=d.id,t.value.ticket_a_bruto=d.bruto,t.value.ticket_a_tara=d.tara,t.value.ticket_a_netto=d.netto,t.value.ticket_a_in_at=d.in_at,t.value.ticket_a_out_at=d.out_at,t.value.ticket_a_supir=d.supir,t.value.ticket_a_no_pol=d.no_pol}},{deep:!0,immediate:!0}),M(()=>t.value.ticket_b_no,(o,l)=>{if(["TBS","TBSK"].indexOf(t.value.jenis)>-1&&(o==""||o)){if(o){let r=S.value.filter(w=>w.TicketNo==t.value.ticket_b_no);r.length>0?d={id:r[0].TicketID,bruto:r[0].Bruto,tara:r[0].Tara,netto:r[0].Netto,supir:r[0].NamaSupir,no_pol:r[0].VehicleNo,in_at:r[0].DateTimeIn,out_at:r[0].DateTimeOut}:t.value.ticket_b_no==n.ticket_b_no&&(d={id:n.ticket_b_id,bruto:n.ticket_b_bruto,tara:n.ticket_b_tara,netto:n.ticket_b_netto,supir:n.ticket_b_supir,no_pol:n.ticket_b_no_pol,in_at:n.ticket_b_in_at,out_at:n.ticket_b_out_at})}o==""&&(d={id:-1,bruto:0,tara:0,netto:0,supir:"-",no_pol:"-",in_at:"",out_at:""}),t.value.ticket_b_id=d.id,t.value.ticket_b_bruto=d.bruto,t.value.ticket_b_tara=d.tara,t.value.ticket_b_netto=d.netto,t.value.ticket_b_in_at=d.in_at,t.value.ticket_b_out_at=d.out_at,t.value.ticket_b_supir=d.supir,t.value.ticket_b_no_pol=d.no_pol}},{deep:!0,immediate:!0}),(o,l)=>{const r=q,w=E("vue-date-picker"),y=L,T=J;return D((c(),u("section",at,[e("div",null,[x(r,{title:"Form Transaction",fn:b.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",ot,[e("div",it,[e("div",st,[e("div",lt,[_t,e("div",rt,s(a(t).tanggal?a(v)(a(t).tanggal).format("DD-MM-YYYY"):""),1)]),e("div",nt,[dt,e("div",ct,s(a(t).jenis),1)]),e("div",ut,[pt,e("div",ft,s(a(t).supir),1)]),e("div",bt,[kt,e("div",wt,s(a(t).kernet),1)]),e("div",vt,[mt,e("div",xt,s(a(t).no_pol),1)]),a(t).jenis!=""?(c(),u("div",ht,[e("div",gt,[yt,e("div",Tt,s(a(t).xto),1)]),e("div",Dt,[jt,e("div",Nt,s(a(t).tipe),1)]),e("div",St,[Bt,e("div",Mt,s(a(m)(a(t).amount||0)),1)])])):f("",!0),a(t).jenis=="TBS"?(c(),u("div",{key:1,class:"w-full p-1",onChange:l[1]||(l[1]=i=>V(i))},[Ct,D(e("select",{"onUpdate:modelValue":l[0]||(l[0]=i=>a(t).transition_target=i),disabled:a(t).transition_type=="From"},[Pt,(c(!0),u(C,null,O(a(g)().list_pabrik,i=>(c(),u("option",{value:i},s(i),9,Ht))),256))],8,Ot),[[Q,a(t).transition_target]]),e("p",It,s(a(k).transition_target),1)],32)):f("",!0),a(t).jenis!=""&&a(t).jenis!="TBSK"?(c(),u("div",At,[Ft,D(e("input",{type:"text",list:"ticket_a","onUpdate:modelValue":l[2]||(l[2]=i=>a(t).ticket_a_no=i)},null,512),[[I,a(t).ticket_a_no]]),e("datalist",Kt,[(c(!0),u(C,null,O(a(N),i=>(c(),u("option",{value:i.TicketNo},s(i.TicketNo+"-"+i.VehicleNo+"-"+i.NamaSupir),9,Vt))),256))]),e("p",Yt,s(a(k).ticket),1)])):f("",!0),a(t).jenis!=""&&a(t).jenis!="TBSK"?(c(),u("div",Ut,[e("div",$t,[qt,e("div",Lt,s(a(t).ticket_a_in_at?a(v)(a(t).ticket_a_in_at).format("DD-MM-Y HH:mm:ss"):"-"),1)]),e("div",Jt,[zt,e("div",Et,s(a(t).ticket_a_out_at?a(v)(a(t).ticket_a_out_at).format("DD-MM-Y HH:mm:ss"):"-"),1)]),e("div",Gt,[Qt,e("div",Rt,s(a(t).ticket_a_bruto?a(m)(a(t).ticket_a_bruto):0),1)]),e("div",Wt,[Xt,e("div",Zt,s(a(t).ticket_a_tara?a(m)(a(t).ticket_a_tara):0),1)]),e("div",te,[ee,e("div",ae,s(a(t).ticket_a_bruto?a(m)(a(t).ticket_a_bruto-a(t).ticket_a_tara):0),1)]),e("div",oe,[ie,e("div",se,s(a(t).ticket_a_no_pol),1)]),e("div",le,[_e,e("div",re,s(a(t).ticket_a_supir),1)])])):f("",!0),["TBS","TBSK"].indexOf(a(t).jenis)>-1?(c(),u("div",ne,[de,D(e("input",{type:"text",list:"ticket_b","onUpdate:modelValue":l[3]||(l[3]=i=>a(t).ticket_b_no=i)},null,512),[[I,a(t).ticket_b_no]]),e("datalist",ce,[(c(!0),u(C,null,O(a(S),i=>(c(),u("option",{value:i.TicketNo},s(i.TicketNo+"-"+i.VehicleNo+"-"+i.NamaSupir),9,ue))),256))]),e("p",pe,s(a(k).ticket),1)])):f("",!0),["TBS","TBSK"].indexOf(a(t).jenis)>-1?(c(),u("div",fe,[e("div",be,[ke,e("div",we,s(a(t).ticket_b_in_at?a(v)(a(t).ticket_b_in_at).format("DD-MM-Y HH:mm:ss"):"-"),1)]),e("div",ve,[me,e("div",xe,s(a(t).ticket_b_out_at?a(v)(a(t).ticket_b_out_at).format("DD-MM-Y HH:mm:ss"):"-"),1)]),e("div",he,[ge,e("div",ye,s(a(t).ticket_b_bruto?a(m)(a(t).ticket_b_bruto):0),1)]),e("div",Te,[De,e("div",je,s(a(t).ticket_b_tara?a(m)(a(t).ticket_b_tara):0),1)]),e("div",Ne,[Se,e("div",Be,s(a(t).ticket_b_bruto?a(m)(a(t).ticket_b_bruto-a(t).ticket_b_tara):0),1)]),e("div",Me,[Ce,e("div",Oe,s(a(t).ticket_b_no_pol),1)]),e("div",Pe,[He,e("div",Ie,s(a(t).ticket_b_supir),1)])])):f("",!0),["CPO","PK"].indexOf(a(t).jenis)>-1?(c(),u("div",Ae,[Fe,x(y,null,{default:A(()=>[x(w,{modelValue:a(t).ticket_b_in_at,"onUpdate:modelValue":l[4]||(l[4]=i=>a(t).ticket_b_in_at=i),type:"datetime",format:"dd-MM-yyyy HH:mm","enable-time-picker":!0,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),e("p",Ke,s(a(k).ticket_b_in_at),1)])):f("",!0),["CPO","PK"].indexOf(a(t).jenis)>-1?(c(),u("div",Ve,[Ye,x(y,null,{default:A(()=>[x(w,{modelValue:a(t).ticket_b_out_at,"onUpdate:modelValue":l[5]||(l[5]=i=>a(t).ticket_b_out_at=i),type:"datetime",format:"dd-MM-yyyy HH:mm","enable-time-picker":!0,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),e("p",Ue,s(a(k).ticket_b_out_at),1)])):f("",!0),["CPO","PK"].indexOf(a(t).jenis)>-1?(c(),u("div",$e,[qe,e("div",null,[x(T,{class:"card-border p-1",type:"text",value:a(t).ticket_b_bruto||0,onInput:l[6]||(l[6]=i=>a(t).ticket_b_bruto=i),show:b.show},null,8,["value","show"])]),e("p",Le,s(a(k).ticket_b_bruto),1)])):f("",!0),["CPO","PK"].indexOf(a(t).jenis)>-1?(c(),u("div",Je,[ze,e("div",null,[x(T,{class:"card-border p-1",type:"text",value:a(t).ticket_b_tara||0,onInput:l[7]||(l[7]=i=>a(t).ticket_b_tara=i),show:b.show},null,8,["value","show"])]),e("p",Ee,s(a(k).ticket_b_tara),1)])):f("",!0),["CPO","PK"].indexOf(a(t).jenis)>-1?(c(),u("div",Ge,[Qe,e("div",Re,s(a(t).ticket_b_bruto?a(m)(a(t).ticket_b_bruto-a(t).ticket_b_tara):0),1)])):f("",!0)])]),e("div",We,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[8]||(l[8]=i=>b.fnClose())}," Cancel "),a(U)?f("",!0):(c(),u("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[9]||(l[9]=R(i=>Y(),["prevent"]))}," Save "))])])])],512)),[[G,b.show]])}}},_a=et(Xe,[["__scopeId","data-v-6356cb3f"]]);export{_a as default};
