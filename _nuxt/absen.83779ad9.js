import be from"./Header.2ad23a48.js";import ye from"./Edit.f1182fe8.js";import xe from"./Eyes.61f47986.js";import ke from"./Signature.9bf050bf.js";import ge from"./Table2Column.871aa25b.js";import he from"./Line.f47efa77.js";import we from"./Check.83fb5fc6.js";import De from"./Times.f67ad23e.js";import Ae from"./TableView.7e22cae5.js";import Te from"./trx_trp_absen.83950b73.js";import Ye from"./trx_trp_absen_validasi.882f43fe.js";import $e from"./trx_absen.e3f0807d.js";import{r as o,f as Se,g as Ce,h as Me,i as q,j as Ne,c as u,b as n,a as y,k as qe,v as He,l,m as Be,n as H,d as b,w as d,q as Oe,x as m,y as B,o as r,z as D,t as h,H as Pe,G as Ue}from"./entry.717b1444.js";import{u as O}from"./useMyFetch.666735e9.js";import{u as R}from"./useUtils.8a7aa554.js";import{u as je}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.b1510539.js";import"./Adjust.d3a939f7.js";import"./TableHeaderEye.3ab28ee7.js";import"./ClearAll.02a611b1.js";import"./client-only.614dad77.js";import"./ClearEach.b66c19ec.js";import"./CaretLeftDoubleBold.43aa08f5.js";import"./CaretLeftBold.f053f920.js";import"./CaretRightBold.f4344752.js";import"./CaretRightDoubleBold.f7ee5671.js";import"./HeaderPopup.vue.4e2f3813.js";import"./AttachmentSingle.99307743.js";import"./PDFJsView.3338045c.js";import"./CaretTop.a9c4901f.js";import"./CaretDown.e47a65e6.js";import"./PopupMini.vue.72cb967d.js";import"./Exclamation.16ee6bfa.js";const Ie={class:"w-full h-full flex flex-col"},Ee={class:"w-full flex grow flex-col overflow-auto h-0"},Fe={class:"w-full flex justify-between flex-wrap"},Ve={class:"grow flex"},Je={class:"m-1"},Re=Pe('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),ze=[Re],Ke=y("span",{class:"text-xs ml-1"}," Download ",-1),Ge={class:"flex"},Le={key:0,class:"bg-red-700 rounded-sm"},Ze={key:1,class:"bg-green-500 rounded-sm"},Qe={key:0,class:"bg-red-700 rounded-sm"},We={key:1,class:"bg-green-500 rounded-sm"},Xe={key:0,class:"bg-red-700 rounded-sm"},et={key:1,class:"bg-green-500 rounded-sm"},tt={key:0,class:"bg-red-700 rounded-sm"},at={key:1,class:"bg-green-500 rounded-sm"},jt={__name:"absen",async setup(lt){let Y,z;const{$moment:w}=Ue(),te=t=>t.deleted==1?"!bg-red-400":t.req_deleted==1?"!bg-yellow-300":t.ritase_val2==1?"!bg-blue-300":"",P=t=>(t.map(a=>{a.class_h=te(a)}),t);let K=o({clearCheckBox:!1});const x=o("Undone");Se(()=>x.value,t=>{ee.value.map(a=>{let p=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(a.key)>-1;return["all","deleted","req_deleted"].indexOf(t)>-1?p&&(a.tbl_show=1):p&&(a.tbl_show=0),a}),Q()},{immediate:!1});const s={};s._TimeZoneOffset=new Date().getTimezoneOffset(),s.sort="tanggal:desc";const G=o({}),$=o({from:"",to:""}),S=Ce("token"),{data:ae}=([Y,z]=Me(async()=>Oe(async()=>{m().loading_full=!0;let t=[];const[a,p]=await Promise.all([O("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{filter_status:x},retry:0})]);return a.status.value!=="error"&&(t=P(a.data.value.data)),a.status.value==="error"?(B().trigger(a.error),{trx_trps:t}):(m().loading_full=!1,{trx_trps:t})},"$Tkqpaz2JeJ")),Y=await Y,z(),Y),i=o(ae.value.trx_trps||[]);o([]),o(!1);const U=o({field:"tanggal",by:"desc"}),_=o(-1),A=q(()=>i.value[_.value]),c=o({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),L=()=>{s.like="";let t=JSON.parse(JSON.stringify(m()._tv.global_keyword));t!=""&&(s.like=`id:%${t}%,xto:%${t}%,jenis:%${t}%,pv_no:%${t}%,ticket_a_no:%${t}%,ticket_b_no:%${t}%,no_pol:%${t}%,supir:%${t}%,kernet:%${t}%,cost_center_code:%${t}%,cost_center_desc:%${t}%,pvr_no:%${t}%,tanggal:%${t}%,transition_target:%${t}%,uj_asst_opt:%${t}%`),s.sort="",U.value.field&&(s.sort=U.value.field+":"+U.value.by),s.date_from=$.value.from?w($.value.from).format("YYYY-MM-DD"):"",s.date_to=$.value.to?w($.value.to).format("YYYY-MM-DD"):"",s.filter_model=JSON.stringify(m()._tv.filter_model)},Z=async()=>{m().loading_full=!0,G.value={},c.value.may_get_data=!1,s.page=c.value.page,s.page==1&&(i.value=[]),s.first_row&&delete s.first_row,s.page>1&&(s.first_row=JSON.stringify(i.value[0])),s.filter_status=x.value;const{data:t,error:a,status:p}=await O("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:s,retry:0});if(m().loading_full=!1,c.value.may_get_data=!0,p.value==="error"){B().trigger(a,G);return}c.value.page==1?i.value=P(t.value.data):c.value.page>1&&(i.value=[...i.value,...P(t.value.data)]),t.value.data.length==0&&(c.value.is_last_record=!0),m()._tv.filter_box=!1},Q=()=>{_.value=-1,c.value.page=1,c.value.is_last_record=!1,L(),Z()},j=o(!1),W=o(0),{display:I}=Ne(),le=()=>{_.value==-1?I({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(W.value=i.value[_.value].id,j.value=!0)},C=o(!1),M=o(0),E=o(!1),se=()=>{_.value==-1?I({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value=i.value[_.value].id,C.value=!0,E.value=!1)},oe=()=>{_.value==-1?I({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value=i.value[_.value].id,C.value=!0,E.value=!0)},X=o(!1),re=o(0),F=o([]),ne=async()=>{m().loading_full=!0;const t=new FormData;t.append("ids",JSON.stringify(F.value)),t.append("_method","PUT");const{data:a,error:p,status:V}=await O("/trx_trp/absen/clear_valval1",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,V.value==="error"){B().trigger(p);return}a.value.val_lists.forEach(k=>{let T=i.value.map(f=>f.id).indexOf(k.id);if(T>-1){let f=i.value[T];f.ritase_val=k.ritase_val,f.ritase_val1=k.ritase_val1,f.ritase_val2=k.ritase_val2,f.updated_at=k.updated_at,i.value.splice(T,1,{...f})}}),K.value.clearCheckBox=!0},ee=o([{key:"cb",label:"",checkbox:"id"},{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"rla",label:"B"},{key:"raa",label:"T"},{key:"rra",label:"K"},{key:"rta",label:"S"},{key:"ritase_leave_at",label:"Berangkat"},{key:"ritase_arrive_at",label:"Tiba"},{key:"ritase_return_at",label:"Kembali"},{key:"ritase_till_at",label:"Sampai"},{key:"ritase_note",label:"Note"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"uj_asst_opt",label:"Info",filter_on:1,type:"select",select_item:["DENGAN KERNET","TANPA KERNET"]},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),ie=q(()=>_.value>-1&&R().checkPermission("trp_trx.absen.view")),_e=q(()=>_.value>-1&&[void 0,0].indexOf(A.value.deleted)>-1&&[void 0,0].indexOf(A.value.req_deleted)>-1&&[void 0,0].indexOf(A.value.ritase_val)>-1&&R().checkPermission("trp_trx.absen.modify")),de=q(()=>_.value>-1&&[void 0,0].indexOf(A.value.deleted)>-1&&[void 0,0].indexOf(A.value.req_deleted)>-1&&R().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1","trp_trx.absen.val2"])),{downloadFile:ue,viewFile:st}=je(),pe=async()=>{L(),m().loading_full=!0,s.filter_status=x.value;const{data:t,error:a,status:p}=await O("/trx_trp/absen/download_excel",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:s,retry:0});if(m().loading_full=!1,p.value==="error"){B().trigger(a);return}ue(t.value)};return(t,a)=>{const p=be,V=ye,k=xe,T=ke,f=ge,J=he,g=we,N=De,me=Ae,ce=Te,fe=Ye,ve=$e;return r(),u("div",Ie,[n(p,{title:"List Transaction"}),y("div",Ee,[y("div",Fe,[y("div",Ve,[y("div",Je,[qe(y("select",{class:"","onUpdate:modelValue":a[0]||(a[0]=e=>Be(x)?x.value=e:null)},ze,512),[[He,l(x)]])]),l(_e)?(r(),u("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=e=>le())},[n(V)])):H("",!0),l(ie)?(r(),u("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=e=>oe())},[n(k)])):H("",!0),l(de)?(r(),u("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=e=>se())},[n(T)])):H("",!0),y("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:a[4]||(a[4]=e=>pe())},[n(f),b(),Ke])]),y("div",Ge,[l(F).length>0?(r(),u("button",{key:0,type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:a[5]||(a[5]=e=>ne())}," Multi UnVal ")):H("",!0)])]),n(me,{thead:l(ee),selected:l(_),onSetSelected:a[6]||(a[6]=e=>_.value=e),tbody:l(i),fnCallData:Z,scrolling:l(c),onSetScrollingPage:a[7]||(a[7]=e=>l(c).page=e),onDoFilter:a[8]||(a[8]=e=>Q()),onSetCheckbox:a[9]||(a[9]=e=>F.value=e),deep_state:l(K)},{ritase_val:d(({item:e})=>[e.ritase_val?(r(),D(g,{key:1})):(r(),D(J,{key:0}))]),ritase_val1:d(({item:e})=>[e.ritase_val1?(r(),D(g,{key:1})):(r(),D(J,{key:0}))]),ritase_val2:d(({item:e})=>[e.ritase_val2?(r(),D(g,{key:1})):(r(),D(J,{key:0}))]),uj_asst_opt:d(({item:e})=>{var v;return[b(h((v=e.uj)==null?void 0:v.asst_opt),1)]}),ritase_leave_at:d(({item:e})=>[b(h(e.ritase_leave_at?l(w)(e.ritase_leave_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rla:d(({item:e})=>[e.ritase_leave_at?(r(),u("div",Ze,[n(g,{class:"text-white text-xl font-bold"})])):(r(),u("div",Le,[n(N,{class:"text-white text-xl font-bold"})]))]),ritase_arrive_at:d(({item:e})=>[b(h(e.ritase_arrive_at?l(w)(e.ritase_arrive_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),raa:d(({item:e})=>[e.ritase_arrive_at?(r(),u("div",We,[n(g,{class:"text-white text-xl font-bold"})])):(r(),u("div",Qe,[n(N,{class:"text-white text-xl font-bold"})]))]),ritase_return_at:d(({item:e})=>[b(h(e.ritase_return_at?l(w)(e.ritase_return_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rra:d(({item:e})=>[e.ritase_return_at?(r(),u("div",et,[n(g,{class:"text-white text-xl font-bold"})])):(r(),u("div",Xe,[n(N,{class:"text-white text-xl font-bold"})]))]),ritase_till_at:d(({item:e})=>[b(h(e.ritase_till_at?l(w)(e.ritase_till_at).format("DD-MM-YYYY HH:mm:ss"):""),1)]),rta:d(({item:e})=>[e.ritase_till_at?(r(),u("div",at,[n(g,{class:"text-white text-xl font-bold"})])):(r(),u("div",tt,[n(N,{class:"text-white text-xl font-bold"})]))]),deleted_by_username:d(({item:e})=>{var v;return[b(h((v=e.deleted_by)==null?void 0:v.username),1)]}),req_deleted_by_username:d(({item:e})=>{var v;return[b(h((v=e.req_deleted_by)==null?void 0:v.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling","deep_state"])]),n(ce,{show:l(j),fnClose:()=>{j.value=!1},id:l(W),p_data:l(i)},null,8,["show","fnClose","id","p_data"]),n(fe,{show:l(C),fnClose:()=>{C.value=!1},id:l(M),p_data:l(i),is_view:l(E),onSetID:a[10]||(a[10]=e=>M.value=e),onSetIndex:a[11]||(a[11]=e=>_.value=e)},null,8,["show","fnClose","id","p_data","is_view"]),n(ve,{show:l(X),fnClose:()=>{X.value=!1},index:l(re),p_data:l(i)},null,8,["show","fnClose","index","p_data"])])}}};export{jt as default};
