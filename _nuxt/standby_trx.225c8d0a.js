import{_ as xe}from"./HeaderPopup.vue.d65961ae.js";import{_ as ye}from"./WidthMiniList.vue.8fecaa17.js";import be from"./Tools.59996675.js";import{_ as ke}from"./client-only.d61bb849.js";import ge from"./AttachmentSingle.49cf95bd.js";import Se from"./Times.55bb2602.js";import Ne from"./Check.f17b370a.js";import Oe from"./Plus.d9933a2b.js";import Ue from"./ToolsPopup.f69b7393.js";import{r as f,g as Ce,j as Ie,i as se,f as ae,x as C,I as Je,o as i,c as d,k as g,K as Te,a as e,b as S,l as s,A,F as J,D,t as c,v as le,n as N,w as oe,z as R,E as Ve,C as Ee,y as M,p as Ae,e as De,G as Pe}from"./entry.d3b1eb86.js";import{u as ne}from"./useUtils.20b3b5b9.js";import{u as K}from"./useMyFetch.e123b428.js";import{_ as Re}from"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.9afc4991.js";import"./PDFJsView.ad4e5781.js";const r=O=>(Ae("data-v-0a592711"),O=O(),De(),O),je={class:"box-fixed"},Fe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},$e={class:"w-full flex flex-col items-center grow overflow-auto"},Be={class:"w-full flex flex-row flex-wrap"},Me={class:"w-full sm:w-9/12 flex px-2 py-3"},Ke={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},ze=r(()=>e("div",{class:"absolute bg-white -top-3"}," Standby ",-1)),qe={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},Le=r(()=>e("label",{for:""},"ID",-1)),He=["disabled"],We={id:"standby_mst"},Ye=["value"],Ge={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Qe=r(()=>e("label",{for:""},"Name",-1)),Ze={class:"card-border disabled"},et={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},tt=r(()=>e("label",{for:""},"Type",-1)),st={class:"card-border disabled"},at={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},lt=r(()=>e("label",{for:""},"Amount",-1)),ot={class:"card-border disabled"},nt={class:"w-full sm:w-3/12 flex px-2 py-3"},it={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative items-end"},_t=r(()=>e("div",{class:"absolute bg-white -top-3"}," Peralihan ",-1)),rt={class:"w-6/12 flex flex-col flex-wrap p-1"},dt=["disabled"],ut=r(()=>e("option",{value:""},null,-1)),ct=r(()=>e("option",{value:"From"},"Dari",-1)),pt=r(()=>e("option",{value:"To"},"Ke",-1)),mt=[ut,ct,pt],vt={class:"text-red-500"},ft={class:"w-6/12 flex flex-col flex-wrap p-1"},ht=["disabled"],wt=r(()=>e("option",{value:""},null,-1)),xt=["value"],yt={class:"text-red-500"},bt={class:"w-full flex flex-wrap"},kt={key:0,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},gt=r(()=>e("label",{for:""},"Supir",-1)),St={class:"text-red-500"},Nt={key:1,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ot=r(()=>e("label",{for:""},"Kernet",-1)),Ut={class:"text-red-500"},Ct={class:"w-full flex flex-wrap"},It={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Jt=r(()=>e("label",{for:""},"No Pol",-1)),Tt=["disabled"],Vt={id:"vehicle"},Et=["value"],At={class:"text-red-500"},Dt={key:0,class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Pt=r(()=>e("label",{for:""},"Tujuan",-1)),Rt=["disabled"],jt={id:"xto"},Ft={class:"text-red-500"},$t={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Bt=r(()=>e("label",{for:""},"Note For Remarks",-1)),Mt=["disabled"],Kt={class:"text-red-500"},zt={key:1,class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},qt=r(()=>e("label",{for:""},"Trx Trp ID#",-1)),Lt=["disabled"],Ht={class:"text-red-500"},Wt={class:"w-full flex grow p-1 overflow-auto 2xl:overflow-hidden justify-between flex-wrap"},Yt={class:"w-full",role:"sticky"},Gt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Xt={class:"sticky -top-1 !z-[2]"},Qt=["colspan"],Zt={class:"sticky top-7 !z-[2]"},es={key:0,class:"!min-w-[30px] !w-[30px] !max-w-[30px]"},ts=r(()=>e("th",{class:"!min-w-[50px] !w-[50px] !max-w-[50px]"},"No",-1)),ss=r(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Tanggal",-1)),as=r(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Waktu",-1)),ls=r(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Foto",-1)),os=r(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Note",-1)),ns=r(()=>e("th",{class:"!min-w-[70px] !w-[70px] !max-w-[70px]"},"Dibayar",-1)),is={ref:"to_move"},_s=["data-index"],rs={key:0,class:"tools cell"},ds={class:"w-full h-auto flex items-center justify-center"},us=["onClick"],cs={class:"cell"},ps={class:"w-full h-auto flex items-center justify-center relative"},ms={class:"cell"},vs={class:"w-full h-auto flex items-center justify-center relative"},fs={class:"cell"},hs={style:{width:"60vw"},class:"h-auto flex items-center justify-center"},ws={class:"cell"},xs={class:"h-auto flex items-center justify-center"},ys=["onUpdate:modelValue"],bs={class:"w-full h-auto flex items-center justify-center"},ks={key:0},gs={class:"tools cell"},Ss={class:"w-full flex items-center justify-end"},Ns={__name:"standby_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(O){const k=O,{$moment:ie}=Pe(),{pointFormat:z}=ne(),j={id:-1,transition_target:"",transition_type:"",standby_mst_id:"",standby_mst_:{name:"",tipe:"",amount:0,is_transition:0,is_trip:0},supir:"",kernet:"",no_pol:"",xto:"",note_for_remarks:"",trx_trp_id:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:0,pv_id:"",pv_no:"",pv_total:0,pv_datetime:"",rv_id:"",rv_no:"",rv_total:0,rv_had_detail:"",details:[],details_count:0},u=f([]),q=f({ordinal:0,id:"",tanggal:new Date,f_waktu:null,waktu:null,note:"",be_paid:0,p_status:"",attachment_1:"",attachment_1_preview:""});let F={...j};const t=f({...j}),$=Ce("token"),h=f({});Ie();const _e=async()=>{C().loading_full=!0,h.value={};const o=new FormData;o.append("transition_target",t.value.transition_target),o.append("transition_type",t.value.transition_type),o.append("standby_mst_id",t.value.standby_mst_id),o.append("supir_id",p.value.id),o.append("kernet_id",m.value.id),o.append("no_pol",t.value.no_pol),o.append("xto",t.value.xto),o.append("note_for_remarks",t.value.note_for_remarks),o.append("trx_trp_id",t.value.trx_trp_id);let a=[...u.value];a=a.map((_,V)=>(_.tanggal=_.tanggal?ie(_.tanggal).format("Y-MM-DD"):"",_.waktu=_.f_waktu?_.f_waktu.hours.toString().padStart(2,"0")+":"+_.f_waktu.minutes.toString().padStart(2,"0"):"",_.attachment_1_preview=_.attachment_1_preview?"Exists":null,o.append(`attachments[${V}]`,_.attachment_1),_)),o.append("details",JSON.stringify(a));let y="post",n=k.id;n==0||(o.append("id",n),o.append("_method","PUT"));const{data:U,error:v,status:I}=await K("/standby_trx",{method:y,headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},body:o,retry:0});if(C().loading_full=!1,I.value==="error"){M().trigger(v,h);return}if(t.value.details=[...u.value].map((_,V)=>(_.attachment_1_type=_.attachment_1_preview?"Exists":"",_)),t.value.details_count=u.value.filter(_=>_.be_paid==1).length,t.value.supir=p.value.name,t.value.supir_rek_no=p.value._.rek_no.val,t.value.supir_rek_name=p.value._.rek_name.val,t.value.kernet=m.value.name,t.value.kernet_rek_no=m.value._.rek_no.val,t.value.kernet_rek_name=m.value._.rek_name.val,t.value.updated_at=U.value.updated_at,k.id<=0)t.value.id=U.value.id,t.value.created_at=U.value.created_at,k.p_data.unshift(t.value);else{let _=k.p_data.map(V=>V.id).indexOf(k.id);_>=-1&&k.p_data.splice(_,1,{...t.value})}k.fnClose()},x={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},p=f(JSON.parse(JSON.stringify(x))),m=f(JSON.parse(JSON.stringify(x))),L=se(()=>{let o=[];return Y.value.forEach((a,y)=>{let n=JSON.parse(JSON.stringify(x));n._.id.val=a.id,n._.name.val=a.name,n._.rek_no.val=a.rek_no,n._.rek_name.val=a.rek_name,n.id=a.id,n.name=a.name,n.title=(a.rek_no||"")+" "+(a.rek_name||""),o.push(JSON.parse(JSON.stringify(n)))}),o}),T=se(()=>!1),re=async()=>{C().loading_full=!0;const{data:o,error:a,status:y}=await K("/standby_trx",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},params:{id:k.id},retry:0});if(C().loading_full=!1,y.value==="error"){M().trigger(a);return}let n=o.value.data;t.value=n,F={...n},p.value._.id.val=n.supir_id,p.value._.name.val=n.supir,p.value._.rek_no.val=n.supir_rek_no,p.value._.rek_name.val=n.supir_rek_name,p.value.id=n.supir_id,p.value.name=n.supir,p.value.rek_no=(n.supir_rek_no||"")+" "+(n.supir_rek_name||""),m.value._.id.val=n.kernet_id,m.value._.name.val=n.kernet,m.value._.rek_no.val=n.kernet_rek_no,m.value._.rek_name.val=n.kernet_rek_name,m.value.id=n.kernet_id,m.value.name=n.kernet,m.value.rek_no=(n.kernet_rek_no||"")+" "+(n.kernet_rek_name||"");let U="Edit";u.value=o.value.data.details.map(v=>{if(v.waktu!=""){let I=v.waktu.split(":");v.f_waktu={hours:I[0],minutes:I[1]}}else v.f_waktu=null;return v.p_status=U,v.key=v.ordinal,v})},B=f([]),H=f([]),W=f([]),Y=f([]),de=async()=>{C().loading_full=!0;const{data:o,error:a,status:y}=await K("/standby_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},retry:0});if(C().loading_full=!1,y.value==="error"){M().trigger(a);return}B.value=o.value.list_standby_mst,H.value=o.value.list_xto,W.value=o.value.list_vehicle,Y.value=o.value.list_employee},w=f(-1),P=f(!1),G=f({left:0,top:0}),ue=(o,a)=>{w.value=a,P.value=!0,G.value={left:o.clientX,top:o.clientY}},ce=()=>{u.value.push({...q.value,p_status:"Add"})},pe=()=>{P.value=!1},me=(o="")=>{if(o=="insert")u.value.splice(w.value,0,{...q.value,p_status:"Add"});else if(o=="delete")u.value[w.value].p_status=="Edit"?u.value[w.value].p_status="Remove":u.value.splice(w.value,1);else if(o=="move_top"){let a=u.value[w.value];u.value.splice(w.value,1),u.value.splice(w.value-1,0,{...a})}else if(o=="move_bottom"){let a=u.value[w.value];u.value.splice(w.value,1),u.value.splice(w.value+1,0,{...a})}P.value=!1};ae(()=>k.show,async(o,a)=>{o==!0&&(await de(),t.value={...j},p.value=JSON.parse(JSON.stringify(x)),m.value=JSON.parse(JSON.stringify(x)),u.value=[],h.value={},k.id!=0&&re())},{immediate:!0});let ve={name:"",tipe:"",amount:0,is_transition:0};return ae(()=>t.value.standby_mst_id,(o,a)=>{var y;if(C().loading_full==!1&&(o==""||o!="")){let n=B.value.filter(v=>v.id==o);switch(n.length>0?t.value.standby_mst_={...n[0]}:t.value.standby_mst_id==F.standby_mst_id?t.value.standby_mst_={...F.standby_mst_}:t.value.standby_mst_={...ve},t.value.standby_mst_.is_transition||(t.value.transition_target="",t.value.transition_type=""),(y=t.value.standby_mst_)==null?void 0:y.driver_asst_opt){case"SUPIR":m.value=JSON.parse(JSON.stringify(x));break;case"KERNET":p.value=JSON.parse(JSON.stringify(x));break;case"SUPIR KERNET":break;default:p.value=JSON.parse(JSON.stringify(x)),m.value=JSON.parse(JSON.stringify(x));break}t.value.standby_mst_.is_trip==0&&(t.value.xto="",t.value.trx_trp_id="")}},{}),(o,a)=>{var X,Q,Z,ee,te;const y=xe,n=ye,U=be,v=Je("vue-date-picker"),I=ke,_=ge,V=Se,fe=Ne,he=Oe,we=Ue;return i(),d(J,null,[g(e("section",je,[e("div",null,[S(y,{title:"Form Transaction",fn:O.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Fe,[e("div",$e,[e("div",Be,[e("div",Me,[e("div",Ke,[ze,e("div",qe,[Le,g(e("input",{type:"text",list:"standby_mst","onUpdate:modelValue":a[0]||(a[0]=l=>s(t).standby_mst_id=l),disabled:s(t).pvr_no!=""},null,8,He),[[A,s(t).standby_mst_id]]),e("datalist",We,[(i(!0),d(J,null,D(s(B),l=>(i(),d("option",{value:l.id},c(l.name+"-"+l.tipe+"-"+s(z)(l.amount||0)),9,Ye))),256))]),e("p",Ge,c(s(h).standby_mst_id),1)]),e("div",Xe,[Qe,e("div",Ze,c((X=s(t).standby_mst_)==null?void 0:X.name),1)]),e("div",et,[tt,e("div",st,c((Q=s(t).standby_mst_)==null?void 0:Q.tipe),1)]),e("div",at,[lt,e("div",ot,c(s(z)((Z=s(t).standby_mst_)==null?void 0:Z.amount)),1)])])]),e("div",nt,[e("div",it,[_t,e("div",rt,[g(e("select",{"onUpdate:modelValue":a[1]||(a[1]=l=>s(t).transition_type=l),disabled:((ee=s(t).standby_mst_)==null?void 0:ee.is_transition)==0},mt,8,dt),[[le,s(t).transition_type]]),e("p",vt,c(s(h).transition_type),1)]),e("div",ft,[g(e("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>s(t).transition_target=l),disabled:((te=s(t).standby_mst_)==null?void 0:te.is_transition)==0},[wt,(i(!0),d(J,null,D(s(C)().list_pabrik,l=>(i(),d("option",{value:l},c(l),9,xt))),256))],8,ht),[[le,s(t).transition_target]]),e("p",yt,c(s(h).transition_target),1)])])]),e("div",bt,[["SUPIR","SUPIR KERNET"].indexOf(s(t).standby_mst_.driver_asst_opt)>-1?(i(),d("div",kt,[gt,S(n,{arr:s(L),selected:s(p),pure:x,onSetSelected:a[3]||(a[3]=l=>p.value=l)},null,8,["arr","selected"]),e("p",St,c(s(h).supir_id),1)])):N("",!0),["KERNET","SUPIR KERNET"].indexOf(s(t).standby_mst_.driver_asst_opt)>-1?(i(),d("div",Nt,[Ot,S(n,{arr:s(L),selected:s(m),pure:x,onSetSelected:a[4]||(a[4]=l=>m.value=l)},null,8,["arr","selected"]),e("p",Ut,c(s(h).kernet_id),1)])):N("",!0)]),e("div",Ct,[e("div",It,[Jt,g(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=l=>s(t).no_pol=l),disabled:s(t).pvr_no!=""},null,8,Tt),[[A,s(t).no_pol]]),e("datalist",Vt,[(i(!0),d(J,null,D(s(W),l=>(i(),d("option",{value:l.no_pol},c(l.no_pol),9,Et))),256))]),e("p",At,c(s(h).no_pol),1)]),s(t).standby_mst_.is_trip==1?(i(),d("div",Dt,[Pt,g(e("input",{type:"text",list:"xto","onUpdate:modelValue":a[6]||(a[6]=l=>s(t).xto=l),disabled:s(t).pvr_no!=""},null,8,Rt),[[A,s(t).xto]]),e("datalist",jt,[(i(!0),d(J,null,D(s(H),l=>(i(),d("option",null,c(l),1))),256))]),e("p",Ft,c(s(h).xto),1)])):N("",!0),e("div",$t,[Bt,g(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=l=>s(t).note_for_remarks=l),disabled:s(t).pvr_no!=""}," ",8,Mt),[[A,s(t).note_for_remarks]]),e("p",Kt,c(s(h).note_for_remarks),1)]),s(t).standby_mst_.is_trip==1?(i(),d("div",zt,[qt,g(e("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=l=>s(t).trx_trp_id=l),disabled:s(t).pvr_no!=""},null,8,Lt),[[A,s(t).trx_trp_id]]),e("p",Ht,c(s(h).trx_trp_id),1)])):N("",!0)]),e("div",Wt,[e("div",Yt,[e("table",Gt,[e("thead",null,[e("tr",Xt,[e("td",{colspan:s(T)?6:7,class:"!bg-slate-800 text-white font-bold"}," Detail Transaction ",8,Qt)]),e("tr",Zt,[s(T)?N("",!0):(i(),d("th",es)),ts,ss,as,ls,os,ns])]),e("tbody",is,[(i(!0),d(J,null,D(s(u),(l,E)=>(i(),d(J,{key:E},[l.p_status!="Remove"?(i(),d("tr",{key:0,"data-index":E},[s(T)?N("",!0):(i(),d("td",rs,[e("div",ds,[e("button",{type:"button",name:"button",onClick:b=>ue(b,E)},[S(U)],8,us)])])),e("td",null,c(E+1)+".",1),e("td",cs,[e("div",ps,[S(I,null,{default:oe(()=>[(i(),R(v,{key:E,modelValue:l.tanggal,"onUpdate:modelValue":b=>l.tanggal=b,type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)])]),e("td",ms,[e("div",vs,[S(I,null,{default:oe(()=>[(i(),R(v,{key:E,modelValue:l.f_waktu,"onUpdate:modelValue":b=>l.f_waktu=b,type:"time",format:"HH:mm","text-input":"","teleport-center":"","time-picker":""},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)])]),e("td",fs,[e("div",hs,[S(_,{value:l.attachment_1_preview,onSetFile:b=>l.attachment_1=b,onSetPreview:b=>l.attachment_1_preview=b,can_remove:!0},null,8,["value","onSetFile","onSetPreview"])])]),e("td",ws,[e("div",xs,[g(e("textarea",{class:"h-full","onUpdate:modelValue":b=>l.note=b},null,8,ys),[[A,l.note]])])]),e("td",{class:Ve(["cell",(!("useUtils"in o?o.useUtils:s(ne))().checkPermissions(["standby_trx.detail.decide_paid"])||s(T),"unselectable")])},[e("div",bs,[l.be_paid==0?(i(),R(V,{key:0,class:"text-red-800"})):(i(),R(fe,{key:1,class:"text-green-800"}))])],2)],8,_s)):N("",!0)],64))),128)),s(T)?N("",!0):(i(),d("tr",ks,[e("td",gs,[e("button",{type:"button",name:"button",onClick:a[9]||(a[9]=l=>ce())},[S(he)])])]))],512)])])])])]),e("div",Ss,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[10]||(a[10]=l=>O.fnClose())}," Cancel "),s(T)?N("",!0):(i(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[11]||(a[11]=Ee(l=>_e(),["prevent"]))}," Save "))])])])],512),[[Te,O.show]]),S(we,{show:s(P),coor:s(G),fn:pe,data:s(u),data_index:s(w),onReplyAct:a[12]||(a[12]=l=>me(l))},null,8,["show","coor","data","data_index"])],64)}}},Bs=Re(Ns,[["__scopeId","data-v-0a592711"]]);export{Bs as default};
