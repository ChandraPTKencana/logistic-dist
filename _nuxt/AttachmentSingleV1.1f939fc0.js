import P from"./PDFJsView.4fa29022.js";import{Q as S,a4 as B,M as I,r as o,g as V,a2 as $,f as U,o as u,c as v,a as h,t as q,l as c,n as y,z as A,k as j,L}from"./entry.050cce63.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";function M(i,f,l,p){let n,a=!1;S(()=>{n=new IntersectionObserver(async([t])=>{t.isIntersecting&&!a&&(a=!0,await f())},{threshold:0,rootMargin:"300px",...p}),i.value&&n.observe(i.value)}),B(()=>{n==null||n.disconnect(),l==null||l()})}const z={class:"w-full"},N={for:""},E={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},J={class:"image-box"},Q={key:0},W=["src"],G={key:1,class:"skeleton"},H=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(i,{emit:f}){const l=i;o(!1);const p=o(null);o(null),o(null);const n=o(null),a=o(null);let t=null;const O=V("token"),{apiBase:R}=$(),d=o(),_=o(!1),m=o(!1),F=e=>{const s=e.target.files;if(!s||!s.length)return;m.value=!0;const r=s[0];d.value=r,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(r),a.value=t,f("setPreview","exist"),f("setFile",r)},C=()=>{k(!0);const e=p.value;e&&(e.value=""),f("setFile",null),f("setPreview",null)};U(()=>l.show,e=>{k(!0),_.value=!1,m.value=!1},{immediate:!0,deep:!0}),U(()=>l.link,e=>{e&&n.value&&b()},{immediate:!0});async function b(){if(!l.link||a.value||l.link=="exist"||m.value||_.value)return;const e=l.link.startsWith("http")?l.link:`${R}${l.link}`,s=await fetch(e,{headers:{Authorization:`Bearer ${O.value}`}});if(!s.ok){let r=p.value;r&&(r.value="");return}d.value=await s.blob(),t=URL.createObjectURL(d.value),a.value=t,_.value=!0}function k(e=!1){m.value&&e==!1||_.value&&e==!1||(t&&(URL.revokeObjectURL(t),t=null),a.value=null,d.value=null)}return M(n,b,k,{rootMargin:"300px 0px",threshold:0}),B(()=>{_.value=!1}),(e,s)=>{var w,g;const r=P;return u(),v("div",{ref_key:"wrapper",ref:n,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[h("div",z,[h("label",N,q(i.label),1)]),h("div",E,[h("div",J,[c(a)?(u(),v("div",Q,[(w=c(d))!=null&&w.type.match(/image/)?(u(),v("img",{key:0,src:c(a),class:"w-full h-full object-cover"},null,8,W)):y("",!0),(g=c(d))!=null&&g.type.match(/application\/pdf/)?(u(),A(r,{key:1,pdfObjUrl:c(t)},null,8,["pdfObjUrl"])):y("",!0)])):(u(),v("div",G))])]),i.can_remove?j((u(),v("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:s[0]||(s[0]=x=>C())},"Clear",512)),[[L,c(a)]]):y("",!0),i.can_remove?j((u(),v("input",{key:1,class:"w-full",onChange:s[1]||(s[1]=x=>F(x)),ref_key:"photo_input",ref:p,type:"file",name:"photo"},null,544)),[[L,!c(a)]]):y("",!0)],512)}}});const Y=D(H,[["__scopeId","data-v-905ccd17"]]);export{Y as default};
