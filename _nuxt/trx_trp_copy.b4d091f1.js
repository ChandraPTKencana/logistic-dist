var oe=Object.defineProperty;var R=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var W=(c,i,d)=>i in c?oe(c,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[i]=d,k=(c,i)=>{for(var d in i||(i={}))se.call(i,d)&&W(c,d,i[d]);if(R)for(var d of R(i))ne.call(i,d)&&W(c,d,i[d]);return c};var B=(c,i,d)=>new Promise((U,b)=>{var w=r=>{try{j(d.next(r))}catch(D){b(D)}},e=r=>{try{j(d.throw(r))}catch(D){b(D)}},j=r=>r.done?U(r.value):Promise.resolve(r.value).then(w,e);j((d=d.apply(c,i)).next())});import{M as ie,Q as re,U as A,N,V as E,W as K,X as de,Y as _e}from"./pages.b486181e.js";import{e as ue,_ as pe}from"./entry.9d4c4f80.js";import{r as y,c as V,w as $,e as ce,f as S,p as G,o as m,a as f,b as s,h as C,u as a,m as ve,n as me,t as h,l as F,F as M,j as P,v as fe,k as q,D as he}from"./vue-vendor.ccf46959.js";import"./state-vendor.7641a25c.js";const we={class:"box-fixed"},ge={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},xe={class:"w-full flex flex-col items-center grow overflow-auto"},ke={class:"w-full flex flex-row flex-wrap"},ye={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},be=s("label",{for:""},"U.Jalan Per",-1),je={key:0,class:"grow"},Se={key:1,class:"grow"},Ne={class:"text-red-500"},De={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Be=s("label",{for:""},"Jenis",-1),Ce=["disabled"],Te=s("option",{value:"TBS"},"TBS",-1),Oe=s("option",{value:"TBSK"},"TBSK",-1),Je=s("option",{value:"CPO"},"CPO",-1),Ae=s("option",{value:"PK"},"PK",-1),Ve=[Te,Oe,Je,Ae],$e={class:"text-red-500"},Fe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Me=s("label",{for:""},"Payment Method",-1),Pe=["disabled"],Ue=["value"],Ee={class:"text-red-500"},Ke={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},qe=s("label",{for:""},"No Pol",-1),Ie=["disabled"],Le={id:"vehicle"},Ye=["value"],ze={class:"text-red-500"},Re={key:0,class:"w-full flex flex-wrap"},We={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ge=s("label",{for:""},"Tujuan",-1),He=["disabled"],Qe={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ze=s("label",{for:""},"Tipe",-1),et=["disabled"],tt=["value","selected"],at={class:"text-red-500"},lt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},ot=s("label",{for:""},"Total Dari U.Jalan",-1),st={class:"card-border disabled"},nt={key:1,class:"w-full flex flex-wrap"},it={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},rt=s("label",{for:""},"Supir",-1),dt={class:"text-red-500"},_t={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ut=s("label",{for:""},"Kernet",-1),pt={class:"text-red-500"},ct={class:"w-full flex items-center justify-end"},gt={__name:"trx_trp_copy",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(c){const i=c,{$moment:d}=ue(),{pointFormat:U}=A(),b={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",payment_method_id:2,payment_method:{id:0,name:""},uj:{}};let w=k({},b);const e=y(k({},b)),j=ie("token"),r=y({}),D=l=>{e.value.transition_target=l.target.value=="TBS"?e.value.transition_target:""};re();const H=()=>B(this,null,function*(){N().loading_full=!0,r.value={};const l=new FormData;l.append("tanggal",d(e.value.tanggal).format("Y-MM-DD")),l.append("jenis",e.value.jenis),l.append("id_uj",e.value.id_uj),l.append("xto",e.value.xto),l.append("cost_center_code",e.value.cost_center_code),l.append("online_status",i.online_status),l.append("transition_target",e.value.transition_target),l.append("payment_method_id",e.value.payment_method_id),l.append("no_pol",e.value.no_pol),l.append("supir_id",p.value.id),l.append("kernet_id",u.value.id);let t="post",_=i.id;_==0||(l.append("id",_),l.append("_method","PUT"));const{data:o,error:v,status:g}=yield E("/trx_trp",{method:t,headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},body:l,retry:0});if(N().loading_full=!1,g.value==="error"){K().trigger(v,r);return}e.value.supir=p.value.name,e.value.supir_rek_no=p.value._.rek_no.val,e.value.supir_rek_name=p.value._.rek_name.val,e.value.kernet=u.value.name,e.value.kernet_rek_no=u.value._.rek_no.val,e.value.kernet_rek_name=u.value._.rek_name.val;let n=O.value.map(J=>J.id).indexOf(e.value.payment_method_id);if(e.value.payment_method=k({},O.value[n]),e.value.updated_at=o.value.updated_at,i.id<=0)e.value.id=o.value.id,e.value.created_at=o.value.created_at,i.p_data.unshift(e.value);else{let J=i.p_data.map(le=>le.id).indexOf(i.id);J>-1&&i.p_data.splice(J,1,k({},e.value))}i.fnClose()}),Q=V(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(T.value.filter(t=>t.jenis==l).map(t=>t.xto))]}),X=V(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return T.value.filter(t=>t.xto==e.value.xto&&t.jenis==l)}),x={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},p=y(JSON.parse(JSON.stringify(x))),u=y(JSON.parse(JSON.stringify(x))),I=V(()=>{let l=[];return Y.value.forEach((t,_)=>{let o=JSON.parse(JSON.stringify(x));o._.id.val=t.id,o._.name.val=t.name,o._.rek_no.val=t.rek_no,o._.rek_name.val=t.rek_name,o.id=t.id,o.name=t.name,o.title=(t.rek_no||"")+" "+(t.rek_name||""),o.note=Z(t),o._raw=t,l.push(JSON.parse(JSON.stringify(o)))}),l}),Z=l=>l.potongan?"Akan ada potong sebesar :"+A().pointFormat(l.potongan.nominal_cut):"",ee=V(()=>!1),te=()=>B(this,null,function*(){N().loading_full=!0;const{data:l,error:t,status:_}=yield E("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},params:{id:i.id},retry:0});if(N().loading_full=!1,_.value==="error"){K().trigger(t);return}let o=l.value.data;e.value=o,w=k({},o),p.value._.id.val=o.supir_id,p.value._.name.val=o.supir,p.value._.rek_no.val=o.supir_rek_no,p.value._.rek_name.val=o.supir_rek_name,p.value.id=o.supir_id,p.value.name=o.supir,p.value.rek_no=(o.supir_rek_no||"")+" "+(o.supir_rek_name||""),u.value._.id.val=o.kernet_id,u.value._.name.val=o.kernet,u.value._.rek_no.val=o.kernet_rek_no,u.value._.rek_name.val=o.kernet_rek_name,u.value.id=o.kernet_id,u.value.name=o.kernet,u.value.rek_no=(o.kernet_rek_no||"")+" "+(o.kernet_rek_name||"");let v=0,g=0;o.potongan.forEach(n=>{n.potongan_mst.employee_id==o.supir_id&&(v+=parseInt(n.nominal_cut)),n.potongan_mst.employee_id==o.kernet_id&&(g+=parseInt(n.nominal_cut))}),v>0&&(p.value.note="Telah di potong sebesar :"+A().pointFormat(v)),g>0&&(u.value.note="Telah di potong sebesar :"+A().pointFormat(g)),i.fnLoadDBData()}),T=y([]),L=y([]),Y=y([]),O=y([]),ae=()=>B(this,null,function*(){N().loading_full=!0;const{data:l,error:t,status:_}=yield E("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},retry:0});if(N().loading_full=!1,_.value==="error"){K().trigger(t);return}T.value=l.value.list_ujalan,L.value=l.value.list_vehicle,Y.value=l.value.list_employee,O.value=l.value.list_payment_methods});$(()=>i.show,(l,t)=>B(this,null,function*(){l==!0&&(yield ae(),yield i.fnLoadDBData(),e.value=k({},b),w=k({},b),p.value=JSON.parse(JSON.stringify(x)),u.value=JSON.parse(JSON.stringify(x)),r.value={},i.id!=0&&te())}),{immediate:!0}),$(()=>e.value.cost_center_code,(l,t)=>{let _="";if(l==""||l){let o=i.list_cost_center.filter(v=>v.CostCenter==e.value.cost_center_code);o.length>0?_=o[0].Description:e.value.cost_center_code==w.cost_center_code&&(_=w.cost_center_desc),e.value.cost_center_desc=_}},{deep:!0,immediate:!0});const z=(l,t)=>{let _=0,o="";if(l==""||l){let v=T.value.filter(g=>g.id==e.value.id_uj);v.length>0?(e.value.uj=v[0],_=v[0].harga,o=v[0].tipe):e.value.id_uj==w.id_uj&&(e.value.uj=w.uj,_=w.amount,o=w.tipe),e.value.tipe=o,e.value.amount=_,e.value.uj.asst_opt&&e.value.uj.asst_opt=="TANPA KERNET"&&!(w.kernet_id>1||e.val1==1)&&(u.value=JSON.parse(JSON.stringify(x)))}};return $(()=>e.value.xto,(l,t)=>{i.show&&z(l)},{deep:!0,immediate:!0}),$(()=>e.value.id_uj,(l,t)=>{i.show&&z(l)},{deep:!0,immediate:!0}),(l,t)=>{const _=de,o=ce("vue-date-picker"),v=pe,g=_e;return S((m(),f("section",we,[s("div",null,[C(_,{title:"Form Transaction",fn:c.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("form",ge,[s("div",xe,[s("div",ke,[s("div",ye,[be,a(e).val!==1?(m(),f("div",je,[C(v,null,{default:ve(()=>[C(o,{modelValue:a(e).tanggal,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(m(),f("div",Se,[s("div",{class:me(["card-border disabled",a(e).pvr_no!=""?"unselectable":""])},h(a(e).tanggal?a(d)(a(e).tanggal).format("DD-MM-YYYY"):""),3)])),s("p",Ne,h(a(r).tanggal),1)]),s("div",De,[Be,S(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>a(e).jenis=n),onChange:t[2]||(t[2]=n=>D(n)),disabled:a(e).val==1},Ve,40,Ce),[[F,a(e).jenis]]),s("p",$e,h(a(r).jenis),1)]),s("div",Fe,[Me,S(s("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>a(e).payment_method_id=n),disabled:a(e).val==1},[(m(!0),f(M,null,P(a(O),n=>(m(),f("option",{value:n.id},h(n.name),9,Ue))),256))],8,Pe),[[F,a(e).payment_method_id]]),s("p",Ee,h(a(r).payment_method_id),1)]),s("div",Ke,[qe,S(s("input",{type:"text",list:"vehicle","onUpdate:modelValue":t[4]||(t[4]=n=>a(e).no_pol=n),disabled:a(e).val==1},null,8,Ie),[[fe,a(e).no_pol]]),s("datalist",Le,[(m(!0),f(M,null,P(a(L),n=>(m(),f("option",{value:n.no_pol},h(n.no_pol),9,Ye))),256))]),s("p",ze,h(a(r).no_pol),1)]),a(e).jenis!=""?(m(),f("div",Re,[s("div",We,[Ge,S(s("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>a(e).xto=n),disabled:a(e).val==1},[(m(!0),f(M,null,P(a(Q),n=>(m(),f("option",null,h(n),1))),256))],8,He),[[F,a(e).xto]]),s("p",Qe,h(a(r).xto),1)]),s("div",Xe,[Ze,S(s("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>a(e).id_uj=n),disabled:a(e).val==1},[(m(!0),f(M,null,P(a(X),n=>(m(),f("option",{value:n.id,selected:n.id==a(e).id_uj},h(n.tipe),9,tt))),256))],8,et),[[F,a(e).id_uj]]),s("p",at,h(a(r).id_uj),1)]),s("div",lt,[ot,s("div",st,h(a(U)(a(e).amount)),1)])])):q("",!0),a(e).uj.asst_opt?(m(),f("div",nt,[s("div",it,[rt,C(g,{arr:a(I),selected:a(p),pure:x,onSetSelected:t[7]||(t[7]=n=>p.value=n),disabled:a(w).supir_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",dt,h(a(r).supir_id),1)]),S(s("div",_t,[ut,C(g,{arr:a(I),selected:a(u),pure:x,onSetSelected:t[8]||(t[8]=n=>u.value=n),disabled:a(w).kernet_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",pt,h(a(r).kernet_id),1)],512),[[G,a(e).uj.asst_opt=="DENGAN KERNET"]])])):q("",!0)])]),s("div",ct,[s("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[9]||(t[9]=n=>c.fnClose())}," Cancel "),a(ee)?q("",!0):(m(),f("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[10]||(t[10]=he(n=>H(),["prevent"]))}," Save "))])])])],512)),[[G,c.show]])}}};export{gt as default};
