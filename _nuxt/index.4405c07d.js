import pt from"./Header.5b4987b2.js";import dt from"./PrinterEye.4d059202.js";import ft from"./Table2Column.35e39afd.js";import bt from"./Eyes.32894b88.js";import mt from"./Line.92979827.js";import yt from"./Check.313cb80f.js";import kt from"./TableView.50d39138.js";import{_ as ht}from"./PopupMini.vue.cf0486c5.js";import vt from"./Times.c32cdb9b.js";import{_ as gt}from"./HeaderPopup.vue.75317d7a.js";import{r as _,h as xt,k as wt,i as Dt,z as V,A as $t,x as c,K as Tt,c as g,b as y,a,w as u,m as s,G as At,n as St,v as Ct,t as l,F as q,D as L,l as Bt,y as x,o as p,E as Mt,J as w,d,H as Nt}from"./entry.9bfb7e63.js";import{u as Z}from"./useUtils.4001deaf.js";import{u as D}from"./useMyFetch.18476d33.js";import{u as Pt}from"./useDownload.737fa5e3.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.fe5244d6.js";import"./Adjust.6928d3be.js";import"./TableHeaderEye.0e0e604c.js";import"./ClearAll.01a6f73a.js";import"./client-only.54530c7e.js";import"./ClearEach.58c1b831.js";import"./CaretLeftDoubleBold.4d745ea1.js";import"./CaretLeftBold.f7a859d3.js";import"./CaretRightBold.affbd0b0.js";import"./CaretRightDoubleBold.4c00fc6e.js";import"./Exclamation.e1e899ad.js";const Ht={class:"w-full h-full flex flex-col"},Yt={class:"w-full flex grow flex-col overflow-auto h-0"},jt={class:"w-full flex"},Ft={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Rt={class:"relative",style:{width:"95%",height:"90%"}},zt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ot=["src"],Kt={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},Et={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},It={class:"p-1 flex flex-wrap overflow-auto items-start"},Jt={class:"w-full sm:w-1/2 flex flex-wrap"},Ut={class:"flex flex-col m-2"},Vt=a("span",{class:"text-xs"}," To ",-1),qt={class:""},Lt={class:"flex flex-col m-2"},Zt=a("span",{class:"text-xs"}," Tipe ",-1),Gt={class:""},Qt={class:"flex flex-col m-2"},Wt=a("span",{class:"text-xs"}," Jenis ",-1),Xt={class:""},te={class:"flex flex-col m-2"},ee=a("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),ae={class:""},oe={class:"w-full sm:w-1/2 text-sm flex justify-center"},se={class:"border border-collapse border-black"},le=a("tr",null,[a("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),re={class:"p-1"},ne={class:"p-1"},ie=a("td",{class:"p-1"},"= Rp.",-1),_e={class:"text-right p-1"},ce={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ue=a("th",{colspan:"2",class:"text-right"},"Total",-1),pe=a("th",{class:"p-1 text-right"},"Rp.",-1),de={class:"p-1 text-right"},fe={class:"w-full mt-2 text-sm flex justify-center"},be={class:"border border-collapse border-black"},me=a("tr",null,[a("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),ye={class:"p-1"},ke={class:"p-1"},he={class:"p-1"},ve=a("td",{class:"p-1"},"= Rp.",-1),ge={class:"text-right p-1"},xe={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},we=a("th",{colspan:"2",class:"text-right"},"Total",-1),De=a("th",{class:"p-1 text-right"},"Rp.",-1),$e={class:"p-1 text-right"},Te={class:"flex p-1 justify-end flex-wrap"},aa={__name:"index",async setup(Ae){let T,z;const{$moment:O}=Nt(),{pointFormat:i}=Z(),r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const M=_({}),h=xt("token"),A=_({from:"",to:""}),{data:G}=([T,z]=wt(async()=>Bt(async()=>{c().loading_full=!0;let e=[];const[o,n]=await Promise.all([D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0})]);return o.status.value!=="error"&&(e=o.data.value.data),o.status.value==="error"?(x().trigger(o.error),{trx_trps:e}):(c().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),T=await T,z(),T),b=_(G.value.trx_trps||[]),N=_({field:"tanggal",by:"desc"}),k=_(-1),f=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),P=()=>{r.like="";let e=JSON.parse(JSON.stringify(c()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),r.sort="",N.value.field&&(r.sort=N.value.field+":"+N.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=A.value.from?O(A.value.from).format("YYYY-MM-DD"):"",r.date_to=A.value.to?O(A.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(c()._tv.filter_model)},K=_(null),E=async()=>{c().loading_full=!0,M.value={},f.value.may_get_data=!1,r.page=f.value.page,r.page==1&&(b.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(b.value[0]));const{data:e,error:o,status:n}=await D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,f.value.may_get_data=!0,n.value==="error"){x().trigger(o,M);return}f.value.page==1?(b.value=e.value.data,K.value&&(K.value.scrollTop=0)):f.value.page>1&&(b.value=[...b.value,...e.value.data]),e.value.data.length==0&&(f.value.is_last_record=!0),c()._tv.filter_box=!1},Q=()=>{f.value.page=1,f.value.is_last_record=!1,P(),E()};Dt(),_(!1),_(0);const{display:W}=V();$t(V());const X=_({}),S=_(!1),tt=async()=>{S.value&&(S.value=!1)},et=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",b.value[k.value].id),e.append("_method","DELETE");const{data:o,error:n,status:v}=await D("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,v.value==="error"){x().trigger(n);return}b.value.splice(k.value,1),k.value=-1,S.value=!1},{downloadFile:I,viewFile:Se}=Pt(),C=_(!1),H=_(""),J=async()=>{if(C.value==!0){C.value=!1;return}P(),c().loading_full=!0;const{data:e,error:o,status:n}=await D("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,n.value==="error"){x().trigger(o);return}H.value=e.value,C.value=!0},at=async()=>{P(),c().loading_full=!0;const{data:e,error:o,status:n}=await D("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,n.value==="error"){x().trigger(o);return}I(e.value)},ot=()=>{I(H.value)},U=e=>e.pv_id<=0||["CPO","PK"].indexOf(e.jenis)>-1&&(e.ticket_a_id<=0||e.ticket_b_bruto<=0||e.ticket_b_tara<=0||e.ticket_b_netto<=0||e.ticket_b_in_at==""||e.ticket_b_out_at=="")||e.jenis=="TBS"&&(e.ticket_a_id<=0||e.ticket_b_id<=0)||e.jenis=="TBSK"&&e.ticket_b_id<=0?0:1,st=_([{key:"status",label:"Status",filter_on:1,sort_off:1,type:"select",select_item:["Undone","Done"]},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:c().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),Y=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e),v=n>0?o:e;if(v==0)return 0;let $=Z().round(n/v*100,2);return $<0?"("+Math.abs($*100)/100+")":$},j=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e);return n<0?"("+i(Math.abs(n))+")":i(n)},B=_(!1),m=_({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),lt=async()=>{k.value==-1&&W({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}),c().loading_full=!0;const{data:e,error:o,status:n}=await D("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:b.value[k.value].id_uj},retry:0});if(c().loading_full=!1,n.value==="error"){x().trigger(o,M);return}m.value=e.value.data,B.value=!0},rt=Tt(()=>{let e=0;return m.value.details2.forEach(o=>{o.p_status!="Remove"&&(e+=o.qty*o.amount)}),e});return(e,o)=>{const n=pt,v=dt,$=ft,nt=bt,F=mt,R=yt,it=kt,_t=ht,ct=vt,ut=gt;return p(),g("div",Ht,[y(n,{title:"Report Transaction"}),a("div",Yt,[a("div",jt,[a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[0]||(o[0]=t=>J())},[y(v)]),a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[1]||(o[1]=t=>at())},[y($)]),a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[2]||(o[2]=t=>lt())},[y(nt)])]),y(it,{thead:s(st),selected:s(k),onSetSelected:o[3]||(o[3]=t=>k.value=t),tbody:s(b),fnCallData:E,scrolling:s(f),onSetScrollingPage:o[4]||(o[4]=t=>s(f).page=t),onDoFilter:o[5]||(o[5]=t=>Q())},{status:u(({item:t})=>[a("div",{class:Mt(["text-white text-xs px-2 py-1 rounded-lg",U(t)?"bg-green-600":"bg-red-600"])},l(U(t)?"Done":"Not Done"),3)]),val:u(({item:t})=>[t.val?(p(),w(R,{key:1})):(p(),w(F,{key:0}))]),val1:u(({item:t})=>[t.val1?(p(),w(R,{key:1})):(p(),w(F,{key:0}))]),pvr_had_detail:u(({item:t})=>[t.pvr_had_detail?(p(),w(R,{key:1})):(p(),w(F,{key:0}))]),susut_bruto_a:u(({item:t})=>[d(l(s(i)(t.ticket_a_bruto)),1)]),susut_tara_a:u(({item:t})=>[d(l(s(i)(t.ticket_a_tara)),1)]),susut_netto_a:u(({item:t})=>[d(l(s(i)(t.ticket_a_netto)),1)]),susut_bruto_b:u(({item:t})=>[d(l(s(i)(t.ticket_b_bruto)),1)]),susut_tara_b:u(({item:t})=>[d(l(s(i)(t.ticket_b_tara)),1)]),susut_netto_b:u(({item:t})=>[d(l(s(i)(t.ticket_b_netto)),1)]),susut_bruto_b_a:u(({item:t})=>[d(l(j(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:u(({item:t})=>[d(l(j(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:u(({item:t})=>[d(l(j(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:u(({item:t})=>[d(l(Y(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:u(({item:t})=>[d(l(Y(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:u(({item:t})=>[d(l(Y(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),y(_t,{type:"delete",show:s(S),data:s(X),fnClose:tt,fnConfirm:et},null,8,["show","data"]),s(C)?(p(),g("div",Ft,[a("div",Rt,[a("div",zt,[y(ct,{style:{color:"black",cursor:"pointer"},onClick:o[6]||(o[6]=t=>J())})]),a("iframe",{ref:"iframe",width:"100%",height:"100%",src:s(H).dataBase64},null,8,Ot),a("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[7]||(o[7]=t=>ot())})])])):At("",!0),St(a("div",Kt,[a("div",Et,[y(ut,{title:"Detail Information",fn:()=>{B.value=!1,e.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),a("div",It,[a("div",Jt,[a("div",Ut,[Vt,a("div",qt,l(s(m).xto)+" ",1)]),a("div",Lt,[Zt,a("div",Gt,l(s(m).tipe),1)]),a("div",Qt,[Wt,a("div",Xt,l(s(m).jenis),1)]),a("div",te,[ee,a("div",ae,l(s(m).note_for_remarks),1)])]),a("div",oe,[a("table",se,[le,(p(!0),g(q,null,L(s(m).details,t=>(p(),g("tr",null,[a("td",re,l(t.ordinal)+". ",1),a("td",ne,l(t.xdesc)+" "+l(t.qty<=1?"":s(i)(t.qty||0)+" x Rp."+s(i)(t.harga||0)),1),ie,a("td",_e,l(s(i)(t.qty*t.harga)),1)]))),256)),a("tr",ce,[ue,pe,a("th",de,l(s(i)(s(m).harga)),1)])])]),a("div",fe,[a("table",be,[me,(p(!0),g(q,null,L(s(m).details2,t=>(p(),g("tr",null,[a("td",ye,l(t.ordinal)+". ",1),a("td",ke,l(t.ac_account_code),1),a("td",he,l(t.description)+" "+l(t.qty<=1?"":s(i)(t.qty||0)+" x Rp."+s(i)(t.amount||0)),1),ve,a("td",ge,l(s(i)(t.qty*t.amount)),1)]))),256)),a("tr",xe,[we,De,a("th",$e,l(s(i)(s(rt))),1)])])])]),a("div",Te,[a("button",{class:"rounded m-1",onClick:o[8]||(o[8]=t=>B.value=!1)}," Cancel ")])])],512),[[Ct,s(B)]])])}}};export{aa as default};
