import Fe from"./Header.a18e61ee.js";import Ue from"./Copy.2a1b40d9.js";import Ie from"./Plus.2ed06c78.js";import Me from"./Edit.7d028291.js";import Ne from"./Eyes.873b5e79.js";import Ee from"./Delete.e8cc0a50.js";import He from"./Signature.320cd194.js";import Ve from"./SignatureOff.966f064d.js";import ze from"./Table2Column.d49c51a8.js";import Ke from"./Line.218916ab.js";import Le from"./Check.725ed637.js";import Je from"./TableView.07dd7455.js";import{_ as Re}from"./PopupMini.vue.e343f7d0.js";import Ye from"./ujalan.57ea8d87.js";import Ge from"./ujalan_batas_persen_susut.379e88b4.js";import qe from"./ujalan_validasi.0a064bd7.js";import{r as i,f as W,g as Xe,h as Ze,i as P,j as ee,s as Qe,x as m,c as k,b as u,a as _,k as te,v as We,l,m as ae,n as j,d as h,w as v,q as et,y as M,o as d,z as N,t as D,A as tt}from"./entry.9a576ab4.js";import{u as p}from"./useUtils.f8596025.js";import{u as E}from"./useMyFetch.584d3068.js";import{u as at}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.c4d9dc68.js";import"./Adjust.eaa0367d.js";import"./TableHeaderEye.89a8c56d.js";import"./Times.78a8d7b1.js";import"./ClearAll.5c324bf9.js";import"./client-only.da573d9c.js";import"./ClearEach.69ff3806.js";import"./CaretLeftDoubleBold.b4ef0163.js";import"./CaretLeftBold.faed96f6.js";import"./CaretRightBold.9a03ccc7.js";import"./CaretRightDoubleBold.9182fedb.js";import"./Exclamation.5e59e2db.js";import"./HeaderPopup.vue.9b650b3a.js";import"./InputPointFormat.vue.8a0c1ea5.js";import"./Tools.3d4a88f0.js";import"./ToolsPopup.3e3cba0c.js";import"./ac_accs.05a2e9a6.js";import"./WidthMiniList.vue.ec9db9ac.js";import"./WidthMiniPart.vue.50b72916.js";const lt={class:"w-full h-full flex flex-col"},nt={class:"w-full flex grow flex-col overflow-auto h-0"},ot={class:"w-full flex justify-between flex-wrap"},st={class:"grow flex"},it={class:"m-1"},rt=_("option",{value:"available"},"Available",-1),ut=_("option",{value:"unapprove"},"Unapprove",-1),_t=_("option",{value:"deleted"},"Trash",-1),dt=_("option",{value:"all"},"All",-1),pt=[rt,ut,_t,dt],mt=_("span",{class:"text-xs ml-1"}," Download ",-1),ct={class:"whitespace-pre-wrap"},vt={class:"grow mb-5"},na={__name:"index",async setup(ft){let F,L;const{pointFormat:$}=p(),le=t=>t.deleted==1?"!bg-red-400":t.val==0||t.val1==0?"!bg-gray-300":"",b=i("available");W(()=>b.value,t=>{G()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const J=i({}),U=Xe("token"),{data:ne}=([F,L]=Ze(async()=>et(async()=>{m().loading_full=!0;let t=[];const[e,x]=await Promise.all([E("/ujalan",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:{filter_status:b},retry:0})]);return e.status.value!=="error"&&(t=e.data.value.data),e.status.value==="error"?(M().trigger(e.error),{ujalans:t}):(m().loading_full=!1,{ujalans:t})},"$SN3C927rLk")),F=await F,L(),F),o=i(ne.value.ujalans||[]),H=i({field:"tanggal",by:"desc"}),n=i(-1),c=P(()=>o.value[n.value]),f=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),R=()=>{r.like="";let t=JSON.parse(JSON.stringify(m()._tv.global_keyword));t!=""&&(r.like=`id:%${t}%,xto:%${t}%,tipe:%${t}%,jenis:%${t}%,harga:%${t}%`),r.sort="",H.value.field&&(r.sort=H.value.field+":"+H.value.by),r.filter_model=JSON.stringify(m()._tv.filter_model)},Y=async()=>{m().loading_full=!0,J.value={},f.value.may_get_data=!1,r.page=f.value.page,r.page==1&&(o.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(o.value[0])),r.filter_status=b.value;const{data:t,error:e,status:x}=await E("/ujalan",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:r,retry:0});if(m().loading_full=!1,f.value.may_get_data=!0,x.value==="error"){M().trigger(e,J);return}f.value.page==1?o.value=t.value.data:f.value.page>1&&(o.value=[...o.value,...t.value.data]),t.value.data.length==0&&(f.value.is_last_record=!0),m()._tv.filter_box=!1},G=()=>{n.value=-1,f.value.page=1,f.value.is_last_record=!1,R(),Y()},A=i(!1),V=i(!1),S=i(0),y=i(0),g=i(-1),oe=()=>{S.value=0,g.value=-1,y.value=!1,A.value=!0},{display:C}=ee();Qe(ee());const se=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=o.value[n.value].id,g.value=-1,y.value=!1,A.value=!0)},ie=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=o.value[n.value].id,g.value=-1,y.value=!1,V.value=!0)},re=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=o.value[n.value].id,g.value=-1,y.value=!0,A.value=!0)},O=i(!1),I=i(0),ue=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,g.value=1,y.value=!1,O.value=!0)},_e=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,g.value=0,y.value=!1,O.value=!0)},de=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,y.value=!1,g.value=-1,O.value=!0)},z=i(!1),q=i({}),B=i(!1),T=i(""),pe=async()=>{B.value&&(B.value=!1)},me=()=>{n.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value="",q.value={id:o.value[n.value].id,tujuan:o.value[n.value].xto},B.value=!0)};W(()=>T.value,t=>{t.trim().length>0?z.value=!0:z.value=!1},{immediate:!1});const ce=async()=>{m().loading_full=!0;const t=new FormData;t.append("id",o.value[n.value].id),t.append("deleted_reason",T.value),t.append("_method","DELETE");const{data:e,error:x,status:K}=await E("/ujalan",{method:"post",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,K.value==="error"){M().trigger(x);return}let w={...o.value[n.value]};w.deleted=e.value.deleted,w.deleted_user=e.value.deleted_user,w.deleted_at=e.value.deleted_at,w.deleted_by=e.value.deleted_by,w.deleted_reason=e.value.deleted_reason,b.value!="all"?o.value.splice(n.value,1):o.value.splice(n.value,1,{...w}),n.value=-1,B.value=!1},ve=i([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"asst_opt",label:"Info",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"destination_location",label:"Dest. Location",childs:[{key:"destination_location_xto",label:"Xto",type:"string",filter_on:1},{key:"destination_location_minimal_trip",label:"Min Trip",filter_on:1,type:"string"},{key:"destination_location_bonus_trip_supir",label:"Bonus Trip Supir",filter_on:1,type:"number"},{key:"destination_location_bonus_next_trip_supir",label:"Bonus Trip Supir",filter_on:1,type:"number"},{key:"destination_location_bonus_trip_kernet",label:"Bonus Trip Kernet",filter_on:1,type:"number"},{key:"destination_location_bonus_next_trip_kernet",label:"Bonus Trip Kernet",filter_on:1,type:"number"}]},{key:"km_range",label:"Jarak KM",filter_on:1,type:"number"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"batas_persen_susut",label:"Batas Persen Susut",class:" justify-end",type:"number",tbl_show:p().checkPermission("ujalan.batas_persen_susut.full_act")},{key:"bonus_trip_supir",label:"Bonus Trip Supir",class:" justify-end",type:"number"},{key:"bonus_trip_kernet",label:"Bonus Trip Kernet",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:m().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),fe=P(()=>n.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&p().checkPermission("ujalan.create")),be=P(()=>["available","all","unapprove"].indexOf(b.value)>-1&&p().checkPermission("ujalan.create")),ye=P(()=>n.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&(p().checkPermission("ujalan.val")&&[void 0,0].indexOf(c.value.val)>-1||p().checkPermission("ujalan.val1")&&[void 0,0].indexOf(c.value.val1)>-1)&&p().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),ke=P(()=>n.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&(p().checkPermission("ujalan.val")&&[void 0,0].indexOf(c.value.val)>-1||p().checkPermission("ujalan.val1")&&[void 0,0].indexOf(c.value.val1)>-1)),he=P(()=>n.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&(p().checkPermission("ujalan.unval")&&[1].indexOf(c.value.val)>-1||p().checkPermission("ujalan.unval1")&&[1].indexOf(c.value.val1)>-1)),ge=P(()=>n.value>-1&&p().checkPermission("ujalan.remove")&&[void 0,0].indexOf(c.value.deleted)>-1),{downloadFile:xe,viewFile:bt}=at(),we=async()=>{R(),m().loading_full=!0,r.filter_status=b.value;const{data:t,error:e,status:x}=await E("/ujalan/download_excel",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:r,retry:0});if(m().loading_full=!1,x.value==="error"){M().trigger(e);return}xe(t.value)};return(t,e)=>{const x=Fe,K=Ue,w=Ie,X=Me,je=Ne,De=Ee,Ce=He,Pe=Ve,Se=ze,Z=Ke,Q=Le,Te=Je,$e=Re,Ae=Ye,Oe=Ge,Be=qe;return d(),k("div",lt,[u(x,{title:"List Ujalan"}),_("div",nt,[_("div",ot,[_("div",st,[_("div",it,[te(_("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=a=>ae(b)?b.value=a:null)},pt,512),[[We,l(b)]])]),l(fe)?(d(),k("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=a=>re())},[u(K)])):j("",!0),l(be)?(d(),k("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=a=>oe())},[u(w)])):j("",!0),l(ye)?(d(),k("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=a=>se())},[u(X)])):j("",!0),l(n)>-1?(d(),k("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=a=>de())},[u(je)])):j("",!0),l(ge)?(d(),k("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=a=>me())},[u(De)])):j("",!0),l(ke)?(d(),k("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=a=>ue())},[u(Ce)])):j("",!0),l(he)?(d(),k("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=a=>_e())},[u(Pe)])):j("",!0),_("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:e[8]||(e[8]=a=>we())},[u(Se),h(),mt]),l(n)>-1&&("useUtils"in t?t.useUtils:l(p))().checkPermission("ujalan.batas_persen_susut.full_act")?(d(),k("button",{key:7,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[9]||(e[9]=a=>ie())},[u(X)])):j("",!0)])]),u(Te,{thead:l(ve),selected:l(n),onSetSelected:e[10]||(e[10]=a=>n.value=a),tbody:l(o),fnCallData:Y,scrolling:l(f),onSetScrollingPage:e[11]||(e[11]=a=>l(f).page=a),onDoFilter:e[12]||(e[12]=a=>G()),rowBgColor:le},{val:v(({item:a})=>[a.val?(d(),N(Q,{key:1})):(d(),N(Z,{key:0}))]),val1:v(({item:a})=>[a.val1?(d(),N(Q,{key:1})):(d(),N(Z,{key:0}))]),xto:v(({item:a})=>[_("div",ct,D(a.xto),1)]),destination_location_xto:v(({item:a})=>{var s;return[h(D((s=a.destination_location)==null?void 0:s.xto),1)]}),destination_location_minimal_trip:v(({item:a})=>{var s;return[h(D(l($)((s=a.destination_location)==null?void 0:s.minimal_trip)),1)]}),destination_location_bonus_trip_supir:v(({item:a})=>{var s;return[h(D(l($)((s=a.destination_location)==null?void 0:s.bonus_trip_supir)),1)]}),destination_location_bonus_next_trip_supir:v(({item:a})=>{var s;return[h(D(l($)((s=a.destination_location)==null?void 0:s.bonus_next_trip_supir)),1)]}),destination_location_bonus_trip_kernet:v(({item:a})=>{var s;return[h(D(l($)((s=a.destination_location)==null?void 0:s.bonus_trip_kernet)),1)]}),destination_location_bonus_next_trip_kernet:v(({item:a})=>{var s;return[h(D(l($)((s=a.destination_location)==null?void 0:s.bonus_next_trip_kernet)),1)]}),deleted_by_username:v(({item:a})=>{var s;return[h(D((s=a.deleted_by)==null?void 0:s.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),u($e,{type:"delete",show:l(B),data:l(q),fnClose:pe,fnConfirm:ce,enabledOk:l(z)},{footer:v(()=>[h(" Masukkan Alasan Penghapusan: "),_("div",vt,[te(_("textarea",{"onUpdate:modelValue":e[13]||(e[13]=a=>ae(T)?T.value=a:null)},null,512),[[tt,l(T)]])])]),_:1},8,["show","data","enabledOk"]),u(Ae,{show:l(A),fnClose:()=>{A.value=!1},id:l(S),p_data:l(o),is_copy:l(y)},null,8,["show","fnClose","id","p_data","is_copy"]),u(Oe,{show:l(V),fnClose:()=>{V.value=!1},id:l(S),p_data:l(o),is_copy:l(y)},null,8,["show","fnClose","id","p_data","is_copy"]),u(Be,{show:l(O),fnClose:()=>{O.value=!1},id:l(I),p_data:l(o),it_state:l(g)},null,8,["show","fnClose","id","p_data","it_state"])])}}};export{na as default};
