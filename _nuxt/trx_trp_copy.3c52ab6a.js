import{_ as ee}from"./HeaderPopup.vue.d6794154.js";import{_ as te}from"./client-only.4a858fe2.js";import{_ as ae}from"./WidthMiniList.vue.d3d4dabb.js";import{r as g,g as le,j as oe,i as B,f as D,I as se,k as x,J as q,o as p,c,a as s,b as y,l as a,w as ne,E as ie,t as v,v as T,F as J,D as O,A as re,n as $,C as de,G as _e,x as k,y as F}from"./entry.5f1e31b4.js";import{u as A}from"./useUtils.0094ecfc.js";import{u as M}from"./useMyFetch.b9ad3f63.js";import"./Times.3628b580.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.36ae349b.js";const ue={class:"box-fixed"},pe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ce={class:"w-full flex flex-col items-center grow overflow-auto"},ve={class:"w-full flex flex-row flex-wrap"},me={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},fe=s("label",{for:""},"U.Jalan Per",-1),he={key:0,class:"grow"},we={key:1,class:"grow"},ge={class:"text-red-500"},xe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ke=s("label",{for:""},"Jenis",-1),ye=["disabled"],be=s("option",{value:"TBS"},"TBS",-1),je=s("option",{value:"TBSK"},"TBSK",-1),Se=s("option",{value:"CPO"},"CPO",-1),Ne=s("option",{value:"PK"},"PK",-1),Ce=[be,je,Se,Ne],Be={class:"text-red-500"},De={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Te=s("label",{for:""},"Payment Method",-1),Je=["disabled"],Oe=["value"],Ae={class:"text-red-500"},Ve={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},$e=s("label",{for:""},"No Pol",-1),Fe=["disabled"],Me={id:"vehicle"},Pe=["value"],Ee={class:"text-red-500"},Ue={key:0,class:"w-full flex flex-wrap"},Ke={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ie=s("label",{for:""},"Tujuan",-1),qe=["disabled"],Le={class:"text-red-500"},Ye={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},ze=s("label",{for:""},"Tipe",-1),Re=["disabled"],Ge=["value","selected"],He={class:"text-red-500"},We={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Qe=s("label",{for:""},"Total Dari U.Jalan",-1),Xe={class:"card-border disabled"},Ze={key:1,class:"w-full flex flex-wrap"},et={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},tt=s("label",{for:""},"Supir",-1),at={class:"text-red-500"},lt={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ot=s("label",{for:""},"Kernet",-1),st={class:"text-red-500"},nt={class:"w-full flex items-center justify-end"},ft={__name:"trx_trp_copy",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(b){const r=b,{$moment:P}=_e(),{pointFormat:L}=A(),j={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",payment_method_id:2,payment_method:{id:0,name:""},uj:{}};let m={...j};const e=g({...j}),V=le("token"),f=g({}),Y=l=>{e.value.transition_target=l.target.value=="TBS"?e.value.transition_target:""};oe();const z=async()=>{k().loading_full=!0,f.value={};const l=new FormData;l.append("tanggal",P(e.value.tanggal).format("Y-MM-DD")),l.append("jenis",e.value.jenis),l.append("id_uj",e.value.id_uj),l.append("xto",e.value.xto),l.append("cost_center_code",e.value.cost_center_code),l.append("online_status",r.online_status),l.append("transition_target",e.value.transition_target),l.append("payment_method_id",e.value.payment_method_id),l.append("no_pol",e.value.no_pol),l.append("supir_id",_.value.id),l.append("kernet_id",d.value.id);let t="post",i=r.id;i==0||(l.append("id",i),l.append("_method","PUT"));const{data:o,error:u,status:h}=await M("/trx_trp",{method:t,headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},body:l,retry:0});if(k().loading_full=!1,h.value==="error"){F().trigger(u,f);return}e.value.supir=_.value.name,e.value.supir_rek_no=_.value._.rek_no.val,e.value.supir_rek_name=_.value._.rek_name.val,e.value.kernet=d.value.name,e.value.kernet_rek_no=d.value._.rek_no.val,e.value.kernet_rek_name=d.value._.rek_name.val;let n=N.value.map(C=>C.id).indexOf(e.value.payment_method_id);if(e.value.payment_method={...N.value[n]},e.value.updated_at=o.value.updated_at,r.id<=0)e.value.id=o.value.id,e.value.created_at=o.value.created_at,r.p_data.unshift(e.value);else{let C=r.p_data.map(Z=>Z.id).indexOf(r.id);C>=-1&&r.p_data.splice(C,1,{...e.value})}r.fnClose()},R=B(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(S.value.filter(t=>t.jenis==l).map(t=>t.xto))]}),G=B(()=>{let l=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return S.value.filter(t=>t.xto==e.value.xto&&t.jenis==l)}),w={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},_=g(JSON.parse(JSON.stringify(w))),d=g(JSON.parse(JSON.stringify(w))),E=B(()=>{let l=[];return K.value.forEach((t,i)=>{let o=JSON.parse(JSON.stringify(w));o._.id.val=t.id,o._.name.val=t.name,o._.rek_no.val=t.rek_no,o._.rek_name.val=t.rek_name,o.id=t.id,o.name=t.name,o.title=(t.rek_no||"")+" "+(t.rek_name||""),o.note=H(t),o._raw=t,l.push(JSON.parse(JSON.stringify(o)))}),l}),H=l=>l.potongan?"Akan ada potong sebesar :"+A().pointFormat(l.potongan.nominal_cut):"",W=B(()=>!1),Q=async()=>{k().loading_full=!0;const{data:l,error:t,status:i}=await M("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},params:{id:r.id},retry:0});if(k().loading_full=!1,i.value==="error"){F().trigger(t);return}let o=l.value.data;e.value=o,m={...o},_.value._.id.val=o.supir_id,_.value._.name.val=o.supir,_.value._.rek_no.val=o.supir_rek_no,_.value._.rek_name.val=o.supir_rek_name,_.value.id=o.supir_id,_.value.name=o.supir,_.value.rek_no=(o.supir_rek_no||"")+" "+(o.supir_rek_name||""),d.value._.id.val=o.kernet_id,d.value._.name.val=o.kernet,d.value._.rek_no.val=o.kernet_rek_no,d.value._.rek_name.val=o.kernet_rek_name,d.value.id=o.kernet_id,d.value.name=o.kernet,d.value.rek_no=(o.kernet_rek_no||"")+" "+(o.kernet_rek_name||"");let u=0,h=0;o.potongan.forEach(n=>{n.potongan_mst.employee_id==o.supir_id&&(u+=parseInt(n.nominal_cut)),n.potongan_mst.employee_id==o.kernet_id&&(h+=parseInt(n.nominal_cut))}),u>0&&(_.value.note="Telah di potong sebesar :"+A().pointFormat(u)),h>0&&(d.value.note="Telah di potong sebesar :"+A().pointFormat(h)),r.fnLoadDBData()},S=g([]),U=g([]),K=g([]),N=g([]),X=async()=>{k().loading_full=!0;const{data:l,error:t,status:i}=await M("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},retry:0});if(k().loading_full=!1,i.value==="error"){F().trigger(t);return}S.value=l.value.list_ujalan,U.value=l.value.list_vehicle,K.value=l.value.list_employee,N.value=l.value.list_payment_methods};D(()=>r.show,async(l,t)=>{l==!0&&(await X(),await r.fnLoadDBData(),e.value={...j},m={...j},_.value=JSON.parse(JSON.stringify(w)),d.value=JSON.parse(JSON.stringify(w)),f.value={},r.id!=0&&Q())},{immediate:!0}),D(()=>e.value.cost_center_code,(l,t)=>{let i="";if(l==""||l){let o=r.list_cost_center.filter(u=>u.CostCenter==e.value.cost_center_code);o.length>0?i=o[0].Description:e.value.cost_center_code==m.cost_center_code&&(i=m.cost_center_desc),e.value.cost_center_desc=i}},{deep:!0,immediate:!0});const I=(l,t)=>{let i=0,o="";if(l==""||l){let u=S.value.filter(h=>h.id==e.value.id_uj);u.length>0?(e.value.uj=u[0],i=u[0].harga,o=u[0].tipe):e.value.id_uj==m.id_uj&&(e.value.uj=m.uj,i=m.amount,o=m.tipe),e.value.tipe=o,e.value.amount=i,e.value.uj.asst_opt&&e.value.uj.asst_opt=="TANPA KERNET"&&!(m.kernet_id>1||e.val1==1)&&(d.value=JSON.parse(JSON.stringify(w)))}};return D(()=>e.value.xto,(l,t)=>{r.show&&I(l)},{deep:!0,immediate:!0}),D(()=>e.value.id_uj,(l,t)=>{r.show&&I(l)},{deep:!0,immediate:!0}),(l,t)=>{const i=ee,o=se("vue-date-picker"),u=te,h=ae;return x((p(),c("section",ue,[s("div",null,[y(i,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("form",pe,[s("div",ce,[s("div",ve,[s("div",me,[fe,a(e).val!==1?(p(),c("div",he,[y(u,null,{default:ne(()=>[y(o,{modelValue:a(e).tanggal,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(p(),c("div",we,[s("div",{class:ie(["card-border disabled",a(e).pvr_no!=""?"unselectable":""])},v(a(e).tanggal?a(P)(a(e).tanggal).format("DD-MM-YYYY"):""),3)])),s("p",ge,v(a(f).tanggal),1)]),s("div",xe,[ke,x(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>a(e).jenis=n),onChange:t[2]||(t[2]=n=>Y(n)),disabled:a(e).val==1},Ce,40,ye),[[T,a(e).jenis]]),s("p",Be,v(a(f).jenis),1)]),s("div",De,[Te,x(s("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>a(e).payment_method_id=n),disabled:a(e).val==1},[(p(!0),c(J,null,O(a(N),n=>(p(),c("option",{value:n.id},v(n.name),9,Oe))),256))],8,Je),[[T,a(e).payment_method_id]]),s("p",Ae,v(a(f).payment_method_id),1)]),s("div",Ve,[$e,x(s("input",{type:"text",list:"vehicle","onUpdate:modelValue":t[4]||(t[4]=n=>a(e).no_pol=n),disabled:a(e).val==1},null,8,Fe),[[re,a(e).no_pol]]),s("datalist",Me,[(p(!0),c(J,null,O(a(U),n=>(p(),c("option",{value:n.no_pol},v(n.no_pol),9,Pe))),256))]),s("p",Ee,v(a(f).no_pol),1)]),a(e).jenis!=""?(p(),c("div",Ue,[s("div",Ke,[Ie,x(s("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>a(e).xto=n),disabled:a(e).val==1},[(p(!0),c(J,null,O(a(R),n=>(p(),c("option",null,v(n),1))),256))],8,qe),[[T,a(e).xto]]),s("p",Le,v(a(f).xto),1)]),s("div",Ye,[ze,x(s("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>a(e).id_uj=n),disabled:a(e).val==1},[(p(!0),c(J,null,O(a(G),n=>(p(),c("option",{value:n.id,selected:n.id==a(e).id_uj},v(n.tipe),9,Ge))),256))],8,Re),[[T,a(e).id_uj]]),s("p",He,v(a(f).id_uj),1)]),s("div",We,[Qe,s("div",Xe,v(a(L)(a(e).amount)),1)])])):$("",!0),a(e).uj.asst_opt?(p(),c("div",Ze,[s("div",et,[tt,y(h,{arr:a(E),selected:a(_),pure:w,onSetSelected:t[7]||(t[7]=n=>_.value=n),disabled:a(m).supir_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",at,v(a(f).supir_id),1)]),x(s("div",lt,[ot,y(h,{arr:a(E),selected:a(d),pure:w,onSetSelected:t[8]||(t[8]=n=>d.value=n),disabled:a(m).kernet_id>1||a(e).val1==1},null,8,["arr","selected","disabled"]),s("p",st,v(a(f).kernet_id),1)],512),[[q,a(e).uj.asst_opt=="DENGAN KERNET"]])])):$("",!0)])]),s("div",nt,[s("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[9]||(t[9]=n=>b.fnClose())}," Cancel "),a(W)?$("",!0):(p(),c("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[10]||(t[10]=de(n=>z(),["prevent"]))}," Save "))])])])],512)),[[q,b.show]])}}};export{ft as default};
