import{_ as oe}from"./Header.408610e1.js";import{u as le,_ as re}from"./useDownload.0df59fda.js";import{_ as se}from"./Table2Column.316a5eab.js";import{_ as ne}from"./Line.c8d1b72c.js";import{_ as _e}from"./Check.ef457354.js";import{_ as ie}from"./TableView.b9817d9b.js";import{_ as ue}from"./PopupMini.vue.6c80b9b1.js";import{_ as ce}from"./Times.7cbddc6d.js";import{r as n,f as pe,D as de,B as fe,H as U,I as be,c as V,b as k,a as p,w as r,k as s,G as ye,E as ke,x as _,y as x,o as b,q as me,t as i,K as m,d as u,s as ve}from"./entry.088021ef.js";import{u as J}from"./useUtils.b741a801.js";import{u as w}from"./useMyFetch.38ca3367.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.89db18e8.js";import"./client-only.560f86f6.js";const ge={class:"w-full h-full flex flex-col"},he={class:"w-full flex grow flex-col overflow-auto h-0"},xe={class:"w-full flex"},we={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},De={class:"relative",style:{width:"95%",height:"90%"}},Se={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ae=["src"],Ue={__name:"index",async setup($e){let D,j;const{$moment:H}=ve(),{pointFormat:d}=J(),o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const K=n({}),v=pe("token"),S=n({from:"",to:""}),{data:R}=([D,j]=de(async()=>ke(async()=>{_().loading_full=!0;let e=[];const[a,l]=await Promise.all([w("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},retry:0})]);return a.status.value!=="error"&&(e=a.data.value.data),a.status.value==="error"?(x().trigger(a.error),{trx_trps:e}):(_().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),D=await D,j(),D),f=n(R.value.trx_trps||[]),M=n({field:"tanggal",by:"desc"}),g=n(-1),c=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),T=()=>{o.like="";let e=JSON.parse(JSON.stringify(_()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_to:%${e}%`),o.sort="",M.value.field&&(o.sort=M.value.field+":"+M.value.by),o._TimeZoneOffset=new Date().getTimezoneOffset(),o.date_from=S.value.from?H(S.value.from).format("YYYY-MM-DD"):"",o.date_to=S.value.to?H(S.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(_()._tv.filter_model)},O=n(null),F=async()=>{_().loading_full=!0,K.value={},c.value.may_get_data=!1,o.page=c.value.page,o.page==1&&(f.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(f.value[0]));const{data:e,error:a,status:l}=await w("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:o,retry:0});if(_().loading_full=!1,c.value.may_get_data=!0,l.value==="error"){x().trigger(a,K);return}c.value.page==1?(f.value=e.value.data,O.value&&(O.value.scrollTop=0)):c.value.page>1&&(f.value=[...f.value,...e.value.data]),e.value.data.length==0&&(c.value.is_last_record=!0),_()._tv.filter_box=!1},L=()=>{c.value.page=1,c.value.is_last_record=!1,T(),F()};fe(),n(!1),n(0),U(),be(U());const Z=n({}),A=n(!1),q=async()=>{A.value&&(A.value=!1)},G=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",f.value[g.value].id),e.append("_method","DELETE");const{data:a,error:l,status:y}=await w("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,y.value==="error"){x().trigger(l);return}f.value.splice(g.value,1),g.value=-1,A.value=!1},{downloadFile:z,viewFile:Me}=le(),$=n(!1),B=n(""),I=async()=>{if($.value==!0){$.value=!1;return}T(),_().loading_full=!0;const{data:e,error:a,status:l}=await w("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:o,retry:0});if(_().loading_full=!1,l.value==="error"){x().trigger(a);return}B.value=e.value,$.value=!0},Q=async()=>{T(),_().loading_full=!0;const{data:e,error:a,status:l}=await w("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:o,retry:0});if(_().loading_full=!1,l.value==="error"){x().trigger(a);return}z(e.value)},W=()=>{z(B.value)},E=e=>e.pv_id<=0||["CPO","PK"].indexOf(e.jenis)>-1&&(e.ticket_a_id<=0||e.ticket_b_bruto<=0||e.ticket_b_tara<=0||e.ticket_b_netto<=0||e.ticket_b_in_at==""||e.ticket_b_out_at=="")||e.jenis=="TBS"&&(e.ticket_a_id<=0||e.ticket_b_id<=0)||e.jenis=="TBSK"&&e.ticket_b_id<=0?0:1,X=n([{key:"status",label:"Status",filter_on:1,sort_off:1,type:"select",select_item:["Undone","Done"]},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition_to",label:"Peralihan",filter_on:1,type:"select",select_item:["KPN","KAS","KUS","ARP","KAP","SMP"]},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),C=(e,a)=>{e=parseFloat(e)||0,a=parseFloat(a)||0;let l=parseFloat(a-e),y=l>0?a:e;if(y==0)return 0;let h=J().round(l/y*100,2);return h<0?"("+Math.abs(h*100)/100+")":h},N=(e,a)=>{e=parseFloat(e)||0,a=parseFloat(a)||0;let l=parseFloat(a-e);return l<0?"("+d(Math.abs(l))+")":d(l)};return(e,a)=>{const l=oe,y=re,h=se,P=ne,Y=_e,ee=ie,te=ue,ae=ce;return b(),V("div",ge,[k(l,{title:"Report Transaction"}),p("div",he,[p("div",xe,[p("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=t=>I())},[k(y)]),p("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=t=>Q())},[k(h)])]),k(ee,{thead:s(X),selected:s(g),onSetSelected:a[2]||(a[2]=t=>g.value=t),tbody:s(f),fnCallData:F,scrolling:s(c),onSetScrollingPage:a[3]||(a[3]=t=>s(c).page=t),onDoFilter:a[4]||(a[4]=t=>L())},{status:r(({item:t})=>[p("div",{class:me(["text-white text-xs px-2 py-1 rounded-lg",E(t)?"bg-green-600":"bg-red-600"])},i(E(t)?"Done":"Not Done"),3)]),val:r(({item:t})=>[t.val?(b(),m(Y,{key:1})):(b(),m(P,{key:0}))]),val1:r(({item:t})=>[t.val1?(b(),m(Y,{key:1})):(b(),m(P,{key:0}))]),pvr_had_detail:r(({item:t})=>[t.pvr_had_detail?(b(),m(Y,{key:1})):(b(),m(P,{key:0}))]),susut_bruto_a:r(({item:t})=>[u(i(s(d)(t.ticket_a_bruto)),1)]),susut_tara_a:r(({item:t})=>[u(i(s(d)(t.ticket_a_tara)),1)]),susut_netto_a:r(({item:t})=>[u(i(s(d)(t.ticket_a_netto)),1)]),susut_bruto_b:r(({item:t})=>[u(i(s(d)(t.ticket_b_bruto)),1)]),susut_tara_b:r(({item:t})=>[u(i(s(d)(t.ticket_b_tara)),1)]),susut_netto_b:r(({item:t})=>[u(i(s(d)(t.ticket_b_netto)),1)]),susut_bruto_b_a:r(({item:t})=>[u(i(N(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:r(({item:t})=>[u(i(N(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:r(({item:t})=>[u(i(N(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:r(({item:t})=>[u(i(C(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:r(({item:t})=>[u(i(C(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:r(({item:t})=>[u(i(C(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),k(te,{type:"delete",show:s(A),data:s(Z),fnClose:q,fnConfirm:G},null,8,["show","data"]),s($)?(b(),V("div",we,[p("div",De,[p("div",Se,[k(ae,{style:{color:"black",cursor:"pointer"},onClick:a[5]||(a[5]=t=>I())})]),p("iframe",{ref:"iframe",width:"100%",height:"100%",src:s(B).dataBase64},null,8,Ae),p("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:a[6]||(a[6]=t=>W())})])])):ye("",!0)])}}};export{Ue as default};
