import{_ as R}from"./Header.62d7bf98.js";import{u as I,_ as L}from"./useDownload.dca223cb.js";import{_ as P}from"./Table2Column.291b97e1.js";import{_ as U}from"./client-only.0d3c49bc.js";import{_ as Z}from"./Search.be96e30c.js";import{r,f as H,D as K,L as q,c as h,b as _,a,w as S,t as $,k as c,h as G,l as Q,i as W,F as X,n as ee,m as te,E as oe,x as l,y as m,o as b,s as ae}from"./entry.b31011cd.js";import{u as v}from"./useMyFetch.54cebe26.js";import"./_plugin-vue_export-helper.c27b6911.js";const se={class:"w-full h-full flex flex-col"},le={class:"w-full flex grow flex-col overflow-auto h-0 bg-gray-200 justify-center items-center p-2"},re={class:"bg-white p-2"},ne={class:"w-full flex"},ie={action:"#",class:"w-full flex flex-wrap text-xs"},ue={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},_e=a("div",{class:"font-bold"}," Tgl Dari ",-1),ce={class:"text-red-500"},de={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},fe=a("div",{class:"font-bold"}," Tgl Sampai ",-1),pe={class:"text-red-500"},me={class:"w-6/12 p-1 sm:w-4/12 md:w-2/12 lg:w-4/12 flex flex-col"},ve=a("div",{class:"font-bold"}," Keyword ",-1),ge=a("option",{value:""},null,-1),xe=["value"],we={class:"w-2/12 md:w-1/12 lg:w-1/12 p-1 flex items-end"},Ve={__name:"index",async setup(ye){let d,k;const{$moment:D}=ae(),o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const f=r({}),p=H("token"),n=r({from:"",to:""}),{data:V}=([d,k]=K(async()=>oe(async()=>{l().loading_full=!0;let e=[];const[t,u]=await Promise.all([v("/report/ramp/get_locations",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},retry:0})]);return t.status.value!=="error"&&(e=t.data.value.data),t.status.value==="error"?(m().trigger(t.error),{locations:e}):(l().loading_full=!1,{locations:e})},"$szlvkxRfm7")),d=await d,k(),d),O=r(V.value.locations||[]),g=r(""),x=r({field:"tanggal",by:"desc"}),i=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),w=()=>{o.like="";let e=JSON.parse(JSON.stringify(l()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_to:%${e}%`),o.sort="",x.value.field&&(o.sort=x.value.field+":"+x.value.by),o._TimeZoneOffset=new Date().getTimezoneOffset(),o.date_from=n.value.from?D(n.value.from).format("YYYY-MM-DD"):"",o.date_to=n.value.to?D(n.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(l()._tv.filter_model)},A=r(null),T=async()=>{l().loading_full=!0,f.value={},i.value.may_get_data=!1,o.page=i.value.page,o.page==1&&(trx_trps.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(trx_trps.value[0]));const{data:e,error:t,status:u}=await v("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:o,retry:0});if(l().loading_full=!1,i.value.may_get_data=!0,u.value==="error"){m().trigger(t,f);return}i.value.page==1?(trx_trps.value=e.value.data,A.value&&(A.value.scrollTop=0)):i.value.page>1&&(trx_trps.value=[...trx_trps.value,...e.value.data]),e.value.data.length==0&&(i.value.is_last_record=!0),l()._tv.filter_box=!1},Y=()=>{i.value.page=1,i.value.is_last_record=!1,w(),T()},{downloadFile:j,viewFile:he}=I(),y=r(!1),z=r(""),B=async()=>{if(y.value==!0){y.value=!1;return}w(),l().loading_full=!0;const{data:e,error:t,status:u}=await v("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:o,retry:0});if(l().loading_full=!1,u.value==="error"){m().trigger(t);return}z.value=e.value,y.value=!0},N=async()=>{w(),l().loading_full=!0;const{data:e,error:t,status:u}=await v("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:o,retry:0});if(l().loading_full=!1,u.value==="error"){m().trigger(t);return}j(e.value)};return(e,t)=>{const u=R,E=L,F=P,C=q("vue-date-picker"),M=U,J=Z;return b(),h("div",se,[_(u,{title:"Report Transaction"}),a("div",le,[a("div",re,[a("div",ne,[a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=s=>B())},[_(E)]),a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=s=>N())},[_(F)])]),a("form",ie,[a("div",ue,[_e,_(M,null,{default:S(()=>[_(C,{modelValue:c(n).from,"onUpdate:modelValue":t[2]||(t[2]=s=>c(n).from=s),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),a("p",ce,$(c(f).date_from),1)]),a("div",de,[fe,_(M,null,{default:S(()=>[_(C,{modelValue:c(n).to,"onUpdate:modelValue":t[3]||(t[3]=s=>c(n).to=s),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),a("p",pe,$(c(f).date_to),1)]),a("div",me,[ve,G(a("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>W(g)?g.value=s:null)},[ge,(b(!0),h(X,null,ee(c(O),s=>(b(),h("option",{value:s},$(s),9,xe))),256))],512),[[Q,c(g)]])]),a("div",we,[a("button",{class:"",type:"submit",name:"button",onClick:t[5]||(t[5]=te(s=>Y(),["prevent"]))},[_(J,{class:"text-2xl"})])])])])])])}}};export{Ve as default};
