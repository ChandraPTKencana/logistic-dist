import _e from"./Header.08920b6a.js";import ce from"./PrinterEye.268d318b.js";import de from"./Table2Column.4faedfac.js";import pe from"./Eyes.61a4f24a.js";import ue from"./Image.bc696a18.js";import fe from"./Line.12cb66ce.js";import me from"./Check.51ebf7e9.js";import ye from"./TableView.d8b9dbc1.js";import ve from"./Times.2788dd5e.js";import{_ as he}from"./HeaderPopup.vue.1bf79ead.js";import{r as p,f as L,g as be,h as ge,x as i,i as ke,c as D,a as e,b,k as J,v as xe,l as s,m as we,d as x,w as u,n as O,L as De,t as n,F as B,E as G,q as $e,y as $,o as r,z as _,I as Ae,H as Te}from"./entry.050cce63.js";import{u as Ce}from"./useUtils.dfb08e84.js";import{u as A}from"./useMyFetch.2cc780a9.js";import{u as Ne}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.93230dec.js";import"./Adjust.27c40047.js";import"./TableHeaderEye.b06b4760.js";import"./ClearAll.061f49c6.js";import"./client-only.f92b82b3.js";import"./ClearEach.16716765.js";import"./CaretLeftDoubleBold.c192695a.js";import"./CaretLeftBold.bc9fc4ef.js";import"./CaretRightBold.4707f22b.js";import"./CaretRightDoubleBold.27d098e2.js";const Re={class:"w-full h-full flex flex-col"},Pe={class:"w-full flex grow flex-col overflow-auto h-0"},Se={class:"w-full flex justify-between flex-wrap"},Me={class:"grow flex"},qe={class:"m-1"},Fe=Ae('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ue=[Fe],je=e("span",{class:"text-xs ml-1"}," PDF ",-1),Ee=e("span",{class:"text-xs ml-1"}," Excel ",-1),Be=e("span",{class:"text-xs ml-1"}," Full ",-1),ze={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Ie={class:"relative",style:{width:"95%",height:"90%"}},Ye={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},He=["src"],Ve={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},Ke={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},Le={class:"p-1 flex flex-wrap overflow-auto items-start"},Je={class:"w-full sm:w-1/2 flex flex-wrap"},Oe={class:"flex flex-col m-2"},Ge=e("span",{class:"text-xs"}," To ",-1),We={class:""},Ze={class:"flex flex-col m-2"},Qe=e("span",{class:"text-xs"}," Tipe ",-1),Xe={class:""},et={class:"flex flex-col m-2"},tt=e("span",{class:"text-xs"}," Jenis ",-1),lt={class:""},ot={class:"flex flex-col m-2"},st=e("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),at={class:""},rt={class:"w-full sm:w-1/2 text-sm flex justify-center"},nt={class:"border border-collapse border-black"},it=e("tr",null,[e("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),_t={class:"p-1"},ct={class:"p-1"},dt=e("td",{class:"p-1"},"= Rp.",-1),pt={class:"text-right p-1"},ut={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ft=e("th",{colspan:"2",class:"text-right"},"Total",-1),mt=e("th",{class:"p-1 text-right"},"Rp.",-1),yt={class:"p-1 text-right"},vt={class:"w-full mt-2 text-sm flex justify-center"},ht={class:"border border-collapse border-black"},bt=e("tr",null,[e("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),gt={class:"p-1"},kt={class:"p-1"},xt={class:"p-1"},wt=e("td",{class:"p-1"},"= Rp.",-1),Dt={class:"text-right p-1"},$t={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},At=e("th",{colspan:"2",class:"text-right"},"Total",-1),Tt=e("th",{class:"p-1 text-right"},"Rp.",-1),Ct={class:"p-1 text-right"},Nt={class:"flex p-1 justify-end flex-wrap"},al={__name:"finance",async setup(Rt){let N,z;const{$moment:I}=Te(),{pointFormat:v}=Ce(),W=l=>l.deleted==1?"!bg-red-400":l.pvr_id>0&&l.req_deleted==1?"!bg-yellow-300":l.pv_id>0?"!bg-blue-300":"",q=l=>(l.map(o=>{o.class_h=W(o)}),l),m=p("pv_not_done");L(()=>m.value,l=>{H()},{immediate:!1});const a={};a._TimeZoneOffset=new Date().getTimezoneOffset(),a.sort="tanggal:desc";const F=p({}),R=p({from:"",to:""}),w=be("token"),{data:Z}=([N,z]=ge(async()=>$e(async()=>{i().loading_full=!0;let l=[];const[o,d]=await Promise.all([A("/trx_trps/dataFin",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{filter_status:m},retry:0})]);return o.status.value!=="error"&&(l=q(o.data.value.data)),o.status.value==="error"?($().trigger(o.error),{trx_trps:l}):(i().loading_full=!1,{trx_trps:l})},{lazy:!0,server:!1,default:()=>({trx_trps:[]})},"$mHT2RIPzaD")),N=await N,z(),N),h=p([]);L(()=>{var l;return(l=Z.value)==null?void 0:l.trx_trps},l=>{l&&(h.value=[...l])},{immediate:!0});const U=p({field:"tanggal",by:"desc"}),T=p(-1),f=p({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),P=()=>{a.like="";let l=JSON.parse(JSON.stringify(i()._tv.global_keyword));l!=""&&(a.like=`id:%${l}%,xto:%${l}%,jenis:%${l}%,pv_no:%${l}%,ticket_a_no:%${l}%,ticket_b_no:%${l}%,no_pol:%${l}%,supir:%${l}%,kernet:%${l}%,cost_center_code:%${l}%,cost_center_desc:%${l}%,pvr_no:%${l}%,tanggal:%${l}%,transition_target:%${l}%,uj_asst_opt:%${l}%`),a.sort="",U.value.field&&(a.sort=U.value.field+":"+U.value.by),a.date_from=R.value.from?I(R.value.from).format("YYYY-MM-DD"):"",a.date_to=R.value.to?I(R.value.to).format("YYYY-MM-DD"):"",a.filter_model=JSON.stringify(i()._tv.filter_model),a.filter_status=m.value},Y=async()=>{i().loading_full=!0,F.value={},f.value.may_get_data=!1,a.page=f.value.page,a.page==1&&(h.value=[]),a.first_row&&delete a.first_row,a.page>1&&(a.first_row=JSON.stringify(h.value[0])),a.filter_status=m.value;const{data:l,error:o,status:d}=await A("/trx_trps/dataFin",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:a,retry:0});if(i().loading_full=!1,f.value.may_get_data=!0,d.value==="error"){$().trigger(o,F);return}f.value.page==1?h.value=q(l.value.data):f.value.page>1&&(h.value=[...h.value,...q(l.value.data)]),l.value.data.length==0&&(f.value.is_last_record=!0),i()._tv.filter_box=!1},H=()=>{T.value=-1,f.value.page=1,f.value.is_last_record=!1,P(),Y()},Q=p([{key:"no",label:"No",isai:!0},{key:"val",label:"APP",childs:[{key:"val",label:"Kasir",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"Mandor",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"KTU/W",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val3",label:"Marketing",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val4",label:"Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val5",label:"SPV Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]}]},{key:"id",label:"ID",filter_on:1,type:"number",sort:{priority:2,type:"desc"}},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"uj_asst_opt",label:"Info",filter_on:1,type:"select",select_item:["DENGAN KERNET","TANPA KERNET"]},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"transition",label:"Peralihan",childs:[{key:"transition_type",label:"Type",type:"select",filter_on:1,select_item:["To","From"]},{key:"transition_target",label:"Target",type:"select",filter_on:1,select_item:i().list_pabrik}]},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"payment_method_name",label:"Payment Method Name",type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),{downloadFile:j,viewFile:Pt}=Ne(),S=p(!1),E=p(""),V=async()=>{if(S.value==!0){S.value=!1;return}P(),i().loading_full=!0;const{data:l,error:o,status:d}=await A("/trx_trps/reportFinPDF",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:a,retry:0});if(i().loading_full=!1,d.value==="error"){$().trigger(o);return}E.value=l.value,S.value=!0},X=async(l="")=>{P(),i().loading_full=!0,a.filter_status=m.value;const{data:o,error:d,status:C}=await A("/trx_trps/reportFinExcel",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:a,retry:0});if(i().loading_full=!1,C.value==="error"){$().trigger(d);return}j(o.value)},ee=async(l="")=>{P(),i().loading_full=!0,a.filter_status=m.value;const{data:o,error:d,status:C}=await A("/trx_trps/reportFullExcel",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:a,retry:0});if(i().loading_full=!1,C.value==="error"){$().trigger(d);return}j(o.value)},te=()=>{j(E.value)},M=p(!1),y=p({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),le=async()=>{T.value==-1&&display({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}),i().loading_full=!0;const{data:l,error:o,status:d}=await A("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:h.value[T.value].id_uj},retry:0});if(i().loading_full=!1,d.value==="error"){$().trigger(o,F);return}y.value=l.value.data,M.value=!0},oe=ke(()=>{let l=0;return y.value.details2.forEach(o=>{o.p_status!="Remove"&&(l+=o.qty*o.amount)}),l});return(l,o)=>{const d=_e,C=ce,K=de,se=pe,ae=ue,g=fe,k=me,re=ye,ne=ve,ie=he;return r(),D(B,null,[e("div",Re,[b(d,{title:"List Transaction"}),e("div",Pe,[e("div",Se,[e("div",Me,[e("div",qe,[J(e("select",{class:"","onUpdate:modelValue":o[0]||(o[0]=t=>we(m)?m.value=t:null)},Ue,512),[[xe,s(m)]])]),e("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[1]||(o[1]=t=>V())},[b(C),x(),je]),e("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[2]||(o[2]=t=>X())},[b(K),x(),Ee]),e("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[3]||(o[3]=t=>ee())},[b(K),x(),Be]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[4]||(o[4]=t=>le())},[b(se)])])]),b(re,{thead:s(Q),selected:s(T),onSetSelected:o[5]||(o[5]=t=>T.value=t),tbody:s(h),fnCallData:Y,scrolling:s(f),onSetScrollingPage:o[6]||(o[6]=t=>s(f).page=t),onDoFilter:o[7]||(o[7]=t=>H())},{absen:u(({item:t,index:c})=>[t.trx_absens&&t.trx_absens.length>0?(r(),_(ae,{key:0,class:"cursor-pointer",onClick:Mt=>l.form_absen(c)},null,8,["onClick"])):O("",!0)]),val:u(({item:t})=>[t.val?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),val1:u(({item:t})=>[t.val1?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),val2:u(({item:t})=>[t.val2?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),val3:u(({item:t})=>[t.val3?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),val4:u(({item:t})=>[t.val4?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),val5:u(({item:t})=>[t.val5?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),uj_asst_opt:u(({item:t})=>{var c;return[x(n((c=t.uj)==null?void 0:c.asst_opt),1)]}),payment_method_name:u(({item:t})=>{var c;return[x(n((c=t.payment_method)==null?void 0:c.name),1)]}),pvr_had_detail:u(({item:t})=>[t.pvr_had_detail?(r(),_(k,{key:1})):(r(),_(g,{key:0}))]),deleted_by_username:u(({item:t})=>{var c;return[x(n((c=t.deleted_by)==null?void 0:c.username),1)]}),req_deleted_by_username:u(({item:t})=>{var c;return[x(n((c=t.req_deleted_by)==null?void 0:c.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])])]),s(S)?(r(),D("div",ze,[e("div",Ie,[e("div",Ye,[b(ne,{style:{color:"black",cursor:"pointer"},onClick:o[8]||(o[8]=t=>V())})]),e("iframe",{ref:"iframe",width:"100%",height:"100%",src:s(E).dataBase64},null,8,He),e("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[9]||(o[9]=t=>te())})])])):O("",!0),J(e("div",Ve,[e("div",Ke,[b(ie,{title:"Detail Information",fn:()=>{M.value=!1,l.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("div",Le,[e("div",Je,[e("div",Oe,[Ge,e("div",We,n(s(y).xto)+" ",1)]),e("div",Ze,[Qe,e("div",Xe,n(s(y).tipe),1)]),e("div",et,[tt,e("div",lt,n(s(y).jenis),1)]),e("div",ot,[st,e("div",at,n(s(y).note_for_remarks),1)])]),e("div",rt,[e("table",nt,[it,(r(!0),D(B,null,G(s(y).details,t=>(r(),D("tr",null,[e("td",_t,n(t.ordinal)+". ",1),e("td",ct,n(t.xdesc)+" "+n(t.qty<=1?"":s(v)(t.qty||0)+" x Rp."+s(v)(t.harga||0)),1),dt,e("td",pt,n(s(v)(t.qty*t.harga)),1)]))),256)),e("tr",ut,[ft,mt,e("th",yt,n(s(v)(s(y).harga)),1)])])]),e("div",vt,[e("table",ht,[bt,(r(!0),D(B,null,G(s(y).details2,t=>(r(),D("tr",null,[e("td",gt,n(t.ordinal)+". ",1),e("td",kt,n(t.ac_account_code),1),e("td",xt,n(t.description)+" "+n(t.qty<=1?"":s(v)(t.qty||0)+" x Rp."+s(v)(t.amount||0)),1),wt,e("td",Dt,n(s(v)(t.qty*t.amount)),1)]))),256)),e("tr",$t,[At,Tt,e("th",Ct,n(s(v)(s(oe))),1)])])])]),e("div",Nt,[e("button",{class:"rounded m-1",onClick:o[10]||(o[10]=t=>M.value=!1)}," Cancel ")])])],512),[[De,s(M)]])],64)}}};export{al as default};
