import{_ as ie}from"./Header.896a3c07.js";import{u as ue,_ as ce}from"./useDownload.42781f0e.js";import{_ as de}from"./Table2Column.0cc4cc01.js";import{_ as pe}from"./client-only.1081a465.js";import{u as L,_ as fe}from"./useUtils.cab915b1.js";import{_ as be,a as me}from"./Check.a22c9b54.js";import{_ as ke}from"./TableView.69ac0948.js";import{_ as ve}from"./PopupMini.vue.455ed07b.js";import{_ as ye}from"./Times.f09964d9.js";import{r as i,f as ge,D as xe,B as he,H as Z,I as we,L as De,c as q,b as d,a as o,w as n,t as u,k as l,h as P,j as Me,i as $e,l as G,m as Se,G as Te,E as Ae,x as f,y as M,o as v,q as Ce,K as x,d as c,M as Be,s as Ne}from"./entry.1bfb00b4.js";import{u as $}from"./useMyFetch.d9d711ae.js";import"./_plugin-vue_export-helper.c27b6911.js";const Ve={class:"w-full h-full flex flex-col"},je={class:"w-full flex grow flex-col overflow-auto h-0"},Ye={class:"w-full flex"},He={action:"#",class:"w-full flex flex-wrap text-xs"},Pe={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},Fe=o("div",{class:"font-bold"}," Tgl Dari ",-1),Ie={class:"text-red-500"},Oe={class:"w-6/12 p-1 sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col"},ze=o("div",{class:"font-bold"}," Tgl Sampai ",-1),Ke={class:"text-red-500"},Ee={class:"w-6/12 p-1 sm:w-4/12 md:w-2/12 lg:w-4/12 flex flex-col"},Ue=o("div",{class:"font-bold"}," Keyword ",-1),Re={class:"w-6/12 p-1 sm:w-4/12 md:w-1/12 lg:w-2/12 flex flex-col"},Je=o("div",{class:"font-bold"}," Sort By ",-1),Le=Be('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Ze=[Le],qe={class:"w-6/12 p-1 sm:w-4/12 md:w-2/12 lg:w-1/12 flex flex-col"},Ge=o("div",{class:"font-bold"}," Sort Order ",-1),Qe=o("option",{value:"asc"},"Asc",-1),We=o("option",{value:"desc"},"Desc",-1),Xe=[Qe,We],et={class:"w-2/12 md:w-1/12 lg:w-1/12 p-1 flex items-end"},tt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},at={class:"relative",style:{width:"95%",height:"90%"}},ot={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},lt=["src"],yt={__name:"index",async setup(st){let S,F;const{$moment:I}=Ne(),{pointFormat:b}=L(),r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const T=i({}),h=ge("token"),m=i({from:"",to:""}),{data:Q}=([S,F]=xe(async()=>Ae(async()=>{f().loading_full=!0;let a=[];const[t,_]=await Promise.all([$("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0})]);return t.status.value!=="error"&&(a=t.data.value.data),t.status.value==="error"?(M().trigger(t.error),{trx_trps:a}):(f().loading_full=!1,{trx_trps:a})},"$8KmJHfPiB5")),S=await S,F(),S),k=i(Q.value.trx_trps||[]),s=i(""),y=i({field:"tanggal",by:"desc"}),w=i(-1),p=i({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),B=()=>{r.like="",s.value!=""&&(r.like=`id:%${s.value}%,xto:%${s.value}%,jenis:%${s.value}%,pv_no:%${s.value}%,ticket_a_no:%${s.value}%,ticket_b_no:%${s.value}%,no_pol:%${s.value}%,supir:%${s.value}%,kernet:%${s.value}%,cost_center_code:%${s.value}%,cost_center_desc:%${s.value}%,pvr_id:%${s.value}%,pvr_no:%${s.value}%,tanggal:%${s.value}%,transition_to:%${s.value}%`),r.sort="",y.value.field&&(r.sort=y.value.field+":"+y.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=m.value.from?I(m.value.from).format("YYYY-MM-DD"):"",r.date_to=m.value.to?I(m.value.to).format("YYYY-MM-DD"):""},O=i(null),z=async()=>{f().loading_full=!0,T.value={},p.value.may_get_data=!1,r.page=p.value.page,r.page==1&&(k.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(k.value[0]));const{data:a,error:t,status:_}=await $("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(f().loading_full=!1,p.value.may_get_data=!0,_.value==="error"){M().trigger(t,T);return}p.value.page==1?(k.value=a.value.data,O.value&&(O.value.scrollTop=0)):p.value.page>1&&(k.value=[...k.value,...a.value.data]),a.value.data.length==0&&(p.value.is_last_record=!0)},W=()=>{p.value.page=1,p.value.is_last_record=!1,B(),z()};he(),i(!1),i(0),Z(),we(Z());const X=i({}),A=i(!1),ee=async()=>{A.value&&(A.value=!1)},te=async()=>{f().loading_full=!0;const a=new FormData;a.append("id",k.value[w.value].id),a.append("_method","DELETE");const{data:t,error:_,status:g}=await $("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:a,retry:0});if(f().loading_full=!1,g.value==="error"){M().trigger(_);return}k.value.splice(w.value,1),w.value=-1,A.value=!1},{downloadFile:K,viewFile:rt}=ue(),C=i(!1),N=i(""),E=async()=>{if(C.value==!0){C.value=!1;return}B(),f().loading_full=!0;const{data:a,error:t,status:_}=await $("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(f().loading_full=!1,_.value==="error"){M().trigger(t);return}N.value=a.value,C.value=!0},ae=async()=>{B(),f().loading_full=!0;const{data:a,error:t,status:_}=await $("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(f().loading_full=!1,_.value==="error"){M().trigger(t);return}K(a.value)},oe=()=>{K(N.value)},U=a=>a.pv_id<=0||["CPO","PK"].indexOf(a.jenis)>-1&&(a.ticket_a_id<=0||a.ticket_b_bruto<=0||a.ticket_b_tara<=0||a.ticket_b_netto<=0||a.ticket_b_in_at==""||a.ticket_b_out_at=="")||a.jenis=="TBS"&&(a.ticket_a_id<=0||a.ticket_b_id<=0)||a.jenis=="TBSK"&&a.ticket_b_id<=0?0:1,le=i([{key:"status",label:"Status"},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"id",label:"ID"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol"},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"default",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",dateformat:"DD-MM-Y"},{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"transition_to",label:"Peralihan"},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No"},{key:"ticket_a_bruto",label:"Bruto"},{key:"ticket_a_tara",label:"Tara"},{key:"ticket_a_netto",label:"Netto"},{key:"ticket_a_supir",label:"Supir"},{key:"ticket_a_no_pol",label:"No Pol"},{key:"ticket_a_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_a_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No"},{key:"ticket_b_bruto",label:"Bruto"},{key:"ticket_b_tara",label:"Tara"},{key:"ticket_b_netto",label:"Netto"},{key:"ticket_b_supir",label:"Supir"},{key:"ticket_b_no_pol",label:"No Pol"},{key:"ticket_b_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_b_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"}]),V=(a,t)=>{a=parseFloat(a)||0,t=parseFloat(t)||0;let _=parseFloat(t-a),g=_>0?t:a;if(g==0)return 0;let D=L().round(_/g*100,2);return D<0?"("+Math.abs(D*100)/100+")":D},j=(a,t)=>{a=parseFloat(a)||0,t=parseFloat(t)||0;let _=parseFloat(t-a);return _<0?"("+b(Math.abs(_))+")":b(_)};return(a,t)=>{const _=ie,g=ce,D=de,R=De("vue-date-picker"),J=pe,se=fe,Y=be,H=me,re=ke,ne=ve,_e=ye;return v(),q("div",Ve,[d(_,{title:"Report Transaction"}),o("div",je,[o("div",Ye,[o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=e=>E())},[d(g)]),o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=e=>ae())},[d(D)])]),o("form",He,[o("div",Pe,[Fe,d(J,null,{default:n(()=>[d(R,{modelValue:l(m).from,"onUpdate:modelValue":t[2]||(t[2]=e=>l(m).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),o("p",Ie,u(l(T).date_from),1)]),o("div",Oe,[ze,d(J,null,{default:n(()=>[d(R,{modelValue:l(m).to,"onUpdate:modelValue":t[3]||(t[3]=e=>l(m).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"",class:"flex-grow"},null,8,["modelValue"])]),_:1}),o("p",Ke,u(l(T).date_to),1)]),o("div",Ee,[Ue,P(o("input",{class:"flex-grow",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>$e(s)?s.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[Me,l(s)]])]),o("div",Re,[Je,P(o("select",{class:"flex-grow","onUpdate:modelValue":t[5]||(t[5]=e=>l(y).field=e)},Ze,512),[[G,l(y).field]])]),o("div",qe,[Ge,P(o("select",{class:"flex-grow","onUpdate:modelValue":t[6]||(t[6]=e=>l(y).by=e)},Xe,512),[[G,l(y).by]])]),o("div",et,[o("button",{class:"",type:"submit",name:"button",onClick:t[7]||(t[7]=Se(e=>W(),["prevent"]))},[d(se,{class:"text-2xl"})])])]),d(re,{thead:l(le),selected:l(w),onSetSelected:t[8]||(t[8]=e=>w.value=e),tbody:l(k),fnCallData:z,scrolling:l(p),onSetScrollingPage:t[9]||(t[9]=e=>l(p).page=e)},{status:n(({item:e})=>[o("div",{class:Ce(["text-white text-xs px-2 py-1 rounded-lg",U(e)?"bg-green-600":"bg-red-600"])},u(U(e)?"Done":"Not Done"),3)]),app1:n(({item:e})=>[e.val?(v(),x(H,{key:1})):(v(),x(Y,{key:0}))]),app2:n(({item:e})=>[e.val1?(v(),x(H,{key:1})):(v(),x(Y,{key:0}))]),pvr_completed:n(({item:e})=>[e.pvr_had_detail?(v(),x(H,{key:1})):(v(),x(Y,{key:0}))]),susut_bruto_a:n(({item:e})=>[c(u(l(b)(e.ticket_a_bruto)),1)]),susut_tara_a:n(({item:e})=>[c(u(l(b)(e.ticket_a_tara)),1)]),susut_netto_a:n(({item:e})=>[c(u(l(b)(e.ticket_a_netto)),1)]),susut_bruto_b:n(({item:e})=>[c(u(l(b)(e.ticket_b_bruto)),1)]),susut_tara_b:n(({item:e})=>[c(u(l(b)(e.ticket_b_tara)),1)]),susut_netto_b:n(({item:e})=>[c(u(l(b)(e.ticket_b_netto)),1)]),susut_bruto_b_a:n(({item:e})=>[c(u(j(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a:n(({item:e})=>[c(u(j(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a:n(({item:e})=>[c(u(j(e.ticket_a_netto,e.ticket_b_netto)),1)]),susut_bruto_b_a_persen:n(({item:e})=>[c(u(V(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a_persen:n(({item:e})=>[c(u(V(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a_persen:n(({item:e})=>[c(u(V(e.ticket_a_netto,e.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),d(ne,{type:"delete",show:l(A),data:l(X),fnClose:ee,fnConfirm:te},null,8,["show","data"]),l(C)?(v(),q("div",tt,[o("div",at,[o("div",ot,[d(_e,{style:{color:"black",cursor:"pointer"},onClick:t[10]||(t[10]=e=>E())})]),o("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(N).dataBase64},null,8,lt),o("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[11]||(t[11]=e=>oe())})])])):Te("",!0)])}}};export{yt as default};
