import{_ as L}from"./HeaderPopup.vue.e254f2d7.js";import{r as y,f as M,G as B,j as J,m as x,J as O,o as p,c as m,a as e,b as G,k as n,v as T,t as h,C as D,F as S,y as $,Y as z,x as H,A as d,B as b}from"./entry.6bd5fcb6.js";import"./useUtils.b118eb2a.js";import{u as k}from"./useMyFetch.f13003ce.js";import"./Times.decf023a.js";import"./_plugin-vue_export-helper.c27b6911.js";const Y={class:"box-fixed"},I={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},K={class:"w-full flex flex-col items-center grow overflow-auto"},Q={class:"w-full flex flex-row flex-wrap"},R={class:"w-full flex flex-col flex-wrap p-1"},W=e("label",{for:""},"Name",-1),X={class:"text-red-500"},Z={class:"w-full flex flex-col sm:flex-row grow p-1 justify-between flex-wrap 2xl:overflow-hidden"},ee={class:"w-full max-w-full p-0 2xl:pr-1 2xl:w-1/2 2xl:max-h-full 2xl:overflow-auto"},te={class:"w-full",role:"sticky"},ae={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},se=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission List ")],-1),le={class:"sticky top-7 !z-[2]"},oe={class:"min-w-[20px] !w-[20px] max-w-[20px]"},re=e("th",null,"Name",-1),ne={ref:"to_move"},ie={class:"!w-[10px]"},ue={class:"w-full h-full flex items-center justify-center"},ce=["onUpdate:modelValue"],de={class:"w-full h-full flex items-center justify-start"},fe={class:"w-full max-w-full max-h-full px-0 py-2 2xl:pl-1 2xl:py-0 2xl:w-1/2 2xl:overflow-auto"},pe={class:"w-full",role:"sticky"},me={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},he=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission User ")],-1),_e={class:"sticky top-7 !z-[2]"},ve={class:"min-w-[10px] !w-[10px] max-w-[10px]"},ge=e("th",null,"Name",-1),we={ref:"to_move"},ye={class:"!w-[10px]"},xe={class:"w-full h-full flex items-center justify-center"},be=["onUpdate:modelValue"],ke={class:"w-full h-full flex items-center justify-start"},Ce={class:"w-full flex items-center justify-end"},ze={__name:"permission_group",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(_){const c=_,A={name:"",list:[]},l=y({...A}),v=M("token"),C=y({}),N=async()=>{d().loading_full=!0,C.value={};const s=new FormData;s.append("name",l.value.name),s.append("permission_list",JSON.stringify(g.value)),s.append("users",JSON.stringify(w.value));let t="post",u=c.is_copy?0:c.id;u==0||(s.append("id",u),s.append("_method","PUT"));const{data:a,error:f,status:r}=await k("/permission_group",{method:t,headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},body:s,retry:0});if(d().loading_full=!1,r.value==="error"){b().trigger(f,C);return}if(u<=0)l.value.id=a.value.id,l.value.created_at=a.value.created_at,l.value.updated_at=a.value.updated_at,c.p_data.unshift(l.value);else{l.value.updated_at=a.value.updated_at;let j=c.p_data.map(E=>E.id).indexOf(u);j>=-1&&c.p_data.splice(j,1,{...l.value})}c.fnClose()},U=async()=>{d().loading_full=!0;const{data:s,error:t,status:u}=await k("/permission_group",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{id:c.id},retry:0});if(d().loading_full=!1,u.value==="error"){b().trigger(t);return}l.value=s.value.data,c.is_copy&&(l.value.val=0,l.value.val1=0),s.value.data.details.forEach((a,f)=>{o.value=o.value.map(r=>(r.name==a.permission_list_name&&(r.checked=!0),r))}),s.value.data.users.forEach((a,f)=>{i.value=i.value.map(r=>(r.username==a.username&&(r.checked=!0),r))})},o=y([]),q=async()=>{d().loading_full=!0;const{data:s,error:t,status:u}=await k("/permission_lists",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{sort:"name:asc"},retry:0});if(d().loading_full=!1,u.value==="error"){b().trigger(t);return}o.value=s.value.data.map(a=>(a.checked=!1,a))},i=y([]),V=async()=>{d().loading_full=!0;const{data:s,error:t,status:u}=await k("/users",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{sort:"username:asc"},retry:0});if(d().loading_full=!1,u.value==="error"){b().trigger(t);return}i.value=s.value.data.map(a=>(a.checked=!1,a))},g=B(s=>o.value.filter(t=>t.checked)),F=s=>{g.value.length!=o.value.length?o.value=o.value.map(t=>(t.checked=!0,t)):o.value=o.value.map(t=>(t.checked=!1,t))},w=B(s=>i.value.filter(t=>t.checked)),P=s=>{w.value.length!=i.value.length?i.value=i.value.map(t=>(t.checked=!0,t)):i.value=i.value.map(t=>(t.checked=!1,t))};return J(()=>c.show,async(s,t)=>{s==!0&&(l.value={...A},o.value=[],await q(),await V(),c.id!=0&&await U())},{immediate:!0}),(s,t)=>{const u=L;return x((p(),m("section",Y,[e("div",null,[G(u,{title:"Form Permission Group",fn:_.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",I,[e("div",K,[e("div",Q,[e("div",R,[W,x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n(l).name=a)},null,512),[[T,n(l).name]]),e("p",X,h(n(C).name),1)])]),e("div",Z,[e("div",ee,[e("div",te,[e("table",ae,[e("thead",null,[se,e("tr",le,[e("th",oe,[e("button",{type:"button",name:"button",class:D(["text-xs",n(g).length!=n(o).length?"bg-green-500":"bg-red-500"]),onClick:t[1]||(t[1]=a=>F())},h(n(g).length!=n(o).length?"Allow":"Deny"),3)]),re])]),e("tbody",ne,[(p(!0),m(S,null,$(n(o),(a,f)=>(p(),m("tr",{key:f},[e("td",ie,[e("div",ue,[x(e("input",{type:"checkbox","onUpdate:modelValue":r=>a.checked=r,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,ce),[[z,a.checked]])])]),e("td",null,[e("div",de,h(a.name),1)])]))),128))],512)])])]),e("div",fe,[e("div",pe,[e("table",me,[e("thead",null,[he,e("tr",_e,[e("th",ve,[e("button",{type:"button",name:"button",class:D(["text-xs",n(w).length!=n(i).length?"bg-green-500":"bg-red-500"]),onClick:t[2]||(t[2]=a=>P())},h(n(w).length!=n(i).length?"Allow":"Deny"),3)]),ge])]),e("tbody",we,[(p(!0),m(S,null,$(n(i),(a,f)=>(p(),m("tr",{key:f},[e("td",ye,[e("div",xe,[x(e("input",{type:"checkbox","onUpdate:modelValue":r=>a.checked=r,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,be),[[z,a.checked]])])]),e("td",null,[e("div",ke,h(a.username),1)])]))),128))],512)])])])])]),e("div",Ce,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[3]||(t[3]=a=>_.fnClose())}," Cancel "),e("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[4]||(t[4]=H(a=>N(),["prevent"]))}," Save ")])])])],512)),[[O,_.show]])}}};export{ze as default};
