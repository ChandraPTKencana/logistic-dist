import P from"./PDFJsView.0237754e.js";import{Q as S,a4 as B,M as I,r as a,g as V,a2 as $,f as U,o as c,c as p,a as h,t as q,l as f,n as m,z as A,k as j,L}from"./entry.a83f8bd6.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";function M(i,d,o,_){let s,l=!1;S(()=>{s=new IntersectionObserver(async([t])=>{t.isIntersecting&&!l&&(l=!0,await d())},{threshold:0,rootMargin:"300px",..._}),i.value&&s.observe(i.value)}),B(()=>{s==null||s.disconnect(),o==null||o()})}const z={class:"w-full"},N={for:""},E={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},J={class:"image-box"},Q={key:0},W=["src"],G={key:1,class:"skeleton"},H=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(i,{emit:d}){const o=i;a(!1);const _=a(null);a(null),a(null);const s=a(null),l=a(null);let t=null;const O=V("token"),{apiBase:F}=$(),u=a(),v=a(!1),g=a(!1),R=e=>{const n=e.target.files;if(!n||!n.length)return;g.value=!0;const r=n[0];u.value=r,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(r),l.value=t,d("setPreview","exist"),d("setFile",r)},C=()=>{k(!0);const e=_.value;e&&(e.value=""),d("setFile",null),d("setPreview",null)};U(()=>o.show,e=>{console.log("+showing",e),k(!0),l.value=null,u.value=null,v.value=!1,g.value=!1,t=null,console.log("-showing",e)},{immediate:!0,deep:!0}),U(()=>o.link,e=>{console.log("+openlink"),e&&(s.value&&y(),console.log("-openlink"))},{immediate:!0});async function y(){if(console.log("++++++trigger load"),console.log("props.link",o.link),console.log("src.value",l.value),console.log("isUserFile.value",g.value),console.log("loadedOnce.value",v.value),console.log("------trigger load"),!o.link||l.value||o.link=="exist"||g.value||v.value)return;const e=o.link.startsWith("http")?o.link:`${F}${o.link}`,n=await fetch(e,{headers:{Authorization:`Bearer ${O.value}`}});if(!n.ok){let r=_.value;r&&(r.value="");return}u.value=await n.blob(),t=URL.createObjectURL(u.value),l.value=t,v.value=!0}function k(e=!1){g.value&&e==!1||v.value&&e==!1||(t&&(URL.revokeObjectURL(t),t=null),l.value=null,u.value=null)}return M(s,y,k,{rootMargin:"300px 0px",threshold:0}),B(()=>{v.value=!1}),(e,n)=>{var b,w;const r=P;return c(),p("div",{ref_key:"wrapper",ref:s,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[h("div",z,[h("label",N,q(i.label),1)]),h("div",E,[h("div",J,[f(l)?(c(),p("div",Q,[(b=f(u))!=null&&b.type.match(/image/)?(c(),p("img",{key:0,src:f(l),class:"w-full h-full object-cover"},null,8,W)):m("",!0),(w=f(u))!=null&&w.type.match(/application\/pdf/)?(c(),A(r,{key:1,pdfObjUrl:f(t)},null,8,["pdfObjUrl"])):m("",!0)])):(c(),p("div",G))])]),i.can_remove?j((c(),p("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:n[0]||(n[0]=x=>C())},"Clear",512)),[[L,f(l)]]):m("",!0),i.can_remove?j((c(),p("input",{key:1,class:"w-full",onChange:n[1]||(n[1]=x=>R(x)),ref_key:"photo_input",ref:_,type:"file",name:"photo"},null,544)),[[L,!f(l)]]):m("",!0)],512)}}});const Y=D(H,[["__scopeId","data-v-d6032248"]]);export{Y as default};
