import{_ as we}from"./HeaderPopup.vue.473bd6f0.js";import{_ as ye}from"./WidthMiniList.vue.d514c0ae.js";import be from"./Tools.a49630cb.js";import{_ as ke}from"./client-only.73418a55.js";import ge from"./AttachmentSingle.6c7e80c2.js";import Se from"./Times.61cc7a12.js";import Ne from"./Check.79406116.js";import Ce from"./Plus.feee31c1.js";import Ue from"./ToolsPopup.581ca559.js";import{r as v,f as Ie,i as Ae,G as oe,j as le,A as N,I as Oe,o as i,c as r,m as b,J as Te,a as e,b as k,k as t,v as V,F as O,y as $,t as u,q as ne,l as T,w as Ve,C as ie,D as E,x as $e,B as M,p as De,e as Pe,E as Ee}from"./entry.a9165af2.js";import{u as z}from"./useUtils.7da01f08.js";import{u as q}from"./useMyFetch.ee09c7ad.js";import{_ as Je}from"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.a54b4587.js";import"./PDFJsView.1039ee85.js";const _=g=>(De("data-v-d25a8f7c"),g=g(),Pe(),g),Re={class:"box-fixed"},je={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Fe={class:"w-full flex flex-col items-center grow overflow-auto"},Be={class:"w-full flex flex-row flex-wrap"},Me={class:"w-full sm:w-9/12 flex px-2 py-3"},ze={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},qe=_(()=>e("div",{class:"absolute bg-white -top-3"}," Standby ",-1)),Ke={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},Le=_(()=>e("label",{for:""},"ID",-1)),Ye=["disabled"],Ge={id:"standby_mst"},He=["value"],We={class:"text-red-500"},Xe={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Qe=_(()=>e("label",{for:""},"Name",-1)),Ze={class:"card-border disabled"},et={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},tt=_(()=>e("label",{for:""},"Type",-1)),st={class:"card-border disabled"},at={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},ot=_(()=>e("label",{for:""},"Amount",-1)),lt={class:"card-border disabled"},nt={class:"w-full sm:w-3/12 flex px-2 py-3"},it={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative items-end"},_t=_(()=>e("div",{class:"absolute bg-white -top-3"}," Peralihan ",-1)),rt={class:"w-6/12 flex flex-col flex-wrap p-1"},dt=["disabled"],ut=_(()=>e("option",{value:""},null,-1)),ct=_(()=>e("option",{value:"From"},"Dari",-1)),pt=_(()=>e("option",{value:"To"},"Ke",-1)),mt=[ut,ct,pt],vt={class:"text-red-500"},ft={class:"w-6/12 flex flex-col flex-wrap p-1"},ht=["disabled"],xt=_(()=>e("option",{value:""},null,-1)),wt=["value"],yt={class:"text-red-500"},bt={class:"w-full flex flex-wrap"},kt={key:0,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},gt=_(()=>e("label",{for:""},"Supir",-1)),St={class:"text-red-500"},Nt={key:1,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ct=_(()=>e("label",{for:""},"Kernet",-1)),Ut={class:"text-red-500"},It={class:"w-full flex flex-wrap"},At={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ot=_(()=>e("label",{for:""},"No Pol",-1)),Tt=["disabled"],Vt={id:"vehicle"},$t=["value"],Dt={class:"text-red-500"},Pt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Et=_(()=>e("label",{for:""},"Tujuan",-1)),Jt=["disabled"],Rt={id:"xto"},jt={class:"text-red-500"},Ft={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Bt=_(()=>e("label",{for:""},"Note For Remarks",-1)),Mt=["disabled"],zt={class:"text-red-500"},qt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Kt=_(()=>e("label",{for:""},"Referensi",-1)),Lt=["disabled"],Yt={class:"text-red-500"},Gt={class:"w-full flex grow p-1 overflow-auto 2xl:overflow-hidden justify-between flex-wrap"},Ht={class:"w-full",role:"sticky"},Wt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Xt={class:"sticky -top-1 !z-[2]"},Qt=["colspan"],Zt={class:"sticky top-7 !z-[2]"},es={key:0,class:"!min-w-[30px] !w-[30px] !max-w-[30px]"},ts=_(()=>e("th",{class:"!min-w-[50px] !w-[50px] !max-w-[50px]"},"No",-1)),ss=_(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Tanggal",-1)),as=_(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Foto",-1)),os=_(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Note",-1)),ls=_(()=>e("th",{class:"!min-w-[70px] !w-[70px] !max-w-[70px]"},"Dibayar",-1)),ns={ref:"to_move"},is=["data-index"],_s={key:0,class:"tools cell"},rs={class:"w-full h-full flex items-center justify-center"},ds=["onClick"],us={class:"cell"},cs={class:"w-full h-full flex items-center justify-center relative"},ps={class:"cell"},ms={class:"h-full flex items-center justify-center"},vs={class:"cell"},fs={class:"h-full flex items-center justify-center"},hs=["onUpdate:modelValue"],xs={class:"w-full h-full flex items-center justify-center"},ws={key:0,class:"text-3xl"},ys=["onClick"],bs={key:0},ks={class:"tools cell"},gs={class:"w-full flex items-center justify-end"},Ss={__name:"standby_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(g){const w=g,{$moment:_e}=Ee(),{pointFormat:K}=z(),J={id:-1,transition_target:"",transition_type:"",standby_mst_id:"",standby_mst_:{name:"",tipe:"",amount:0,is_transition:0},supir:"",kernet:"",no_pol:"",xto:"",note_for_remarks:"",ref:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:0,pv_id:"",pv_no:"",pv_total:0,pv_datetime:"",rv_id:"",rv_no:"",rv_total:0,rv_had_detail:"",details:[],details_count:0},d=v([]),L=v({ordinal:0,id:"",tanggal:new Date,note:"",be_paid:0,p_status:"",attachment_1:"",attachment_1_preview:""});let R={...J};const s=v({...J}),j=Ie("token"),f=v({});Ae();const re=async()=>{N().loading_full=!0,f.value={};const l=new FormData;l.append("transition_target",s.value.transition_target),l.append("transition_type",s.value.transition_type),l.append("standby_mst_id",s.value.standby_mst_id),l.append("supir_id",p.value.id),l.append("kernet_id",m.value.id),l.append("no_pol",s.value.no_pol),l.append("xto",s.value.xto),l.append("note_for_remarks",s.value.note_for_remarks),l.append("ref",s.value.ref);let a=[...d.value];a=a.map((c,A)=>(c.tanggal=c.tanggal?_e(c.tanggal).format("Y-MM-DD"):"",c.attachment_1_preview=c.attachment_1_preview?"Exists":null,l.append(`attachments[${A}]`,c.attachment_1),c)),l.append("details",JSON.stringify(a));let x="post",n=w.id;n==0||(l.append("id",n),l.append("_method","PUT"));const{data:I,error:S,status:B}=await q("/standby_trx",{method:x,headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},body:l,retry:0});if(N().loading_full=!1,B.value==="error"){M().trigger(S,f);return}if(s.value.details=[...d.value].map((c,A)=>(c.attachment_1_type=c.attachment_1_preview?"Exists":"",c)),s.value.details_count=d.value.length,s.value.supir=p.value.name,s.value.supir_rek_no=p.value._.rek_no.val,s.value.supir_rek_name=p.value._.rek_name.val,s.value.kernet=m.value.name,s.value.kernet_rek_no=m.value._.rek_no.val,s.value.kernet_rek_name=m.value._.rek_name.val,s.value.updated_at=I.value.updated_at,w.id<=0)s.value.id=I.value.id,s.value.created_at=I.value.created_at,w.p_data.unshift(s.value);else{let c=w.p_data.map(A=>A.id).indexOf(w.id);c>=-1&&w.p_data.splice(c,1,{...s.value})}w.fnClose()},C={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},p=v(JSON.parse(JSON.stringify(C))),m=v(JSON.parse(JSON.stringify(C))),Y=oe(()=>{let l=[];return W.value.forEach((a,x)=>{let n=JSON.parse(JSON.stringify(C));n._.id.val=a.id,n._.name.val=a.name,n._.rek_no.val=a.rek_no,n._.rek_name.val=a.rek_name,n.id=a.id,n.name=a.name,n.title=(a.rek_no||"")+" "+(a.rek_name||""),l.push(JSON.parse(JSON.stringify(n)))}),l}),U=oe(()=>!1),de=async()=>{N().loading_full=!0;const{data:l,error:a,status:x}=await q("/standby_trx",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},params:{id:w.id},retry:0});if(N().loading_full=!1,x.value==="error"){M().trigger(a);return}let n=l.value.data;s.value=n,R={...n},p.value._.id.val=n.supir_id,p.value._.name.val=n.supir,p.value._.rek_no.val=n.supir_rek_no,p.value._.rek_name.val=n.supir_rek_name,p.value.id=n.supir_id,p.value.name=n.supir,p.value.rek_no=(n.supir_rek_no||"")+" "+(n.supir_rek_name||""),m.value._.id.val=n.kernet_id,m.value._.name.val=n.kernet,m.value._.rek_no.val=n.kernet_rek_no,m.value._.rek_name.val=n.kernet_rek_name,m.value.id=n.kernet_id,m.value.name=n.kernet,m.value.rek_no=(n.kernet_rek_no||"")+" "+(n.kernet_rek_name||"");let I="Edit";d.value=l.value.data.details.map(S=>(S.p_status=I,S.key=S.ordinal,S))},F=v([]),G=v([]),H=v([]),W=v([]),ue=async()=>{N().loading_full=!0;const{data:l,error:a,status:x}=await q("/standby_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${j.value}`,Accept:"application/json"},retry:0});if(N().loading_full=!1,x.value==="error"){M().trigger(a);return}F.value=l.value.list_standby_mst,G.value=l.value.list_xto,H.value=l.value.list_vehicle,W.value=l.value.list_employee},h=v(-1),D=v(!1),X=v({left:0,top:0}),ce=(l,a)=>{h.value=a,D.value=!0,X.value={left:l.clientX,top:l.clientY}},pe=()=>{d.value.push({...L.value,p_status:"Add"})},me=()=>{D.value=!1},ve=(l="")=>{if(l=="insert")d.value.splice(h.value,0,{...L.value,p_status:"Add"});else if(l=="delete")d.value[h.value].p_status=="Edit"?d.value[h.value].p_status="Remove":d.value.splice(h.value,1);else if(l=="move_top"){let a=d.value[h.value];d.value.splice(h.value,1),d.value.splice(h.value-1,0,{...a})}else if(l=="move_bottom"){let a=d.value[h.value];d.value.splice(h.value,1),d.value.splice(h.value+1,0,{...a})}D.value=!1};le(()=>w.show,async(l,a)=>{l==!0&&(await ue(),s.value={...J},p.value=JSON.parse(JSON.stringify(C)),m.value=JSON.parse(JSON.stringify(C)),d.value=[],f.value={},w.id!=0&&de())},{immediate:!0});let fe={name:"",tipe:"",amount:0,is_transition:0};return le(()=>s.value.standby_mst_id,(l,a)=>{if(N().loading_full==!1&&(l==""||l!="")){let x=F.value.filter(n=>n.id==l);x.length>0?s.value.standby_mst_={...x[0]}:s.value.standby_mst_id==R.standby_mst_id?s.value.standby_mst_={...R.standby_mst_}:s.value.standby_mst_={...fe},s.value.standby_mst_.is_transition||(s.value.transition_target="",s.value.transition_type="")}},{}),(l,a)=>{var Z,ee,te,se,ae;const x=we,n=ye,I=be,S=Oe("vue-date-picker"),B=ke,c=ge,A=Se,Q=Ne,he=Ce,xe=Ue;return i(),r(O,null,[b(e("section",Re,[e("div",null,[k(x,{title:"Form Transaction",fn:g.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",je,[e("div",Fe,[e("div",Be,[e("div",Me,[e("div",ze,[qe,e("div",Ke,[Le,b(e("input",{type:"text",list:"standby_mst","onUpdate:modelValue":a[0]||(a[0]=o=>t(s).standby_mst_id=o),disabled:t(s).pvr_no!=""},null,8,Ye),[[V,t(s).standby_mst_id]]),e("datalist",Ge,[(i(!0),r(O,null,$(t(F),o=>(i(),r("option",{value:o.id},u(o.name+"-"+o.tipe+"-"+t(K)(o.amount||0)),9,He))),256))]),e("p",We,u(t(f).standby_mst_id),1)]),e("div",Xe,[Qe,e("div",Ze,u((Z=t(s).standby_mst_)==null?void 0:Z.name),1)]),e("div",et,[tt,e("div",st,u((ee=t(s).standby_mst_)==null?void 0:ee.tipe),1)]),e("div",at,[ot,e("div",lt,u(t(K)((te=t(s).standby_mst_)==null?void 0:te.amount)),1)])])]),e("div",nt,[e("div",it,[_t,e("div",rt,[b(e("select",{"onUpdate:modelValue":a[1]||(a[1]=o=>t(s).transition_type=o),disabled:((se=t(s).standby_mst_)==null?void 0:se.is_transition)==0},mt,8,dt),[[ne,t(s).transition_type]]),e("p",vt,u(t(f).transition_type),1)]),e("div",ft,[b(e("select",{"onUpdate:modelValue":a[2]||(a[2]=o=>t(s).transition_target=o),disabled:((ae=t(s).standby_mst_)==null?void 0:ae.is_transition)==0},[xt,(i(!0),r(O,null,$(t(N)().list_pabrik,o=>(i(),r("option",{value:o},u(o),9,wt))),256))],8,ht),[[ne,t(s).transition_target]]),e("p",yt,u(t(f).transition_target),1)])])]),e("div",bt,[["SUPIR","SUPIR KERNET"].indexOf(t(s).standby_mst_.driver_asst_opt)>-1?(i(),r("div",kt,[gt,k(n,{arr:t(Y),selected:t(p),pure:C,onSetSelected:a[3]||(a[3]=o=>p.value=o)},null,8,["arr","selected"]),e("p",St,u(t(f).supir_id),1)])):T("",!0),["KERNET","SUPIR KERNET"].indexOf(t(s).standby_mst_.driver_asst_opt)>-1?(i(),r("div",Nt,[Ct,k(n,{arr:t(Y),selected:t(m),pure:C,onSetSelected:a[4]||(a[4]=o=>m.value=o)},null,8,["arr","selected"]),e("p",Ut,u(t(f).kernet_id),1)])):T("",!0)]),e("div",It,[e("div",At,[Ot,b(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=o=>t(s).no_pol=o),disabled:t(s).pvr_no!=""},null,8,Tt),[[V,t(s).no_pol]]),e("datalist",Vt,[(i(!0),r(O,null,$(t(H),o=>(i(),r("option",{value:o.no_pol},u(o.no_pol),9,$t))),256))]),e("p",Dt,u(t(f).no_pol),1)]),e("div",Pt,[Et,b(e("input",{type:"text",list:"xto","onUpdate:modelValue":a[6]||(a[6]=o=>t(s).xto=o),disabled:t(s).pvr_no!=""},null,8,Jt),[[V,t(s).xto]]),e("datalist",Rt,[(i(!0),r(O,null,$(t(G),o=>(i(),r("option",null,u(o),1))),256))]),e("p",jt,u(t(f).xto),1)]),e("div",Ft,[Bt,b(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=o=>t(s).note_for_remarks=o),disabled:t(s).pvr_no!=""}," ",8,Mt),[[V,t(s).note_for_remarks]]),e("p",zt,u(t(f).note_for_remarks),1)]),e("div",qt,[Kt,b(e("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=o=>t(s).ref=o),disabled:t(s).pvr_no!=""},null,8,Lt),[[V,t(s).ref]]),e("p",Yt,u(t(f).ref),1)])]),e("div",Gt,[e("div",Ht,[e("table",Wt,[e("thead",null,[e("tr",Xt,[e("td",{colspan:t(U)?5:6,class:"!bg-slate-800 text-white font-bold"}," Detail Transaction ",8,Qt)]),e("tr",Zt,[t(U)?T("",!0):(i(),r("th",es)),ts,ss,as,os,ls])]),e("tbody",ns,[(i(!0),r(O,null,$(t(d),(o,P)=>(i(),r(O,{key:P},[o.p_status!="Remove"?(i(),r("tr",{key:0,"data-index":P},[t(U)?T("",!0):(i(),r("td",_s,[e("div",rs,[e("button",{type:"button",name:"button",onClick:y=>ce(y,P)},[k(I)],8,ds)])])),e("td",null,u(P+1)+".",1),e("td",us,[e("div",cs,[k(B,null,{default:Ve(()=>[k(S,{modelValue:o.tanggal,"onUpdate:modelValue":y=>o.tanggal=y,type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),e("td",ps,[e("div",ms,[k(c,{value:o.attachment_1_preview,onSetFile:y=>o.attachment_1=y,onSetPreview:y=>o.attachment_1_preview=y,can_remove:!0},null,8,["value","onSetFile","onSetPreview"])])]),e("td",vs,[e("div",fs,[b(e("textarea",{class:"h-full","onUpdate:modelValue":y=>o.note=y},null,8,hs),[[V,o.note]])])]),e("td",{class:ie(["cell",!("useUtils"in l?l.useUtils:t(z))().checkPermissions(["standby_trx.detail.decide_paid"])||t(U)?"unselectable":""])},[e("div",xs,[!("useUtils"in l?l.useUtils:t(z))().checkPermissions(["standby_trx.detail.decide_paid"])||t(U)?(i(),r("div",ws,[o.be_paid==0?(i(),E(A,{key:0,class:"text-red-800"})):(i(),E(Q,{key:1,class:"text-green-800"}))])):(i(),r("button",{key:1,type:"button",onClick:y=>o.be_paid=o.be_paid?0:1,class:ie(["text-white w-auto rounded text-xl",o.be_paid?"bg-green-600":"bg-red-600"])},[o.be_paid==0?(i(),E(A,{key:0})):(i(),E(Q,{key:1}))],10,ys))])],2)],8,is)):T("",!0)],64))),128)),t(U)?T("",!0):(i(),r("tr",bs,[e("td",ks,[e("button",{type:"button",name:"button",onClick:a[9]||(a[9]=o=>pe())},[k(he)])])]))],512)])])])])]),e("div",gs,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[10]||(a[10]=o=>g.fnClose())}," Cancel "),t(U)?T("",!0):(i(),r("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[11]||(a[11]=$e(o=>re(),["prevent"]))}," Save "))])])])],512),[[Te,g.show]]),k(xe,{show:t(D),coor:t(X),fn:me,data:t(d),data_index:t(h),onReplyAct:a[12]||(a[12]=o=>ve(o))},null,8,["show","coor","data","data_index"])],64)}}},Fs=Je(Ss,[["__scopeId","data-v-d25a8f7c"]]);export{Fs as default};
