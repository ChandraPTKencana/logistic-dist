import{r,f as q,g as Ee,h as Ie,i as S,j as le,s as ze,x as f,c as h,b as v,a as c,k as ne,v as Ve,l,m as oe,n as D,d as g,w as p,q as Me,y as M,o as d,z as P,t as C,A as Ne,B as R,_ as H}from"./entry.64cd1aac.js";import Re from"./Header.f208760b.js";import He from"./Copy.e579f24f.js";import Ke from"./Plus.010dc4d3.js";import Je from"./Edit.38146354.js";import Ge from"./Eyes.520cf251.js";import Ye from"./Delete.b32e4015.js";import qe from"./Signature.114dc868.js";import Xe from"./SignatureOff.aaf93e54.js";import Ze from"./Table2Column.a2758520.js";import Qe from"./Line.c0ce5175.js";import We from"./Check.e14d635e.js";import et from"./TableView.80f55f53.js";import{u as i}from"./useUtils.5c007a0a.js";import{u as N}from"./useMyFetch.26817b29.js";import{u as tt}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.47c47ba9.js";import"./Adjust.312fadec.js";import"./TableHeaderEye.3ced445c.js";import"./Times.580cbe5f.js";import"./ClearAll.7b669fbe.js";import"./client-only.6d089a8e.js";import"./ClearEach.24954096.js";import"./CaretLeftDoubleBold.3174994d.js";import"./CaretLeftBold.b497ca79.js";import"./CaretRightBold.bbf1d341.js";import"./CaretRightDoubleBold.bceefeca.js";const at=R(()=>H(()=>import("./PopupMini.7cf92bc9.js"),["./PopupMini.7cf92bc9.js","./PopupMini.vue.f821ddd2.js","./Times.580cbe5f.js","./_plugin-vue_export-helper.c27b6911.js","./entry.64cd1aac.js","./entry.c5f8f180.css","./Exclamation.d4af6369.js"],import.meta.url).then(m=>m.default||m)),lt=R(()=>H(()=>import("./ujalan.cdfd3b1c.js"),["./ujalan.cdfd3b1c.js","./HeaderPopup.vue.013ce12d.js","./Times.580cbe5f.js","./_plugin-vue_export-helper.c27b6911.js","./entry.64cd1aac.js","./entry.c5f8f180.css","./Tools.aa3d730c.js","./InputPointFormat.vue.003229da.js","./Check.e14d635e.js","./Plus.010dc4d3.js","./ToolsPopup.428a5bf9.js","./ToolsPopup.13c08491.css","./ac_accs.4d0b7307.js","./Search.47c47ba9.js","./useUtils.5c007a0a.js","./useMyFetch.26817b29.js","./ac_accs.2900e1e1.css"],import.meta.url).then(m=>m.default||m)),nt=R(()=>H(()=>import("./ujalan_change_some.7be78a36.js"),["./ujalan_change_some.7be78a36.js","./HeaderPopup.vue.013ce12d.js","./Times.580cbe5f.js","./_plugin-vue_export-helper.c27b6911.js","./entry.64cd1aac.js","./entry.c5f8f180.css","./InputPointFormat.vue.003229da.js","./WidthMiniList.vue.0e876d42.js","./WidthMiniPart.vue.b1c52855.js","./useUtils.5c007a0a.js","./useMyFetch.26817b29.js"],import.meta.url).then(m=>m.default||m)),ot=R(()=>H(()=>import("./ujalan_validasi.408fbe7c.js"),["./ujalan_validasi.408fbe7c.js","./HeaderPopup.vue.013ce12d.js","./Times.580cbe5f.js","./_plugin-vue_export-helper.c27b6911.js","./entry.64cd1aac.js","./entry.c5f8f180.css","./Check.e14d635e.js","./useUtils.5c007a0a.js","./useMyFetch.26817b29.js"],import.meta.url).then(m=>m.default||m)),st={class:"w-full h-full flex flex-col"},it={class:"w-full flex grow flex-col overflow-auto h-0"},rt={class:"w-full flex justify-between flex-wrap"},ut={class:"grow flex"},_t={class:"m-1"},dt=c("option",{value:"available"},"Available",-1),vt=c("option",{value:"unapprove"},"Unapprove",-1),ct=c("option",{value:"deleted"},"Trash",-1),pt=c("option",{value:"all"},"All",-1),mt=[dt,vt,ct,pt],ft=c("span",{class:"text-xs ml-1"}," Download ",-1),yt={class:"whitespace-pre-wrap"},bt={class:"grow mb-5"},Yt={__name:"index",async setup(m){let L,X;const{pointFormat:$}=i(),se=e=>e.deleted==1?"!bg-red-400":e.val==0||e.val1==0||e.val2==0||e.val3==0?"!bg-gray-300":"",b=r("available");q(()=>b.value,e=>{ee()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const Z=r({}),E=Ee("token"),{data:ie}=([L,X]=Ie(async()=>Me(async()=>{f().loading_full=!0;let e=[];const[t,w]=await Promise.all([N("/ujalan",{method:"get",headers:{Authorization:`Bearer ${E.value}`,Accept:"application/json"},params:{filter_status:b},retry:0})]);return t.status.value!=="error"&&(e=t.data.value.data),t.status.value==="error"?(M().trigger(t.error),{ujalans:e}):(f().loading_full=!1,{ujalans:e})},{lazy:!0,server:!1,default:()=>({ujalans:[]})},"$SN3C927rLk")),L=await L,X(),L),o=r([]);q(()=>{var e;return(e=ie.value)==null?void 0:e.ujalans},e=>{e&&(o.value=[...e])},{immediate:!0});const K=r({field:"tanggal",by:"desc"}),n=r(-1),_=S(()=>o.value[n.value]),y=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),Q=()=>{u.like="";let e=JSON.parse(JSON.stringify(f()._tv.global_keyword));e!=""&&(u.like=`id:%${e}%,xto:%${e}%,tipe:%${e}%,jenis:%${e}%,harga:%${e}%`),u.sort="",K.value.field&&(u.sort=K.value.field+":"+K.value.by),u.filter_model=JSON.stringify(f()._tv.filter_model)},W=async()=>{f().loading_full=!0,Z.value={},y.value.may_get_data=!1,u.page=y.value.page,u.page==1&&(o.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(o.value[0])),u.filter_status=b.value;const{data:e,error:t,status:w}=await N("/ujalan",{method:"get",headers:{Authorization:`Bearer ${E.value}`,Accept:"application/json"},params:u,retry:0});if(f().loading_full=!1,y.value.may_get_data=!0,w.value==="error"){M().trigger(t,Z);return}y.value.page==1?o.value=e.value.data:y.value.page>1&&(o.value=[...o.value,...e.value.data]),e.value.data.length==0&&(y.value.is_last_record=!0),f()._tv.filter_box=!1},ee=()=>{n.value=-1,y.value.page=1,y.value.is_last_record=!1,Q(),W()},B=r(!1),J=r(!1),T=r(0),k=r(0),x=r(-1),re=()=>{T.value=0,x.value=-1,k.value=!1,B.value=!0},{display:O}=le();ze(le());const ue=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=o.value[n.value].id,x.value=-1,k.value=!1,B.value=!0)},_e=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=o.value[n.value].id,x.value=-1,k.value=!1,J.value=!0)},de=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=o.value[n.value].id,x.value=-1,k.value=!0,B.value=!0)},F=r(!1),I=r(0),ve=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,x.value=1,k.value=!1,F.value=!0)},ce=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,x.value=0,k.value=!1,F.value=!0)},pe=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(I.value=o.value[n.value].id,k.value=!1,x.value=-1,F.value=!0)},G=r(!1),te=r({}),U=r(!1),A=r(""),me=async()=>{U.value&&(U.value=!1)},fe=()=>{n.value==-1?O({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(A.value="",te.value={id:o.value[n.value].id,tujuan:o.value[n.value].xto},U.value=!0)};q(()=>A.value,e=>{e.trim().length>0?G.value=!0:G.value=!1},{immediate:!1});const ye=async()=>{f().loading_full=!0;const e=new FormData;e.append("id",o.value[n.value].id),e.append("deleted_reason",A.value),e.append("_method","DELETE");const{data:t,error:w,status:Y}=await N("/ujalan",{method:"post",headers:{Authorization:`Bearer ${E.value}`,Accept:"application/json"},body:e,retry:0});if(f().loading_full=!1,Y.value==="error"){M().trigger(w);return}let j={...o.value[n.value]};j.deleted=t.value.deleted,j.deleted_user=t.value.deleted_user,j.deleted_at=t.value.deleted_at,j.deleted_by=t.value.deleted_by,j.deleted_reason=t.value.deleted_reason,b.value!="all"?o.value.splice(n.value,1):o.value.splice(n.value,1,{...j}),n.value=-1,U.value=!1},be=r([{key:"no",label:"No",isai:!0},{key:"val",label:"Staff Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"Kasir",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"SPV Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val3",label:"MGR Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"asst_opt",label:"Info",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"destination_location",label:"Dest. Location",childs:[{key:"destination_location_xto",label:"Xto",type:"string",filter_on:1},{key:"destination_location_minimal_trip",label:"Min Trip",filter_on:1,type:"string"},{key:"destination_location_bonus_trip_supir",label:"Bonus Trip Supir",filter_on:1,type:"number"},{key:"destination_location_bonus_next_trip_supir",label:"Bonus Trip Supir",filter_on:1,type:"number"},{key:"destination_location_bonus_trip_kernet",label:"Bonus Trip Kernet",filter_on:1,type:"number"},{key:"destination_location_bonus_next_trip_kernet",label:"Bonus Trip Kernet",filter_on:1,type:"number"}]},{key:"km_range",label:"Jarak KM",filter_on:1,type:"number"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"batas_persen_susut",label:"Batas Persen Susut",class:" justify-end",type:"number",tbl_show:i().checkPermission("ujalan.batas_persen_susut.full_act")},{key:"bonus_trip_supir",label:"Bonus Trip Supir",class:" justify-end",type:"number"},{key:"bonus_trip_kernet",label:"Bonus Trip Kernet",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:f().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),ke=S(()=>n.value>-1&&[void 0,0].indexOf(_.value.deleted)>-1&&i().checkPermission("ujalan.create")),he=S(()=>["available","all","unapprove"].indexOf(b.value)>-1&&i().checkPermission("ujalan.create")),ge=S(()=>n.value>-1&&[void 0,0].indexOf(_.value.deleted)>-1&&(i().checkPermission("ujalan.val")&&[void 0,0].indexOf(_.value.val)>-1||i().checkPermission("ujalan.val1")&&[void 0,0].indexOf(_.value.val1)>-1||i().checkPermission("ujalan.val2")&&[void 0,0].indexOf(_.value.val2)>-1||i().checkPermission("ujalan.val3")&&[void 0,0].indexOf(_.value.val3)>-1)&&i().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),xe=S(()=>n.value>-1&&[void 0,0].indexOf(_.value.deleted)>-1&&(i().checkPermission("ujalan.val")&&[void 0,0].indexOf(_.value.val)>-1||i().checkPermission("ujalan.val1")&&[void 0,0].indexOf(_.value.val1)>-1||i().checkPermission("ujalan.val2")&&[void 0,0].indexOf(_.value.val2)>-1||i().checkPermission("ujalan.val3")&&[void 0,0].indexOf(_.value.val3)>-1)),we=S(()=>n.value>-1&&[void 0,0].indexOf(_.value.deleted)>-1&&(i().checkPermission("ujalan.unval")&&[1].indexOf(_.value.val)>-1||i().checkPermission("ujalan.unval1")&&[1].indexOf(_.value.val1)>-1||i().checkPermission("ujalan.unval2")&&[1].indexOf(_.value.val2)>-1||i().checkPermission("ujalan.unval3")&&[1].indexOf(_.value.val3)>-1)),je=S(()=>n.value>-1&&i().checkPermission("ujalan.remove")&&[void 0,0].indexOf(_.value.deleted)>-1),{downloadFile:De,viewFile:kt}=tt(),Pe=async()=>{Q(),f().loading_full=!0,u.filter_status=b.value;const{data:e,error:t,status:w}=await N("/ujalan/download_excel",{method:"get",headers:{Authorization:`Bearer ${E.value}`,Accept:"application/json"},params:u,retry:0});if(f().loading_full=!1,w.value==="error"){M().trigger(t);return}De(e.value)};return(e,t)=>{const w=Re,Y=He,j=Ke,ae=Je,Ce=Ge,Oe=Ye,Se=qe,Te=Xe,Ae=Ze,z=Qe,V=We,$e=et,Be=at,Fe=lt,Ue=nt,Le=ot;return d(),h("div",st,[v(w,{title:"List Ujalan"}),c("div",it,[c("div",rt,[c("div",ut,[c("div",_t,[ne(c("select",{"aria-label":"Filter Status","onUpdate:modelValue":t[0]||(t[0]=a=>oe(b)?b.value=a:null)},mt,512),[[Ve,l(b)]])]),l(ke)?(d(),h("button",{key:0,type:"button",name:"button","aria-label":"Copy Data",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>de())},[v(Y)])):D("",!0),l(he)?(d(),h("button",{key:1,type:"button",name:"button","aria-label":"New Form",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>re())},[v(j)])):D("",!0),l(ge)?(d(),h("button",{key:2,type:"button",name:"button","aria-label":"Edit Form",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>ue())},[v(ae)])):D("",!0),l(n)>-1?(d(),h("button",{key:3,type:"button",name:"button","aria-label":"View Form",class:"m-1 text-2xl",onClick:t[4]||(t[4]=a=>pe())},[v(Ce)])):D("",!0),l(je)?(d(),h("button",{key:4,type:"button",name:"button","aria-label":"Delete Data",class:"m-1 text-2xl",onClick:t[5]||(t[5]=a=>fe())},[v(Oe)])):D("",!0),l(xe)?(d(),h("button",{key:5,type:"button",name:"button","aria-label":"Validate Data",class:"m-1 text-2xl",onClick:t[6]||(t[6]=a=>ve())},[v(Se)])):D("",!0),l(we)?(d(),h("button",{key:6,type:"button",name:"button","aria-label":"Unvalidate Data",class:"m-1 text-2xl",onClick:t[7]||(t[7]=a=>ce())},[v(Te)])):D("",!0),c("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:t[8]||(t[8]=a=>Pe())},[v(Ae),g(),ft]),l(n)>-1&&("useUtils"in e?e.useUtils:l(i))().checkPermission("ujalan.modify")?(d(),h("button",{key:7,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[9]||(t[9]=a=>_e())},[v(ae)])):D("",!0)])]),v($e,{thead:l(be),selected:l(n),onSetSelected:t[10]||(t[10]=a=>n.value=a),tbody:l(o),fnCallData:W,scrolling:l(y),onSetScrollingPage:t[11]||(t[11]=a=>l(y).page=a),onDoFilter:t[12]||(t[12]=a=>ee()),rowBgColor:se},{val:p(({item:a})=>[a.val?(d(),P(V,{key:1})):(d(),P(z,{key:0}))]),val1:p(({item:a})=>[a.val1?(d(),P(V,{key:1})):(d(),P(z,{key:0}))]),val2:p(({item:a})=>[a.val2?(d(),P(V,{key:1})):(d(),P(z,{key:0}))]),val3:p(({item:a})=>[a.val3?(d(),P(V,{key:1})):(d(),P(z,{key:0}))]),xto:p(({item:a})=>[c("div",yt,C(a.xto),1)]),destination_location_xto:p(({item:a})=>{var s;return[g(C((s=a.destination_location)==null?void 0:s.xto),1)]}),destination_location_minimal_trip:p(({item:a})=>{var s;return[g(C(l($)((s=a.destination_location)==null?void 0:s.minimal_trip)),1)]}),destination_location_bonus_trip_supir:p(({item:a})=>{var s;return[g(C(l($)((s=a.destination_location)==null?void 0:s.bonus_trip_supir)),1)]}),destination_location_bonus_next_trip_supir:p(({item:a})=>{var s;return[g(C(l($)((s=a.destination_location)==null?void 0:s.bonus_next_trip_supir)),1)]}),destination_location_bonus_trip_kernet:p(({item:a})=>{var s;return[g(C(l($)((s=a.destination_location)==null?void 0:s.bonus_trip_kernet)),1)]}),destination_location_bonus_next_trip_kernet:p(({item:a})=>{var s;return[g(C(l($)((s=a.destination_location)==null?void 0:s.bonus_next_trip_kernet)),1)]}),deleted_by_username:p(({item:a})=>{var s;return[g(C((s=a.deleted_by)==null?void 0:s.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),v(Be,{type:"delete",show:l(U),data:l(te),fnClose:me,fnConfirm:ye,enabledOk:l(G)},{footer:p(()=>[g(" Masukkan Alasan Penghapusan: "),c("div",bt,[ne(c("textarea",{"onUpdate:modelValue":t[13]||(t[13]=a=>oe(A)?A.value=a:null)},null,512),[[Ne,l(A)]])])]),_:1},8,["show","data","enabledOk"]),v(Fe,{show:l(B),fnClose:()=>{B.value=!1},id:l(T),p_data:l(o),is_copy:l(k)},null,8,["show","fnClose","id","p_data","is_copy"]),v(Ue,{show:l(J),fnClose:()=>{J.value=!1},id:l(T),p_data:l(o),is_copy:l(k)},null,8,["show","fnClose","id","p_data","is_copy"]),v(Le,{show:l(F),fnClose:()=>{F.value=!1},id:l(I),p_data:l(o),it_state:l(x)},null,8,["show","fnClose","id","p_data","it_state"])])}}};export{Yt as default};
