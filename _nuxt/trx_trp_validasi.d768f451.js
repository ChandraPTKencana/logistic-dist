import{_ as E}from"./HeaderPopup.vue.5821c5be.js";import{_ as ie}from"./client-only.c5b7b91d.js";import{r as S,f as G,H as de,J as T,g as A,L as re,h as $,v as Q,o as d,c as r,a as e,b as N,k as t,w as _e,q as ce,t as i,l as z,j as q,F as D,n as V,G as b,m as W,s as X,x as g,y as P,p as Z,e as ee}from"./entry.ec567dfd.js";import{u as te}from"./useUtils.ebfece3e.js";import{u as Y}from"./useMyFetch.5a9c3706.js";import{_ as le}from"./_plugin-vue_export-helper.c27b6911.js";const u=c=>(Z("data-v-8879424d"),c=c(),ee(),c),ue={class:"box-fixed"},pe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ve={class:"w-full flex flex-col items-center grow overflow-auto"},fe={class:"w-full flex flex-row flex-wrap"},we={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},me=u(()=>e("label",{for:""},"U.Jalan Per",-1)),xe={key:0,class:"grow"},he={key:1,class:"grow"},be={class:"text-red-500"},ge={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ye=u(()=>e("label",{for:""},"Jenis",-1)),$e=["disabled"],je=u(()=>e("option",{value:"TBS"},"TBS",-1)),Ce=u(()=>e("option",{value:"TBSK"},"TBSK",-1)),ke=u(()=>e("option",{value:"CPO"},"CPO",-1)),De=u(()=>e("option",{value:"PK"},"PK",-1)),Ve=[je,Ce,ke,De],Se={class:"text-red-500"},Be={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Te=u(()=>e("label",{for:""},"Supir",-1)),Ae=["disabled"],Pe={id:"supir"},Ye=["value"],Me={class:"text-red-500"},Ue={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Fe=u(()=>e("label",{for:""},"Kernet",-1)),qe=["disabled"],Ne={id:"kernet"},He=["value"],Ke={class:"text-red-500"},Ie={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Je=u(()=>e("label",{for:""},"No Pol",-1)),ze=["disabled"],Le={id:"vehicle"},Oe=["value"],Re={class:"text-red-500"},Ee={key:0,class:"w-full flex flex-wrap"},Ge={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Qe=u(()=>e("label",{for:""},"Tujuan",-1)),We=["disabled"],Xe={class:"text-red-500"},Ze={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},et=u(()=>e("label",{for:""},"Tipe",-1)),tt=["disabled"],lt=["value","selected"],st={class:"text-red-500"},ot={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},at=u(()=>e("label",{for:""},"Total Dari U.Jalan",-1)),nt={class:"card-border disabled"},it={key:1,class:"w-full flex flex-wrap"},dt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},rt=u(()=>e("label",{for:""},"Cost Center Code",-1)),_t=["disabled"],ct={id:"cost_center"},ut=["value"],pt={class:"text-red-500"},vt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},ft=u(()=>e("label",{for:""},"Cost Center Desc",-1)),wt={class:"card-border disabled"},mt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},xt=u(()=>e("label",{for:""},"PVR No",-1)),ht={class:"card-border disabled"},bt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},gt=u(()=>e("label",{for:""},"PVR Total",-1)),yt={class:"card-border disabled"},$t={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},jt=u(()=>e("label",{for:""},"PV",-1)),Ct={class:"card-border disabled"},kt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Dt=u(()=>e("label",{for:""},"PV Amount",-1)),Vt={class:"card-border disabled"},St={class:"w-full flex items-center justify-end"},Bt={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(c){const _=c,{$moment:C}=X(),{pointFormat:k}=te(),M={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_to:""};let s={...M};const l=S({...M}),B=G("token"),m=S({}),h=o=>{let a=o.target.value;if(!a){l.value.cost_center_code="",l.value.cost_center_desc="";return}_.list_cost_center.filter(w=>w.CostCenter==a).length==0&&(l.value.cost_center_code="112",l.value.cost_center_desc="Transport")},x=o=>{l.value.transition_to=o.target.value=="TBS"?l.value.transition_to:""},{display:j}=de(),v=async()=>{if(l.value.pv_no&&parseInt(l.value.pv_total)!=parseInt(l.value.amount)){j({show:!0,status:"Failed",message:"Total dari Ujalan dan PV tidak cocok"});return}g().loading_full=!0,m.value={};const o=new FormData;o.append("tanggal",C(l.value.tanggal).format("Y-MM-DD")),o.append("jenis",l.value.jenis),o.append("id_uj",l.value.id_uj),o.append("xto",l.value.xto),o.append("cost_center_code",l.value.cost_center_code),o.append("online_status",_.online_status),o.append("transition_to",l.value.transition_to),o.append("supir",l.value.supir),o.append("kernet",l.value.kernet),o.append("no_pol",l.value.no_pol);let a="post",p=_.id;p==0||(o.append("id",p),o.append("_method","PUT"));const{data:w,error:y,status:n}=await Y("/trx_trp",{method:a,headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:o,retry:0});if(g().loading_full=!1,n.value==="error"){P().trigger(y,m);return}if(l.value.updated_at=w.value.updated_at,_.id<=0)l.value.id=w.value.id,l.value.created_at=w.value.created_at,_.p_data.unshift(l.value);else{let R=_.p_data.map(ne=>ne.id).indexOf(_.id);R>=-1&&_.p_data.splice(R,1,{...l.value})}_.fnClose()},H=T(()=>{let o=l.value.jenis=="TBSK"?"TBS":l.value.jenis;return[...new Set(F.value.filter(a=>a.jenis==o).map(a=>a.xto))]}),K=T(()=>{let o=l.value.jenis=="TBSK"?"TBS":l.value.jenis;return F.value.filter(a=>a.xto==l.value.xto&&a.jenis==o)}),U=T(()=>[...new Set(J.value.filter(o=>o.role=="Supir"))]),I=T(()=>[...new Set(J.value.filter(o=>o.role=="Kernet"))]),se=T(()=>!1),oe=async()=>{g().loading_full=!0;const{data:o,error:a,status:p}=await Y("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(g().loading_full=!1,p.value==="error"){P().trigger(a);return}l.value=o.value.data,s={...o.value.data},_.fnLoadDBData()},F=S([]),L=S([]),J=S([]),ae=async()=>{g().loading_full=!0;const{data:o,error:a,status:p}=await Y("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},retry:0});if(g().loading_full=!1,p.value==="error"){P().trigger(a);return}F.value=o.value.list_ujalan,L.value=o.value.list_vehicle,J.value=o.value.list_employee};A(()=>_.show,async(o,a)=>{o==!0&&(await ae(),await _.fnLoadDBData(),l.value={...M},m.value={},_.id!=0&&oe())},{immediate:!0}),A(()=>l.value.cost_center_code,(o,a)=>{let p="";if(o==""||o){let w=_.list_cost_center.filter(y=>y.CostCenter==l.value.cost_center_code);w.length>0?p=w[0].Description:l.value.cost_center_code==s.cost_center_code&&(p=s.cost_center_desc),l.value.cost_center_desc=p}},{deep:!0,immediate:!0});const O=(o,a)=>{let p=0,w="";if(o==""||o){let y=F.value.filter(n=>n.id==l.value.id_uj);y.length>0?(p=y[0].harga,w=y[0].tipe):l.value.id_uj==s.id_uj&&(p=s.amount,w=s.tipe),l.value.tipe=w,l.value.amount=p}};return A(()=>l.value.xto,(o,a)=>{_.show&&O(o)},{deep:!0,immediate:!0}),A(()=>l.value.id_uj,(o,a)=>{_.show&&O(o)},{deep:!0,immediate:!0}),(o,a)=>{const p=E,w=re("vue-date-picker"),y=ie;return $((d(),r("section",ue,[e("div",null,[N(p,{title:"Form Transaction",fn:c.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",pe,[e("div",ve,[e("div",fe,[e("div",we,[me,t(l).val==0?(d(),r("div",xe,[N(y,null,{default:_e(()=>[N(w,{modelValue:t(l).tanggal,"onUpdate:modelValue":a[0]||(a[0]=n=>t(l).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(d(),r("div",he,[e("div",{class:ce(["card-border disabled",t(l).pvr_no!=""?"unselectable":""])},i(t(l).tanggal?t(C)(t(l).tanggal).format("DD-MM-YYYY"):""),3)])),e("p",be,i(t(m).tanggal),1)]),e("div",ge,[ye,$(e("select",{"onUpdate:modelValue":a[1]||(a[1]=n=>t(l).jenis=n),onChange:a[2]||(a[2]=n=>x(n)),disabled:t(l).val==1},Ve,40,$e),[[z,t(l).jenis]]),e("p",Se,i(t(m).jenis),1)]),e("div",Be,[Te,$(e("input",{type:"text",list:"supir","onUpdate:modelValue":a[3]||(a[3]=n=>t(l).supir=n),disabled:t(l).val==1},null,8,Ae),[[q,t(l).supir]]),e("datalist",Pe,[(d(!0),r(D,null,V(t(U),n=>(d(),r("option",{value:n.name},i(n.name),9,Ye))),256))]),e("p",Me,i(t(m).supir),1)]),e("div",Ue,[Fe,$(e("input",{type:"text",list:"kernet","onUpdate:modelValue":a[4]||(a[4]=n=>t(l).kernet=n),disabled:t(l).val==1},null,8,qe),[[q,t(l).kernet]]),e("datalist",Ne,[(d(!0),r(D,null,V(t(I),n=>(d(),r("option",{value:n.name},i(n.name),9,He))),256))]),e("p",Ke,i(t(m).kernet),1)]),e("div",Ie,[Je,$(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=n=>t(l).no_pol=n),disabled:t(l).val==1},null,8,ze),[[q,t(l).no_pol]]),e("datalist",Le,[(d(!0),r(D,null,V(t(L),n=>(d(),r("option",{value:n.no_pol},i(n.no_pol),9,Oe))),256))]),e("p",Re,i(t(m).no_pol),1)]),t(l).jenis!=""?(d(),r("div",Ee,[e("div",Ge,[Qe,$(e("select",{"onUpdate:modelValue":a[6]||(a[6]=n=>t(l).xto=n),disabled:t(l).val==1},[(d(!0),r(D,null,V(t(H),n=>(d(),r("option",null,i(n),1))),256))],8,We),[[z,t(l).xto]]),e("p",Xe,i(t(m).xto),1)]),e("div",Ze,[et,$(e("select",{"onUpdate:modelValue":a[7]||(a[7]=n=>t(l).id_uj=n),disabled:t(l).val==1},[(d(!0),r(D,null,V(t(K),n=>(d(),r("option",{value:n.id,selected:n.id==t(l).id_uj},i(n.tipe),9,lt))),256))],8,tt),[[z,t(l).id_uj]]),e("p",st,i(t(m).id_uj),1)]),e("div",ot,[at,e("div",nt,i(t(k)(t(l).amount)),1)])])):b("",!0),t(l).jenis!=""?(d(),r("div",it,[e("div",dt,[rt,$(e("input",{list:"cost_center","onUpdate:modelValue":a[8]||(a[8]=n=>t(l).cost_center_code=n),onBlur:a[9]||(a[9]=n=>h(n)),disabled:t(l).pvr_no!=""},null,40,_t),[[q,t(l).cost_center_code]]),e("datalist",ct,[(d(!0),r(D,null,V(c.list_cost_center,n=>(d(),r("option",{value:n.CostCenter},i(n.CostCenter+"-"+n.Description),9,ut))),256))]),e("p",pt,i(t(m).cost_center_code),1)]),e("div",vt,[ft,e("div",wt,i(t(l).cost_center_desc),1)]),e("div",mt,[xt,e("div",ht,i(t(l).pvr_no),1)]),e("div",bt,[gt,e("div",yt,i(t(k)(t(l).pvr_total||0)),1)]),e("div",$t,[jt,e("div",Ct,i(t(l).pv_no),1)]),e("div",kt,[Dt,e("div",Vt,i(t(k)(t(l).pv_total)),1)])])):b("",!0)])]),e("div",St,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[10]||(a[10]=n=>c.fnClose())}," Cancel "),t(se)?b("",!0):(d(),r("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[11]||(a[11]=W(n=>v(),["prevent"]))}," Save "))])])])],512)),[[Q,c.show]])}}},Nl=le(Bt,[["__scopeId","data-v-8879424d"]]);const f=c=>(Z("data-v-5c229c84"),c=c(),ee(),c),Tt={class:"box-fixed"},At={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Pt={class:"w-full flex flex-col items-center grow overflow-auto"},Yt={class:"w-full flex flex-row flex-wrap"},Mt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Ut=f(()=>e("label",{for:""},"U.Jalan Per",-1)),Ft={class:"card-border"},qt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Nt=f(()=>e("label",{for:""},"Jenis",-1)),Ht={class:"card-border"},Kt={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},It=f(()=>e("label",{for:""},"Supir",-1)),Jt={class:"card-border"},zt={class:"w-6/12 sm:w-3/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Lt=f(()=>e("label",{for:""},"Kernet",-1)),Ot={class:"card-border"},Rt={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Et=f(()=>e("label",{for:""},"No Pol",-1)),Gt={class:"card-border"},Qt={key:0,class:"w-full flex flex-wrap"},Wt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Xt=f(()=>e("label",{for:""},"Tujuan",-1)),Zt={class:"card-border"},el={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},tl=f(()=>e("label",{for:""},"Tipe",-1)),ll={class:"card-border"},sl={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},ol=f(()=>e("label",{for:""},"Total Dari U.Jalan",-1)),al={class:"card-border"},nl={key:1,class:"w-full flex flex-wrap"},il={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},dl=f(()=>e("label",{for:""},"Cost Center Code",-1)),rl={class:"card-border"},_l={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},cl=f(()=>e("label",{for:""},"Cost Center Desc",-1)),ul={class:"card-border"},pl={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},vl=f(()=>e("label",{for:""},"PVR No",-1)),fl={class:"card-border"},wl={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ml=f(()=>e("label",{for:""},"PVR Total",-1)),xl={class:"card-border"},hl={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},bl=f(()=>e("label",{for:""},"PV",-1)),gl={class:"card-border"},yl={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},$l=f(()=>e("label",{for:""},"PV Amount",-1)),jl={class:"card-border"},Cl={class:"w-full flex items-center justify-end"},kl={class:"w-full flex flex-wrap p-3 items-center"},Dl=f(()=>e("div",null," Di Validasi oleh : ",-1)),Vl={key:0,class:"border-solid border-2 w-fit p-1 bg-slate-700 text-white text-xs"},Sl={key:0},Bl={key:1},Tl={key:2},Al={__name:"trx_trp_validasi",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_view:{type:Boolean,required:!1,default:!1}},setup(c){const _=c,{$moment:C}=X(),{pointFormat:k}=te(),s=S({...{id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",val:0,val_by:{username:""},val_at:"",val1:0,val1_by:{username:""},val1_at:"",val2:0,val2_by:{username:""},val2_at:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:"",pvr_had_detail:""}}),l=G("token"),B=async()=>{g().loading_full=!0;const h=new FormData;let x="post",j=_.id;j==0||(h.append("id",j),h.append("_method","PUT"));const{data:v,error:H,status:K}=await Y("/trx_trp_validasi",{method:x,headers:{Authorization:`Bearer ${l.value}`,Accept:"application/json"},body:h,retry:0});if(g().loading_full=!1,K.value==="error"){P().trigger(H);return}s.value.val=v.value.val,s.value.val_user=v.value.val_user,s.value.val_by=v.value.val_by,s.value.val_at=v.value.val_at,s.value.val1=v.value.val1,s.value.val1_user=v.value.val1_user,s.value.val1_by=v.value.val1_by,s.value.val1_at=v.value.val1_at,s.value.val2=v.value.val2,s.value.val2_user=v.value.val2_user,s.value.val2_by=v.value.val2_by,s.value.val2_at=v.value.val2_at;let U=_.p_data.map(I=>I.id).indexOf(_.id);U>=-1&&_.p_data.splice(U,1,{...s.value}),_.fnClose()},m=async()=>{g().loading_full=!0;const{data:h,error:x,status:j}=await Y("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${l.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(g().loading_full=!1,j.value==="error"){P().trigger(x);return}s.value=h.value.data};return A(()=>_.show,(h,x)=>{h==!0&&m()},{immediate:!0}),(h,x)=>{const j=E;return $((d(),r("section",Tt,[e("div",null,[N(j,{title:"Form Transaction Validation",fn:c.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",At,[e("div",Pt,[e("div",Yt,[e("div",Mt,[Ut,e("div",Ft,i(t(s).tanggal?t(C)(t(s).tanggal).format("DD-MM-YYYY"):""),1)]),e("div",qt,[Nt,e("div",Ht,i(t(s).jenis),1)]),e("div",Kt,[It,e("div",Jt,i(t(s).supir),1)]),e("div",zt,[Lt,e("div",Ot,i(t(s).kernet),1)]),e("div",Rt,[Et,e("div",Gt,i(t(s).no_pol),1)]),t(s).jenis!=""?(d(),r("div",Qt,[e("div",Wt,[Xt,e("div",Zt,i(t(s).xto),1)]),e("div",el,[tl,e("div",ll,i(t(s).tipe),1)]),e("div",sl,[ol,e("div",al,i(t(k)(t(s).amount||0)),1)])])):b("",!0),t(s).jenis!=""?(d(),r("div",nl,[e("div",il,[dl,e("div",rl,i(t(s).cost_center_code),1)]),e("div",_l,[cl,e("div",ul,i(t(s).cost_center_desc),1)]),e("div",pl,[vl,e("div",fl,i(t(s).pvr_no),1)]),e("div",wl,[ml,e("div",xl,i(t(k)(t(s).pvr_total||0)),1)]),e("div",hl,[bl,e("div",gl,i(t(s).pv_no),1)]),e("div",yl,[$l,e("div",jl,i(t(k)(t(s).pv_total||0)),1)])])):b("",!0)])]),e("div",Cl,[e("div",kl,[Dl,t(s).val||t(s).val1||t(s).val2?(d(),r("div",Vl,[t(s).val?(d(),r("div",Sl," App 1 : "+i(t(s).val_by.username)+" ( "+i(t(s).val_at?t(C)(t(s).val_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):b("",!0),t(s).val1?(d(),r("div",Bl," App 2 : "+i(t(s).val1_by.username)+" ( "+i(t(s).val1_at?t(C)(t(s).val1_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):b("",!0),t(s).val2?(d(),r("div",Tl," App 3 : "+i(t(s).val2_by.username)+" ( "+i(t(s).val2_at?t(C)(t(s).val2_at).format("DD-MM-YYYY HH:mm:ss"):"")+" ) ",1)):b("",!0)])):b("",!0)]),e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:x[0]||(x[0]=v=>c.fnClose())}," Cancel "),c.is_view==0?(d(),r("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:x[1]||(x[1]=W(v=>B(),["prevent"]))}," Validasi ")):b("",!0)])])])],512)),[[Q,c.show]])}}},Hl=le(Al,[["__scopeId","data-v-5c229c84"]]);export{Nl as _,Hl as a};
