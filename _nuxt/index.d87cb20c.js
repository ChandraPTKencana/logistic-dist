import je from"./Header.8b01c619.js";import De from"./Copy.e4bbf5c6.js";import Ce from"./Plus.66136a3c.js";import Se from"./Edit.f05ec807.js";import Pe from"./Eyes.8291c282.js";import $e from"./Delete.b5093890.js";import Ae from"./Signature.b7297e54.js";import Oe from"./Line.3a30fb5d.js";import Te from"./Check.651e7441.js";import Be from"./TableView.56963a10.js";import{_ as Me}from"./PopupMini.vue.3b0b4ea2.js";import Ue from"./ujalan.2a550402.js";import Fe from"./ujalan_validasi.f41a6a47.js";import{r as n,j as G,f as Ne,g as Ie,G as g,i as Z,s as He,A as c,c as y,b as i,a as d,m as Q,q as Ve,k as l,n as W,l as x,w as A,z as Ee,B as I,o as u,D as O,d as X,t as ze,v as Je}from"./entry.67a9b0cf.js";import{u as p}from"./useUtils.7ceec33c.js";import{u as H}from"./useMyFetch.a36498f2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.2f626088.js";import"./Adjust.bf2e86c8.js";import"./TableHeaderEye.87a22967.js";import"./Times.cb674315.js";import"./ClearAll.7de34a7b.js";import"./client-only.53511d47.js";import"./ClearEach.91c60cc2.js";import"./CaretLeftDoubleBold.db462c14.js";import"./CaretLeftBold.27747b7f.js";import"./CaretRightBold.0e03227e.js";import"./CaretRightDoubleBold.1651677b.js";import"./Exclamation.46ffdfd6.js";import"./HeaderPopup.vue.c549540a.js";import"./Tools.c6215b95.js";import"./InputPointFormat.vue.54c5a3cd.js";import"./ToolsPopup.6733e558.js";import"./ac_accs.410ae0e6.js";const Le={class:"w-full h-full flex flex-col"},Re={class:"w-full flex grow flex-col overflow-auto h-0"},Ke={class:"w-full flex justify-between flex-wrap"},Ye={class:"grow flex"},qe={class:"m-1"},Ge=d("option",{value:"available"},"Available",-1),Ze=d("option",{value:"unapprove"},"Unapprove",-1),Qe=d("option",{value:"deleted"},"Trash",-1),We=d("option",{value:"all"},"All",-1),Xe=[Ge,Ze,Qe,We],et={class:"grow mb-5"},Ft={__name:"index",async setup(tt){let C,V;const E=t=>t.deleted==1?"!bg-red-400":t.val==0||t.val1==0?"!bg-gray-300":"",T=t=>(t.map(e=>{e.class_h=E(e)}),t),m=n("available");G(()=>m.value,t=>{L()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const z=n({}),B=Ne("token"),{data:ee}=([C,V]=Ie(async()=>Ee(async()=>{c().loading_full=!0;let t=[];const[e,k]=await Promise.all([H("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{filter_status:m},retry:0})]);return e.status.value!=="error"&&(t=T(e.data.value.data)),e.status.value==="error"?(I().trigger(e.error),{ujalans:t}):(c().loading_full=!1,{ujalans:t})},"$SN3C927rLk")),C=await C,V(),C),s=n(ee.value.ujalans||[]),M=n({field:"tanggal",by:"desc"}),a=n(-1),f=g(()=>s.value[a.value]),_=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),te=()=>{r.like="",JSON.parse(JSON.stringify(c()._tv.global_keyword))!=""&&(r.like=`id:%${search.value}%,xto:%${search.value}%,tipe:%${search.value}%,jenis:%${search.value}%,harga:%${search.value}%`),r.sort="",M.value.field&&(r.sort=M.value.field+":"+M.value.by),r.filter_model=JSON.stringify(c()._tv.filter_model)},J=async()=>{c().loading_full=!0,z.value={},_.value.may_get_data=!1,r.page=_.value.page,r.page==1&&(s.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(s.value[0])),r.filter_status=m.value;const{data:t,error:e,status:k}=await H("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,_.value.may_get_data=!0,k.value==="error"){I().trigger(e,z);return}_.value.page==1?s.value=T(t.value.data):_.value.page>1&&(s.value=[...s.value,...T(t.value.data)]),t.value.data.length==0&&(_.value.is_last_record=!0),c()._tv.filter_box=!1},L=()=>{a.value=-1,_.value.page=1,_.value.is_last_record=!1,te(),J()},w=n(!1),S=n(0),P=n(0),b=n(!1),ae=()=>{S.value=0,b.value=!1,P.value=!1,w.value=!0},{display:j}=Z();He(Z());const le=()=>{a.value==-1?j({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=s.value[a.value].id,b.value=!1,P.value=!1,w.value=!0)},oe=()=>{a.value==-1?j({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=s.value[a.value].id,b.value=!1,P.value=!0,w.value=!0)},$=n(!1),U=n(0),se=()=>{a.value==-1?j({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=s.value[a.value].id,b.value=!1,$.value=!0)},ne=()=>{a.value==-1?j({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(U.value=s.value[a.value].id,b.value=!0,$.value=!0)},F=n(!1),R=n({}),D=n(!1),h=n(""),re=async()=>{D.value&&(D.value=!1)},ie=()=>{a.value==-1?j({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(h.value="",R.value={id:s.value[a.value].id,tujuan:s.value[a.value].xto},D.value=!0)};G(()=>h.value,t=>{t.trim().length>0?F.value=!0:F.value=!1},{immediate:!1});const ue=async()=>{c().loading_full=!0;const t=new FormData;t.append("id",s.value[a.value].id),t.append("deleted_reason",h.value),t.append("_method","DELETE");const{data:e,error:k,status:N}=await H("/ujalan",{method:"post",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:t,retry:0});if(c().loading_full=!1,N.value==="error"){I().trigger(k);return}let v={...s.value[a.value]};v.deleted=e.value.deleted,v.deleted_user=e.value.deleted_user,v.deleted_at=e.value.deleted_at,v.deleted_by=e.value.deleted_by,v.deleted_reason=e.value.deleted_reason,v.class_h=E(v),m.value!="all"?s.value.splice(a.value,1):s.value.splice(a.value,1,{...v}),a.value=-1,D.value=!1},de=n([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:c().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),_e=g(()=>a.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&p().checkPermission("ujalan.create")),ve=g(()=>["available","all"].indexOf(m.value)>-1&&p().checkPermission("ujalan.create")),ce=g(()=>a.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&(p().checkPermission("ujalan.val")&&[void 0,0].indexOf(f.value.val)>-1||p().checkPermission("ujalan.val1")&&[void 0,0].indexOf(f.value.val1)>-1)&&p().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),me=g(()=>a.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&(p().checkPermission("ujalan.val")&&[void 0,0].indexOf(f.value.val)>-1||p().checkPermission("ujalan.val1")&&[void 0,0].indexOf(f.value.val1)>-1)),fe=g(()=>a.value>-1&&p().checkPermission("ujalan.remove")&&[void 0,0].indexOf(f.value.deleted)>-1);return(t,e)=>{const k=je,N=De,v=Ce,pe=Se,ye=Pe,be=$e,he=Ae,K=Oe,Y=Te,ke=Be,ge=Me,xe=Ue,we=Fe;return u(),y("div",Le,[i(k,{title:"List Ujalan"}),d("div",Re,[d("div",Ke,[d("div",Ye,[d("div",qe,[Q(d("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>W(m)?m.value=o:null)},Xe,512),[[Ve,l(m)]])]),l(_e)?(u(),y("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>oe())},[i(N)])):x("",!0),l(ve)?(u(),y("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>ae())},[i(v)])):x("",!0),l(ce)?(u(),y("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>le())},[i(pe)])):x("",!0),l(a)>-1?(u(),y("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>ne())},[i(ye)])):x("",!0),l(fe)?(u(),y("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>ie())},[i(be)])):x("",!0),l(me)?(u(),y("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>se())},[i(he)])):x("",!0)])]),i(ke,{thead:l(de),selected:l(a),onSetSelected:e[7]||(e[7]=o=>a.value=o),tbody:l(s),fnCallData:J,scrolling:l(_),onSetScrollingPage:e[8]||(e[8]=o=>l(_).page=o),onDoFilter:e[9]||(e[9]=o=>L())},{val:A(({item:o})=>[o.val?(u(),O(Y,{key:1})):(u(),O(K,{key:0}))]),val1:A(({item:o})=>[o.val1?(u(),O(Y,{key:1})):(u(),O(K,{key:0}))]),deleted_by_username:A(({item:o})=>{var q;return[X(ze((q=o.deleted_by)==null?void 0:q.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),i(ge,{type:"delete",show:l(D),data:l(R),fnClose:re,fnConfirm:ue,enabledOk:l(F)},{footer:A(()=>[X(" Masukkan Alasan Penghapusan: "),d("div",et,[Q(d("textarea",{"onUpdate:modelValue":e[10]||(e[10]=o=>W(h)?h.value=o:null)},null,512),[[Je,l(h)]])])]),_:1},8,["show","data","enabledOk"]),i(xe,{show:l(w),fnClose:()=>{w.value=!1},id:l(S),p_data:l(s),is_copy:l(P)},null,8,["show","fnClose","id","p_data","is_copy"]),i(we,{show:l($),fnClose:()=>{$.value=!1},id:l(U),p_data:l(s),is_view:l(b)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{Ft as default};
