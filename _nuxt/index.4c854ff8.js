import{_ as re}from"./Header.8bafa6a1.js";import{_ as W}from"./Plus.7c841810.js";import{_ as de}from"./Edit.57352ac0.js";import{_ as ce}from"./Eyes.ed66d6dc.js";import{_ as _e}from"./Delete.0cd505a5.js";import{_ as pe}from"./Search.882b377f.js";import{_ as fe}from"./PopupMini.vue.f5da6157.js";import{_ as ve}from"./HeaderPopup.vue.e340ba41.js";import{_ as me}from"./InputPointFormat.vue.4b94bebf.js";import{_ as he,a as xe}from"./ToolsPopup.a9df2e1b.js";import{r as f,u as ee,R as ye,g as we,o as p,c as x,n as S,v as ge,a as e,b,x as t,s as z,t as g,y as Q,M as P,F as O,A as te,B as X,T as J,z as ae,D as k,E as V,p as be,e as ke,K as $e,I as je,N as Z,O as Ce,q as Ae,L as De,U as Se,C as Te}from"./entry.81e8bd84.js";import{u as E}from"./useMyFetch.732ddcd9.js";import{_ as Ie}from"./_plugin-vue_export-helper.c27b6911.js";import{u as qe}from"./useUtils.100f5b4a.js";import"./Times.2a5d20fa.js";const $=j=>(be("data-v-d0c4ee90"),j=j(),ke(),j),Pe={class:"box-fixed"},Ue={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Be={class:"w-full flex flex-col items-center justify-center grow overflow-auto"},Fe={class:"w-full flex flex-row flex-wrap"},Me={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Re=$(()=>e("label",{for:""},"To",-1)),Ve={class:"text-red-500"},Ee={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ne=$(()=>e("label",{for:""},"Tipe",-1)),He={class:"text-red-500"},Le={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ze=$(()=>e("label",{for:""},"Jenis",-1)),Oe=$(()=>e("option",{value:"CPO"},"CPO",-1)),Je=$(()=>e("option",{value:"TBS"},"TBS",-1)),Ke=[Oe,Je],Ye={class:"text-red-500"},Ge={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Qe=$(()=>e("label",{for:""},"Harga",-1)),Xe={class:"text-red-500"},Ze={class:"w-full flex grow p-1 overflow-auto"},We={role:"sticky",ref:"loadRef"},et={class:"tacky w-full",style:{"white-space":"normal"}},tt={class:"sticky top-0 !z-[2]"},at={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},lt=$(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1)),st=$(()=>e("th",null,"Desc",-1)),ot=$(()=>e("th",{class:"min-w-[100px] !w-[100px] max-w-[100px]"},"Harga @",-1)),nt=$(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"Qty",-1)),ut={ref:"to_move"},it=["data-index"],rt={key:0,class:"tools cell"},dt={class:"w-full h-full flex items-center justify-center"},ct=["onClick"],_t={key:1,class:"cell"},pt={class:"w-full h-full flex items-center justify-center"},ft=["disabled","onUpdate:modelValue"],vt={class:"w-full h-full flex items-center justify-center"},mt={class:"w-full h-full flex items-center justify-center"},ht={key:0},xt={class:"tools cell"},yt={class:"w-full flex items-center justify-end"},wt={__name:"ujalan",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(j){const h=j,U={id:-1,xto:"",tipe:"",jenis:"",harga:0,details:[]},i=f({...U}),N=ee("token"),r=f({}),B=f([{xdesc:"Timbangan",qty:1,harga:55e3},{xdesc:"Retribusi TPR",qty:1,harga:23e3},{xdesc:"Parkir & Nginap",qty:1,harga:1e4},{xdesc:"Penitipan Alat (Dongkrak)",qty:1,harga:5e3},{xdesc:"Ikas Danau",qty:1,harga:1e4},{xdesc:"U.Bongkar + Ambil surat",qty:1,harga:35e3},{xdesc:"Perbaikan Jalan Pujut",qty:1,harga:1e4},{xdesc:"Gaji Supir",qty:1,harga:0},{xdesc:"Gaji Kernet",qty:1,harga:0},{xdesc:"U.Extrafooding",qty:1,harga:2e4}]),d=f([]),v=f({ordinal:0,id:-1,xdesc:"",qty:1,harga:0,p_status:""}),y=()=>{B.value.forEach(s=>{d.value.filter(a=>a.xdesc==s.xdesc).length==0&&d.value.push({...s,ordinal:0,id:-1,p_status:"Add"})})},C=async()=>{k().loading_full=!0,r.value={};const s=new FormData;s.append("xto",i.value.xto),s.append("tipe",i.value.tipe),s.append("jenis",i.value.jenis),s.append("harga",i.value.harga),s.append("details",JSON.stringify(d.value));let a="post",D=h.id;D==0||(s.append("id",D),s.append("_method","PUT"));const{data:m,error:A,status:M}=await E("/ujalan",{method:a,headers:{Authorization:`Bearer ${N.value}`,Accept:"application/json"},body:s,retry:0});if(k().loading_full=!1,M.value==="error"){V().trigger(A,r);return}if(h.id<=0)i.value.id=m.value.id,i.value.created_at=m.value.created_at,i.value.updated_at=m.value.updated_at,h.p_data.unshift(i.value);else{i.value.updated_at=m.value.updated_at;let q=h.p_data.map(n=>n.id).indexOf(h.id);q>=-1&&h.p_data.splice(q,1,{...i.value})}h.fnClose()},o=f(-1),_=f(!1),H=f({left:0,top:0}),I=(s,a)=>{o.value=a,_.value=!0,H.value={left:s.clientX,top:s.clientY}},L=()=>{d.value.push({...v.value,p_status:"Add"})},K=()=>{_.value=!1},Y=(s="")=>{if(s=="insert")d.value.splice(o.value,0,{...v.value,p_status:"Add"});else if(s=="delete")d.value[o.value].p_status=="Edit"?d.value[o.value].p_status="Remove":d.value.splice(o.value,1);else if(s=="move_top"){let a=d.value[o.value];d.value.splice(o.value,1),d.value.splice(o.value-1,0,{...a})}else if(s=="move_bottom"){let a=d.value[o.value];d.value.splice(o.value,1),d.value.splice(o.value+1,0,{...a})}_.value=!1},w=ye(()=>!1),F=async()=>{k().loading_full=!0;const{data:s,error:a,status:D}=await E("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${N.value}`,Accept:"application/json"},params:{id:h.id},retry:0});if(k().loading_full=!1,D.value==="error"){V().trigger(a);return}i.value=s.value.data,d.value=s.value.data.details.map(m=>(m.p_status="Edit",m.key=m.ordinal,m))};return we(()=>h.show,(s,a)=>{s==!0&&(i.value={...U},d.value=[],h.id!=0&&F())},{immediate:!0}),(s,a)=>{const D=ve,m=me,A=he,M=W,q=xe;return p(),x(O,null,[S(e("section",Pe,[e("div",null,[b(D,{title:"Form Ujalan",fn:j.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Ue,[e("div",Be,[e("div",Fe,[e("div",Me,[Re,S(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>t(i).xto=n)},null,512),[[z,t(i).xto]]),e("p",Ve,g(t(r).xto),1)]),e("div",Ee,[Ne,S(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>t(i).tipe=n)},null,512),[[z,t(i).tipe]]),e("p",He,g(t(r).tipe),1)]),e("div",Le,[ze,S(e("select",{"onUpdate:modelValue":a[2]||(a[2]=n=>t(i).jenis=n)},Ke,512),[[Q,t(i).jenis]]),e("p",Ye,g(t(r).jenis),1)]),e("div",Ge,[Qe,e("div",null,[b(m,{class:"w-full h-full p-1",type:"text",value:t(i).harga||0,onInput:a[3]||(a[3]=n=>t(i).harga=n)},null,8,["value"])]),e("p",Xe,g(t(r).harga),1)])]),e("div",Ze,[e("div",We,[e("table",et,[e("thead",null,[e("tr",tt,[t(w)?P("",!0):(p(),x("th",at,[e("button",{type:"button",name:"button",class:"bg-yellow-600",onClick:a[4]||(a[4]=n=>y())}," Default In ")])),lt,st,ot,nt])]),e("tbody",ut,[(p(!0),x(O,null,te(t(d),(n,u)=>(p(),x(O,{key:u},[n.p_status!="Remove"?(p(),x("tr",{key:0,"data-index":u},[t(w)?P("",!0):(p(),x("td",rt,[e("div",dt,[e("button",{type:"button",name:"button",onClick:l=>I(l,u)},[b(A)],8,ct)])])),e("td",null,g(u+1)+".",1),t(w)?P("",!0):(p(),x("td",_t,[e("div",pt,[S(e("textarea",{disabled:t(w),class:"p-1 w-full","onUpdate:modelValue":l=>n.xdesc=l,cols:"7",rows:"2"},null,8,ft),[[z,n.xdesc]])])])),e("td",{class:X(["cell bold",t(w)?"unselectable":""])},[e("div",vt,[(p(),J(m,{key:u,class:"w-full h-full p-1",type:"text",value:n.harga||0,onInput:l=>n.harga=l},null,8,["value","onInput"]))])],2),e("td",{class:X(["cell",t(w)?"unselectable":""])},[e("div",mt,[(p(),J(m,{key:u,class:"w-full h-full p-1",type:"text",value:n.qty||0,onInput:l=>n.qty=l},null,8,["value","onInput"]))])],2)],8,it)):P("",!0)],64))),128)),t(w)?P("",!0):(p(),x("tr",ht,[e("td",xt,[e("button",{type:"button",name:"button",onClick:a[5]||(a[5]=n=>L())},[b(M)])])]))],512)])],512)])]),e("div",yt,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[6]||(a[6]=n=>j.fnClose())}," Cancel "),t(w)?P("",!0):(p(),x("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[7]||(a[7]=ae(n=>C(),["prevent"]))}," Save "))])])])],512),[[ge,j.show]]),b(q,{show:t(_),coor:t(H),fn:K,data:t(d),data_index:t(o),onReplyAct:a[8]||(a[8]=n=>Y(n))},null,8,["show","coor","data","data_index"])],64)}}},gt=Ie(wt,[["__scopeId","data-v-d0c4ee90"]]),bt={class:"w-full h-full flex flex-col"},kt={class:"w-full flex grow flex-col overflow-auto h-0"},$t={class:"w-full flex"},jt={action:"#",class:"w-full flex p-1"},Ct={class:"grow"},At=e("div",{class:"font-bold"}," Keyword ",-1),Dt={class:"pl-1"},St=e("div",{class:"font-bold"}," Sort By ",-1),Tt=Se('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),It=[Tt],qt={class:"pl-1"},Pt=e("div",{class:"font-bold"}," Sort Order ",-1),Ut=e("option",{value:"asc"},"Asc",-1),Bt=e("option",{value:"desc"},"Desc",-1),Ft=[Ut,Bt],Mt={class:"flex items-end pl-1"},Rt={class:"w-full flex justify-center items-center grow h-0 p-1"},Vt={key:0,class:""},Et={class:"tacky"},Nt=e("thead",null,[e("tr",{class:"sticky top-0 !z-[2]"},[e("th",null,"ID"),e("th",null,"To"),e("th",null,"Tipe"),e("th",null,"Jenis"),e("th",null,"Harga"),e("th",null,"Created At"),e("th",null,"Updated At")])],-1),Ht=["onClick"],Lt={class:"bold"},na={__name:"index",async setup(j){let h,U;const{$moment:i}=Te(),{pointFormat:N}=qe(),r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="created_at:desc";const B=ee("token"),{data:d}=([h,U]=$e(async()=>De(async()=>{let u=[];k().loading_full=!0;const{data:l,error:T,status:R}=await E("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:r,retry:0});return k().loading_full=!1,R.value==="error"?(V().trigger(T),{ujalans:u}):(u=l.value.data,{ujalans:u})},"$SN3C927rLk")),h=await h,U(),h),v=f(d.value.ujalans),y=f(""),C=f({field:"created_at",by:"desc"}),o=f(-1),_=f({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),H=()=>{r.like="",y.value!=""&&(r.like=`id:%${y.value}%,warehouse_name:%${y.value}%,warehouse_source_name:%${y.value}%,warehouse_target_name:%${y.value}%,item_name:%${y.value}%,status:%${y.value}%,type:%${y.value}%`),r.sort="",C.value.field&&(r.sort=C.value.field+":"+C.value.by)},I=f(null),L=async()=>{k().loading_full=!0,_.value.may_get_data=!1,r.page=_.value.page,r.page==1&&(v.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(v.value[0]));const{data:u,error:l,status:T}=await E("/ujalan",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:r,retry:0});if(k().loading_full=!1,_.value.may_get_data=!0,T.value==="error"){V().trigger(l);return}_.value.page==1?(v.value=u.value.data,I.value&&(I.value.scrollTop=0)):_.value.page>1&&(v.value=[...v.value,...u.value.data]),u.value.data.length==0&&(_.value.is_last_record=!0)},K=async()=>{if(!_.value.may_get_data)return;let u=I.value;if(u.scrollLeft!=_.value.scrollLeft){_.value.scrollLeft=u.scrollLeft;return}_.value.is_last_record||!(Math.round(u.scrollTop)+u.clientHeight>=u.scrollHeight-1)||(_.value.page++,await L())},Y=()=>{_.value.page=1,_.value.is_last_record=!1,H(),L()};je();const w=f(!1),F=f(0),s=()=>{F.value=0,w.value=!0},{display:a}=Z();Ce(Z());const D=()=>{o.value==-1?a({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(F.value=v.value[o.value].id,w.value=!0)},m=f({}),A=f(!1),M=async()=>{A.value&&(A.value=!1)},q=()=>{o.value==-1?a({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(m.value={id:v.value[o.value].id},A.value=!0)},n=async()=>{k().loading_full=!0;const u=new FormData;u.append("id",v.value[o.value].id),u.append("_method","DELETE");const{data:l,error:T,status:R}=await E("/ujalan",{method:"post",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:u,retry:0});if(k().loading_full=!1,R.value==="error"){V().trigger(T);return}v.value.splice(o.value,1),o.value=-1,A.value=!1};return(u,l)=>{const T=re,R=W,le=de,se=ce,oe=_e,ne=pe,ue=fe,ie=gt;return p(),x("div",bt,[b(T,{title:"List Ujalan"}),e("div",kt,[e("div",$t,[e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:l[0]||(l[0]=c=>s())},[b(R)]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:l[1]||(l[1]=c=>D())},[t(o)==-1||t(v)[t(o)].ref_id==null&&t(v)[t(o)].confirmed_by==null?(p(),J(le,{key:0})):(p(),J(se,{key:1}))]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:l[2]||(l[2]=c=>q())},[b(oe)])]),e("form",jt,[e("div",Ct,[At,S(e("input",{class:"",type:"text","onUpdate:modelValue":l[3]||(l[3]=c=>Ae(y)?y.value=c:null),name:"search",placeholder:"Keyword"},null,512),[[z,t(y)]])]),e("div",Dt,[St,S(e("select",{class:"","onUpdate:modelValue":l[4]||(l[4]=c=>t(C).field=c)},It,512),[[Q,t(C).field]])]),e("div",qt,[Pt,S(e("select",{class:"","onUpdate:modelValue":l[5]||(l[5]=c=>t(C).by=c)},Ft,512),[[Q,t(C).by]])]),e("div",Mt,[e("button",{class:"",type:"submit",name:"button",onClick:l[6]||(l[6]=ae(c=>Y(),["prevent"]))},[b(ne,{class:"text-2xl"})])])]),e("div",Rt,[t(v).length==0?(p(),x("div",Vt," Maaf Tidak Ada Record ")):(p(),x("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:I,onScroll:K},[e("table",Et,[Nt,e("tbody",null,[(p(!0),x(O,null,te(t(v),(c,G)=>(p(),x("tr",{key:G,onClick:zt=>o.value=G,class:X(t(o)==G?"active":"")},[e("td",Lt,g(c.id),1),e("td",null,g(c.xto),1),e("td",null,g(c.tipe),1),e("td",null,g(c.jenis),1),e("td",null,g(t(N)(c.harga)),1),e("td",null,g(c.created_at?t(i)(c.created_at).format("DD-MM-Y HH:mm:ss"):""),1),e("td",null,g(c.updated_at?t(i)(c.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Ht))),128))])])],544))])]),b(ue,{type:"delete",show:t(A),data:t(m),fnClose:M,fnConfirm:n},null,8,["show","data"]),b(ie,{show:t(w),fnClose:()=>{w.value=!1},id:t(F),p_data:t(v)},null,8,["show","fnClose","id","p_data"])])}}};export{na as default};
