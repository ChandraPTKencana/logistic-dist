import se from"./Header.ab0edfaf.js";import re from"./Plus.b7702c80.js";import ne from"./Edit.b0cfe3e9.js";import ue from"./Signature.573e475d.js";import ie from"./Table2Column.bc6c6b6f.js";import ce from"./TableUp.0230d1cd.js";import de from"./Line.0ffb5f18.js";import _e from"./Check.4502dfaf.js";import{_ as fe}from"./PopupMini.vue.ff6ced29.js";import me from"./rpt_salary.c698420f.js";import pe from"./rpt_salary_validasi.c99a295c.js";import{g as ve,h as ye,r as s,B as he,j as z,s as ge,f as we,c as _,b as m,a as o,l as t,n as h,F as ke,D as xe,w as be,q as Ce,x as f,y as g,o as u,E as Ae,z as I,t as D,d as De,k as $e,A as Me,m as Te,G as Se}from"./entry.fa6a43a6.js";import{u as P}from"./useUtils.e43caca5.js";import{u as w}from"./useMyFetch.e44aed2a.js";import{u as Be}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Times.abdf3177.js";import"./Exclamation.48001766.js";import"./HeaderPopup.vue.84d65bd6.js";import"./client-only.da14e2b9.js";const Pe={class:"w-full h-full flex flex-col"},Ee={class:"w-full flex grow flex-col overflow-auto h-0"},Fe={class:"w-full flex"},Le={class:"w-full flex justify-center items-center grow h-0 p-1"},Ue={key:0,class:""},ze={class:"tacky"},Ie=o("thead",null,[o("tr",{class:"sticky top-0 !z-[2]"},[o("th",null,"Logistik"),o("th",null,"ID"),o("th",null,"Period End"),o("th",null,"Created At"),o("th",null,"Updated At")])],-1),je=["onClick"],Re={class:"flex items-center justify-center"},He={class:"bold"},Ne={class:"grow mb-5"},_t={__name:"rpt",async setup(Oe){let k,E;const{$moment:$}=Se(),d={};d._TimeZoneOffset=new Date().getTimezoneOffset(),d.sort="created_at:desc";const p=ve("token"),{data:j}=([k,E]=ye(async()=>Ce(async()=>{let e=[];f().loading_full=!0;const{data:a,error:c,status:y}=await w("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:d,retry:0});return f().loading_full=!1,y.value==="error"?(g().trigger(c),{rpt_salarys:e}):(e=a.value.data,{rpt_salarys:e})},"$fWJlXxIgiP")),k=await k,E(),k),l=s(j.value.rpt_salarys);s(""),s({field:"created_at",by:"desc"});const r=s(-1),i=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),x=s(null),R=async()=>{f().loading_full=!0,i.value.may_get_data=!1,d.page=i.value.page,d.page==1&&(l.value=[]),d.first_row&&delete d.first_row,d.page>1&&(d.first_row=JSON.stringify(l.value[0]));const{data:e,error:a,status:c}=await w("/rpt_salarys",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:d,retry:0});if(f().loading_full=!1,i.value.may_get_data=!0,c.value==="error"){g().trigger(a);return}i.value.page==1?(l.value=e.value.data,x.value&&(x.value.scrollTop=0)):i.value.page>1&&(l.value=[...l.value,...e.value.data]),e.value.data.length==0&&(i.value.is_last_record=!0)},H=async()=>{if(!i.value.may_get_data)return;let e=x.value;if(e.scrollLeft!=i.value.scrollLeft){i.value.scrollLeft=e.scrollLeft;return}i.value.is_last_record||!(Math.round(e.scrollTop)+e.clientHeight>=e.scrollHeight-1)||(i.value.page++,await R())};he();const b=s(!1),M=s(0),C=s(0),N=()=>{M.value=0,b.value=!0,C.value=!1},{display:F}=z();ge(z());const O=()=>{r.value==-1?F({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value=l.value[r.value].id,b.value=!0,C.value=!1)},T=s(!1),L=s(0),V=()=>{r.value==-1?F({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=l.value[r.value].id,C.value=!0,T.value=!0)},S=s(!1),Y=s({}),A=s(!1),v=s(""),J=async()=>{A.value&&(A.value=!1)};we(()=>v.value,e=>{e.trim().length>0?S.value=!0:S.value=!1},{immediate:!1});const q=async()=>{f().loading_full=!0;const e=new FormData;e.append("id",l.value[r.value].id),e.append("deleted_reason",v.value),e.append("_method","DELETE");const{data:a,error:c,status:y}=await w("/rpt_salary",{method:"post",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},body:e,retry:0});if(f().loading_full=!1,y.value==="error"){g().trigger(c);return}l.value.splice(r.value,1),r.value=-1,A.value=!1},{downloadFile:U,viewFile:Ve}=Be();s(!1),s({});const G=async()=>{f().loading_full=!0;const{data:e,error:a,status:c}=await w("/rpt_salary/excel_download",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:l.value[r.value].id},retry:0});if(f().loading_full=!1,c.value==="error"){g().trigger(a);return}U(e.value)},W=async()=>{f().loading_full=!0;const{data:e,error:a,status:c}=await w("/rpt_salary/excel_download2",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:l.value[r.value].id},retry:0});if(f().loading_full=!1,c.value==="error"){g().trigger(a);return}U(e.value)};return(e,a)=>{const c=se,y=re,X=ne,Z=ue,K=ie,Q=ce,ee=de,te=_e,ae=fe,oe=me,le=pe;return u(),_("div",Pe,[m(c,{title:"List Salary Paid"}),o("div",Ee,[o("div",Fe,[("useUtils"in e?e.useUtils:t(P))().checkPermission("rpt_salary.create")?(u(),_("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=n=>N())},[m(y)])):h("",!0),("useUtils"in e?e.useUtils:t(P))().checkPermissions(["rpt_salary.modify"])?(u(),_("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=n=>O())},[m(X)])):h("",!0),("useUtils"in e?e.useUtils:t(P))().checkPermissions(["rpt_salary.val1","rpt_salary.val2","rpt_salary.val3"])?(u(),_("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=n=>V())},[m(Z)])):h("",!0),t(r)>-1&&t(l)[t(r)].val1==1?(u(),_("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=n=>G())},[m(K)])):h("",!0),t(r)>-1&&t(l)[t(r)].val1==1?(u(),_("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:a[4]||(a[4]=n=>W())},[m(Q)])):h("",!0)]),o("div",Le,[t(l).length==0?(u(),_("div",Ue," Maaf Tidak Ada Record ")):(u(),_("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:x,onScroll:H},[o("table",ze,[Ie,o("tbody",null,[(u(!0),_(ke,null,xe(t(l),(n,B)=>(u(),_("tr",{key:B,onClick:Ye=>r.value=B,class:Ae(t(r)==B?"active":"")},[o("td",null,[o("div",Re,[n.val1?(u(),I(te,{key:1})):(u(),I(ee,{key:0}))])]),o("td",He,D(n.id),1),o("td",null,D(n.period_end?t($)(n.period_end).format("MM-Y"):""),1),o("td",null,D(n.created_at?t($)(n.created_at).format("DD-MM-Y HH:mm:ss"):""),1),o("td",null,D(n.updated_at?t($)(n.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,je))),128))])])],544))])]),m(ae,{type:"delete",show:t(A),data:t(Y),fnClose:J,fnConfirm:q,enabledOk:t(S)},{footer:be(()=>[De(" Masukkan Alasan Penghapusan: "),o("div",Ne,[$e(o("textarea",{"onUpdate:modelValue":a[5]||(a[5]=n=>Te(v)?v.value=n:null)},null,512),[[Me,t(v)]])])]),_:1},8,["show","data","enabledOk"]),m(oe,{show:t(b),fnClose:()=>{b.value=!1},id:t(M),p_data:t(l),is_copy:t(C)},null,8,["show","fnClose","id","p_data","is_copy"]),m(le,{show:t(T),fnClose:()=>{T.value=!1},id:t(L),p_data:t(l)},null,8,["show","fnClose","id","p_data"])])}}};export{_t as default};
