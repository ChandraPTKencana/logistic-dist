import rt from"./Header.64eb7973.js";import nt from"./PrinterEye.d42bf7c8.js";import it from"./Table2Column.a706e382.js";import _t from"./Line.36d728d7.js";import ct from"./Check.8b0ac96a.js";import ut from"./TableView.afcbe5f8.js";import pt from"./Times.691ca0bc.js";import{_ as dt}from"./HeaderPopup.vue.e17b4467.js";import{r as u,j as ft,f as bt,g as mt,A as p,G as yt,c as h,b as v,a as s,m as L,q as kt,k as l,n as ht,d as c,w as i,l as vt,J as gt,t as a,F as Z,y as G,z as xt,B as $,o as d,C as wt,D as g,H as Dt,E as St}from"./entry.92b11eb7.js";import{u as Q}from"./useUtils.e6218bed.js";import{u as C}from"./useMyFetch.dbdd839c.js";import{u as Tt}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.9e98a0ab.js";import"./Adjust.f333e226.js";import"./TableHeaderEye.5e98155f.js";import"./ClearAll.c67eb43c.js";import"./client-only.3f3eeb49.js";import"./ClearEach.83f1b777.js";import"./CaretLeftDoubleBold.9753b776.js";import"./CaretLeftBold.299e5f7f.js";import"./CaretRightBold.b638535e.js";import"./CaretRightDoubleBold.d8775c7f.js";const $t={class:"w-full h-full flex flex-col"},Ct={class:"w-full flex grow flex-col overflow-auto h-0"},At={class:"w-full flex"},Mt={class:"m-1"},Bt=Dt('<option value="ticket_not_done">Undone</option><option value="ticket_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Nt=[Bt],Pt=s("span",{class:"text-xs ml-1"}," PDF ",-1),Ht=s("span",{class:"text-xs ml-1"}," Excel ",-1),Yt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Ft={class:"relative",style:{width:"95%",height:"90%"}},Rt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ot=["src"],jt={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},qt={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},zt={class:"p-1 flex flex-wrap overflow-auto items-start"},Vt={class:"w-full sm:w-1/2 flex flex-wrap"},Jt={class:"flex flex-col m-2"},Kt=s("span",{class:"text-xs"}," To ",-1),Ut={class:""},It={class:"flex flex-col m-2"},Et=s("span",{class:"text-xs"}," Tipe ",-1),Lt={class:""},Zt={class:"flex flex-col m-2"},Gt=s("span",{class:"text-xs"}," Jenis ",-1),Qt={class:""},Wt={class:"flex flex-col m-2"},Xt=s("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),te={class:""},ee={class:"w-full sm:w-1/2 text-sm flex justify-center"},se={class:"border border-collapse border-black"},oe=s("tr",null,[s("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),le={class:"p-1"},ae={class:"p-1"},re=s("td",{class:"p-1"},"= Rp.",-1),ne={class:"text-right p-1"},ie={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},_e=s("th",{colspan:"2",class:"text-right"},"Total",-1),ce=s("th",{class:"p-1 text-right"},"Rp.",-1),ue={class:"p-1 text-right"},pe={class:"w-full mt-2 text-sm flex justify-center"},de={class:"border border-collapse border-black"},fe=s("tr",null,[s("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),be={class:"p-1"},me={class:"p-1"},ye={class:"p-1"},ke=s("td",{class:"p-1"},"= Rp.",-1),he={class:"text-right p-1"},ve={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ge=s("th",{colspan:"2",class:"text-right"},"Total",-1),xe=s("th",{class:"p-1 text-right"},"Rp.",-1),we={class:"p-1 text-right"},De={class:"flex p-1 justify-end flex-wrap"},Qe={__name:"index",async setup(Se){let w,j;const{$moment:q}=St(),{pointFormat:n}=Q(),A=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":["CPO","PK"].indexOf(e.jenis)>-1&&e.ticket_a_id!=""&&e.ticket_b_bruto!=""&&e.ticket_b_tara!=""&&e.ticket_b_netto!=""&&e.ticket_b_in_at!=""&&e.ticket_b_out_at!=""||e.jenis=="TBS"&&e.ticket_a_id!=""&&e.ticket_b_id!=""||e.jenis=="TBSK"&&e.ticket_b_id!=""?"!bg-blue-300":"",M=e=>(e.map(o=>{o.class_h=A(o)}),e),y=u("ticket_not_done");ft(()=>y.value,e=>{U()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const z=u({}),D=bt("token"),S=u({from:"",to:""}),{data:W}=([w,j]=mt(async()=>xt(async()=>{p().loading_full=!0;let e=[];const[o,_]=await Promise.all([C("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return o.status.value!=="error"&&(e=M(o.data.value.data)),o.status.value==="error"?($().trigger(o.error),{trx_trps:e}):(p().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),w=await w,j(),w),k=u(W.value.trx_trps||[]),B=u({field:"tanggal",by:"desc"}),V=u(-1),f=u({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),N=()=>{r.like="";let e=JSON.parse(JSON.stringify(p()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),r.sort="",B.value.field&&(r.sort=B.value.field+":"+B.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=S.value.from?q(S.value.from).format("YYYY-MM-DD"):"",r.date_to=S.value.to?q(S.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(p()._tv.filter_model)},J=u(null),K=async()=>{p().loading_full=!0,z.value={},f.value.may_get_data=!1,r.page=f.value.page,r.page==1&&(k.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(k.value[0])),r.filter_status=y.value;const{data:e,error:o,status:_}=await C("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:r,retry:0});if(p().loading_full=!1,f.value.may_get_data=!0,_.value==="error"){$().trigger(o,z);return}f.value.page==1?(k.value=M(e.value.data),J.value&&(J.value.scrollTop=0)):f.value.page>1&&(k.value=[...k.value,...M(e.value.data)]),e.value.data.length==0&&(f.value.is_last_record=!0),p()._tv.filter_box=!1},U=()=>{f.value.page=1,f.value.is_last_record=!1,N(),K()},{downloadFile:I,viewFile:Te}=Tt(),T=u(!1),P=u(""),E=async(e="")=>{if(T.value==!0){T.value=!1;return}N(),p().loading_full=!0;const{data:o,error:_,status:m}=await C("/trx_trps/"+e,{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:r,retry:0});if(p().loading_full=!1,m.value==="error"){$().trigger(_);return}P.value=o.value,T.value=!0},X=async(e="")=>{N(),p().loading_full=!0;const{data:o,error:_,status:m}=await C("/trx_trps/"+e,{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:r,retry:0});if(p().loading_full=!1,m.value==="error"){$().trigger(_);return}I(o.value)},tt=()=>{I(P.value)},et=u([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:p().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),H=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let _=parseFloat(o-e),m=_>0?o:e;if(m==0)return 0;let x=Q().round(_/m*100,2);return x<0?"("+Math.abs(x*100)/100+")":x},Y=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let _=parseFloat(o-e);return _<0?"("+n(Math.abs(_))+")":n(_)},F=u(!1),b=u({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),st=yt(()=>{let e=0;return b.value.details2.forEach(o=>{o.p_status!="Remove"&&(e+=o.qty*o.amount)}),e});return(e,o)=>{const _=rt,m=nt,x=it,R=_t,O=ct,ot=ut,lt=pt,at=dt;return d(),h("div",$t,[v(_,{title:"Report Transaction"}),s("div",Ct,[s("div",At,[s("div",Mt,[L(s("select",{class:"","onUpdate:modelValue":o[0]||(o[0]=t=>ht(y)?y.value=t:null)},Nt,512),[[kt,l(y)]])]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[1]||(o[1]=t=>E("reportSusutPDF"))},[v(m),c(),Pt]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[2]||(o[2]=t=>X("reportSusutExcel"))},[v(x),c(),Ht])]),v(ot,{thead:l(et),selected:l(V),onSetSelected:o[3]||(o[3]=t=>V.value=t),tbody:l(k),fnCallData:K,scrolling:l(f),onSetScrollingPage:o[4]||(o[4]=t=>l(f).page=t),onDoFilter:o[5]||(o[5]=t=>U())},{status:i(({item:t})=>[s("div",{class:wt(["text-white text-xs px-2 py-1 rounded-lg",A(t)?"bg-green-600":"bg-red-600"])},a(A(t)?"Done":"Not Done"),3)]),val:i(({item:t})=>[t.val?(d(),g(O,{key:1})):(d(),g(R,{key:0}))]),val1:i(({item:t})=>[t.val1?(d(),g(O,{key:1})):(d(),g(R,{key:0}))]),pvr_had_detail:i(({item:t})=>[t.pvr_had_detail?(d(),g(O,{key:1})):(d(),g(R,{key:0}))]),susut_bruto_a:i(({item:t})=>[c(a(l(n)(t.ticket_a_bruto)),1)]),susut_tara_a:i(({item:t})=>[c(a(l(n)(t.ticket_a_tara)),1)]),susut_netto_a:i(({item:t})=>[c(a(l(n)(t.ticket_a_netto)),1)]),susut_bruto_b:i(({item:t})=>[c(a(l(n)(t.ticket_b_bruto)),1)]),susut_tara_b:i(({item:t})=>[c(a(l(n)(t.ticket_b_tara)),1)]),susut_netto_b:i(({item:t})=>[c(a(l(n)(t.ticket_b_netto)),1)]),susut_bruto_b_a:i(({item:t})=>[c(a(Y(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:i(({item:t})=>[c(a(Y(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:i(({item:t})=>[c(a(Y(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:i(({item:t})=>[c(a(H(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:i(({item:t})=>[c(a(H(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:i(({item:t})=>[c(a(H(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),l(T)?(d(),h("div",Yt,[s("div",Ft,[s("div",Rt,[v(lt,{style:{color:"black",cursor:"pointer"},onClick:o[6]||(o[6]=t=>E())})]),s("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(P).dataBase64},null,8,Ot),s("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[7]||(o[7]=t=>tt())})])])):vt("",!0),L(s("div",jt,[s("div",qt,[v(at,{title:"Detail Information",fn:()=>{F.value=!1,e.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("div",zt,[s("div",Vt,[s("div",Jt,[Kt,s("div",Ut,a(l(b).xto)+" ",1)]),s("div",It,[Et,s("div",Lt,a(l(b).tipe),1)]),s("div",Zt,[Gt,s("div",Qt,a(l(b).jenis),1)]),s("div",Wt,[Xt,s("div",te,a(l(b).note_for_remarks),1)])]),s("div",ee,[s("table",se,[oe,(d(!0),h(Z,null,G(l(b).details,t=>(d(),h("tr",null,[s("td",le,a(t.ordinal)+". ",1),s("td",ae,a(t.xdesc)+" "+a(t.qty<=1?"":l(n)(t.qty||0)+" x Rp."+l(n)(t.harga||0)),1),re,s("td",ne,a(l(n)(t.qty*t.harga)),1)]))),256)),s("tr",ie,[_e,ce,s("th",ue,a(l(n)(l(b).harga)),1)])])]),s("div",pe,[s("table",de,[fe,(d(!0),h(Z,null,G(l(b).details2,t=>(d(),h("tr",null,[s("td",be,a(t.ordinal)+". ",1),s("td",me,a(t.ac_account_code),1),s("td",ye,a(t.description)+" "+a(t.qty<=1?"":l(n)(t.qty||0)+" x Rp."+l(n)(t.amount||0)),1),ke,s("td",he,a(l(n)(t.qty*t.amount)),1)]))),256)),s("tr",ve,[ge,xe,s("th",we,a(l(n)(l(st))),1)])])])]),s("div",De,[s("button",{class:"rounded m-1",onClick:o[8]||(o[8]=t=>F.value=!1)}," Cancel ")])])],512),[[gt,l(F)]])])}}};export{Qe as default};
