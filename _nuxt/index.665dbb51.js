import Ae from"./Header.41b36b0e.js";import Oe from"./Copy.3c3b0d4f.js";import Te from"./Plus.bd419c70.js";import Be from"./Edit.b97cb8e3.js";import Fe from"./Eyes.24c47f62.js";import Ie from"./Delete.0a45e9fb.js";import Ue from"./Signature.0b6ade8d.js";import Me from"./SignatureOff.d1b15d97.js";import Ne from"./Table2Column.58f530f3.js";import Ee from"./Line.89532fab.js";import He from"./Check.11a82cfa.js";import Ve from"./TableView.5a749bcd.js";import{_ as ze}from"./PopupMini.vue.9289ac15.js";import Je from"./ujalan.a838b0c7.js";import Le from"./ujalan_validasi.d6e00b8d.js";import{r as s,f as q,g as Ke,h as Re,i as h,j as Z,s as Ye,x as d,c as b,b as u,a as i,k as Q,v as Ge,l,m as W,n as x,d as E,w as S,q as qe,y as B,o as _,z as F,t as X,A as Ze}from"./entry.0a1396d5.js";import{u as c}from"./useUtils.1564ce74.js";import{u as I}from"./useMyFetch.19970559.js";import{u as Qe}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.38aa820b.js";import"./Adjust.ac82db70.js";import"./TableHeaderEye.f864434f.js";import"./Times.74c2b1be.js";import"./ClearAll.2ab33b37.js";import"./client-only.77bd91aa.js";import"./ClearEach.55121c91.js";import"./CaretLeftDoubleBold.b4cb240c.js";import"./CaretLeftBold.28681ca2.js";import"./CaretRightBold.30e1bc2a.js";import"./CaretRightDoubleBold.726b1af9.js";import"./Exclamation.2d114207.js";import"./HeaderPopup.vue.102e4a9f.js";import"./InputPointFormat.vue.53267d5b.js";import"./Tools.892a335d.js";import"./ToolsPopup.019cda2e.js";import"./ac_accs.5676daa1.js";const We={class:"w-full h-full flex flex-col"},Xe={class:"w-full flex grow flex-col overflow-auto h-0"},et={class:"w-full flex justify-between flex-wrap"},tt={class:"grow flex"},at={class:"m-1"},lt=i("option",{value:"available"},"Available",-1),ot=i("option",{value:"unapprove"},"Unapprove",-1),nt=i("option",{value:"deleted"},"Trash",-1),st=i("option",{value:"all"},"All",-1),rt=[lt,ot,nt,st],it=i("span",{class:"text-xs ml-1"}," Download ",-1),ut={class:"whitespace-pre-wrap"},dt={class:"grow mb-5"},Zt={__name:"index",async setup(_t){let $,H;const ee=t=>t.deleted==1?"!bg-red-400":t.val==0||t.val1==0?"!bg-gray-300":"",p=s("available");q(()=>p.value,t=>{L()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const V=s({}),A=Ke("token"),{data:te}=([$,H]=Re(async()=>qe(async()=>{d().loading_full=!0;let t=[];const[e,f]=await Promise.all([I("/ujalan",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{filter_status:p},retry:0})]);return e.status.value!=="error"&&(t=e.data.value.data),e.status.value==="error"?(B().trigger(e.error),{ujalans:t}):(d().loading_full=!1,{ujalans:t})},"$SN3C927rLk")),$=await $,H(),$),n=s(te.value.ujalans||[]),U=s({field:"tanggal",by:"desc"}),a=s(-1),m=h(()=>n.value[a.value]),v=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),z=()=>{r.like="";let t=JSON.parse(JSON.stringify(d()._tv.global_keyword));t!=""&&(r.like=`id:%${t}%,xto:%${t}%,tipe:%${t}%,jenis:%${t}%,harga:%${t}%`),r.sort="",U.value.field&&(r.sort=U.value.field+":"+U.value.by),r.filter_model=JSON.stringify(d()._tv.filter_model)},J=async()=>{d().loading_full=!0,V.value={},v.value.may_get_data=!1,r.page=v.value.page,r.page==1&&(n.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(n.value[0])),r.filter_status=p.value;const{data:t,error:e,status:f}=await I("/ujalan",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:r,retry:0});if(d().loading_full=!1,v.value.may_get_data=!0,f.value==="error"){B().trigger(e,V);return}v.value.page==1?n.value=t.value.data:v.value.page>1&&(n.value=[...n.value,...t.value.data]),t.value.data.length==0&&(v.value.is_last_record=!0),d()._tv.filter_box=!1},L=()=>{a.value=-1,v.value.page=1,v.value.is_last_record=!1,z(),J()},D=s(!1),O=s(0),k=s(0),g=s(-1),ae=()=>{O.value=0,g.value=-1,k.value=!1,D.value=!0},{display:w}=Z();Ye(Z());const le=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(O.value=n.value[a.value].id,g.value=-1,k.value=!1,D.value=!0)},oe=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(O.value=n.value[a.value].id,g.value=-1,k.value=!0,D.value=!0)},C=s(!1),T=s(0),ne=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=n.value[a.value].id,g.value=1,k.value=!1,C.value=!0)},se=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=n.value[a.value].id,g.value=0,k.value=!1,C.value=!0)},re=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value=n.value[a.value].id,k.value=!1,g.value=-1,C.value=!0)},M=s(!1),K=s({}),P=s(!1),j=s(""),ie=async()=>{P.value&&(P.value=!1)},ue=()=>{a.value==-1?w({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value="",K.value={id:n.value[a.value].id,tujuan:n.value[a.value].xto},P.value=!0)};q(()=>j.value,t=>{t.trim().length>0?M.value=!0:M.value=!1},{immediate:!1});const de=async()=>{d().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",j.value),t.append("_method","DELETE");const{data:e,error:f,status:N}=await I("/ujalan",{method:"post",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},body:t,retry:0});if(d().loading_full=!1,N.value==="error"){B().trigger(f);return}let y={...n.value[a.value]};y.deleted=e.value.deleted,y.deleted_user=e.value.deleted_user,y.deleted_at=e.value.deleted_at,y.deleted_by=e.value.deleted_by,y.deleted_reason=e.value.deleted_reason,p.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...y}),a.value=-1,P.value=!1},_e=s([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"xto",label:"Tujuan",freeze:1,filter_on:1,type:"string"},{key:"asst_opt",label:"Info",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"km_range",label:"Jarak KM",filter_on:1,type:"number"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK","LAIN","TUNGGU"]},{key:"harga",label:"Harga",class:" justify-end",type:"number"},{key:"bonus_trip_supir",label:"Bonus Trip Supir",class:" justify-end",type:"number"},{key:"bonus_trip_kernet",label:"Bonus Trip Kernet",class:" justify-end",type:"number"},{key:"note_for_remarks",label:"Ket.U.Remarks",filter_on:1,type:"string"},{key:"transition_from",label:"Pengalihan",filter_on:1,type:"select",select_item:d().list_pabrik},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),me=h(()=>a.value>-1&&[void 0,0].indexOf(m.value.deleted)>-1&&c().checkPermission("ujalan.create")),ve=h(()=>["available","all","unapprove"].indexOf(p.value)>-1&&c().checkPermission("ujalan.create")),ce=h(()=>a.value>-1&&[void 0,0].indexOf(m.value.deleted)>-1&&(c().checkPermission("ujalan.val")&&[void 0,0].indexOf(m.value.val)>-1||c().checkPermission("ujalan.val1")&&[void 0,0].indexOf(m.value.val1)>-1)&&c().checkPermissions(["ujalan.modify","ujalan.detail.modify","ujalan.detail2.modify"])),pe=h(()=>a.value>-1&&[void 0,0].indexOf(m.value.deleted)>-1&&(c().checkPermission("ujalan.val")&&[void 0,0].indexOf(m.value.val)>-1||c().checkPermission("ujalan.val1")&&[void 0,0].indexOf(m.value.val1)>-1)),fe=h(()=>a.value>-1&&[void 0,0].indexOf(m.value.deleted)>-1&&(c().checkPermission("ujalan.unval")&&[1].indexOf(m.value.val)>-1||c().checkPermission("ujalan.unval1")&&[1].indexOf(m.value.val1)>-1)),ye=h(()=>a.value>-1&&c().checkPermission("ujalan.remove")&&[void 0,0].indexOf(m.value.deleted)>-1),{downloadFile:be,viewFile:mt}=Qe(),ke=async()=>{z(),d().loading_full=!0;const{data:t,error:e,status:f}=await I("/ujalan/download_excel",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:r,retry:0});if(d().loading_full=!1,f.value==="error"){B().trigger(e);return}be(t.value)};return(t,e)=>{const f=Ae,N=Oe,y=Te,ge=Be,he=Fe,xe=Ie,we=Ue,je=Me,De=Ne,R=Ee,Y=He,Ce=Ve,Pe=ze,Se=Je,$e=Le;return _(),b("div",We,[u(f,{title:"List Ujalan"}),i("div",Xe,[i("div",et,[i("div",tt,[i("div",at,[Q(i("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>W(p)?p.value=o:null)},rt,512),[[Ge,l(p)]])]),l(me)?(_(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>oe())},[u(N)])):x("",!0),l(ve)?(_(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>ae())},[u(y)])):x("",!0),l(ce)?(_(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>le())},[u(ge)])):x("",!0),l(a)>-1?(_(),b("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>re())},[u(he)])):x("",!0),l(ye)?(_(),b("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>ue())},[u(xe)])):x("",!0),l(pe)?(_(),b("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>ne())},[u(we)])):x("",!0),l(fe)?(_(),b("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>se())},[u(je)])):x("",!0),i("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:e[8]||(e[8]=o=>ke())},[u(De),E(),it])])]),u(Ce,{thead:l(_e),selected:l(a),onSetSelected:e[9]||(e[9]=o=>a.value=o),tbody:l(n),fnCallData:J,scrolling:l(v),onSetScrollingPage:e[10]||(e[10]=o=>l(v).page=o),onDoFilter:e[11]||(e[11]=o=>L()),rowBgColor:ee},{val:S(({item:o})=>[o.val?(_(),F(Y,{key:1})):(_(),F(R,{key:0}))]),val1:S(({item:o})=>[o.val1?(_(),F(Y,{key:1})):(_(),F(R,{key:0}))]),xto:S(({item:o})=>[i("div",ut,X(o.xto),1)]),deleted_by_username:S(({item:o})=>{var G;return[E(X((G=o.deleted_by)==null?void 0:G.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),u(Pe,{type:"delete",show:l(P),data:l(K),fnClose:ie,fnConfirm:de,enabledOk:l(M)},{footer:S(()=>[E(" Masukkan Alasan Penghapusan: "),i("div",dt,[Q(i("textarea",{"onUpdate:modelValue":e[12]||(e[12]=o=>W(j)?j.value=o:null)},null,512),[[Ze,l(j)]])])]),_:1},8,["show","data","enabledOk"]),u(Se,{show:l(D),fnClose:()=>{D.value=!1},id:l(O),p_data:l(n),is_copy:l(k)},null,8,["show","fnClose","id","p_data","is_copy"]),u($e,{show:l(C),fnClose:()=>{C.value=!1},id:l(T),p_data:l(n),it_state:l(g)},null,8,["show","fnClose","id","p_data","it_state"])])}}};export{Zt as default};
