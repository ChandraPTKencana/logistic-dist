import{_ as be}from"./HeaderPopup.vue.1f66d8b8.js";import ye from"./Tools.d82fafb4.js";import{_ as ke}from"./InputPointFormat.vue.923183b3.js";import ge from"./Times.f70da358.js";import je from"./Check.89456827.js";import Pe from"./Plus.efe08782.js";import Te from"./ToolsPopup.aa22d362.js";import Se from"./ac_accs.8248323d.js";import{r as x,h as Z,z as Ce,K,I as qe,o as c,c as d,n as P,v as Ae,a as e,b as T,m as t,q as N,t as f,C as J,F as A,D as O,x as D,G as k,d as E,E as j,J as q,s as Ie,y as ee,p as Ue,e as Ve}from"./entry.88f34d4f.js";import{u as Ne}from"./useUtils.8b5b7e0b.js";import{u as te}from"./useMyFetch.939ba7e3.js";import{_ as De}from"./_plugin-vue_export-helper.c27b6911.js";import"./Search.e6544f40.js";const i=w=>(Ue("data-v-94ce5a47"),w=w(),Ve(),w),Re={class:"box-fixed"},Fe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Be={class:"w-full flex flex-col items-center grow overflow-auto"},$e={class:"w-full flex flex-row flex-wrap"},Ee={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ze=i(()=>e("label",{for:""},"To",-1)),Ke=["disabled"],Je={class:"text-red-500"},Oe={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Le=i(()=>e("label",{for:""},"Jenis",-1)),Me=["disabled"],Ge=i(()=>e("option",{value:"PK"},"PK",-1)),He=i(()=>e("option",{value:"CPO"},"CPO",-1)),Qe=i(()=>e("option",{value:"TBS"},"TBS",-1)),Xe=[Ge,He,Qe],Ye={class:"text-red-500"},We={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ze=i(()=>e("label",{for:""},"Harga",-1)),et={class:"card-border disabled"},tt={class:"text-red-500"},st={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},lt=i(()=>e("label",{for:""},"Asal Peralihan",-1)),ot=["disabled"],at=i(()=>e("option",{value:""},null,-1)),nt=["value"],ct={class:"text-red-500"},it={class:"w-full sm:w-4/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ut=i(()=>e("label",{for:""},"Tipe",-1)),rt=["disabled"],dt={class:"text-red-500"},_t={class:"w-full sm:w-4/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},pt=i(()=>e("label",{for:""},"Ket. Untuk Remarks",-1)),ft=["disabled"],mt={class:"text-red-500"},ht={class:"w-full flex flex-col sm:flex-row grow p-1 justify-between flex-wrap 2xl:overflow-hidden"},vt={class:"w-full max-w-full p-0 2xl:pr-1 2xl:w-1/2 2xl:max-h-full 2xl:overflow-auto"},xt={class:"w-full",role:"sticky"},wt={class:"tacky w-full",style:{"white-space":"normal"}},bt={class:"sticky -top-1 !z-[2]"},yt=["colspan"],kt={class:"sticky top-7 !z-[2]"},gt={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},jt=i(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1)),Pt=i(()=>e("th",null,"Desc",-1)),Tt=i(()=>e("th",{class:"min-w-[100px] !w-[100px] max-w-[100px]"},"Harga @",-1)),St=i(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"Qty",-1)),Ct={class:"min-w-[100px] !w-[100px] max-w-[100px]"},qt=i(()=>e("br",null,null,-1)),At={class:"text-sm"},It=i(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"For Remarks",-1)),Ut={ref:"to_move"},Vt=["data-index"],Nt={key:0,class:"tools cell"},Dt={class:"w-full h-full flex items-center justify-center"},Rt=["onClick"],Ft={class:"cell"},Bt={class:"w-full h-full flex items-center justify-center"},$t=["disabled","onUpdate:modelValue"],Et={class:"w-full h-full flex items-center justify-center"},zt={class:"w-full h-full flex items-center justify-center"},Kt={class:"cell"},Jt={class:"w-full h-full flex items-center justify-center unselectable"},Ot={class:"w-full h-full flex items-center justify-center"},Lt={key:0,class:"text-3xl"},Mt=["onClick"],Gt={key:0},Ht={class:"tools cell"},Qt={class:"w-full max-w-full max-h-full px-0 py-2 2xl:pl-1 2xl:py-0 2xl:w-1/2 2xl:overflow-auto"},Xt={class:"w-full",role:"sticky"},Yt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Wt={class:"sticky -top-1 !z-[2]"},Zt=["colspan"],es={class:"sticky top-7 !z-[2]"},ts={key:0,class:"min-w-[30px] !w-[30px] max-w-[30px]"},ss=i(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1)),ls={key:1,class:"min-w-[30px] !w-[30px] max-w-[30px]"},os=i(()=>e("th",{class:"min-w-[40px] !w-[40px] max-w-[40px]"},"Acc ID",-1)),as=i(()=>e("th",{class:"!min-w-[100px] !w-[100px] !max-w-[100px]"},"Acc Code",-1)),ns=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Acc Name",-1)),cs=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Desc",-1)),is=i(()=>e("th",{class:"min-w-[100px] !w-[100px] max-w-[100px]"},"Amount",-1)),us=i(()=>e("th",{class:"min-w-[40px] !w-[40px] max-w-[40px]"},"Qty",-1)),rs=i(()=>e("th",{class:"min-w-[80px] !w-[80px] max-w-[80px]"},"For",-1)),ds={class:"min-w-[100px] !w-[100px] max-w-[100px]"},_s=i(()=>e("br",null,null,-1)),ps={class:"text-sm"},fs={ref:"to_move"},ms=["data-index"],hs={key:0,class:"tools cell"},vs={class:"w-full h-full flex items-center justify-center"},xs=["onClick"],ws={key:1,class:"cell"},bs={class:"w-full h-full flex items-center justify-center"},ys=["onClick"],ks=["onClick","disabled"],gs={class:"w-full h-full flex items-center justify-center"},js={class:"w-full h-full flex items-center justify-center"},Ps={class:"w-full h-full flex items-center justify-center"},Ts={class:"cell"},Ss={class:"w-full h-full flex items-center justify-center"},Cs=["disabled","onUpdate:modelValue"],qs={class:"w-full h-full flex items-center justify-center"},As={class:"w-full h-full flex items-center justify-center"},Is={class:"w-full h-full flex items-center justify-center"},Us=["onUpdate:modelValue","disabled"],Vs=i(()=>e("option",{value:"Supir"},"Supir",-1)),Ns=i(()=>e("option",{value:"Kernet"},"Kernet",-1)),Ds=[Vs,Ns],Rs={class:"cell"},Fs={class:"w-full h-full flex items-center justify-center unselectable"},Bs={key:0},$s={class:"tools cell"},Es={class:"w-full flex items-center justify-end"},zs={__name:"ujalan",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(w){const g=w,{pointFormat:I}=Ne(),L={id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",transition_from:"",details:[],details2:[]},n=x({...L}),M=Z("token"),S=x({}),se=x([{xdesc:"Timbangan",qty:1,harga:55e3},{xdesc:"Retribusi TPR",qty:1,harga:23e3},{xdesc:"Parkir & Nginap",qty:1,harga:1e4},{xdesc:"Penitipan Alat (Dongkrak)",qty:1,harga:5e3},{xdesc:"Ikas Danau",qty:1,harga:1e4},{xdesc:"U.Bongkar + Ambil surat",qty:1,harga:35e3},{xdesc:"Perbaikan Jalan Pujut",qty:1,harga:1e4},{xdesc:"Gaji Supir",qty:1,harga:0},{xdesc:"Gaji Kernet",qty:1,harga:0},{xdesc:"U.Extrafooding",qty:1,harga:2e4}]);x([]);const _=x([]),u=x([]),G=x({ordinal:0,id:-1,xdesc:"",qty:1,harga:0,for_remarks:0,p_status:""}),H=x({ordinal:0,id:-1,ac_account_id:"",ac_account_name:"",ac_account_code:"",description:"",qty:1,amount:0,xfor:"",p_status:""}),le=()=>{se.value.forEach(o=>{_.value.filter(s=>s.xdesc==o.xdesc).length==0&&_.value.push({...o,ordinal:0,id:-1,p_status:"Add"})})},R=x(!1),oe=()=>{R.value=!1},ae=o=>{u.value[m.value].ac_account_id=o.ac_account_id,u.value[m.value].ac_account_code=o.ac_account_code,u.value[m.value].ac_account_name=o.ac_account_name,R.value=!1},ne=(o,s)=>{m.value=s,R.value=!0},ce=(o,s)=>{u.value[s].ac_account_id="",u.value[s].ac_account_code="",u.value[s].ac_account_name=""},{display:ie}=Ce(),ue=async()=>{if(u.value.length>0&&z.value!=Q.value){ie({show:!0,status:"Failed",message:"Total tidak cocok"});return}D().loading_full=!0,S.value={};const o=new FormData;o.append("xto",n.value.xto),o.append("tipe",n.value.tipe),o.append("jenis",n.value.jenis),o.append("harga",n.value.harga),o.append("note_for_remarks",n.value.note_for_remarks),o.append("transition_from",n.value.transition_from),o.append("details",JSON.stringify(_.value)),o.append("details2",JSON.stringify(u.value));let s="post",C=g.is_copy?0:g.id;C==0||(o.append("id",C),o.append("_method","PUT"));const{data:y,error:h,status:U}=await te("/ujalan",{method:s,headers:{Authorization:`Bearer ${M.value}`,Accept:"application/json"},body:o,retry:0});if(D().loading_full=!1,U.value==="error"){ee().trigger(h,S);return}if(C<=0)n.value.id=y.value.id,n.value.created_at=y.value.created_at,n.value.updated_at=y.value.updated_at,g.p_data.unshift(n.value);else{n.value.updated_at=y.value.updated_at;let V=g.p_data.map($=>$.id).indexOf(C);V>=-1&&g.p_data.splice(V,1,{...n.value})}g.fnClose()},z=K(()=>{let o=0;return _.value.forEach(s=>{s.p_status!="Remove"&&(o+=s.qty*s.harga)}),n.value.harga=o,o}),Q=K(()=>{let o=0;return u.value.forEach(s=>{s.p_status!="Remove"&&(o+=s.qty*s.amount)}),o}),b=x(-1),m=x(-1),F=x(!1),X=x({left:0,top:0}),B=x(!1),Y=x({left:0,top:0}),re=(o,s)=>{b.value=s,F.value=!0,X.value={left:o.clientX,top:o.clientY}},de=(o,s)=>{m.value=s,B.value=!0,Y.value={left:o.clientX,top:o.clientY}},_e=()=>{_.value.push({...G.value,p_status:"Add"})},pe=()=>{u.value.push({...H.value,p_status:"Add"})},fe=()=>{F.value=!1},me=()=>{B.value=!1},he=(o="")=>{if(o=="insert")_.value.splice(b.value,0,{...G.value,p_status:"Add"});else if(o=="delete")_.value[b.value].p_status=="Edit"?_.value[b.value].p_status="Remove":_.value.splice(b.value,1);else if(o=="move_top"){let s=_.value[b.value];_.value.splice(b.value,1),_.value.splice(b.value-1,0,{...s})}else if(o=="move_bottom"){let s=_.value[b.value];_.value.splice(b.value,1),_.value.splice(b.value+1,0,{...s})}F.value=!1},ve=(o="")=>{if(o=="insert")u.value.splice(m.value,0,{...H.value,p_status:"Add"});else if(o=="delete")u.value[m.value].p_status=="Edit"?u.value[m.value].p_status="Remove":u.value.splice(m.value,1);else if(o=="move_top"){let s=u.value[m.value];u.value.splice(m.value,1),u.value.splice(m.value-1,0,{...s})}else if(o=="move_bottom"){let s=u.value[m.value];u.value.splice(m.value,1),u.value.splice(m.value+1,0,{...s})}B.value=!1},p=Z("role"),a=K(()=>n.value.val&&n.value.val1||p.value=="Logistic"&&n.value.val||p.value=="PabrikTransport"&&n.value.val1),xe=async()=>{D().loading_full=!0;const{data:o,error:s,status:C}=await te("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${M.value}`,Accept:"application/json"},params:{id:g.id},retry:0});if(D().loading_full=!1,C.value==="error"){ee().trigger(s);return}n.value=o.value.data;let y="Edit";g.is_copy&&(y="Add",n.value.val=0,n.value.val1=0),_.value=o.value.data.details.map(h=>(h.p_status=y,h.key=h.ordinal,h)),u.value=o.value.data.details2.map(h=>(h.p_status=y,h.key=h.ordinal,h))};return qe(()=>g.show,(o,s)=>{o==!0&&(n.value={...L},_.value=[],u.value=[],g.id!=0&&xe())},{immediate:!0}),(o,s)=>{const C=be,y=ye,h=ke,U=ge,V=je,$=Pe,W=Te,we=Se;return c(),d(A,null,[P(e("section",Re,[e("div",null,[T(C,{title:"Form Ujalan",fn:w.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Fe,[e("div",Be,[e("div",$e,[e("div",Ee,[ze,P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>t(n).xto=l),disabled:t(p)=="PabrikTransport"||t(a)},null,8,Ke),[[N,t(n).xto]]),e("p",Je,f(t(S).xto),1)]),e("div",Oe,[Le,P(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>t(n).jenis=l),disabled:t(p)=="PabrikTransport"||t(a)},Xe,8,Me),[[J,t(n).jenis]]),e("p",Ye,f(t(S).jenis),1)]),e("div",We,[Ze,e("div",et,f(t(I)(t(z))),1),e("p",tt,f(t(S).harga),1)]),e("div",st,[lt,P(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>t(n).transition_from=l),disabled:t(p)=="PabrikTransport"||t(a)},[at,(c(!0),d(A,null,O(t(D)().list_pabrik,l=>(c(),d("option",{value:l},f(l),9,nt))),256))],8,ot),[[J,t(n).transition_from]]),e("p",ct,f(t(S).transition_from),1)]),e("div",it,[ut,P(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=l=>t(n).tipe=l),disabled:t(p)=="PabrikTransport"||t(a)},null,8,rt),[[N,t(n).tipe]]),e("p",dt,f(t(S).tipe),1)]),e("div",_t,[pt,P(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=l=>t(n).note_for_remarks=l),disabled:t(p)=="PabrikTransport"||t(a)},null,8,ft),[[N,t(n).note_for_remarks]]),e("p",mt,f(t(S).note_for_remarks),1)])]),e("div",ht,[e("div",vt,[e("div",xt,[e("table",wt,[e("thead",null,[e("tr",bt,[e("td",{colspan:t(p)!="PabrikTransport"&&!t(a)?7:6,class:"!bg-slate-800 text-white font-bold"}," Detail Uang Jalan ",8,yt)]),e("tr",kt,[t(p)!="PabrikTransport"&&!t(a)?(c(),d("th",gt,[e("button",{type:"button",name:"button",class:"bg-yellow-600",onClick:s[5]||(s[5]=l=>le())}," Default In ")])):k("",!0),jt,Pt,Tt,St,e("th",Ct,[E("Total "),qt,E(),e("span",At,"("+f(t(I)(t(z)))+")",1)]),It])]),e("tbody",Ut,[(c(!0),d(A,null,O(t(_),(l,v)=>(c(),d(A,{key:v},[l.p_status!="Remove"?(c(),d("tr",{key:0,"data-index":v},[t(p)!="PabrikTransport"&&!t(a)?(c(),d("td",Nt,[e("div",Dt,[e("button",{type:"button",name:"button",onClick:r=>re(r,v)},[T(y)],8,Rt)])])):k("",!0),e("td",null,f(v+1)+".",1),e("td",Ft,[e("div",Bt,[P(e("textarea",{disabled:t(p)=="PabrikTransport"||t(a),class:"p-1 w-full","onUpdate:modelValue":r=>l.xdesc=r,cols:"7",rows:"2"},null,8,$t),[[N,l.xdesc]])])]),e("td",{class:j(["cell bold",t(p)=="PabrikTransport"||t(a)?"unselectable":""])},[e("div",Et,[(c(),q(h,{key:v,class:"w-full h-full p-1",type:"text",value:l.harga||0,onInput:r=>l.harga=r,show:w.show,disabled:t(p)=="PabrikTransport"||t(a)},null,8,["value","onInput","show","disabled"]))])],2),e("td",{class:j(["cell",t(p)=="PabrikTransport"||t(a)?"unselectable":""])},[e("div",zt,[(c(),q(h,{key:v,class:"w-full h-full p-1",type:"text",value:l.qty||0,onInput:r=>l.qty=r,show:w.show,disabled:t(p)=="PabrikTransport"||t(a)},null,8,["value","onInput","show","disabled"]))])],2),e("td",Kt,[e("div",Jt,f(t(I)(l.qty*l.harga||0)),1)]),e("td",{class:j(["cell",t(p)=="PabrikTransport"||t(a)?"unselectable":""])},[e("div",Ot,[t(p)=="PabrikTransport"||t(a)?(c(),d("div",Lt,[l.for_remarks==0?(c(),q(U,{key:0,class:"text-red-800"})):(c(),q(V,{key:1,class:"text-green-800"}))])):(c(),d("button",{key:1,type:"button",onClick:r=>l.for_remarks=l.for_remarks?0:1,class:j(["text-white w-auto rounded text-xl",l.for_remarks?"bg-green-600":"bg-red-600"])},[l.for_remarks==0?(c(),q(U,{key:0})):(c(),q(V,{key:1}))],10,Mt))])],2)],8,Vt)):k("",!0)],64))),128)),t(p)!="PabrikTransport"&&!t(a)?(c(),d("tr",Gt,[e("td",Ht,[e("button",{type:"button",name:"button",onClick:s[6]||(s[6]=l=>_e())},[T($)])])])):k("",!0)],512)])])]),e("div",Qt,[e("div",Xt,[e("table",Yt,[e("thead",null,[e("tr",Wt,[e("td",{colspan:t(a)?9:11,class:"!bg-slate-800 text-white font-bold"}," Detail PVR ",8,Zt)]),e("tr",es,[t(a)?k("",!0):(c(),d("th",ts)),ss,t(a)?k("",!0):(c(),d("th",ls)),os,as,ns,cs,is,us,rs,e("th",ds,[E("Total "),_s,E(),e("span",ps,"("+f(t(I)(t(Q)))+")",1)])])]),e("tbody",fs,[(c(!0),d(A,null,O(t(u),(l,v)=>(c(),d(A,{key:v},[l.p_status!="Remove"?(c(),d("tr",{key:0,"data-index":v},[t(a)?k("",!0):(c(),d("td",hs,[e("div",vs,[e("button",{type:"button",name:"button",onClick:r=>de(r,v)},[T(y)],8,xs)])])),e("td",null,f(v+1)+".",1),t(a)?k("",!0):(c(),d("td",ws,[e("div",bs,[l.ac_account_id?(c(),d("button",{key:1,type:"button",onClick:r=>ce(r,v),disabled:l.confirm_by},[T(U,{class:"font-bold text-2xl"})],8,ks)):(c(),d("button",{key:0,type:"button",name:"button",onClick:r=>ne(r,v)}," ... ",8,ys))])])),e("td",{class:j(["cell bold",t(a)?"unselectable":""])},[e("div",gs,f(l.ac_account_id),1)],2),e("td",{class:j(["cell bold",t(a)?"unselectable":""])},[e("div",js,f(l.ac_account_code),1)],2),e("td",{class:j(["cell bold",t(a)?"unselectable":""])},[e("div",Ps,f(l.ac_account_name),1)],2),e("td",Ts,[e("div",Ss,[P(e("textarea",{disabled:t(a),class:"p-1 w-full","onUpdate:modelValue":r=>l.description=r,cols:"7",rows:"2"},null,8,Cs),[[N,l.description]])])]),e("td",{class:j(["cell bold",t(a)?"unselectable":""])},[e("div",qs,[(c(),q(h,{key:v,class:"w-full h-full p-1",type:"text",value:l.amount||0,onInput:r=>l.amount=r,show:w.show,disabled:t(a)},null,8,["value","onInput","show","disabled"]))])],2),e("td",{class:j(["cell",t(a)?"unselectable":""])},[e("div",As,[(c(),q(h,{key:v,class:"w-full h-full p-1",type:"text",value:l.qty||0,onInput:r=>l.qty=r,show:w.show,disabled:t(a)},null,8,["value","onInput","show","disabled"]))])],2),e("td",{class:j(["cell",t(a)?"unselectable":""])},[e("div",Is,[P(e("select",{class:"h-full","onUpdate:modelValue":r=>l.xfor=r,disabled:t(a)},Ds,8,Us),[[J,l.xfor]])])],2),e("td",Rs,[e("div",Fs,f(t(I)(l.qty*l.amount||0)),1)])],8,ms)):k("",!0)],64))),128)),t(a)?k("",!0):(c(),d("tr",Bs,[e("td",$s,[e("button",{type:"button",name:"button",onClick:s[7]||(s[7]=l=>pe())},[T($)])])]))],512)])])])])]),e("div",Es,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:s[8]||(s[8]=l=>w.fnClose())}," Cancel "),t(a)?k("",!0):(c(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:s[9]||(s[9]=Ie(l=>ue(),["prevent"]))}," Save "))])])])],512),[[Ae,w.show]]),T(W,{show:t(F),coor:t(X),fn:fe,data:t(_),data_index:t(b),onReplyAct:s[10]||(s[10]=l=>he(l))},null,8,["show","coor","data","data_index"]),T(W,{show:t(B),coor:t(Y),fn:me,data:t(u),data_index:t(m),onReplyAct:s[11]||(s[11]=l=>ve(l))},null,8,["show","coor","data","data_index"]),T(we,{show:t(R),fnClose:oe,fnSelect:ae},null,8,["show"])],64)}}},tl=De(zs,[["__scopeId","data-v-94ce5a47"]]);export{tl as default};
