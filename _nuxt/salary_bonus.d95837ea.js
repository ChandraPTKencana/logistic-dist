import{_ as F}from"./HeaderPopup.vue.ab5fc035.js";import{_ as P}from"./client-only.747b8740.js";import{_ as V}from"./WidthMiniList.vue.c7db55e4.js";import{_ as T}from"./InputPointFormat.vue.b03b1c92.js";import E from"./AttachmentSingle.86a46470.js";import{r as m,f as z,G as B,j as U,I as K,m as O,J as L,o as k,c as S,a as l,b as p,k as o,t as c,w as Y,v as G,x as H,E as W,A as _,B as N}from"./entry.d6b0a822.js";import"./useUtils.423a3309.js";import{u as C}from"./useMyFetch.301c6deb.js";import"./Times.04a59f51.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.a0146332.js";import"./PDFJsView.d26f9f3a.js";const Q={class:"box-fixed"},R={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},X={class:"w-full flex flex-col items-center grow overflow-auto"},Z={class:"w-full flex flex-row flex-wrap"},ee={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},te=l("label",{for:""},"Tanggal",-1),ae={key:0,class:"card-border"},le={key:1},oe={class:"text-red-500"},ne={class:"w-full sm:w-8/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},se=l("label",{for:""},"Pekerja",-1),ie={class:"text-red-500"},re={class:"w-full sm:w-6/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},de=l("label",{for:""},"Nominal",-1),ue={class:"text-red-500"},pe={class:"w-full sm:w-6/12 md:w-full lg:w-full flex flex-col flex-wrap p-1"},_e=l("label",{for:""},"Note",-1),me=["disabled"],ce={class:"text-red-500"},ve={class:"p-1 w-full"},fe={class:"w-full flex items-center justify-end"},Me={__name:"salary_bonus",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(v){const d=v,{$moment:A}=W(),D={id:"",tanggal:new Date,type:"Kerajinan",nominal:0,note:"",attachment_1:"",attachment_1_preview:"",attachment_1_type:""},t=m({...D}),h=z("token"),u=m({}),f={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},ktp_no:{tcon:"IconsNumber",text:"No KTP",val:""},sim_no:{tcon:"IconsCreditCard",text:"No SIM",val:""}},id:"",name:"",title:""},s=m(JSON.parse(JSON.stringify(f))),M=m([]),I=async()=>{_().loading_full=!0;const{data:n,error:e,status:r}=await C("/salary_bonus_load_local",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0});if(_().loading_full=!1,r.value==="error"){N().trigger(e);return}M.value=n.value.list_employee},J=B(()=>{let n=[];return M.value.forEach((e,r)=>{let a=JSON.parse(JSON.stringify(f));a._.id.val=e.id,a._.name.val=e.name,a._.ktp_no.val=e.ktp_no,a._.sim_no.val=e.sim_no,a.id=e.id,a.name=e.name,a.title=(e.ktp_no||"")+" "+(e.sim_no||""),n.push(JSON.parse(JSON.stringify(a)))}),n}),$=m([]),q=async()=>{_().loading_full=!0,u.value={};const n=new FormData;n.append("type",t.value.type),n.append("tanggal",t.value.tanggal?A(t.value.tanggal).format("Y-MM-DD"):""),n.append("employee_id",s.value.id),n.append("nominal",t.value.nominal),n.append("note",t.value.note),n.append("attachment_1",t.value.attachment_1),n.append("attachment_1_preview",t.value.attachment_1_preview);let e="post",r=t.value.id;r==""||(n.append("id",r),n.append("_method","PUT"));const{data:a,error:g,status:x}=await C("/salary_bonus",{method:e,headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:n,retry:0});if(_().loading_full=!1,x.value==="error"){N().trigger(g,u);return}if(t.value.employee={name:s.value._.name.val,ktp_no:s.value._.ktp_no.val,sim_no:s.value._.sim_no.val},t.value.attachment_1_type=a.value.attachment_1_type,$.value=a.value.details,r<=0)t.value.id=a.value.id,t.value.created_at=a.value.created_at,t.value.updated_at=a.value.updated_at,d.p_data.unshift(t.value);else{t.value.updated_at=a.value.updated_at;let w=d.p_data.map(b=>b.id).indexOf(r);w>=-1&&d.p_data.splice(w,1,{...t.value})}d.fnClose()},y=B(()=>t.value.val1),j=async()=>{_().loading_full=!0;const{data:n,error:e,status:r}=await C("/salary_bonus",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(_().loading_full=!1,r.value==="error"){N().trigger(e);return}d.is_copy&&(t.value.val=0,t.value.val1=0);let a=n.value.data;t.value=a,s.value._.id.val=a.employee.id,s.value._.name.val=a.employee.name,s.value._.ktp_no.val=a.employee.ktp_no,s.value._.sim_no.val=a.employee.sim_no,s.value.id=a.employee.id,s.value.name=a.employee.name,s.value.ktp_no=(a.employee.ktp_no||"")+" "+(a.employee.sim_no||"")};return U(()=>d.show,async(n,e)=>{n==!0&&(await I(),t.value={...D},s.value=JSON.parse(JSON.stringify(f)),$.value=[],u.value={},d.id!=0&&j())},{immediate:!0}),(n,e)=>{const r=F,a=K("vue-date-picker"),g=P,x=V,w=T,b=E;return O((k(),S("section",Q,[l("div",null,[p(r,{title:"Form Salary Additional",fn:v.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),l("form",R,[l("div",X,[l("div",Z,[l("div",ee,[te,o(y)?(k(),S("div",ae,c(o(A)(o(t).tanggal).format("DD-MM-Y")),1)):(k(),S("div",le,[p(g,null,{default:Y(()=>[p(a,{modelValue:o(t).tanggal,"onUpdate:modelValue":e[0]||(e[0]=i=>o(t).tanggal=i),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])),l("p",oe,c(o(u).tanggal),1)]),l("div",ne,[se,p(x,{arr:o(J),selected:o(s),pure:f,onSetSelected:e[1]||(e[1]=i=>s.value=i),disabled:o(y)},null,8,["arr","selected","disabled"]),l("p",ie,c(o(u).employee_id),1)]),l("div",re,[de,l("div",null,[p(w,{class:"w-full h-full p-1",type:"text",value:o(t).nominal||0,onInput:e[2]||(e[2]=i=>o(t).nominal=i),disabled:o(y)},null,8,["value","disabled"])]),l("p",ue,c(o(u).nominal),1)]),l("div",pe,[_e,l("div",null,[O(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>o(t).note=i),disabled:o(y)},null,8,me),[[G,o(t).note]])]),l("p",ce,c(o(u).nominal),1)]),l("div",ve,[p(b,{label:"Attachment",value:o(t).attachment_1_preview,onSetFile:e[4]||(e[4]=i=>o(t).attachment_1=i),onSetPreview:e[5]||(e[5]=i=>o(t).attachment_1_preview=i),can_remove:!0},null,8,["value"])])])]),l("div",fe,[l("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[6]||(e[6]=i=>v.fnClose())}," Cancel "),l("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:e[7]||(e[7]=H(i=>q(),["prevent"]))}," Save ")])])])],512)),[[L,v.show]])}}};export{Me as default};
