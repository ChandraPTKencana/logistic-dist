import{_ as it}from"./Header.4beb7718.js";import{_ as ut}from"./Plus.83aec977.js";import{_ as rt}from"./Edit.5818aeb3.js";import{_ as ct}from"./Delete.948a03ad.js";import{_ as dt,u as _t,a as pt}from"./useDownload.e82b4dcd.js";import{_ as ft}from"./Search.9b610064.js";import{_ as vt}from"./PopupMini.vue.c22f2a20.js";import{_ as mt}from"./Times.d9dc50c1.js";import{u as ht,K as kt,r as n,I as gt,N as O,O as yt,c as b,b as p,a as t,n as z,s as bt,x as l,q as wt,y as Y,z as Tt,F as Dt,A as At,M as xt,L as $t,D as v,E as S,o as w,B as Mt,t as o,U as Bt,C as Ct}from"./entry.d5fe10a3.js";import{u as jt}from"./useUtils.100f5b4a.js";import{u as x}from"./useMyFetch.1339d47f.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.223648a4.js";import"./client-only.1ae292aa.js";import"./InputPointFormat.vue.12658f94.js";const St={class:"w-full h-full flex flex-col"},Ht={class:"w-full flex grow flex-col overflow-auto h-0"},Nt={class:"w-full flex"},Pt={action:"#",class:"w-full flex p-1"},Ft={class:"grow"},zt=t("div",{class:"font-bold"}," Keyword ",-1),It={class:"pl-1"},Lt=t("div",{class:"font-bold"}," Sort By ",-1),Vt=Bt('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Et=[Vt],Ot={class:"pl-1"},Yt=t("div",{class:"font-bold"}," Sort Order ",-1),Rt=t("option",{value:"asc"},"Asc",-1),Ut=t("option",{value:"desc"},"Desc",-1),Kt=[Rt,Ut],Jt={class:"flex items-end pl-1"},qt={class:"w-full flex justify-center items-center grow h-0 p-1"},Zt={key:0,class:""},Gt={class:"tacky"},Qt=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Jenis"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket A In At"),t("th",null,"Ticket A Out At"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Ticket B In At"),t("th",null,"Ticket B Out At"),t("th",null,"Supir"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),Wt=["onClick"],Xt={class:"bold"},te={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},ee={class:"relative",style:{width:"95%",height:"90%"}},le={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},ae=["src"],we={__name:"index",async setup(oe){let $,I;const{$moment:m}=Ct(),{pointFormat:f}=jt(),i={};i._TimeZoneOffset=new Date().getTimezoneOffset(),i.sort="created_at:desc";const T=ht("token"),{data:M}=([$,I]=kt(async()=>$t(async()=>{v().loading_full=!0;let s=[],a=[],_=[],k=[],A=[];const[y,g]=await Promise.all([x("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0}),x("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},retry:0})]);return y.status.value!=="error"&&(s=y.data.value.data),y.status.value==="error"?(S().trigger(y.error),{trx_trps:s,list_ujalan:a,list_tipe:_,list_ticket:k,list_pv:A}):(g.status.value!=="error"&&(a=g.data.value.list_ujalan,_=g.data.value.list_tipe,k=g.data.value.list_ticket,A=g.data.value.list_pv),v().loading_full=!1,{trx_trps:s,list_ujalan:a,list_tipe:_,list_ticket:k,list_pv:A})},"$pFLmKcrKj9")),$=await $,I(),$),u=n(M.value.trx_trps||[]),R=n(M.value.list_ujalan),U=n(M.value.list_ticket),K=n(M.value.list_pv),c=n(""),h=n({field:"created_at",by:"desc"}),d=n(-1),r=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),J=()=>{i.like="",c.value!=""&&(i.like=`id:%${c.value}%,warehouse_name:%${c.value}%,warehouse_source_name:%${c.value}%,warehouse_target_name:%${c.value}%,item_name:%${c.value}%,status:%${c.value}%,type:%${c.value}%`),i.sort="",h.value.field&&(i.sort=h.value.field+":"+h.value.by)},B=n(null),L=async()=>{v().loading_full=!0,r.value.may_get_data=!1,i.page=r.value.page,i.page==1&&(u.value=[]),i.first_row&&delete i.first_row,i.page>1&&(i.first_row=JSON.stringify(u.value[0]));const{data:s,error:a,status:_}=await x("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:i,retry:0});if(v().loading_full=!1,r.value.may_get_data=!0,_.value==="error"){S().trigger(a);return}r.value.page==1?(u.value=s.value.data,B.value&&(B.value.scrollTop=0)):r.value.page>1&&(u.value=[...u.value,...s.value.data]),s.value.data.length==0&&(r.value.is_last_record=!0)},q=async()=>{if(!r.value.may_get_data)return;let s=B.value;if(s.scrollLeft!=r.value.scrollLeft){r.value.scrollLeft=s.scrollLeft;return}r.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(r.value.page++,await L())},Z=()=>{r.value.page=1,r.value.is_last_record=!1,J(),L()};gt();const C=n(!1),H=n(0),G=()=>{H.value=0,C.value=!0},{display:N}=O();yt(O());const Q=()=>{d.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(H.value=u.value[d.value].id,C.value=!0)},V=n({}),D=n(!1),W=async()=>{D.value&&(D.value=!1)},X=()=>{d.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(V.value={id:u.value[d.value].id},D.value=!0)},tt=async()=>{v().loading_full=!0;const s=new FormData;s.append("id",u.value[d.value].id),s.append("_method","DELETE");const{data:a,error:_,status:k}=await x("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:s,retry:0});if(v().loading_full=!1,k.value==="error"){S().trigger(_);return}u.value.splice(d.value,1),d.value=-1,D.value=!1},{downloadFile:et,viewFile:se}=_t(),j=n(!1),P=n(""),E=async()=>{if(j.value==!0){j.value=!1;return}if(d.value==-1){N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}v().loading_full=!0;const{data:s,error:a,status:_}=await x("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{id:u.value[d.value].id},retry:0});if(v().loading_full=!1,_.value==="error"){S().trigger(a);return}P.value=s.value,j.value=!0},lt=()=>{et(P.value)};return(s,a)=>{const _=it,k=ut,A=rt,y=ct,g=pt,at=ft,ot=vt,st=dt,nt=mt;return w(),b("div",St,[p(_,{title:"List Transaction"}),t("div",Ht,[t("div",Nt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=e=>G())},[p(k)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=e=>Q())},[p(A)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=e=>X())},[p(y)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=e=>E())},[p(g)])]),t("form",Pt,[t("div",Ft,[zt,z(t("input",{class:"",type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>wt(c)?c.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[bt,l(c)]])]),t("div",It,[Lt,z(t("select",{class:"","onUpdate:modelValue":a[5]||(a[5]=e=>l(h).field=e)},Et,512),[[Y,l(h).field]])]),t("div",Ot,[Yt,z(t("select",{class:"","onUpdate:modelValue":a[6]||(a[6]=e=>l(h).by=e)},Kt,512),[[Y,l(h).by]])]),t("div",Jt,[t("button",{class:"",type:"submit",name:"button",onClick:a[7]||(a[7]=Tt(e=>Z(),["prevent"]))},[p(at,{class:"text-2xl"})])])]),t("div",qt,[l(u).length==0?(w(),b("div",Zt," Maaf Tidak Ada Record ")):(w(),b("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:B,onScroll:q},[t("table",Gt,[Qt,t("tbody",null,[(w(!0),b(Dt,null,At(l(u),(e,F)=>(w(),b("tr",{key:F,onClick:ne=>d.value=F,class:Mt(l(d)==F?"active":"")},[t("td",Xt,o(e.id),1),t("td",null,o(e.tanggal?l(m)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,o(e.xto),1),t("td",null,o(e.tipe),1),t("td",null,o(e.jenis),1),t("td",null,o(l(f)(e.amount)),1),t("td",null,o(e.pv_no),1),t("td",null,o(l(f)(e.pv_total)),1),t("td",null,o(e.ticket_a_no),1),t("td",null,o(l(f)(e.ticket_a_bruto)),1),t("td",null,o(l(f)(e.ticket_a_tara)),1),t("td",null,o(l(f)(e.ticket_a_netto)),1),t("td",null,o(e.ticket_a_supir),1),t("td",null,o(e.ticket_a_no_pol),1),t("td",null,o(l(m)(e.ticket_a_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(m)(e.ticket_a_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.ticket_b_no),1),t("td",null,o(l(f)(e.ticket_b_bruto)),1),t("td",null,o(l(f)(e.ticket_b_tara)),1),t("td",null,o(l(f)(e.ticket_b_netto)),1),t("td",null,o(e.ticket_b_supir),1),t("td",null,o(e.ticket_b_no_pol),1),t("td",null,o(l(m)(e.ticket_b_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(m)(e.ticket_b_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.supir),1),t("td",null,o(e.no_pol),1),t("td",null,o(e.created_at?l(m)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,o(e.updated_at?l(m)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Wt))),128))])])],544))])]),p(ot,{type:"delete",show:l(D),data:l(V),fnClose:W,fnConfirm:tt},null,8,["show","data"]),p(st,{show:l(C),fnClose:()=>{C.value=!1},id:l(H),p_data:l(u),list_ujalan:l(R),list_ticket:l(U),list_pv:l(K)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(j)?(w(),b("div",te,[t("div",ee,[t("div",le,[p(nt,{style:{color:"black",cursor:"pointer"},onClick:a[8]||(a[8]=e=>E())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(P).dataBase64},null,8,ae),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:a[9]||(a[9]=e=>lt())})])])):xt("",!0)])}}};export{we as default};
