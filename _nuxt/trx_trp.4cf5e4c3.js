import{_ as te}from"./HeaderPopup.vue.174cb466.js";import{_ as ae}from"./client-only.6c28f54f.js";import{_ as le}from"./WidthMiniList.vue.310b7084.js";import{r as w,g as oe,i as C,f as K,I as se,k as S,J as V,o as c,c as v,a as s,b as x,l,w as ne,E as ie,t as m,v as Y,F as z,D as R,A as re,n as I,C as _e,G as de,x as N,y as T,H as ue}from"./entry.76310763.js";import{u as A}from"./useUtils.010c4004.js";import{u as M}from"./useMyFetch.0a78e1d7.js";import"./Times.462b07df.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.e20fdef0.js";const pe={class:"box-fixed"},ce={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ve={class:"w-full flex flex-col items-center grow overflow-auto"},me={class:"w-full flex flex-row flex-wrap"},fe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ge=s("label",{for:""},"U.Jalan Per",-1),he={key:0,class:"grow"},we={key:1,class:"grow"},ye={class:"text-red-500"},ke={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},xe=s("label",{for:""},"Jenis",-1),Ne=["disabled"],be=ue('<option value="TBS">TBS</option><option value="TBSK">TBSK</option><option value="CPO">CPO</option><option value="PK">PK</option><option value="LAIN">LAIN</option>',5),Se=[be],Oe={class:"text-red-500"},Je={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},je=s("label",{for:""},"Payment Method",-1),De=["disabled"],Ce=["value"],Ae={class:"text-red-500"},Be={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Ie=s("label",{for:""},"No Pol",-1),Te=["disabled"],Me={id:"vehicle"},Pe=["value"],Fe={class:"text-red-500"},Ee={key:0,class:"w-full flex flex-wrap"},$e={class:"w-full flex flex-col flex-wrap p-1"},Le=s("label",{for:""},"Uang Jalan",-1),Ue={class:"text-red-500"},qe={key:1,class:"w-full flex flex-wrap"},Ke={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Ve=s("label",{for:""},"Supir",-1),Ye={class:"text-red-500"},ze={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Re=s("label",{for:""},"Kernet",-1),Ge={class:"text-red-500"},He={class:"w-full flex items-center justify-end"},st={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(O){const _=O,{$moment:P}=de(),{pointFormat:F}=A(),J={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir_id:"",supir:"",kernet_id:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:"",transition_type:"",payment_method_id:2,payment_method:{id:0,name:""},uj:{}};let b={...J};const a=w({...J}),B=oe("token"),d=w({}),G=async()=>{N().loading_full=!0,d.value={};const e=new FormData;e.append("tanggal",P(a.value.tanggal).format("Y-MM-DD")),e.append("jenis",a.value.jenis),e.append("id_uj",f.value.id),e.append("payment_method_id",a.value.payment_method_id),e.append("no_pol",a.value.no_pol),e.append("supir_id",r.value.id),e.append("kernet_id",i.value.id);let t="post",p=_.id;p==0||(e.append("id",p),e.append("_method","PUT"));const{data:o,error:y,status:g}=await M("/trx_trp",{method:t,headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:e,retry:0});if(N().loading_full=!1,g.value==="error"){T().trigger(y,d);return}a.value.supir=r.value.name,a.value.supir_rek_no=r.value._.rek_no.val,a.value.supir_rek_name=r.value._.rek_name.val,a.value.kernet=i.value.name,a.value.kernet_rek_no=i.value._.rek_no.val,a.value.kernet_rek_name=i.value._.rek_name.val,a.value.uj=f.value._raw;let h=D.value.map(k=>k.id).indexOf(a.value.payment_method_id);if(a.value.payment_method={...D.value[h]},a.value.updated_at=o.value.updated_at,_.id<=0)a.value.id=o.value.id,a.value.created_at=o.value.created_at,_.p_data.unshift(a.value);else{let k=_.p_data.map(n=>n.id).indexOf(_.id);k>=-1&&_.p_data.splice(k,1,{...a.value})}_.fnClose()},H=C(()=>L.value.filter(e=>e.jenis==a.value.jenis)),u={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:"",note:""},r=w(JSON.parse(JSON.stringify(u))),i=w(JSON.parse(JSON.stringify(u))),E=C(()=>{let e=[];return q.value.forEach((t,p)=>{let o=JSON.parse(JSON.stringify(u));o._.id.val=t.id,o._.name.val=t.name,o._.rek_no.val=t.rek_no,o._.rek_name.val=t.rek_name,o.id=t.id,o.name=t.name,o.title=(t.rek_no||"")+" "+(t.rek_name||""),o.note=Q(t),o._raw=t,e.push(JSON.parse(JSON.stringify(o)))}),e}),j={_raw:{},_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},xto:{tcon:"IconsLocationOn",text:"Tujuan",val:""},asst_opt:{tcon:"IconsPerson",text:"Info",val:""},tipe:{tcon:"",text:"Tipe",val:""},harga:{tcon:"IconsMoney",text:"Amount",val:""}},id:"",name:"",title:"",note:""},f=w(JSON.parse(JSON.stringify(j))),$=e=>{let t=JSON.parse(JSON.stringify(j));return t._.id.val=e.id,t._.xto.val=e.xto,t._.asst_opt.val=e.asst_opt,t._.tipe.val=e.tipe,t._.harga.val=F(e.harga),t.id=e.id,t.name=e.xto,t.title=(e.asst_opt||"")+" "+(e.tipe||"")+" "+(F(e.harga)||""),t._raw=e,t},W=C(()=>{let e=[];return H.value.forEach((t,p)=>{e.push(JSON.parse(JSON.stringify($(t))))}),e}),Q=e=>e.potongan?"Akan ada potong sebesar :"+A().pointFormat(e.potongan.nominal_cut):"",X=C(()=>!1),Z=async()=>{N().loading_full=!0;const{data:e,error:t,status:p}=await M("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{id:_.id},retry:0});if(N().loading_full=!1,p.value==="error"){T().trigger(t);return}let o=e.value.data;a.value=o,b={...o},r.value._.id.val=o.supir_id,r.value._.name.val=o.supir,r.value._.rek_no.val=o.supir_rek_no,r.value._.rek_name.val=o.supir_rek_name,r.value.id=o.supir_id,r.value.name=o.supir,r.value.rek_no=(o.supir_rek_no||"")+" "+(o.supir_rek_name||""),i.value._.id.val=o.kernet_id,i.value._.name.val=o.kernet,i.value._.rek_no.val=o.kernet_rek_no,i.value._.rek_name.val=o.kernet_rek_name,i.value.id=o.kernet_id,i.value.name=o.kernet,i.value.rek_no=(o.kernet_rek_no||"")+" "+(o.kernet_rek_name||""),f.value=$(o.uj);let y=0,g=0;o.potongan.forEach(h=>{h.potongan_mst.employee_id==o.supir_id&&(y+=parseInt(h.nominal_cut)),h.potongan_mst.employee_id==o.kernet_id&&(g+=parseInt(h.nominal_cut))}),y>0&&(r.value.note="Telah di potong sebesar :"+A().pointFormat(y)),g>0&&(i.value.note="Telah di potong sebesar :"+A().pointFormat(g)),_.fnLoadDBData()},L=w([]),U=w([]),q=w([]),D=w([]),ee=async()=>{N().loading_full=!0;const{data:e,error:t,status:p}=await M("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},retry:0});if(N().loading_full=!1,p.value==="error"){T().trigger(t);return}L.value=e.value.list_ujalan,U.value=e.value.list_vehicle,q.value=e.value.list_employee,D.value=e.value.list_payment_methods};return K(()=>_.show,async(e,t)=>{e==!0&&(await ee(),await _.fnLoadDBData(),a.value={...J},b={...J},r.value=JSON.parse(JSON.stringify(u)),i.value=JSON.parse(JSON.stringify(u)),f.value=JSON.parse(JSON.stringify(j)),d.value={},_.id!=0&&Z())},{immediate:!0}),K(()=>f.value._raw,(e,t)=>{e&&Object.keys(e).length===0&&e.constructor===Object?(r.value=JSON.parse(JSON.stringify(u)),i.value=JSON.parse(JSON.stringify(u)),a.value.transition_target="",a.value.transition_type=""):e.asst_opt&&e.asst_opt=="TANPA KERNET"&&(i.value=JSON.parse(JSON.stringify(u)),e.transition_from&&(a.value.transition_target=e.transition_from,a.value.transition_type="From"))},{deep:!0,immediate:!0}),(e,t)=>{var h,k;const p=te,o=se("vue-date-picker"),y=ae,g=le;return S((c(),v("section",pe,[s("div",null,[x(p,{title:"Form Transaction",fn:O.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("form",ce,[s("div",ve,[s("div",me,[s("div",fe,[ge,l(a).val!==1?(c(),v("div",he,[x(y,null,{default:ne(()=>[x(o,{modelValue:l(a).tanggal,"onUpdate:modelValue":t[0]||(t[0]=n=>l(a).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(c(),v("div",we,[s("div",{class:ie(["card-border disabled",l(a).pvr_no!=""?"unselectable":""])},m(l(a).tanggal?l(P)(l(a).tanggal).format("DD-MM-YYYY"):""),3)])),s("p",ye,m(l(d).tanggal),1)]),s("div",ke,[xe,S(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>l(a).jenis=n),disabled:l(a).val==1},Se,8,Ne),[[Y,l(a).jenis]]),s("p",Oe,m(l(d).jenis),1)]),s("div",Je,[je,S(s("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>l(a).payment_method_id=n),disabled:l(a).val==1},[(c(!0),v(z,null,R(l(D),n=>(c(),v("option",{value:n.id},m(n.name),9,Ce))),256))],8,De),[[Y,l(a).payment_method_id]]),s("p",Ae,m(l(d).payment_method_id),1)]),s("div",Be,[Ie,S(s("input",{type:"text",list:"vehicle","onUpdate:modelValue":t[3]||(t[3]=n=>l(a).no_pol=n),disabled:l(a).val==1},null,8,Te),[[re,l(a).no_pol]]),s("datalist",Me,[(c(!0),v(z,null,R(l(U),n=>(c(),v("option",{value:n.no_pol},m(n.no_pol),9,Pe))),256))]),s("p",Fe,m(l(d).no_pol),1)]),l(a).jenis!=""?(c(),v("div",Ee,[s("div",$e,[Le,x(g,{arr:l(W),selected:l(f),pure:j,onSetSelected:t[4]||(t[4]=n=>f.value=n),disabled:l(b).supir_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",Ue,m(l(d).id_uj),1)])])):I("",!0),(h=l(f)._raw)!=null&&h.asst_opt?(c(),v("div",qe,[s("div",Ke,[Ve,x(g,{arr:l(E),selected:l(r),pure:u,onSetSelected:t[5]||(t[5]=n=>r.value=n),disabled:l(b).supir_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",Ye,m(l(d).supir_id),1)]),S(s("div",ze,[Re,x(g,{arr:l(E),selected:l(i),pure:u,onSetSelected:t[6]||(t[6]=n=>i.value=n),disabled:l(b).kernet_id>1||l(a).val1==1},null,8,["arr","selected","disabled"]),s("p",Ge,m(l(d).kernet_id),1)],512),[[V,((k=l(f)._raw)==null?void 0:k.asst_opt)=="DENGAN KERNET"]])])):I("",!0)])]),s("div",He,[s("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[7]||(t[7]=n=>O.fnClose())}," Cancel "),l(X)?I("",!0):(c(),v("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[8]||(t[8]=_e(n=>G(),["prevent"]))}," Save "))])])])],512)),[[V,O.show]])}}};export{st as default};
