import ze from"./Header.03e7a2d6.js";import He from"./Plus.65c643ff.js";import Le from"./Edit.4a5f5c83.js";import Ke from"./Eyes.cbfb973a.js";import Je from"./Delete.223ccfcd.js";import Ge from"./Void.f615158b.js";import Ze from"./Signature.e8618d1b.js";import Qe from"./PrinterEye.2caa32c1.js";import We from"./Image.03b70965.js";import Xe from"./Line.10b9c470.js";import et from"./Check.30560ade.js";import tt from"./TableView.44be2b45.js";import{_ as at}from"./PopupMini.vue.32511e96.js";import lt from"./trx_trp.05381f72.js";import ot from"./trx_trp_validasi.800bd0bb.js";import nt from"./trx_absen.7c65317c.js";import{r as s,I as Q,h as rt,k as st,K as M,z as it,c as $,b as f,a as c,n as W,C as dt,m as l,B as X,G as C,d as S,E as ut,t as ee,w as y,l as _t,x as u,y as q,o as p,J as x,q as pe,L as pt,H as vt}from"./entry.e204f976.js";import{u as A}from"./useMyFetch.6be3d84a.js";import{u as ct}from"./useDownload.737fa5e3.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.8acc9d3d.js";import"./Adjust.b0530194.js";import"./TableHeaderEye.a596abee.js";import"./Times.3b7905e2.js";import"./ClearAll.8df5af62.js";import"./client-only.c132b00b.js";import"./ClearEach.e1dffa81.js";import"./CaretLeftDoubleBold.68b56186.js";import"./CaretLeftBold.359effb5.js";import"./CaretRightBold.e192ef1c.js";import"./CaretRightDoubleBold.93cf1dcc.js";import"./useUtils.8fe8bb8e.js";import"./Exclamation.d1d51ef6.js";import"./HeaderPopup.vue.08540e42.js";import"./WidthMiniList.vue.7cd05ea1.js";import"./WidthMiniPart.vue.93df62e9.js";const ft={class:"w-full h-full flex flex-col"},mt={class:"w-full flex grow flex-col overflow-auto h-0"},yt={class:"w-full flex justify-between flex-wrap"},bt={class:"grow flex"},kt={class:"m-1"},gt=pt('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),xt=[gt],ht={class:"flex"},wt=c("span",{class:"text-xs"},"Mode",-1),Dt={class:"grow mb-5"},$t=c("b",null,"tidak dapat dibatalkan lagi",-1),Ct={class:"grow mb-5"},_a={__name:"index",async setup(qt){let j,te;const{$moment:ae}=vt(),U=t=>t.deleted==1?"!bg-red-400":t.pvr_id>0&&t.req_deleted==1?"!bg-yellow-300":t.pv_id>0?"!bg-blue-300":"",Y=t=>(t.map(e=>{e.class_h=U(e)}),t),b=s("pv_not_done");Q(()=>b.value,t=>{ue.value.map(e=>{let i=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(e.key)>-1;return["all","deleted","req_deleted"].indexOf(t)>-1?i&&(e.tbl_show=1):i&&(e.tbl_show=0),e}),re()},{immediate:!1});const _={};_._TimeZoneOffset=new Date().getTimezoneOffset(),_.sort="tanggal:desc";const le=s({}),V=s({from:"",to:""}),h=rt("token"),{data:ve}=([j,te]=st(async()=>_t(async()=>{u().loading_full=!0;let t=[];const[e,i]=await Promise.all([A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{filter_status:b},retry:0})]);return e.status.value!=="error"&&(t=Y(e.data.value.data)),e.status.value==="error"?(q().trigger(e.error),{trx_trps:t}):(u().loading_full=!1,{trx_trps:t})},"$pFLmKcrKj9")),j=await j,te(),j),n=s(ve.value.trx_trps||[]),oe=s([]),w=s(!1),ce=async()=>{u().loading_full=!0;const{data:t,error:e,status:i}=await A("/trx_load_cost_center",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{online_status:w.value},retry:0});if(u().loading_full=!1,i.value==="error"){q().trigger(e);return}oe.value=t.value.list_cost_center},z=s({field:"tanggal",by:"desc"}),a=s(-1),v=M(()=>n.value[a.value]),m=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),fe=()=>{_.like="";let t=JSON.parse(JSON.stringify(u()._tv.global_keyword));t!=""&&(_.like=`id:%${t}%,xto:%${t}%,jenis:%${t}%,pv_no:%${t}%,ticket_a_no:%${t}%,ticket_b_no:%${t}%,no_pol:%${t}%,supir:%${t}%,kernet:%${t}%,cost_center_code:%${t}%,cost_center_desc:%${t}%,pvr_no:%${t}%,tanggal:%${t}%,transition_target:%${t}%`),_.sort="",z.value.field&&(_.sort=z.value.field+":"+z.value.by),_.date_from=V.value.from?ae(V.value.from).format("YYYY-MM-DD"):"",_.date_to=V.value.to?ae(V.value.to).format("YYYY-MM-DD"):"",_.filter_model=JSON.stringify(u()._tv.filter_model)},ne=async()=>{u().loading_full=!0,le.value={},m.value.may_get_data=!1,_.page=m.value.page,_.page==1&&(n.value=[]),_.first_row&&delete _.first_row,_.page>1&&(_.first_row=JSON.stringify(n.value[0])),_.filter_status=b.value;const{data:t,error:e,status:i}=await A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:_,retry:0});if(u().loading_full=!1,m.value.may_get_data=!0,i.value==="error"){q().trigger(e,le);return}m.value.page==1?n.value=Y(t.value.data):m.value.page>1&&(n.value=[...n.value,...Y(t.value.data)]),t.value.data.length==0&&(m.value.is_last_record=!0),u()._tv.filter_box=!1},re=()=>{a.value=-1,m.value.page=1,m.value.is_last_record=!1,fe(),ne()},F=s(!1),H=s(0),me=()=>{H.value=0,F.value=!0},{display:D}=it(),ye=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(H.value=n.value[a.value].id,F.value=!0)},R=s(!1),L=s(0),K=s(!1),be=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=n.value[a.value].id,R.value=!0,K.value=!1)},ke=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=n.value[a.value].id,R.value=!0,K.value=!0)},J=s(!1),se=s(0),ge=t=>{se.value=t,J.value=!0},G=s(!1),ie=s({}),B=s(!1),T=s(""),xe=async()=>{B.value&&(B.value=!1)},he=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(T.value="",ie.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},B.value=!0)};Q(()=>T.value,t=>{t.trim().length>0?G.value=!0:G.value=!1},{immediate:!1});const we=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",T.value),t.append("_method","DELETE");const{data:e,error:i,status:k}=await A("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,k.value==="error"){q().trigger(i);return}let r={...n.value[a.value]};r.deleted=e.value.deleted,r.deleted_user=e.value.deleted_user,r.deleted_at=e.value.deleted_at,r.deleted_by=e.value.deleted_by,r.deleted_reason=e.value.deleted_reason,r.class_h=U(r),b.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...r}),a.value=-1,B.value=!1},Z=s(!1),de=s({}),N=s(!1),P=s(""),De=async()=>{N.value&&(N.value=!1)},$e=()=>{a.value==-1?D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value="",de.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},N.value=!0)};Q(()=>P.value,t=>{t.trim().length>0?Z.value=!0:Z.value=!1},{immediate:!1});const Ce=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("req_deleted_reason",P.value),t.append("_method","DELETE");const{data:e,error:i,status:k}=await A("/trx_trp_req_delete",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,k.value==="error"){q().trigger(i);return}let r={...n.value[a.value]};r.req_deleted=e.value.req_deleted,r.req_deleted_user=e.value.req_deleted_user,r.req_deleted_by=e.value.req_deleted_by,r.req_deleted_at=e.value.req_deleted_at,r.req_deleted_reason=e.value.req_deleted_reason,r.class_h=U(r),b.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...r}),a.value=-1,N.value=!1},{printHtml:qe}=ct(),Ae=async()=>{if(a.value==-1){D({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}u().loading_full=!0;const{data:t,error:e,status:i}=await A("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:n.value[a.value].id},retry:0});if(u().loading_full=!1,i.value==="error"){q().trigger(e);return}qe(t.value.html,318)},Oe=async()=>{u().loading_full=!0;const t=new FormData;t.append("online_status",w.value);const{data:e,error:i,status:k}=await A("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,k.value==="error"){q().trigger(i);return}e.value.forEach(r=>{let g=n.value.map(d=>d.id).indexOf(r.id);if(g!==-1){let d=n.value[g];d.pvr_id=r.pvr_id,d.pvr_no=r.pvr_no,d.pvr_total=r.pvr_total,d.pvr_had_detail=r.pvr_had_detail,d.updated_at=r.updated_at,n.value.splice(g,1,{...d})}}),D({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},Se=async()=>{u().loading_full=!0;const t=new FormData;t.append("online_status",w.value);const{data:e,error:i,status:k}=await A("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,k.value==="error"){q().trigger(i);return}e.value.data.forEach(r=>{let g=n.value.map(d=>d.id).indexOf(r.id);if(g!==-1){let d=n.value[g];d.pv_id=r.pv_id,d.pv_no=r.pv_no,d.pv_total=r.pv_total,d.pv_datetime=r.pv_datetime,d.updated_at=r.updated_at,n.value.splice(g,1,{...d})}}),D({show:!0,status:"Success",message:"Update PV Done"})},ue=s([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),Te=M(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,0].indexOf(v.value.val1)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1),Pe=M(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,0].indexOf(v.value.val)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1),Me=M(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&[void 0,""].indexOf(v.value.pvr_id)>-1),Be=M(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1&&v.value.pvr_id!=""),Ne=M(()=>a.value>-1&&[void 0,0].indexOf(v.value.deleted)>-1&&[void 0,0].indexOf(v.value.req_deleted)>-1);return(t,e)=>{const i=ze,k=He,r=Le,g=Ke,d=Je,je=Ge,Ve=Ze,Fe=Qe,Re=We,E=Xe,I=et,Ee=tt,_e=at,Ie=lt,Ue=ot,Ye=nt;return p(),$("div",ft,[f(i,{title:"List Transaction"}),c("div",mt,[c("div",yt,[c("div",bt,[c("div",kt,[W(c("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>X(b)?b.value=o:null)},xt,512),[[dt,l(b)]])]),["pv_not_done","all"].indexOf(l(b))>-1?(p(),$("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>me())},[f(k)])):C("",!0),l(Te)?(p(),$("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>ye())},[f(r)])):C("",!0),l(a)>-1?(p(),$("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>ke())},[f(g)])):C("",!0),l(Me)?(p(),$("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>he())},[f(d)])):C("",!0),l(Be)?(p(),$("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>$e())},[f(je)])):C("",!0),l(Pe)?(p(),$("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>be())},[f(Ve)])):C("",!0),l(Ne)?(p(),$("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>Ae())},[f(Fe)])):C("",!0)]),c("div",ht,[c("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[8]||(e[8]=o=>Oe())}," Gen/Update PVR "),c("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[9]||(e[9]=o=>Se())}," Update PV "),c("div",{class:"m-1 card-border cursor-pointer",onClick:e[10]||(e[10]=o=>w.value=!l(w))},[wt,S(" : "),c("span",{class:ut(["font-bold",l(w)?"text-green-600":"text-red-600"])},ee(l(w)?"ONLINE":"OFFLINE"),3)])])]),f(Ee,{thead:l(ue),selected:l(a),onSetSelected:e[11]||(e[11]=o=>a.value=o),tbody:l(n),fnCallData:ne,scrolling:l(m),onSetScrollingPage:e[12]||(e[12]=o=>l(m).page=o),onDoFilter:e[13]||(e[13]=o=>re())},{absen:y(({item:o,index:O})=>[o.trx_absens&&o.trx_absens.length>0?(p(),x(Re,{key:0,class:"cursor-pointer",onClick:At=>ge(O)},null,8,["onClick"])):C("",!0)]),val:y(({item:o})=>[o.val?(p(),x(I,{key:1})):(p(),x(E,{key:0}))]),val1:y(({item:o})=>[o.val1?(p(),x(I,{key:1})):(p(),x(E,{key:0}))]),val2:y(({item:o})=>[o.val2?(p(),x(I,{key:1})):(p(),x(E,{key:0}))]),pvr_had_detail:y(({item:o})=>[o.pvr_had_detail?(p(),x(I,{key:1})):(p(),x(E,{key:0}))]),deleted_by_username:y(({item:o})=>{var O;return[S(ee((O=o.deleted_by)==null?void 0:O.username),1)]}),req_deleted_by_username:y(({item:o})=>{var O;return[S(ee((O=o.req_deleted_by)==null?void 0:O.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),f(_e,{type:"delete",show:l(B),data:l(ie),fnClose:xe,fnConfirm:we,enabledOk:l(G)},{footer:y(()=>[S(" Masukkan Alasan Penghapusan: "),c("div",Dt,[W(c("textarea",{"onUpdate:modelValue":e[14]||(e[14]=o=>X(T)?T.value=o:null)},null,512),[[pe,l(T)]])])]),_:1},8,["show","data","enabledOk"]),f(_e,{type:"custome",show:l(N),data:l(de),fnClose:De,fnConfirm:Ce,enabledOk:l(Z)},{words:y(()=>[S(" Data akan diproses dan "),$t,S(", yakin untuk melanjutkan ? ")]),footer:y(()=>[S(" Masukkan Alasan Permintaan Penghapusan: "),c("div",Ct,[W(c("textarea",{"onUpdate:modelValue":e[15]||(e[15]=o=>X(P)?P.value=o:null)},null,512),[[pe,l(P)]])])]),_:1},8,["show","data","enabledOk"]),f(Ie,{show:l(F),fnClose:()=>{F.value=!1},fnLoadDBData:ce,id:l(H),p_data:l(n),list_cost_center:l(oe),online_status:l(w)},null,8,["show","fnClose","id","p_data","list_cost_center","online_status"]),f(Ue,{show:l(R),fnClose:()=>{R.value=!1},id:l(L),p_data:l(n),is_view:l(K)},null,8,["show","fnClose","id","p_data","is_view"]),f(Ye,{show:l(J),fnClose:()=>{J.value=!1},index:l(se),p_data:l(n)},null,8,["show","fnClose","index","p_data"])])}}};export{_a as default};
