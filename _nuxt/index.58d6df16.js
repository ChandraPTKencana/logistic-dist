import{r as n,f as T,g as fe,h as ye,i as D,j as q,s as he,c as A,a as r,b as v,k as G,v as be,l,m as Z,n as B,w as h,F as ge,q as ke,x as _,y as $,o as p,z as C,d as E,t as K,A as xe,B as Q,_ as W,p as we,e as De}from"./entry.53fce88d.js";import Ae from"./Header.e0343497.js";import Ce from"./Plus.92044684.js";import Se from"./Edit.30fc6340.js";import Oe from"./Delete.570902ee.js";import Pe from"./Line.82af2390.js";import Ie from"./Check.d53ffe50.js";import Te from"./TypeIcon.70d5e334.js";import Be from"./TableView.62d69304.js";import{u as M}from"./useMyFetch.bdb404b5.js";import{u as V}from"./useUtils.483f3866.js";import{_ as $e}from"./_plugin-vue_export-helper.c27b6911.js";import"./DocJPEG.cec762b8.js";import"./DocJPG.2ee75ece.js";import"./DocPNG.48cab1ad.js";import"./DocPDF.8071ebc2.js";import"./Search.b29f9ee0.js";import"./Adjust.16e8fe9a.js";import"./TableHeaderEye.38334467.js";import"./Times.afe9e524.js";import"./ClearAll.1bba4582.js";import"./client-only.39d007ad.js";import"./ClearEach.b1a6d953.js";import"./CaretLeftDoubleBold.12027468.js";import"./CaretLeftBold.f6ea44d2.js";import"./CaretRightBold.b7dc87e5.js";import"./CaretRightDoubleBold.cb4caae4.js";const Ee=Q(()=>W(()=>import("./PopupMini.e66739fa.js"),["./PopupMini.e66739fa.js","./PopupMini.vue.824f527c.js","./Times.afe9e524.js","./_plugin-vue_export-helper.c27b6911.js","./entry.53fce88d.js","./entry.c5f8f180.css","./Exclamation.23c0198d.js"],import.meta.url).then(i=>i.default||i)),Me=Q(()=>W(()=>import("./vehicle.ace3cd8e.js"),["./vehicle.ace3cd8e.js","./HeaderPopup.vue.2a33db0a.js","./Times.afe9e524.js","./_plugin-vue_export-helper.c27b6911.js","./entry.53fce88d.js","./entry.c5f8f180.css","./useMyFetch.bdb404b5.js"],import.meta.url).then(i=>i.default||i)),z=i=>(we("data-v-4b5e1de6"),i=i(),De(),i),Ve={class:"w-full h-full flex flex-col"},ze={class:"w-full flex grow flex-col overflow-auto h-0"},Ne={class:"w-full flex justify-between flex-wrap"},Fe={class:"grow flex"},Le={class:"m-1"},He=z(()=>r("option",{value:"available"},"Available",-1)),je=z(()=>r("option",{value:"deleted"},"Trash",-1)),Re=z(()=>r("option",{value:"all"},"All",-1)),Ue=[He,je,Re],Je={class:"grow mb-5"},Ye={__name:"index",async setup(i){let x,N;const X=e=>e.deleted==1?"!bg-red-400":e.val==0?"!bg-gray-300":"",c=n("available");T(()=>c.value,e=>{H()},{immediate:!1});const d={};d._TimeZoneOffset=new Date().getTimezoneOffset();const S=fe("token"),{data:ee}=([x,N]=ye(async()=>ke(async()=>{let e=[];_().loading_full=!0;const{data:t,error:f,status:g}=await M("/vehicles",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{filter_status:c},retry:0});return _().loading_full=!1,g.value==="error"?($().trigger(f),[]):(e=t.value.data,{vehicles:e})},{lazy:!0,server:!1,default:()=>({vehicles:[]})},"$OEvmawoGm4")),x=await x,N(),x),s=n([]);T(()=>{var e;return(e=ee.value)==null?void 0:e.vehicles},e=>{e&&(s.value=[...e])},{immediate:!0}),n("");const O=n({field:"",by:"desc"}),o=n(-1),u=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),F=D(()=>s.value[o.value]),te=()=>{d.like="";let e=JSON.parse(JSON.stringify(_()._tv.global_keyword));e!=""&&(d.like=`id:%${e}%,no_pol:%${e}%`),d.sort="",O.value.field&&(d.sort=O.value.field+":"+O.value.by),d.filter_model=JSON.stringify(_()._tv.filter_model)},L=async()=>{_().loading_full=!0,u.value.may_get_data=!1,d.page=u.value.page,d.page==1&&(s.value=[]),d.filter_status=c.value;const{data:e,error:t,status:f}=await M("/vehicles",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:d,retry:0});if(_().loading_full=!1,u.value.may_get_data=!0,f.value==="error"){$().trigger(t);return}u.value.page==1?s.value=e.value.data:u.value.page>1&&(s.value=[...s.value,...e.value.data]),e.value.data.length==0&&(u.value.is_last_record=!0),_()._tv.filter_box=!1},H=()=>{o.value=-1,u.value.page=1,u.value.is_last_record=!1,te(),L()},w=n(!1),P=n(0),j=n(!1),ae=()=>{P.value=0,j.value=!1,w.value=!0},{display:R}=q();he(q());const le=()=>{o.value==-1?R({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(P.value=s.value[o.value].id,j.value=!1,w.value=!0)},I=n(!1),U=n({}),b=n(!1),y=n(""),oe=async()=>{b.value&&(b.value=!1)},se=()=>{o.value==-1?R({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(y.value="",U.value={id:s.value[o.value].id},b.value=!0)};T(()=>y.value,e=>{e.trim().length>0?I.value=!0:I.value=!1},{immediate:!1});const ne=async()=>{_().loading_full=!0;const e=new FormData;e.append("id",s.value[o.value].id),e.append("deleted_reason",y.value),e.append("_method","DELETE");const{data:t,error:f,status:g}=await M("/vehicle",{method:"post",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:e,retry:0});if(_().loading_full=!1,g.value==="error"){$().trigger(f);return}let m={...s.value[o.value]};m.deleted=t.value.deleted,m.deleted_user=t.value.deleted_user,m.deleted_at=t.value.deleted_at,m.deleted_by=t.value.deleted_by,m.deleted_reason=t.value.deleted_reason,c.value!="all"?s.value.splice(o.value,1):s.value.splice(o.value,1,{...m}),o.value=-1,b.value=!1},re=n([{key:"no",label:"No",isai:!0},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"no_pol",label:"No Pol",filter_on:1,type:"string",sort:{priority:1,type:"asc"}},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:1},{key:"deleted_at",label:"Deleted At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1,tbl_show:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:1,type:"string",filter_on:1}]),ie=D(()=>["available","all","unapprove"].indexOf(c.value)>-1&&V().checkPermission("vehicle.create")),de=D(()=>o.value>-1&&[void 0,0].indexOf(F.value.deleted)>-1&&V().checkPermissions(["vehicle.modify"])),ue=D(()=>o.value>-1&&V().checkPermission("vehicle.remove")&&[void 0,0].indexOf(F.value.deleted)>-1);return(e,t)=>{const f=Ae,g=Ce,m=Se,_e=Oe,J=Pe,Y=Ie,ce=Te,me=Be,ve=Ee,pe=Me;return p(),A(ge,null,[r("div",Ve,[v(f,{title:"List Vehicle"}),r("div",ze,[r("div",Ne,[r("div",Fe,[r("div",Le,[G(r("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=a=>Z(c)?c.value=a:null)},Ue,512),[[be,l(c)]])]),l(ie)?(p(),A("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>ae())},[v(g)])):B("",!0),l(de)?(p(),A("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>le())},[v(m)])):B("",!0),l(ue)?(p(),A("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>se())},[v(_e)])):B("",!0)])]),v(me,{thead:l(re),selected:l(o),onSetSelected:t[4]||(t[4]=a=>o.value=a),tbody:l(s),fnCallData:L,scrolling:l(u),onSetScrollingPage:t[5]||(t[5]=a=>l(u).page=a),onDoFilter:t[6]||(t[6]=a=>H()),rowBgColor:X},{val:h(({item:a})=>[a.val?(p(),C(Y,{key:1})):(p(),C(J,{key:0}))]),val1:h(({item:a})=>[a.val1?(p(),C(Y,{key:1})):(p(),C(J,{key:0}))]),bank_code:h(({item:a})=>{var k;return[E(K((k=a.bank)==null?void 0:k.code),1)]}),attachment_1_type:h(({item:a})=>[v(ce,{value:a.attachment_1_type},null,8,["value"])]),deleted_by_username:h(({item:a})=>{var k;return[E(K((k=a.deleted_by)==null?void 0:k.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])])]),v(ve,{type:"delete",show:l(b),data:l(U),fnClose:oe,fnConfirm:ne,enabledOk:l(I)},{footer:h(()=>[E(" Masukkan Alasan Penghapusan: "),r("div",Je,[G(r("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>Z(y)?y.value=a:null)},null,512),[[xe,l(y)]])])]),_:1},8,["show","data","enabledOk"]),v(pe,{show:l(w),fnClose:()=>{w.value=!1},id:l(P),p_data:l(s)},null,8,["show","fnClose","id","p_data"])],64)}}},gt=$e(Ye,[["__scopeId","data-v-4b5e1de6"]]);export{gt as default};
