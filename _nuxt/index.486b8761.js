import{_ as dt}from"./Header.5229fb2b.js";import{_ as pt}from"./PrinterEye.10fd9b27.js";import{_ as ft}from"./Table2Column.6d7c5a75.js";import{_ as bt}from"./Eyes.86e05d90.js";import{_ as mt}from"./Line.93246c3c.js";import{_ as yt}from"./Check.b50119df.js";import{_ as kt}from"./TableView.44365904.js";import{_ as ht}from"./PopupMini.vue.20e17d38.js";import{_ as vt}from"./Times.d78ccce2.js";import{_ as gt}from"./HeaderPopup.vue.c3fedf1e.js";import{r as _,f as xt,D as wt,B as Dt,H as V,I as St,J as $t,c as g,b as y,a,w as c,k as o,G as At,h as Tt,v as Ct,t as l,F as q,n as L,E as Bt,x as u,y as x,o as d,q as Mt,K as w,d as p,s as Pt}from"./entry.2ea6ee01.js";import{u as Z}from"./useUtils.35f2b1a7.js";import{u as D}from"./useMyFetch.f9b2b7b2.js";import{u as Nt}from"./useDownload.737fa5e3.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.b3832684.js";import"./client-only.92f847e9.js";const Ht={class:"w-full h-full flex flex-col"},Yt={class:"w-full flex grow flex-col overflow-auto h-0"},jt={class:"w-full flex"},Ft={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Kt={class:"relative",style:{width:"95%",height:"90%"}},Rt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ot=["src"],zt={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},It={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},Ut={class:"p-1 flex flex-wrap overflow-auto items-start"},Et={class:"w-full sm:w-1/2 flex flex-wrap"},Jt={class:"flex flex-col m-2"},Vt=a("span",{class:"text-xs"}," To ",-1),qt={class:""},Lt={class:"flex flex-col m-2"},Zt=a("span",{class:"text-xs"}," Tipe ",-1),Gt={class:""},Qt={class:"flex flex-col m-2"},Wt=a("span",{class:"text-xs"}," Jenis ",-1),Xt={class:""},te={class:"flex flex-col m-2"},ee=a("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),ae={class:""},se={class:"w-full sm:w-1/2 text-sm flex justify-center"},oe={class:"border border-collapse border-black"},le=a("tr",null,[a("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),re={class:"p-1"},ne={class:"p-1"},ie=a("td",{class:"p-1"},"= Rp.",-1),_e={class:"text-right p-1"},ce={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ue=a("th",{colspan:"2",class:"text-right"},"Total",-1),de=a("th",{class:"p-1 text-right"},"Rp.",-1),pe={class:"p-1 text-right"},fe={class:"w-full mt-2 text-sm flex justify-center"},be={class:"border border-collapse border-black"},me=a("tr",null,[a("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),ye={class:"p-1"},ke={class:"p-1"},he={class:"p-1"},ve=a("td",{class:"p-1"},"= Rp.",-1),ge={class:"text-right p-1"},xe={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},we=a("th",{colspan:"2",class:"text-right"},"Total",-1),De=a("th",{class:"p-1 text-right"},"Rp.",-1),Se={class:"p-1 text-right"},$e={class:"flex p-1 justify-end flex-wrap"},qe={__name:"index",async setup(Ae){let $,R;const{$moment:O}=Pt(),{pointFormat:i}=Z(),r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const M=_({}),h=xt("token"),A=_({from:"",to:""}),{data:G}=([$,R]=wt(async()=>Bt(async()=>{u().loading_full=!0;let e=[];const[s,n]=await Promise.all([D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},retry:0})]);return s.status.value!=="error"&&(e=s.data.value.data),s.status.value==="error"?(x().trigger(s.error),{trx_trps:e}):(u().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),$=await $,R(),$),b=_(G.value.trx_trps||[]),P=_({field:"tanggal",by:"desc"}),k=_(-1),f=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),N=()=>{r.like="";let e=JSON.parse(JSON.stringify(u()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_to:%${e}%`),r.sort="",P.value.field&&(r.sort=P.value.field+":"+P.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=A.value.from?O(A.value.from).format("YYYY-MM-DD"):"",r.date_to=A.value.to?O(A.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(u()._tv.filter_model)},z=_(null),I=async()=>{u().loading_full=!0,M.value={},f.value.may_get_data=!1,r.page=f.value.page,r.page==1&&(b.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(b.value[0]));const{data:e,error:s,status:n}=await D("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(u().loading_full=!1,f.value.may_get_data=!0,n.value==="error"){x().trigger(s,M);return}f.value.page==1?(b.value=e.value.data,z.value&&(z.value.scrollTop=0)):f.value.page>1&&(b.value=[...b.value,...e.value.data]),e.value.data.length==0&&(f.value.is_last_record=!0),u()._tv.filter_box=!1},Q=()=>{f.value.page=1,f.value.is_last_record=!1,N(),I()};Dt(),_(!1),_(0);const{display:W}=V();St(V());const X=_({}),T=_(!1),tt=async()=>{T.value&&(T.value=!1)},et=async()=>{u().loading_full=!0;const e=new FormData;e.append("id",b.value[k.value].id),e.append("_method","DELETE");const{data:s,error:n,status:v}=await D("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},body:e,retry:0});if(u().loading_full=!1,v.value==="error"){x().trigger(n);return}b.value.splice(k.value,1),k.value=-1,T.value=!1},{downloadFile:U,viewFile:Te}=Nt(),C=_(!1),H=_(""),E=async()=>{if(C.value==!0){C.value=!1;return}N(),u().loading_full=!0;const{data:e,error:s,status:n}=await D("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(u().loading_full=!1,n.value==="error"){x().trigger(s);return}H.value=e.value,C.value=!0},at=async()=>{N(),u().loading_full=!0;const{data:e,error:s,status:n}=await D("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:r,retry:0});if(u().loading_full=!1,n.value==="error"){x().trigger(s);return}U(e.value)},st=()=>{U(H.value)},J=e=>e.pv_id<=0||["CPO","PK"].indexOf(e.jenis)>-1&&(e.ticket_a_id<=0||e.ticket_b_bruto<=0||e.ticket_b_tara<=0||e.ticket_b_netto<=0||e.ticket_b_in_at==""||e.ticket_b_out_at=="")||e.jenis=="TBS"&&(e.ticket_a_id<=0||e.ticket_b_id<=0)||e.jenis=="TBSK"&&e.ticket_b_id<=0?0:1,ot=_([{key:"status",label:"Status",filter_on:1,sort_off:1,type:"select",select_item:["Undone","Done"]},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition_to",label:"Peralihan",filter_on:1,type:"select",select_item:["KPN","KAS","KUS","ARP","KAP","SMP"]},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),Y=(e,s)=>{e=parseFloat(e)||0,s=parseFloat(s)||0;let n=parseFloat(s-e),v=n>0?s:e;if(v==0)return 0;let S=Z().round(n/v*100,2);return S<0?"("+Math.abs(S*100)/100+")":S},j=(e,s)=>{e=parseFloat(e)||0,s=parseFloat(s)||0;let n=parseFloat(s-e);return n<0?"("+i(Math.abs(n))+")":i(n)},B=_(!1),m=_({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),lt=async()=>{k.value==-1&&W({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}),u().loading_full=!0;const{data:e,error:s,status:n}=await D("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${h.value}`,Accept:"application/json"},params:{id:b.value[k.value].id_uj},retry:0});if(u().loading_full=!1,n.value==="error"){x().trigger(s,M);return}m.value=e.value.data,B.value=!0},rt=$t(()=>{let e=0;return m.value.details2.forEach(s=>{s.p_status!="Remove"&&(e+=s.qty*s.amount)}),e});return(e,s)=>{const n=dt,v=pt,S=ft,nt=bt,F=mt,K=yt,it=kt,_t=ht,ct=vt,ut=gt;return d(),g("div",Ht,[y(n,{title:"Report Transaction"}),a("div",Yt,[a("div",jt,[a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:s[0]||(s[0]=t=>E())},[y(v)]),a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:s[1]||(s[1]=t=>at())},[y(S)]),a("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:s[2]||(s[2]=t=>lt())},[y(nt)])]),y(it,{thead:o(ot),selected:o(k),onSetSelected:s[3]||(s[3]=t=>k.value=t),tbody:o(b),fnCallData:I,scrolling:o(f),onSetScrollingPage:s[4]||(s[4]=t=>o(f).page=t),onDoFilter:s[5]||(s[5]=t=>Q())},{status:c(({item:t})=>[a("div",{class:Mt(["text-white text-xs px-2 py-1 rounded-lg",J(t)?"bg-green-600":"bg-red-600"])},l(J(t)?"Done":"Not Done"),3)]),val:c(({item:t})=>[t.val?(d(),w(K,{key:1})):(d(),w(F,{key:0}))]),val1:c(({item:t})=>[t.val1?(d(),w(K,{key:1})):(d(),w(F,{key:0}))]),pvr_had_detail:c(({item:t})=>[t.pvr_had_detail?(d(),w(K,{key:1})):(d(),w(F,{key:0}))]),susut_bruto_a:c(({item:t})=>[p(l(o(i)(t.ticket_a_bruto)),1)]),susut_tara_a:c(({item:t})=>[p(l(o(i)(t.ticket_a_tara)),1)]),susut_netto_a:c(({item:t})=>[p(l(o(i)(t.ticket_a_netto)),1)]),susut_bruto_b:c(({item:t})=>[p(l(o(i)(t.ticket_b_bruto)),1)]),susut_tara_b:c(({item:t})=>[p(l(o(i)(t.ticket_b_tara)),1)]),susut_netto_b:c(({item:t})=>[p(l(o(i)(t.ticket_b_netto)),1)]),susut_bruto_b_a:c(({item:t})=>[p(l(j(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:c(({item:t})=>[p(l(j(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:c(({item:t})=>[p(l(j(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:c(({item:t})=>[p(l(Y(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:c(({item:t})=>[p(l(Y(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:c(({item:t})=>[p(l(Y(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),y(_t,{type:"delete",show:o(T),data:o(X),fnClose:tt,fnConfirm:et},null,8,["show","data"]),o(C)?(d(),g("div",Ft,[a("div",Kt,[a("div",Rt,[y(ct,{style:{color:"black",cursor:"pointer"},onClick:s[6]||(s[6]=t=>E())})]),a("iframe",{ref:"iframe",width:"100%",height:"100%",src:o(H).dataBase64},null,8,Ot),a("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:s[7]||(s[7]=t=>st())})])])):At("",!0),Tt(a("div",zt,[a("div",It,[y(ut,{title:"Detail Information",fn:()=>{B.value=!1,e.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),a("div",Ut,[a("div",Et,[a("div",Jt,[Vt,a("div",qt,l(o(m).xto)+" ",1)]),a("div",Lt,[Zt,a("div",Gt,l(o(m).tipe),1)]),a("div",Qt,[Wt,a("div",Xt,l(o(m).jenis),1)]),a("div",te,[ee,a("div",ae,l(o(m).note_for_remarks),1)])]),a("div",se,[a("table",oe,[le,(d(!0),g(q,null,L(o(m).details,t=>(d(),g("tr",null,[a("td",re,l(t.ordinal)+". ",1),a("td",ne,l(t.xdesc)+" "+l(t.qty<=1?"":o(i)(t.qty||0)+" x Rp."+o(i)(t.harga||0)),1),ie,a("td",_e,l(o(i)(t.qty*t.harga)),1)]))),256)),a("tr",ce,[ue,de,a("th",pe,l(o(i)(o(m).harga)),1)])])]),a("div",fe,[a("table",be,[me,(d(!0),g(q,null,L(o(m).details2,t=>(d(),g("tr",null,[a("td",ye,l(t.ordinal)+". ",1),a("td",ke,l(t.ac_account_code),1),a("td",he,l(t.description)+" "+l(t.qty<=1?"":o(i)(t.qty||0)+" x Rp."+o(i)(t.amount||0)),1),ve,a("td",ge,l(o(i)(t.qty*t.amount)),1)]))),256)),a("tr",xe,[we,De,a("th",Se,l(o(i)(o(rt))),1)])])])]),a("div",$e,[a("button",{class:"rounded m-1",onClick:s[8]||(s[8]=t=>B.value=!1)}," Cancel ")])])],512),[[Ct,o(B)]])])}}};export{qe as default};
