import ne from"./Header.e8fbd9bd.js";import ie from"./PrinterEye.4c5e9411.js";import _e from"./Table2Column.ba25df6e.js";import ce from"./Eyes.ba527973.js";import de from"./Image.ca3764bd.js";import pe from"./Line.e332566a.js";import ue from"./Check.3fd5e058.js";import fe from"./TableView.ea517006.js";import me from"./Times.f23511d3.js";import{_ as ve}from"./HeaderPopup.vue.65289720.js";import{r as c,j as ye,f as he,g as be,G as ge,c as x,a as e,b as k,m as J,q as ke,k as s,n as xe,d as $,w as d,l as K,J as we,t as n,F as Y,y as L,z as De,A as _,B as A,o as a,D as i,H as $e,E as Ae}from"./entry.e36785a7.js";import{u as Ce}from"./useUtils.e0162c97.js";import{u as C}from"./useMyFetch.23ee3399.js";import{u as Te}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.81b0610a.js";import"./Adjust.481ab0ba.js";import"./TableHeaderEye.0a28cb84.js";import"./ClearAll.e692e47c.js";import"./client-only.0add4dc4.js";import"./ClearEach.21461e27.js";import"./CaretLeftDoubleBold.48a864f1.js";import"./CaretLeftBold.7bee16d8.js";import"./CaretRightBold.a98c9812.js";import"./CaretRightDoubleBold.88c7f373.js";const Re={class:"w-full h-full flex flex-col"},Se={class:"w-full flex grow flex-col overflow-auto h-0"},Me={class:"w-full flex justify-between flex-wrap"},Pe={class:"grow flex"},qe={class:"m-1"},Ne=$e('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ue=[Ne],Be=e("span",{class:"text-xs ml-1"}," PDF ",-1),Fe=e("span",{class:"text-xs ml-1"}," Excel ",-1),Ye={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},je={class:"relative",style:{width:"95%",height:"90%"}},ze={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},He=["src"],Ve={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},Ie={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},Ee={class:"p-1 flex flex-wrap overflow-auto items-start"},Je={class:"w-full sm:w-1/2 flex flex-wrap"},Ke={class:"flex flex-col m-2"},Le=e("span",{class:"text-xs"}," To ",-1),Oe={class:""},Ge={class:"flex flex-col m-2"},We=e("span",{class:"text-xs"}," Tipe ",-1),Ze={class:""},Qe={class:"flex flex-col m-2"},Xe=e("span",{class:"text-xs"}," Jenis ",-1),et={class:""},tt={class:"flex flex-col m-2"},ot=e("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),lt={class:""},st={class:"w-full sm:w-1/2 text-sm flex justify-center"},at={class:"border border-collapse border-black"},rt=e("tr",null,[e("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),nt={class:"p-1"},it={class:"p-1"},_t=e("td",{class:"p-1"},"= Rp.",-1),ct={class:"text-right p-1"},dt={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},pt=e("th",{colspan:"2",class:"text-right"},"Total",-1),ut=e("th",{class:"p-1 text-right"},"Rp.",-1),ft={class:"p-1 text-right"},mt={class:"w-full mt-2 text-sm flex justify-center"},vt={class:"border border-collapse border-black"},yt=e("tr",null,[e("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),ht={class:"p-1"},bt={class:"p-1"},gt={class:"p-1"},kt=e("td",{class:"p-1"},"= Rp.",-1),xt={class:"text-right p-1"},wt={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},Dt=e("th",{colspan:"2",class:"text-right"},"Total",-1),$t=e("th",{class:"p-1 text-right"},"Rp.",-1),At={class:"p-1 text-right"},Ct={class:"flex p-1 justify-end flex-wrap"},lo={__name:"finance",async setup(Tt){let T,j;const{$moment:z}=Ae(),{pointFormat:v}=Ce(),O=o=>o.deleted==1?"!bg-red-400":o.pvr_id>0&&o.req_deleted==1?"!bg-yellow-300":o.pv_id>0?"!bg-blue-300":"",P=o=>(o.map(l=>{l.class_h=O(l)}),o),y=c("pv_not_done");ye(()=>y.value,o=>{V()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const q=c({}),R=c({from:"",to:""}),w=he("token"),{data:G}=([T,j]=be(async()=>De(async()=>{_().loading_full=!0;let o=[];const[l,u]=await Promise.all([C("/trx_trps/dataFin",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return l.status.value!=="error"&&(o=P(l.data.value.data)),l.status.value==="error"?(A().trigger(l.error),{trx_trps:o}):(_().loading_full=!1,{trx_trps:o})},"$mHT2RIPzaD")),T=await T,j(),T),h=c(G.value.trx_trps||[]),N=c({field:"tanggal",by:"desc"}),D=c(-1),p=c({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),U=()=>{r.like="";let o=JSON.parse(JSON.stringify(_()._tv.global_keyword));o!=""&&(r.like=`id:%${o}%,xto:%${o}%,jenis:%${o}%,pv_no:%${o}%,ticket_a_no:%${o}%,ticket_b_no:%${o}%,no_pol:%${o}%,supir:%${o}%,kernet:%${o}%,cost_center_code:%${o}%,cost_center_desc:%${o}%,pvr_no:%${o}%,tanggal:%${o}%,transition_target:%${o}%`),r.sort="",N.value.field&&(r.sort=N.value.field+":"+N.value.by),r.date_from=R.value.from?z(R.value.from).format("YYYY-MM-DD"):"",r.date_to=R.value.to?z(R.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(_()._tv.filter_model),r.filter_status=y.value},H=async()=>{_().loading_full=!0,q.value={},p.value.may_get_data=!1,r.page=p.value.page,r.page==1&&(h.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(h.value[0])),r.filter_status=y.value;const{data:o,error:l,status:u}=await C("/trx_trps/dataFin",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:r,retry:0});if(_().loading_full=!1,p.value.may_get_data=!0,u.value==="error"){A().trigger(l,q);return}p.value.page==1?h.value=P(o.value.data):p.value.page>1&&(h.value=[...h.value,...P(o.value.data)]),o.value.data.length==0&&(p.value.is_last_record=!0),_()._tv.filter_box=!1},V=()=>{D.value=-1,p.value.page=1,p.value.is_last_record=!1,U(),H()},W=c([{key:"no",label:"No",isai:!0},{key:"val",label:"APP",childs:[{key:"val",label:"Kasir",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"Mandor",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"KTU/W",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val3",label:"Marketing",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val4",label:"Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val5",label:"SPV Logistik",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"supir_rek_no",label:"No Rek Supir",filter_on:1,type:"string"},{key:"supir_rek_name",label:"Nama Rek Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"kernet_rek_no",label:"No Rek Kernet",filter_on:1,type:"string"},{key:"kernet_rek_name",label:"Nama Rek Kernet",filter_on:1,type:"string"},{key:"payment_method_name",label:"Payment Method Name",type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),{downloadFile:I,viewFile:Rt}=Te(),S=c(!1),B=c(""),E=async()=>{if(S.value==!0){S.value=!1;return}U(),_().loading_full=!0;const{data:o,error:l,status:u}=await C("/trx_trps/reportFinPDF",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:r,retry:0});if(_().loading_full=!1,u.value==="error"){A().trigger(l);return}B.value=o.value,S.value=!0},Z=async(o="")=>{U(),_().loading_full=!0;const{data:l,error:u,status:F}=await C("/trx_trps/reportFinExcel",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:r,retry:0});if(_().loading_full=!1,F.value==="error"){A().trigger(u);return}I(l.value)},Q=()=>{I(B.value)},M=c(!1),m=c({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),X=async()=>{D.value==-1&&display({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}),_().loading_full=!0;const{data:o,error:l,status:u}=await C("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:h.value[D.value].id_uj},retry:0});if(_().loading_full=!1,u.value==="error"){A().trigger(l,q);return}m.value=o.value.data,M.value=!0},ee=ge(()=>{let o=0;return m.value.details2.forEach(l=>{l.p_status!="Remove"&&(o+=l.qty*l.amount)}),o});return(o,l)=>{const u=ne,F=ie,te=_e,oe=ce,le=de,b=pe,g=ue,se=fe,ae=me,re=ve;return a(),x(Y,null,[e("div",Re,[k(u,{title:"List Transaction"}),e("div",Se,[e("div",Me,[e("div",Pe,[e("div",qe,[J(e("select",{class:"","onUpdate:modelValue":l[0]||(l[0]=t=>xe(y)?y.value=t:null)},Ue,512),[[ke,s(y)]])]),e("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:l[1]||(l[1]=t=>E())},[k(F),$(),Be]),e("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:l[2]||(l[2]=t=>Z())},[k(te),$(),Fe]),e("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:l[3]||(l[3]=t=>X())},[k(oe)])])]),k(se,{thead:s(W),selected:s(D),onSetSelected:l[4]||(l[4]=t=>D.value=t),tbody:s(h),fnCallData:H,scrolling:s(p),onSetScrollingPage:l[5]||(l[5]=t=>s(p).page=t),onDoFilter:l[6]||(l[6]=t=>V())},{absen:d(({item:t,index:f})=>[t.trx_absens&&t.trx_absens.length>0?(a(),i(le,{key:0,class:"cursor-pointer",onClick:Mt=>o.form_absen(f)},null,8,["onClick"])):K("",!0)]),val:d(({item:t})=>[t.val?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),val1:d(({item:t})=>[t.val1?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),val2:d(({item:t})=>[t.val2?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),val3:d(({item:t})=>[t.val3?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),val4:d(({item:t})=>[t.val4?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),val5:d(({item:t})=>[t.val5?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),payment_method_name:d(({item:t})=>{var f;return[$(n((f=t.payment_method)==null?void 0:f.name),1)]}),pvr_had_detail:d(({item:t})=>[t.pvr_had_detail?(a(),i(g,{key:1})):(a(),i(b,{key:0}))]),deleted_by_username:d(({item:t})=>{var f;return[$(n((f=t.deleted_by)==null?void 0:f.username),1)]}),req_deleted_by_username:d(({item:t})=>{var f;return[$(n((f=t.req_deleted_by)==null?void 0:f.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])])]),s(S)?(a(),x("div",Ye,[e("div",je,[e("div",ze,[k(ae,{style:{color:"black",cursor:"pointer"},onClick:l[7]||(l[7]=t=>E())})]),e("iframe",{ref:"iframe",width:"100%",height:"100%",src:s(B).dataBase64},null,8,He),e("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:l[8]||(l[8]=t=>Q())})])])):K("",!0),J(e("div",Ve,[e("div",Ie,[k(re,{title:"Detail Information",fn:()=>{M.value=!1,o.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("div",Ee,[e("div",Je,[e("div",Ke,[Le,e("div",Oe,n(s(m).xto)+" ",1)]),e("div",Ge,[We,e("div",Ze,n(s(m).tipe),1)]),e("div",Qe,[Xe,e("div",et,n(s(m).jenis),1)]),e("div",tt,[ot,e("div",lt,n(s(m).note_for_remarks),1)])]),e("div",st,[e("table",at,[rt,(a(!0),x(Y,null,L(s(m).details,t=>(a(),x("tr",null,[e("td",nt,n(t.ordinal)+". ",1),e("td",it,n(t.xdesc)+" "+n(t.qty<=1?"":s(v)(t.qty||0)+" x Rp."+s(v)(t.harga||0)),1),_t,e("td",ct,n(s(v)(t.qty*t.harga)),1)]))),256)),e("tr",dt,[pt,ut,e("th",ft,n(s(v)(s(m).harga)),1)])])]),e("div",mt,[e("table",vt,[yt,(a(!0),x(Y,null,L(s(m).details2,t=>(a(),x("tr",null,[e("td",ht,n(t.ordinal)+". ",1),e("td",bt,n(t.ac_account_code),1),e("td",gt,n(t.description)+" "+n(t.qty<=1?"":s(v)(t.qty||0)+" x Rp."+s(v)(t.amount||0)),1),kt,e("td",xt,n(s(v)(t.qty*t.amount)),1)]))),256)),e("tr",wt,[Dt,$t,e("th",At,n(s(v)(s(ee))),1)])])])]),e("div",Ct,[e("button",{class:"rounded m-1",onClick:l[9]||(l[9]=t=>M.value=!1)}," Cancel ")])])],512),[[we,s(M)]])],64)}}};export{lo as default};
