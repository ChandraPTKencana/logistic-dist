import{_ as V}from"./HeaderPopup.vue.4e2f3813.js";import L from"./Table2Column.871aa25b.js";import M from"./Send.386cef57.js";import Y from"./Refresh.b13ddda0.js";import{j as Q,r as N,g as J,i as v,f as O,k as C,K as A,o as j,c as k,a as t,b as E,l as a,d,t as o,F as G,D as H,C as W,n as X,x as c,y as w}from"./entry.717b1444.js";import{u as Z}from"./useUtils.8a7aa554.js";import{u as x}from"./useMyFetch.666735e9.js";import{u as tt}from"./useDownload.174f4da2.js";import"./Times.f67ad23e.js";import"./_plugin-vue_export-helper.c27b6911.js";const et={class:"box-fixed"},st={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},lt={class:"w-full flex flex-col items-center grow overflow-auto"},ot={class:"w-full flex"},nt={class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},at={class:"w-full",role:"sticky"},rt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},it=t("tr",{class:"sticky top-0 !z-[2]"},[t("td",{colspan:18,class:"!bg-slate-800 text-white font-bold"}," List Transaksi ")],-1),ct={class:"sticky top-7 !z-[2]"},ut=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),_t=t("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1),dt=t("th",null,"Tujuan",-1),ft=t("th",null,"Produk",-1),ht=t("th",null,"No Trx",-1),mt=t("th",{class:"min-w-[75px] !w-[75px] max-w-[75px]"},"No Pol",-1),pt=t("th",null,"Jabatan",-1),vt=t("th",null,"Nama",-1),wt=t("br",null,null,-1),xt=t("br",null,null,-1),yt=t("br",null,null,-1),gt=t("th",null,null,-1),bt=t("th",null,"No Rek",-1),jt=t("th",null,"Nama Di Bank",-1),kt=t("br",null,null,-1),Et=t("th",null,"Status ",-1),Dt=t("th",null,"Aksi ",-1),Nt=t("th",null,"Alasan Gagal ",-1),Ct={ref:"to_move"},At={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},It={class:"w-full h-full flex items-center justify-center"},St={class:"cell min-w-[50px] !w-[50px] max-w-[50px]"},$t={class:"w-full h-full flex items-center justify-center"},Bt={class:"cell min-w-[150px] !w-[150px] max-w-[150px]"},Ft={class:"w-full h-full flex items-center justify-center"},Rt={class:"cell"},Tt={class:"w-full h-full flex items-center justify-center"},qt={class:"cell"},Pt={class:"w-full h-full flex items-center justify-center"},Ut={class:"cell"},zt={class:"w-full h-full flex items-center justify-center"},Kt={class:"cell"},Vt={class:"w-full h-full flex items-center justify-center"},Lt={class:"cell"},Mt={class:"w-full h-full flex items-center justify-center"},Yt={class:"cell"},Qt={class:"w-full h-full flex items-center justify-end p-2"},Jt={class:"cell"},Ot={class:"w-full h-full flex items-center justify-end p-2"},Gt={class:"cell"},Ht={class:"w-full h-full flex items-center justify-end p-2"},Wt=t("td",null,[t("div",{class:"w-full h-full flex items-center justify-end p-2"})],-1),Xt={class:"cell"},Zt={class:"w-full h-full flex items-center justify-center"},te={class:"cell"},ee={class:"w-full h-full flex items-center justify-center"},se={class:"cell"},le={class:"w-full h-full flex items-center justify-end p-1"},oe={class:"cell"},ne={class:"w-full h-full flex items-center justify-end p-1"},ae={class:"cell"},re={class:"w-full h-full flex items-center justify-end p-1"},ie=["onClick"],ce={class:"cell"},ue={class:"w-full h-full flex items-center justify-end p-1"},_e={class:"w-full flex items-center justify-end"},ke={__name:"fin_payment_req_view",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0}},setup(y){const f=y,{pointFormat:_}=Z(),{display:D}=Q(),I={id:-1,details:[]},g=N({...I}),p=J("token"),n=N([]),$=v(()=>{let s=0;return n.value.forEach(e=>{s+=parseInt(e.nominal)}),s}),B=v(()=>{let s=0;return n.value.forEach(e=>{s+=parseInt(e.potongan_trx_ttl)}),s}),F=v(()=>{let s=0;return n.value.forEach(e=>{s+=parseInt(e.extra_money_trx_ttl)}),s}),R=v(()=>{let s=0;return n.value.forEach(e=>{s+=parseInt(e.jumlah)}),s}),S=v(()=>{let s=0;return n.value.every(e=>e.status=="READY"?(s=1,!1):e.status=="INQUIRY_FAILED"?(s=2,!1):!0),s}),T=async()=>{c().loading_full=!0;const{data:s,error:e,status:r}=await x("/fin_payment_req",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:f.id},retry:0});if(c().loading_full=!1,r.value==="error"){w().trigger(e);return}g.value=s.value.data,f.is_copy&&(g.value.val=0,g.value.val1=0),n.value=s.value.data.details},{downloadFile:q,viewFile:de}=tt(),P=async()=>{c().loading_full=!0;const{data:s,error:e,status:r}=await x("/fin_payment_req/download_view",{method:"get",headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},params:{id:f.id},retry:0});if(c().loading_full=!1,r.value==="error"){w().trigger(e);return}q(s.value)},m=N({}),U=async()=>{c().loading_full=!0,m.value={};const s=new FormData;s.append("id",f.id),s.append("_method","PUT");let e="post";const{data:r,error:h,status:i}=await x("/fin_payment_req/gen_csv_and_send_mandiri",{method:e,headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,i.value==="error"){w().trigger(h,m);return}D({show:!0,status:"Success",message:"Kirim Ke Mandiri Berhasil"}),n.value.forEach(u=>{u.status="INQUIRY_PROCESS"})},z=async()=>{c().loading_full=!0,m.value={};const s=new FormData;s.append("id",f.id),s.append("_method","PUT");let e="post";const{data:r,error:h,status:i}=await x("/fin_payment_req/get_update",{method:e,headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},body:s,retry:0});if(c().loading_full=!1,i.value==="error"){w().trigger(h,m);return}D({show:!0,status:"Success",message:"Update Data Berhasil"}),r.value.details.forEach(u=>{let l=n.value.map(b=>b.id).indexOf(u.id);l>-1&&(n.value[l].status=u.status,n.value[l].failed_reason=u.failed_reason)}),console.log(r.value.details),console.log(n.value)},K=async(s,e)=>{c().loading_full=!0,m.value={};const r=new FormData;r.append("detail_id",s),r.append("_method","PUT");let h="post";const{data:i,error:u,status:l}=await x("/fin_payment_req_dtl/renew_data",{method:h,headers:{Authorization:`Bearer ${p.value}`,Accept:"application/json"},body:r,retry:0});if(c().loading_full=!1,l.value==="error"){w().trigger(u,m);return}D({show:!0,status:"Success",message:"Data Berhasil Diperbaharui"}),n.value[e].employee_rek_no=i.value.employee_rek_no,n.value[e].employee_rek_name=i.value.employee_rek_name,n.value[e].employee_bank_code=i.value.employee_bank_code,n.value[e].status=i.value.status,n.value[e].failed_reason=i.value.failed_reason};return O(()=>f.show,(s,e)=>{s==!0&&(g.value={...I},n.value=[],f.id!=0&&T())},{immediate:!0}),(s,e)=>{const r=V,h=L,i=M,u=Y;return C((j(),k("section",et,[t("div",null,[E(r,{title:"Finance Payment Request",fn:y.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",st,[t("div",lt,[t("div",ot,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[0]||(e[0]=l=>P())},[E(h)]),C(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=l=>U())},[E(i)],512),[[A,a(S)==1]]),C(t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=l=>z())},[E(u)],512),[[A,a(S)==0]])]),t("div",nt,[t("div",at,[t("table",rt,[t("thead",null,[it,t("tr",ct,[ut,_t,dt,ft,ht,mt,pt,vt,t("th",null,[d("Jumlah "),wt,d(" ("+o(a(_)(a($)||0))+") ",1)]),t("th",null,[d("Potongan "),xt,d(" ("+o(a(_)(a(B)))+")",1)]),t("th",null,[d("ExtraMoney "),yt,d(" ("+o(a(_)(a(F)))+")",1)]),gt,bt,jt,t("th",null,[d("Nominal Transfer "),kt,d(" ("+o(a(_)(a(R)||0))+")",1)]),Et,Dt,Nt])]),t("tbody",Ct,[(j(!0),k(G,null,H(a(n),(l,b)=>(j(),k("tr",{key:b},[t("td",At,[t("div",It,o(l.no),1)]),t("td",St,[t("div",$t,o(l.id),1)]),t("td",Bt,[t("div",Ft,o(l.jabatan!="KERNET"?l.tujuan:""),1)]),t("td",Rt,[t("div",Tt,o(l.jabatan!="KERNET"?l.produk:""),1)]),t("td",qt,[t("div",Pt,o(l.jabatan!="KERNET"?l.trx_trp_id:""),1)]),t("td",Ut,[t("div",zt,o(l.jabatan!="KERNET"?l.no_pol:""),1)]),t("td",Kt,[t("div",Vt,o(l.jabatan),1)]),t("td",Lt,[t("div",Mt,o(l.nama),1)]),t("td",Yt,[t("div",Qt,o(a(_)(l.jumlah||0)),1)]),t("td",Jt,[t("div",Ot,o(a(_)(l.potongan_trx_ttl)),1)]),t("td",Gt,[t("div",Ht,o(a(_)(l.extra_money_trx_ttl)),1)]),Wt,t("td",Xt,[t("div",Zt,o(l.rek_no),1)]),t("td",te,[t("div",ee,o(l.rek_name),1)]),t("td",se,[t("div",le,o(a(_)(l.jumlah||0)),1)]),t("td",oe,[t("div",ne,o(l.status),1)]),t("td",ae,[t("div",re,[l.status=="INQUIRY_FAILED"?(j(),k("button",{key:0,class:"bg-yellow-400 rounded",onClick:W(fe=>K(l.id,b),["prevent"])}," Renew Data ",8,ie)):X("",!0)])]),t("td",ce,[t("div",ue,o(l.failed_reason),1)])]))),128))],512)])])])]),t("div",_e,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:e[3]||(e[3]=l=>y.fnClose())}," Cancel ")])])])],512)),[[A,y.show]])}}};export{ke as default};
