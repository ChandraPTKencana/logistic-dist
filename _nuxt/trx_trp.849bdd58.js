import{_ as Q}from"./HeaderPopup.vue.1f66d8b8.js";import{_ as X}from"./client-only.6c95dfa7.js";import{_ as Z}from"./WidthMiniList.vue.17bc5e09.js";import{r as m,h as ee,z as te,K as S,I as j,M as le,n as h,v as oe,o as c,c as p,a as t,b as y,m as o,w as se,E as ae,t as r,C as J,q as K,F as N,D as B,G as O,s as ne,H as re,x as g,y as P}from"./entry.88f34d4f.js";import{u as ie}from"./useUtils.8b5b7e0b.js";import{u as A}from"./useMyFetch.939ba7e3.js";import"./Times.f70da358.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./WidthMiniPart.vue.9008041d.js";const de={class:"box-fixed"},_e={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ue={class:"w-full flex flex-col items-center grow overflow-auto"},ce={class:"w-full flex flex-row flex-wrap"},pe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ve=t("label",{for:""},"U.Jalan Per",-1),fe={key:0,class:"grow"},me={key:1,class:"grow"},we={class:"text-red-500"},xe={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},he=t("label",{for:""},"Jenis",-1),ge=["disabled"],ke=t("option",{value:"TBS"},"TBS",-1),be=t("option",{value:"TBSK"},"TBSK",-1),ye=t("option",{value:"CPO"},"CPO",-1),Ce=t("option",{value:"PK"},"PK",-1),Se=[ke,be,ye,Ce],je={class:"text-red-500"},Ne={class:"w-6/12 sm:w-3/12 md:w-2/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Be=t("label",{for:""},"No Pol",-1),De=["disabled"],Te={id:"vehicle"},Ve=["value"],Je={class:"text-red-500"},Oe={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},Pe=t("label",{for:""},"Supir",-1),Ae={class:"text-red-500"},Me={class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},$e=t("label",{for:""},"Kernet",-1),Fe={class:"text-red-500"},Ue={key:0,class:"w-full flex flex-wrap"},qe={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ke=t("label",{for:""},"Tujuan",-1),Ie=["disabled"],Le={class:"text-red-500"},ze={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},Ye=t("label",{for:""},"Tipe",-1),Ee=["disabled"],Re=["value","selected"],He={class:"text-red-500"},Ge={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-4/12 flex flex-col flex-wrap p-1"},We=t("label",{for:""},"Total Dari U.Jalan",-1),Qe={class:"card-border disabled"},Xe={key:1,class:"w-full flex flex-wrap"},Ze={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},et=t("label",{for:""},"Cost Center Code",-1),tt=["disabled"],lt={id:"cost_center"},ot=["value"],st={class:"text-red-500"},at={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},nt=t("label",{for:""},"Cost Center Desc",-1),rt={class:"card-border disabled"},it={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},dt=t("label",{for:""},"PVR No",-1),_t={class:"card-border disabled"},ut={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},ct=t("label",{for:""},"PVR Total",-1),pt={class:"card-border disabled"},vt={class:"w-6/12 sm:w-8/12 flex flex-col flex-wrap p-1"},ft=t("label",{for:""},"PV",-1),mt={class:"card-border disabled"},wt={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},xt=t("label",{for:""},"PV Amount",-1),ht={class:"card-border disabled"},gt={class:"w-full flex items-center justify-end"},Tt={__name:"trx_trp",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnLoadDBData:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},list_cost_center:{type:Array,required:!0,default:[]},online_status:{type:Boolean,required:!0,default:!1}},setup(k){const d=k,{$moment:M}=re(),{pointFormat:D}=ie(),T={id:-1,tanggal:new Date,id_uj:-1,xto:"",tipe:"",jenis:"",amount:0,pv_id:-1,pv_no:"",pv_total:0,supir:"",kernet:"",no_pol:"",cost_center_code:"",cost_center_desc:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:"",transition_target:""};let w={...T};const e=m({...T}),V=ee("token"),v=m({}),I=s=>{let l=s.target.value;if(!l){e.value.cost_center_code="",e.value.cost_center_desc="";return}d.list_cost_center.filter(a=>a.CostCenter==l).length==0&&(e.value.cost_center_code="112",e.value.cost_center_desc="Transport")},L=s=>{e.value.transition_target=s.target.value=="TBS"?e.value.transition_target:""};te();const z=async()=>{g().loading_full=!0,v.value={};const s=new FormData;s.append("tanggal",M(e.value.tanggal).format("Y-MM-DD")),s.append("jenis",e.value.jenis),s.append("id_uj",e.value.id_uj),s.append("xto",e.value.xto),s.append("cost_center_code",e.value.cost_center_code),s.append("online_status",d.online_status),s.append("transition_target",e.value.transition_target),s.append("no_pol",e.value.no_pol),s.append("supir_id",_.value.id),s.append("kernet_id",u.value.id);let l="post",i=d.id;i==0||(s.append("id",i),s.append("_method","PUT"));const{data:a,error:f,status:x}=await A("/trx_trp",{method:l,headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},body:s,retry:0});if(g().loading_full=!1,x.value==="error"){P().trigger(f,v);return}if(e.value.supir=_.value.name,e.value.supir_rek_no=_.value._.rek_no.val,e.value.supir_rek_name=_.value._.rek_name.val,e.value.kernet=u.value.name,e.value.kernet_rek_no=u.value._.rek_no.val,e.value.kernet_rek_name=u.value._.rek_name.val,e.value.updated_at=a.value.updated_at,d.id<=0)e.value.id=a.value.id,e.value.created_at=a.value.created_at,d.p_data.unshift(e.value);else{let n=d.p_data.map(W=>W.id).indexOf(d.id);n>=-1&&d.p_data.splice(n,1,{...e.value})}d.fnClose()},Y=S(()=>{let s=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return[...new Set(C.value.filter(l=>l.jenis==s).map(l=>l.xto))]}),E=S(()=>{let s=e.value.jenis=="TBSK"?"TBS":e.value.jenis;return C.value.filter(l=>l.xto==e.value.xto&&l.jenis==s)}),b={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},_=m(JSON.parse(JSON.stringify(b))),u=m(JSON.parse(JSON.stringify(b))),$=S(()=>{let s=[];return U.value.forEach((l,i)=>{let a=JSON.parse(JSON.stringify(b));a._.id.val=l.id,a._.name.val=l.name,a._.rek_no.val=l.rek_no,a._.rek_name.val=l.rek_name,a.id=l.id,a.name=l.name,a.title=(l.rek_no||"")+" "+(l.rek_name||""),s.push(JSON.parse(JSON.stringify(a)))}),s}),R=S(()=>!1),H=async()=>{g().loading_full=!0;const{data:s,error:l,status:i}=await A("/trx_trp",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},params:{id:d.id},retry:0});if(g().loading_full=!1,i.value==="error"){P().trigger(l);return}let a=s.value.data;e.value=a,w={...a},_.value._.id.val=a.supir_id,_.value._.name.val=a.supir,_.value._.rek_no.val=a.supir_rek_no,_.value._.rek_name.val=a.supir_rek_name,_.value.id=a.supir_id,_.value.name=a.supir,_.value.rek_no=(a.supir_rek_no||"")+" "+(a.supir_rek_name||""),u.value._.id.val=a.kernet_id,u.value._.name.val=a.kernet,u.value._.rek_no.val=a.kernet_rek_no,u.value._.rek_name.val=a.kernet_rek_name,u.value.id=a.kernet_id,u.value.name=a.kernet,u.value.rek_no=(a.kernet_rek_no||"")+" "+(a.kernet_rek_name||""),d.fnLoadDBData()},C=m([]),F=m([]),U=m([]),G=async()=>{g().loading_full=!0;const{data:s,error:l,status:i}=await A("/trx_load_for_local",{method:"get",headers:{Authorization:`Bearer ${V.value}`,Accept:"application/json"},retry:0});if(g().loading_full=!1,i.value==="error"){P().trigger(l);return}C.value=s.value.list_ujalan,F.value=s.value.list_vehicle,U.value=s.value.list_employee};j(()=>d.show,async(s,l)=>{s==!0&&(await G(),await d.fnLoadDBData(),e.value={...T},_.value=JSON.parse(JSON.stringify(b)),u.value=JSON.parse(JSON.stringify(b)),v.value={},d.id!=0&&H())},{immediate:!0}),j(()=>e.value.cost_center_code,(s,l)=>{let i="";if(s==""||s){let a=d.list_cost_center.filter(f=>f.CostCenter==e.value.cost_center_code);a.length>0?i=a[0].Description:e.value.cost_center_code==w.cost_center_code&&(i=w.cost_center_desc),e.value.cost_center_desc=i}},{deep:!0,immediate:!0});const q=(s,l)=>{let i=0,a="";if(s==""||s){let f=C.value.filter(x=>x.id==e.value.id_uj);f.length>0?(i=f[0].harga,a=f[0].tipe):e.value.id_uj==w.id_uj&&(i=w.amount,a=w.tipe),e.value.tipe=a,e.value.amount=i}};return j(()=>e.value.xto,(s,l)=>{d.show&&q(s)},{deep:!0,immediate:!0}),j(()=>e.value.id_uj,(s,l)=>{d.show&&q(s)},{deep:!0,immediate:!0}),(s,l)=>{const i=Q,a=le("vue-date-picker"),f=X,x=Z;return h((c(),p("section",de,[t("div",null,[y(i,{title:"Form Transaction",fn:k.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),t("form",_e,[t("div",ue,[t("div",ce,[t("div",pe,[ve,o(e).val!==1?(c(),p("div",fe,[y(f,null,{default:se(()=>[y(a,{modelValue:o(e).tanggal,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).tanggal=n),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1})])):(c(),p("div",me,[t("div",{class:ae(["card-border disabled",o(e).pvr_no!=""?"unselectable":""])},r(o(e).tanggal?o(M)(o(e).tanggal).format("DD-MM-YYYY"):""),3)])),t("p",we,r(o(v).tanggal),1)]),t("div",xe,[he,h(t("select",{"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).jenis=n),onChange:l[2]||(l[2]=n=>L(n)),disabled:o(e).val==1},Se,40,ge),[[J,o(e).jenis]]),t("p",je,r(o(v).jenis),1)]),t("div",Ne,[Be,h(t("input",{type:"text",list:"vehicle","onUpdate:modelValue":l[3]||(l[3]=n=>o(e).no_pol=n),disabled:o(e).val==1},null,8,De),[[K,o(e).no_pol]]),t("datalist",Te,[(c(!0),p(N,null,B(o(F),n=>(c(),p("option",{value:n.no_pol},r(n.no_pol),9,Ve))),256))]),t("p",Je,r(o(v).no_pol),1)]),t("div",Oe,[Pe,y(x,{arr:o($),selected:o(_),onSetSelected:l[4]||(l[4]=n=>_.value=n)},null,8,["arr","selected"]),t("p",Ae,r(o(v).supir_id),1)]),t("div",Me,[$e,y(x,{arr:o($),selected:o(u),onSetSelected:l[5]||(l[5]=n=>u.value=n)},null,8,["arr","selected"]),t("p",Fe,r(o(v).kernet_id),1)]),o(e).jenis!=""?(c(),p("div",Ue,[t("div",qe,[Ke,h(t("select",{"onUpdate:modelValue":l[6]||(l[6]=n=>o(e).xto=n),disabled:o(e).val==1},[(c(!0),p(N,null,B(o(Y),n=>(c(),p("option",null,r(n),1))),256))],8,Ie),[[J,o(e).xto]]),t("p",Le,r(o(v).xto),1)]),t("div",ze,[Ye,h(t("select",{"onUpdate:modelValue":l[7]||(l[7]=n=>o(e).id_uj=n),disabled:o(e).val==1},[(c(!0),p(N,null,B(o(E),n=>(c(),p("option",{value:n.id,selected:n.id==o(e).id_uj},r(n.tipe),9,Re))),256))],8,Ee),[[J,o(e).id_uj]]),t("p",He,r(o(v).id_uj),1)]),t("div",Ge,[We,t("div",Qe,r(o(D)(o(e).amount)),1)])])):O("",!0),o(e).jenis!=""?(c(),p("div",Xe,[t("div",Ze,[et,h(t("input",{list:"cost_center","onUpdate:modelValue":l[8]||(l[8]=n=>o(e).cost_center_code=n),onBlur:l[9]||(l[9]=n=>I(n)),disabled:o(e).pvr_no!=""},null,40,tt),[[K,o(e).cost_center_code]]),t("datalist",lt,[(c(!0),p(N,null,B(k.list_cost_center,n=>(c(),p("option",{value:n.CostCenter},r(n.CostCenter+"-"+n.Description),9,ot))),256))]),t("p",st,r(o(v).cost_center_code),1)]),t("div",at,[nt,t("div",rt,r(o(e).cost_center_desc),1)]),t("div",it,[dt,t("div",_t,r(o(e).pvr_no),1)]),t("div",ut,[ct,t("div",pt,r(o(D)(o(e).pvr_total||0)),1)]),t("div",vt,[ft,t("div",mt,r(o(e).pv_no),1)]),t("div",wt,[xt,t("div",ht,r(o(D)(o(e).pv_total)),1)])])):O("",!0)])]),t("div",gt,[t("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[10]||(l[10]=n=>k.fnClose())}," Cancel "),o(R)?O("",!0):(c(),p("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[11]||(l[11]=ne(n=>z(),["prevent"]))}," Save "))])])])],512)),[[oe,k.show]])}}};export{Tt as default};
