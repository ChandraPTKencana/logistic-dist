import Ne from"./Header.c1b17b6c.js";import Pe from"./Edit.c3f2666e.js";import je from"./Eyes.97c81736.js";import Ye from"./Void.a6cc35ff.js";import He from"./Signature.94a2dfb3.js";import Oe from"./Cog.4d2ee6fa.js";import Ve from"./Image.cbc0e2b0.js";import Ie from"./Line.31a286ec.js";import Fe from"./Check.124d4ca6.js";import Ue from"./TableView.5850908f.js";import{_ as ze}from"./PopupMini.vue.39e3e679.js";import Ee from"./trx_trp_ticket.199991c9.js";import Re from"./trx_trp_ticket_validasi.c1957ac7.js";import Le from"./trx_absen.1650528b.js";import Je from"./Times.fd762f40.js";import{_ as Ke}from"./client-only.3a70806c.js";import{r as _,j as Ge,f as Xe,g as Ze,G as S,h as Qe,i as ie,s as We,A as p,I as et,c as $,b as c,a as n,m as tt,q as ot,k as l,n as at,l as C,d as q,C as lt,t as K,w as b,z as st,B,o as f,D,H as nt,E as rt}from"./entry.ee76e376.js";import{u as N}from"./useMyFetch.ece246bd.js";import{u as V}from"./useUtils.56dadbdf.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.b70cd14d.js";import"./Adjust.ee334c46.js";import"./TableHeaderEye.38db9496.js";import"./ClearAll.aa440456.js";import"./ClearEach.96d8fbd7.js";import"./CaretLeftDoubleBold.a08be12d.js";import"./CaretLeftBold.cd4387bc.js";import"./CaretRightBold.1a0f6ae9.js";import"./CaretRightDoubleBold.f318c5ee.js";import"./Exclamation.930b4073.js";import"./HeaderPopup.vue.6354cbe7.js";import"./InputPointFormat.vue.14ffbec2.js";const it={class:"w-full h-full flex flex-col"},_t={class:"w-full flex grow flex-col overflow-auto h-0"},ut={class:"w-full flex justify-between flex-wrap"},dt={class:"grow flex"},ct={class:"m-1"},pt=nt('<option value="ticket_not_done">Undone</option><option value="ticket_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),mt=[pt],ft={class:"flex"},vt=n("span",{class:"text-xs"},"Mode",-1),kt=n("b",null,"tidak dapat dibatalkan lagi",-1),bt={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},yt={class:"relative",style:{width:"95%",height:"90%"}},gt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},xt={class:"w-full h-full flex flex-col items-center justify-content-center bg-white"},ht={class:"w-full p-1"},wt={class:"w-full p-1 bg-gray-200"},Dt=n("div",{class:"w-full text-blue-600 font-bold"}," Set Date For Load Data ",-1),$t={class:"w-full grid grid-cols-2 grid-rows-1 gap-1"},Ct={class:"flex flex-col flex-wrap p-1"},Tt=n("label",{for:""},"From",-1),At={class:"grow"},Mt={class:"flex flex-col flex-wrap p-1"},St=n("label",{for:""},"To",-1),qt={class:"grow"},po={__name:"ticket",async setup(Bt){let P,G;const{$moment:j}=rt(),X=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":["CPO","PK"].indexOf(e.jenis)>-1&&e.ticket_a_id!=""&&e.ticket_b_bruto!=""&&e.ticket_b_tara!=""&&e.ticket_b_netto!=""&&e.ticket_b_in_at!=""&&e.ticket_b_out_at!=""||e.jenis=="TBS"&&e.ticket_a_id!=""&&e.ticket_b_id!=""||e.jenis=="TBSK"&&e.ticket_b_id!=""?"!bg-blue-300":"",I=e=>(e.map(t=>{t.class_h=X(t)}),e),y=_("ticket_not_done");Ge(()=>y.value,e=>{se.value.map(t=>{let m=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?m&&(t.tbl_show=1):m&&(t.tbl_show=0),t}),ee()},{immediate:!1});const u={};u._TimeZoneOffset=new Date().getTimezoneOffset(),u.sort="tanggal:desc";const Z=_({}),Y=_({from:"",to:""}),T=Xe("token"),{data:_e}=([P,G]=Ze(async()=>st(async()=>{p().loading_full=!0;let e=[];const[t,m]=await Promise.all([N("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{filter_status:y},retry:0})]);return t.status.value!=="error"&&(e=I(t.data.value.data)),t.status.value==="error"?(B().trigger(t.error),{trx_trps:e}):(p().loading_full=!1,{trx_trps:e})},"$X4xCu6yBOs")),P=await P,G(),P),r=_(_e.value.trx_trps||[]),Q=_([]),g=_(!1),ue=async(e,t="")=>{p().loading_full=!0;let m=d.value.from?j(d.value.from).format("Y-MM-DD"):"",x=d.value.to?j(d.value.to).format("Y-MM-DD"):"";const{data:a,error:h,status:s}=await N("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:{jenis:e,online_status:g.value,from:m,to:x,transition_target:t},retry:0});if(p().loading_full=!1,s.value==="error"){B().trigger(h);return}Q.value=a.value.list_ticket},F=_({field:"tanggal",by:"desc"}),i=_(-1),k=S(()=>r.value[i.value]),v=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),de=()=>{u.like="";let e=JSON.parse(JSON.stringify(p()._tv.global_keyword));e!=""&&(u.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),u.sort="",F.value.field&&(u.sort=F.value.field+":"+F.value.by),u.date_from=Y.value.from?j(Y.value.from).format("YYYY-MM-DD"):"",u.date_to=Y.value.to?j(Y.value.to).format("YYYY-MM-DD"):"",u.filter_model=JSON.stringify(p()._tv.filter_model)},W=async()=>{p().loading_full=!0,Z.value={},v.value.may_get_data=!1,u.page=v.value.page,u.page==1&&(r.value=[]),u.first_row&&delete u.first_row,u.page>1&&(u.first_row=JSON.stringify(r.value[0])),u.filter_status=y.value;const{data:e,error:t,status:m}=await N("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},params:u,retry:0});if(p().loading_full=!1,v.value.may_get_data=!0,m.value==="error"){B().trigger(t,Z);return}v.value.page==1?r.value=I(e.value.data):v.value.page>1&&(r.value=[...r.value,...I(e.value.data)]),e.value.data.length==0&&(v.value.is_last_record=!0),p()._tv.filter_box=!1},ee=()=>{i.value=-1,v.value.page=1,v.value.is_last_record=!1,de(),W()};Qe();const U=_(!1),te=_(0),{display:A}=ie();We(ie());const ce=()=>{i.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(te.value=r.value[i.value].id,U.value=!0)},H=_(!1),z=_(0),E=_(!1),pe=()=>{i.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(z.value=r.value[i.value].id,H.value=!0,E.value=!1)},me=()=>{i.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(z.value=r.value[i.value].id,H.value=!0,E.value=!0)},R=_(!1),oe=_(0),fe=e=>{oe.value=e,R.value=!0},ae=_({}),M=_(!1),ve=_(""),ke=async()=>{M.value&&(M.value=!1)},be=()=>{var e;i.value==-1?A({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(ve.value="",ae.value={id:r.value[i.value].id,"no pol":r.value[i.value].no_pol,tujuan:r.value[i.value].xto,permintaan:(e=r.value[i.value].req_deleted_by)==null?void 0:e.username,alasan:r.value[i.value].req_deleted_reason},M.value=!0)},ye=async()=>{p().loading_full=!0;const e=new FormData;e.append("id",r.value[i.value].id),e.append("_method","DELETE");const{data:t,error:m,status:x}=await N("/trx_trp_approve_req_delete",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:e,retry:0});if(p().loading_full=!1,x.value==="error"){B().trigger(m);return}let a={...r.value[i.value]};a.deleted=t.value.deleted,a.deleted_user=t.value.deleted_user,a.deleted_at=t.value.deleted_at,a.deleted_by=t.value.deleted_by,a.deleted_reason=t.value.deleted_reason,a.class_h=X(a),y.value!="all"?r.value.splice(i.value,1):r.value.splice(i.value,1,{...a}),i.value=-1,M.value=!1},O=_(!1),d=_({from:new Date().setDate(new Date().getDate()-3),to:new Date}),le=e=>{e=="from"?d.value.from-d.value.to>0&&(d.value.from=d.value.to):d.value.to-d.value.from<0&&(d.value.to=d.value.from)},ge=async()=>{p().loading_full=!0;const e=new FormData;e.append("online_status",g.value);const{data:t,error:m,status:x}=await N("/trx_trp_do_update_ticket",{method:"post",headers:{Authorization:`Bearer ${T.value}`,Accept:"application/json"},body:e,retry:0});if(p().loading_full=!1,x.value==="error"){B().trigger(m);return}t.value.data.forEach(a=>{let h=r.value.map(s=>s.id).indexOf(a.id);if(h!==-1){let s=r.value[h];s.ticket_a_id=a.ticket_a_id,s.ticket_a_no=a.ticket_a_no,s.ticket_a_bruto=a.ticket_a_bruto,s.ticket_a_tara=a.ticket_a_tara,s.ticket_a_netto=a.ticket_a_netto,s.ticket_a_supir=a.ticket_a_supir,s.ticket_a_no_pol=a.ticket_a_no_pol,s.ticket_a_in_at=a.ticket_a_in_at,s.ticket_a_out_at=a.ticket_a_out_at,s.ticket_b_id=a.ticket_b_id,s.ticket_b_no=a.ticket_b_no,s.ticket_b_bruto=a.ticket_b_bruto,s.ticket_b_tara=a.ticket_b_tara,s.ticket_b_netto=a.ticket_b_netto,s.ticket_b_supir=a.ticket_b_supir,s.ticket_b_no_pol=a.ticket_b_no_pol,s.ticket_b_in_at=a.ticket_b_in_at,s.ticket_b_out_at=a.ticket_b_out_at,s.updated_at=a.updated_at,r.value.splice(h,1,{...s})}}),A({show:!0,status:"Success",message:"Update PV Done"})},se=_([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val_ticket",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:p().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),xe=S(()=>i.value>-1&&V().checkPermission("trp_trx.ticket.view")),he=S(()=>i.value>-1&&k.value.deleted==0&&k.value.req_deleted==0&&k.value.val_ticket==0&&V().checkPermission("trp_trx.ticket.modify")),we=S(()=>i.value>-1&&k.value.deleted==0&&k.value.req_deleted==0&&k.value.val_ticket==0&&V().checkPermission("trp_trx.ticket.val_ticket")),De=S(()=>i.value>-1&&k.value.deleted==0&&k.value.req_deleted==1&&k.value.val_ticket==0&&V().checkPermission("trp_trx.approve_request_remove"));return(e,t)=>{const m=Ne,x=Pe,a=je,h=Ye,s=He,$e=Oe,Ce=Ve,L=Ie,J=Fe,Te=Ue,Ae=ze,Me=Ee,Se=Re,qe=Le,Be=Je,ne=et("vue-date-picker"),re=Ke;return f(),$("div",it,[c(m,{title:"List Transaction"}),n("div",_t,[n("div",ut,[n("div",dt,[n("div",ct,[tt(n("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=o=>at(y)?y.value=o:null)},mt,512),[[ot,l(y)]])]),l(he)?(f(),$("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=o=>ce())},[c(x)])):C("",!0),l(xe)?(f(),$("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=o=>me())},[c(a)])):C("",!0),l(De)?(f(),$("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=o=>be())},[c(h)])):C("",!0),l(we)?(f(),$("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[4]||(t[4]=o=>pe())},[c(s)])):C("",!0)]),n("div",ft,[n("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[5]||(t[5]=o=>O.value=!0)},[c($e)]),n("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:t[6]||(t[6]=o=>ge())}," Update Ticket "),n("div",{class:"m-1 card-border cursor-pointer",onClick:t[7]||(t[7]=o=>g.value=!l(g))},[vt,q(" : "),n("span",{class:lt(["font-bold",l(g)?"text-green-600":"text-red-600"])},K(l(g)?"ONLINE":"OFFLINE"),3)])])]),c(Te,{thead:l(se),selected:l(i),onSetSelected:t[8]||(t[8]=o=>i.value=o),tbody:l(r),fnCallData:W,scrolling:l(v),onSetScrollingPage:t[9]||(t[9]=o=>l(v).page=o),onDoFilter:t[10]||(t[10]=o=>ee())},{absen:b(({item:o,index:w})=>[o.trx_absens&&o.trx_absens.length>0?(f(),D(Ce,{key:0,class:"cursor-pointer",onClick:Nt=>fe(w)},null,8,["onClick"])):C("",!0)]),val:b(({item:o})=>[o.val?(f(),D(J,{key:1})):(f(),D(L,{key:0}))]),val1:b(({item:o})=>[o.val1?(f(),D(J,{key:1})):(f(),D(L,{key:0}))]),val_ticket:b(({item:o})=>[o.val_ticket?(f(),D(J,{key:1})):(f(),D(L,{key:0}))]),deleted_by_username:b(({item:o})=>{var w;return[q(K((w=o.deleted_by)==null?void 0:w.username),1)]}),req_deleted_by_username:b(({item:o})=>{var w;return[q(K((w=o.req_deleted_by)==null?void 0:w.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),c(Ae,{type:"custome",show:l(M),data:l(ae),fnClose:ke,fnConfirm:ye},{words:b(()=>[q(" Data akan diproses dan "),kt,q(", apakah Anda menyetujui permintaan penghapusan data berikut? ")]),_:1},8,["show","data"]),c(Me,{show:l(U),fnClose:()=>{U.value=!1},fnLoadDBData:ue,id:l(te),p_data:l(r),list_ticket:l(Q),online_status:l(g)},null,8,["show","fnClose","id","p_data","list_ticket","online_status"]),c(Se,{show:l(H),fnClose:()=>{H.value=!1},id:l(z),p_data:l(r),is_view:l(E)},null,8,["show","fnClose","id","p_data","is_view"]),c(qe,{show:l(R),fnClose:()=>{R.value=!1},index:l(oe),p_data:l(r)},null,8,["show","fnClose","index","p_data"]),l(O)?(f(),$("div",bt,[n("div",yt,[n("div",gt,[c(Be,{style:{color:"black",cursor:"pointer"},onClick:t[11]||(t[11]=o=>O.value=!1)})]),n("div",xt,[n("div",ht,[n("div",wt,[Dt,n("div",$t,[n("div",Ct,[Tt,n("div",At,[c(re,null,{default:b(()=>[c(ne,{modelValue:l(d).from,"onUpdate:modelValue":t[12]||(t[12]=o=>l(d).from=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[13]||(t[13]=o=>le("from"))},null,8,["modelValue"])]),_:1})])]),n("div",Mt,[St,n("div",qt,[c(re,null,{default:b(()=>[c(ne,{modelValue:l(d).to,"onUpdate:modelValue":t[14]||(t[14]=o=>l(d).to=o),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,clearable:!1,"text-input":"","teleport-center":"",onClosed:t[15]||(t[15]=o=>le("to"))},null,8,["modelValue"])]),_:1})])])])])])]),n("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[16]||(t[16]=o=>O.value=!1)})])])):C("",!0)])}}};export{po as default};
