import{_ as it}from"./Header.d2e96861.js";import{_ as ut}from"./Plus.4c244b29.js";import{_ as rt}from"./Edit.ceb54fec.js";import{_ as ct}from"./Delete.0f5649af.js";import{_ as dt,u as _t,a as pt}from"./useDownload.7da52341.js";import{_ as ft}from"./Search.9a947178.js";import{_ as vt}from"./PopupMini.vue.ce589a5d.js";import{_ as mt}from"./Times.83d0abb6.js";import{u as ht,K as kt,r as n,I as gt,N as O,O as yt,c as y,b as p,a as t,n as z,s as bt,x as l,q as wt,y as Y,z as Tt,F as Dt,A as At,M as xt,L as $t,D as v,E as S,o as b,B as Mt,t as o,U as Bt,C as Ct}from"./entry.5f0c4429.js";import{u as jt}from"./useUtils.100f5b4a.js";import{u as A}from"./useMyFetch.7c247e08.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.1039f791.js";import"./client-only.180ba5f4.js";const St={class:"w-full h-full flex flex-col"},Ht={class:"w-full flex grow flex-col overflow-auto h-0"},Nt={class:"w-full flex"},Pt={action:"#",class:"w-full flex p-1"},Ft={class:"grow"},zt=t("div",{class:"font-bold"}," Keyword ",-1),It={class:"pl-1"},Lt=t("div",{class:"font-bold"}," Sort By ",-1),Vt=Bt('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option>',5),Et=[Vt],Ot={class:"pl-1"},Yt=t("div",{class:"font-bold"}," Sort Order ",-1),Rt=t("option",{value:"asc"},"Asc",-1),Ut=t("option",{value:"desc"},"Desc",-1),Kt=[Rt,Ut],Jt={class:"flex items-end pl-1"},qt={class:"w-full flex justify-center items-center grow h-0 p-1"},Zt={key:0,class:""},Gt={class:"tacky"},Qt=t("thead",null,[t("tr",{class:"sticky top-0 !z-[2]"},[t("th",null,"ID"),t("th",null,"Tanggal"),t("th",null,"To"),t("th",null,"Tipe"),t("th",null,"Jenis"),t("th",null,"Amount"),t("th",null,"PV No"),t("th",null,"PV Total"),t("th",null,"Ticket A No"),t("th",null,"Ticket A Bruto"),t("th",null,"Ticket A Tara"),t("th",null,"Ticket A Netto"),t("th",null,"Ticket A Supir"),t("th",null,"Ticket A No Pol"),t("th",null,"Ticket A In At"),t("th",null,"Ticket A Out At"),t("th",null,"Ticket B No"),t("th",null,"Ticket B Bruto"),t("th",null,"Ticket B Tara"),t("th",null,"Ticket B Netto"),t("th",null,"Ticket B Supir"),t("th",null,"Ticket B No Pol"),t("th",null,"Ticket B In At"),t("th",null,"Ticket B Out At"),t("th",null,"Supir"),t("th",null,"No Pol"),t("th",null,"Created At"),t("th",null,"Updated At")])],-1),Wt=["onClick"],Xt={class:"bold"},te={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},ee={class:"relative",style:{width:"95%",height:"90%"}},le={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},ae=["src"],be={__name:"index",async setup(oe){let x,I;const{$moment:m}=Ct(),{pointFormat:f}=jt(),i={};i._TimeZoneOffset=new Date().getTimezoneOffset(),i.sort="created_at:desc";const w=ht("token"),{data:$}=([x,I]=kt(async()=>$t(async()=>{v().loading_full=!0;let s=[],a=[],_=[],g=[],j=[];const[D,k]=await Promise.all([A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},retry:0}),A("/trx_load_for_trp",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},retry:0})]);return D.status.value!=="error"&&(s=D.data.value.data),D.status.value==="error"?(S().trigger(error),[]):(k.status.value!=="error"&&(a=k.data.value.list_ujalan,_=k.data.value.list_tipe,g=k.data.value.list_ticket,j=k.data.value.list_pv),v().loading_full=!1,{trx_trps:s,list_ujalan:a,list_tipe:_,list_ticket:g,list_pv:j})},"$pFLmKcrKj9")),x=await x,I(),x),u=n($.value.trx_trps||[]),R=n($.value.list_ujalan),U=n($.value.list_ticket),K=n($.value.list_pv),c=n(""),h=n({field:"created_at",by:"desc"}),d=n(-1),r=n({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),J=()=>{i.like="",c.value!=""&&(i.like=`id:%${c.value}%,warehouse_name:%${c.value}%,warehouse_source_name:%${c.value}%,warehouse_target_name:%${c.value}%,item_name:%${c.value}%,status:%${c.value}%,type:%${c.value}%`),i.sort="",h.value.field&&(i.sort=h.value.field+":"+h.value.by)},M=n(null),L=async()=>{v().loading_full=!0,r.value.may_get_data=!1,i.page=r.value.page,i.page==1&&(u.value=[]),i.first_row&&delete i.first_row,i.page>1&&(i.first_row=JSON.stringify(u.value[0]));const{data:s,error:a,status:_}=await A("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:i,retry:0});if(v().loading_full=!1,r.value.may_get_data=!0,_.value==="error"){S().trigger(a);return}r.value.page==1?(u.value=s.value.data,M.value&&(M.value.scrollTop=0)):r.value.page>1&&(u.value=[...u.value,...s.value.data]),s.value.data.length==0&&(r.value.is_last_record=!0)},q=async()=>{if(!r.value.may_get_data)return;let s=M.value;if(s.scrollLeft!=r.value.scrollLeft){r.value.scrollLeft=s.scrollLeft;return}r.value.is_last_record||!(Math.round(s.scrollTop)+s.clientHeight>=s.scrollHeight-1)||(r.value.page++,await L())},Z=()=>{r.value.page=1,r.value.is_last_record=!1,J(),L()};gt();const B=n(!1),H=n(0),G=()=>{H.value=0,B.value=!0},{display:N}=O();yt(O());const Q=()=>{d.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(H.value=u.value[d.value].id,B.value=!0)},V=n({}),T=n(!1),W=async()=>{T.value&&(T.value=!1)},X=()=>{d.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(V.value={id:u.value[d.value].id},T.value=!0)},tt=async()=>{v().loading_full=!0;const s=new FormData;s.append("id",u.value[d.value].id),s.append("_method","DELETE");const{data:a,error:_,status:g}=await A("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:s,retry:0});if(v().loading_full=!1,g.value==="error"){S().trigger(_);return}u.value.splice(d.value,1),d.value=-1,T.value=!1},{downloadFile:et,viewFile:se}=_t(),C=n(!1),P=n(""),E=async()=>{if(C.value==!0){C.value=!1;return}if(d.value==-1){N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}v().loading_full=!0;const{data:s,error:a,status:_}=await A("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:u.value[d.value].id},retry:0});if(v().loading_full=!1,_.value==="error"){S().trigger(a);return}P.value=s.value,C.value=!0},lt=()=>{et(P.value)};return(s,a)=>{const _=it,g=ut,j=rt,D=ct,k=pt,at=ft,ot=vt,st=dt,nt=mt;return b(),y("div",St,[p(_,{title:"List Transaction"}),t("div",Ht,[t("div",Nt,[t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[0]||(a[0]=e=>G())},[p(g)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[1]||(a[1]=e=>Q())},[p(j)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[2]||(a[2]=e=>X())},[p(D)]),t("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:a[3]||(a[3]=e=>E())},[p(k)])]),t("form",Pt,[t("div",Ft,[zt,z(t("input",{class:"",type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>wt(c)?c.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[bt,l(c)]])]),t("div",It,[Lt,z(t("select",{class:"","onUpdate:modelValue":a[5]||(a[5]=e=>l(h).field=e)},Et,512),[[Y,l(h).field]])]),t("div",Ot,[Yt,z(t("select",{class:"","onUpdate:modelValue":a[6]||(a[6]=e=>l(h).by=e)},Kt,512),[[Y,l(h).by]])]),t("div",Jt,[t("button",{class:"",type:"submit",name:"button",onClick:a[7]||(a[7]=Tt(e=>Z(),["prevent"]))},[p(at,{class:"text-2xl"})])])]),t("div",qt,[l(u).length==0?(b(),y("div",Zt," Maaf Tidak Ada Record ")):(b(),y("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:M,onScroll:q},[t("table",Gt,[Qt,t("tbody",null,[(b(!0),y(Dt,null,At(l(u),(e,F)=>(b(),y("tr",{key:F,onClick:ne=>d.value=F,class:Mt(l(d)==F?"active":"")},[t("td",Xt,o(e.id),1),t("td",null,o(e.tanggal?l(m)(e.tanggal).format("DD-MM-Y"):""),1),t("td",null,o(e.xto),1),t("td",null,o(e.tipe),1),t("td",null,o(e.jenis),1),t("td",null,o(l(f)(e.amount)),1),t("td",null,o(e.pv_no),1),t("td",null,o(l(f)(e.pv_total)),1),t("td",null,o(e.ticket_a_no),1),t("td",null,o(l(f)(e.ticket_a_bruto)),1),t("td",null,o(l(f)(e.ticket_a_tara)),1),t("td",null,o(l(f)(e.ticket_a_netto)),1),t("td",null,o(e.ticket_a_supir),1),t("td",null,o(e.ticket_a_no_pol),1),t("td",null,o(l(m)(e.ticket_a_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(m)(e.ticket_a_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.ticket_b_no),1),t("td",null,o(l(f)(e.ticket_b_bruto)),1),t("td",null,o(l(f)(e.ticket_b_tara)),1),t("td",null,o(l(f)(e.ticket_b_netto)),1),t("td",null,o(e.ticket_b_supir),1),t("td",null,o(e.ticket_b_no_pol),1),t("td",null,o(l(m)(e.ticket_b_in_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(l(m)(e.ticket_b_out_at).format("DD-MM-Y HH:mm:ss")),1),t("td",null,o(e.supir),1),t("td",null,o(e.no_pol),1),t("td",null,o(e.created_at?l(m)(e.created_at).format("DD-MM-Y HH:mm:ss"):""),1),t("td",null,o(e.updated_at?l(m)(e.updated_at).format("DD-MM-Y HH:mm:ss"):""),1)],10,Wt))),128))])])],544))])]),p(ot,{type:"delete",show:l(T),data:l(V),fnClose:W,fnConfirm:tt},null,8,["show","data"]),p(st,{show:l(B),fnClose:()=>{B.value=!1},id:l(H),p_data:l(u),list_ujalan:l(R),list_ticket:l(U),list_pv:l(K)},null,8,["show","fnClose","id","p_data","list_ujalan","list_ticket","list_pv"]),l(C)?(b(),y("div",te,[t("div",ee,[t("div",le,[p(nt,{style:{color:"black",cursor:"pointer"},onClick:a[8]||(a[8]=e=>E())})]),t("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(P).dataBase64},null,8,ae),t("div",{style:{position:"absolute",top:"12px",right:"98px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:a[9]||(a[9]=e=>lt())})])])):xt("",!0)])}}};export{be as default};
