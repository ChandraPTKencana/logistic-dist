import{_ as _e}from"./Header.88dad2af.js";import{u as ue,_ as ce}from"./useDownload.76375d2c.js";import{_ as de}from"./Table2Column.2689c479.js";import{_ as pe}from"./client-only.b7fd926e.js";import{u as L,_ as be}from"./useUtils.cbe06c40.js";import{_ as fe,a as ke}from"./Check.2f9a6b04.js";import{_ as me}from"./TableView.36c5d230.js";import{_ as ve}from"./PopupMini.vue.fc84b0bb.js";import{_ as ye}from"./Times.c7b6c435.js";import{r as _,f as ge,D as he,B as xe,H as Z,I as we,J as De,c as q,b as d,a as o,w as r,t as u,k as l,h as Y,j as Te,i as $e,l as G,m as Me,G as Se,E as Ae,x as b,y as T,o as v,q as Ce,N as h,d as c,O as Be,s as Ne}from"./entry.4c35601f.js";import{u as $}from"./useMyFetch.78650e3b.js";import"./_plugin-vue_export-helper.c27b6911.js";const Ve={class:"w-full h-full flex flex-col"},je={class:"w-full flex grow flex-col overflow-auto h-0"},Pe={class:"w-full flex"},He={action:"#",class:"w-full flex p-1"},Ye=o("div",{class:"font-bold"}," Tgl Dari ",-1),Oe={class:"text-red-500"},Fe=o("div",{class:"font-bold"}," Tgl Sampai ",-1),Ie={class:"text-red-500"},ze={class:"grow"},Ke=o("div",{class:"font-bold"}," Keyword ",-1),Ee={class:"pl-1"},Ue=o("div",{class:"font-bold"}," Sort By ",-1),Je=Be('<option value=""></option><option value="id">ID</option><option value="xto">To</option><option value="jenis">Jenis</option><option value="tipe">Tipe</option><option value="pv_no">PV No</option><option value="ticket_a_no">Ticket A No</option><option value="ticket_b_no">Ticket B No</option>',8),Re=[Je],Le={class:"pl-1"},Ze=o("div",{class:"font-bold"}," Sort Order ",-1),qe=o("option",{value:"asc"},"Asc",-1),Ge=o("option",{value:"desc"},"Desc",-1),Qe=[qe,Ge],We={class:"flex items-end pl-1"},Xe={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},et={class:"relative",style:{width:"95%",height:"90%"}},tt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},at=["src"],mt={__name:"index",async setup(ot){let M,O;const{$moment:F}=Ne(),{pointFormat:f}=L(),n={};n._TimeZoneOffset=new Date().getTimezoneOffset(),n.sort="tanggal:desc";const S=_({}),x=ge("token"),k=_({from:"",to:""}),{data:Q}=([M,O]=he(async()=>Ae(async()=>{b().loading_full=!0;let a=[];const[t,i]=await Promise.all([$("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},retry:0})]);return t.status.value!=="error"&&(a=t.data.value.data),t.status.value==="error"?(T().trigger(t.error),{trx_trps:a}):(b().loading_full=!1,{trx_trps:a})},"$8KmJHfPiB5")),M=await M,O(),M),m=_(Q.value.trx_trps||[]),s=_(""),y=_({field:"tanggal",by:"desc"}),w=_(-1),p=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),B=()=>{n.like="",s.value!=""&&(n.like=`id:%${s.value}%,xto:%${s.value}%,jenis:%${s.value}%,pv_no:%${s.value}%,ticket_a_no:%${s.value}%,ticket_b_no:%${s.value}%,no_pol:%${s.value}%,supir:%${s.value}%,kernet:%${s.value}%,cost_center_code:%${s.value}%,cost_center_desc:%${s.value}%,pvr_id:%${s.value}%,pvr_no:%${s.value}%,tanggal:%${s.value}%,transition_to:%${s.value}%`),n.sort="",y.value.field&&(n.sort=y.value.field+":"+y.value.by),n._TimeZoneOffset=new Date().getTimezoneOffset(),n.date_from=k.value.from?F(k.value.from).format("YYYY-MM-DD"):"",n.date_to=k.value.to?F(k.value.to).format("YYYY-MM-DD"):""},I=_(null),z=async()=>{b().loading_full=!0,S.value={},p.value.may_get_data=!1,n.page=p.value.page,n.page==1&&(m.value=[]),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(m.value[0]));const{data:a,error:t,status:i}=await $("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,p.value.may_get_data=!0,i.value==="error"){T().trigger(t,S);return}p.value.page==1?(m.value=a.value.data,I.value&&(I.value.scrollTop=0)):p.value.page>1&&(m.value=[...m.value,...a.value.data]),a.value.data.length==0&&(p.value.is_last_record=!0)},W=()=>{p.value.page=1,p.value.is_last_record=!1,B(),z()};xe(),_(!1),_(0),Z(),we(Z());const X=_({}),A=_(!1),ee=async()=>{A.value&&(A.value=!1)},te=async()=>{b().loading_full=!0;const a=new FormData;a.append("id",m.value[w.value].id),a.append("_method","DELETE");const{data:t,error:i,status:g}=await $("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},body:a,retry:0});if(b().loading_full=!1,g.value==="error"){T().trigger(i);return}m.value.splice(w.value,1),w.value=-1,A.value=!1},{downloadFile:K,viewFile:lt}=ue(),C=_(!1),N=_(""),E=async()=>{if(C.value==!0){C.value=!1;return}B(),b().loading_full=!0;const{data:a,error:t,status:i}=await $("/trx_trps_preview_file",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,i.value==="error"){T().trigger(t);return}N.value=a.value,C.value=!0},ae=async()=>{B(),b().loading_full=!0;const{data:a,error:t,status:i}=await $("/trx_trps_download_excel",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:n,retry:0});if(b().loading_full=!1,i.value==="error"){T().trigger(t);return}K(a.value)},oe=()=>{K(N.value)},U=a=>a.pv_id<=0||["CPO","PK"].indexOf(a.jenis)>-1&&(a.ticket_a_id<=0||a.ticket_b_bruto<=0||a.ticket_b_tara<=0||a.ticket_b_netto<=0||a.ticket_b_in_at==""||a.ticket_b_out_at=="")||a.jenis=="TBS"&&(a.ticket_a_id<=0||a.ticket_b_id<=0)||a.jenis=="TBSK"&&a.ticket_b_id<=0?0:1,le=_([{key:"status",label:"Status"},{key:"app1",label:"App 1"},{key:"app2",label:"App 2"},{key:"id",label:"ID"},{key:"tanggal",label:"U.Jalan Per",dateformat:"DD-MM-Y"},{key:"no_pol",label:"No Pol"},{key:"xto",label:"Tujuan"},{key:"tipe",label:"Tipe"},{key:"jenis",label:"Jenis"},{key:"amount",label:"Amount",class:" justify-end"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"default",class:" justify-start"},{key:"cost_center_desc",label:"Desc"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No"},{key:"pvr_total",label:"Total"},{key:"pvr_completed",label:"Completed"}]},{key:"pv",label:"PV",childs:[{key:"pv_no",label:"No"},{key:"pv_total",label:"Total"}]},{key:"transition_to",label:"Peralihan"},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No"},{key:"ticket_a_bruto",label:"Bruto"},{key:"ticket_a_tara",label:"Tara"},{key:"ticket_a_netto",label:"Netto"},{key:"ticket_a_supir",label:"Supir"},{key:"ticket_a_no_pol",label:"No Pol"},{key:"ticket_a_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_a_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No"},{key:"ticket_b_bruto",label:"Bruto"},{key:"ticket_b_tara",label:"Tara"},{key:"ticket_b_netto",label:"Netto"},{key:"ticket_b_supir",label:"Supir"},{key:"ticket_b_no_pol",label:"No Pol"},{key:"ticket_b_in_at",label:"In At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"ticket_b_out_at",label:"Out At",dateformat:"DD-MM-Y HH:mm:ss"}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir"},{key:"kernet",label:"Kernet"},{key:"created_at",label:"Created At",dateformat:"DD-MM-Y HH:mm:ss"},{key:"updated_at",label:"Updated At",dateformat:"DD-MM-Y HH:mm:ss"}]),V=(a,t)=>{a=parseFloat(a)||0,t=parseFloat(t)||0;let i=parseFloat(t-a),g=i>0?t:a;if(g==0)return 0;let D=L().round(i/g*100,2);return D<0?"("+Math.abs(D*100)/100+")":D},j=(a,t)=>{a=parseFloat(a)||0,t=parseFloat(t)||0;let i=parseFloat(t-a);return i<0?"("+f(Math.abs(i))+")":f(i)};return(a,t)=>{const i=_e,g=ce,D=de,J=De("vue-date-picker"),R=pe,se=be,P=fe,H=ke,ne=me,re=ve,ie=ye;return v(),q("div",Ve,[d(i,{title:"Report Transaction"}),o("div",je,[o("div",Pe,[o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=e=>E())},[d(g)]),o("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=e=>ae())},[d(D)])]),o("form",He,[o("div",null,[Ye,d(R,null,{default:r(()=>[d(J,{modelValue:l(k).from,"onUpdate:modelValue":t[2]||(t[2]=e=>l(k).from=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),o("p",Oe,u(l(S).date_from),1)]),o("div",null,[Fe,d(R,null,{default:r(()=>[d(J,{modelValue:l(k).to,"onUpdate:modelValue":t[3]||(t[3]=e=>l(k).to=e),type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue"])]),_:1}),o("p",Ie,u(l(S).date_to),1)]),o("div",ze,[Ke,Y(o("input",{class:"",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>$e(s)?s.value=e:null),name:"search",placeholder:"Keyword"},null,512),[[Te,l(s)]])]),o("div",Ee,[Ue,Y(o("select",{class:"","onUpdate:modelValue":t[5]||(t[5]=e=>l(y).field=e)},Re,512),[[G,l(y).field]])]),o("div",Le,[Ze,Y(o("select",{class:"","onUpdate:modelValue":t[6]||(t[6]=e=>l(y).by=e)},Qe,512),[[G,l(y).by]])]),o("div",We,[o("button",{class:"",type:"submit",name:"button",onClick:t[7]||(t[7]=Me(e=>W(),["prevent"]))},[d(se,{class:"text-2xl"})])])]),d(ne,{thead:l(le),selected:l(w),onSetSelected:t[8]||(t[8]=e=>w.value=e),tbody:l(m),fnCallData:z,scrolling:l(p),onSetScrollingPage:t[9]||(t[9]=e=>l(p).page=e)},{status:r(({item:e})=>[o("div",{class:Ce(["text-white text-xs px-2 py-1 rounded-lg",U(e)?"bg-green-600":"bg-red-600"])},u(U(e)?"Done":"Not Done"),3)]),app1:r(({item:e})=>[e.val?(v(),h(H,{key:1})):(v(),h(P,{key:0}))]),app2:r(({item:e})=>[e.val1?(v(),h(H,{key:1})):(v(),h(P,{key:0}))]),pvr_completed:r(({item:e})=>[e.pvr_had_detail?(v(),h(H,{key:1})):(v(),h(P,{key:0}))]),susut_bruto_a:r(({item:e})=>[c(u(l(f)(e.ticket_a_bruto)),1)]),susut_tara_a:r(({item:e})=>[c(u(l(f)(e.ticket_a_tara)),1)]),susut_netto_a:r(({item:e})=>[c(u(l(f)(e.ticket_a_netto)),1)]),susut_bruto_b:r(({item:e})=>[c(u(l(f)(e.ticket_b_bruto)),1)]),susut_tara_b:r(({item:e})=>[c(u(l(f)(e.ticket_b_tara)),1)]),susut_netto_b:r(({item:e})=>[c(u(l(f)(e.ticket_b_netto)),1)]),susut_bruto_b_a:r(({item:e})=>[c(u(j(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a:r(({item:e})=>[c(u(j(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a:r(({item:e})=>[c(u(j(e.ticket_a_netto,e.ticket_b_netto)),1)]),susut_bruto_b_a_persen:r(({item:e})=>[c(u(V(e.ticket_a_bruto,e.ticket_b_bruto)),1)]),susut_tara_b_a_persen:r(({item:e})=>[c(u(V(e.ticket_a_tara,e.ticket_b_tara)),1)]),susut_netto_b_a_persen:r(({item:e})=>[c(u(V(e.ticket_a_netto,e.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),d(re,{type:"delete",show:l(A),data:l(X),fnClose:ee,fnConfirm:te},null,8,["show","data"]),l(C)?(v(),q("div",Xe,[o("div",et,[o("div",tt,[d(ie,{style:{color:"black",cursor:"pointer"},onClick:t[10]||(t[10]=e=>E())})]),o("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(N).dataBase64},null,8,at),o("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:t[11]||(t[11]=e=>oe())})])])):Se("",!0)])}}};export{mt as default};
