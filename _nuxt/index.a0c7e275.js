import{_ as He}from"./Header.71ed6a7a.js";import{_ as Le}from"./Plus.20e40809.js";import{_ as Ke}from"./Edit.468b824a.js";import{_ as Je}from"./Eyes.a945b41c.js";import{_ as Ge}from"./Delete.33334e8b.js";import{_ as Ze}from"./Void.93e3bfbf.js";import{_ as Qe}from"./Signature.51267873.js";import{u as We,_ as Xe}from"./useDownload.35afcaaa.js";import{_ as et,a as tt}from"./trx_absen.1f0716fb.js";import{_ as at,a as lt}from"./Check.35d029cf.js";import{_ as ot}from"./TableView.8cb0d023.js";import{_ as nt}from"./PopupMini.vue.47efb420.js";import{_ as st,a as rt}from"./trx_trp_validasi.2aaa1ab8.js";import{r,g as W,f as dt,D as it,J as j,H as ut,c as q,b as m,a as f,h as X,l as _t,k as l,i as ee,G as C,d as P,q as pt,t as te,w as b,E as vt,x as u,y as A,o as p,K as h,j as ve,M as ct,s as ft}from"./entry.d239d820.js";import{u as O}from"./useMyFetch.75d43dc0.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.185b5495.js";import"./Times.74e0f3d2.js";import"./useUtils.807de404.js";import"./Search.547d4f6a.js";import"./client-only.5c3a87a2.js";const mt={class:"w-full h-full flex flex-col"},yt={class:"w-full flex grow flex-col overflow-auto h-0"},bt={class:"w-full flex justify-between flex-wrap"},gt={class:"grow flex"},xt={class:"m-1"},kt=ct('<option value="pv_not_done">Undone</option><option value="pv_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),ht=[kt],wt={class:"flex"},Dt=f("span",{class:"text-xs"},"Mode",-1),$t={class:"grow mb-5"},qt=f("b",null,"tidak dapat dibatalkan lagi",-1),Ct={class:"grow mb-5"},Qt={__name:"index",async setup(At){let F,ae;const{$moment:le}=ft(),R=t=>t.deleted==1?"!bg-red-400":t.pvr_id>0&&t.req_deleted==1?"!bg-yellow-300":t.pv_id>0?"!bg-blue-300":"",z=t=>(t.map(e=>{e.class_h=R(e)}),t),g=r("pv_not_done");W(()=>g.value,t=>{_e.value.map(e=>{let d=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(e.key)>-1;return["all","deleted","req_deleted"].indexOf(t)>-1?d&&(e.tbl_show=1):d&&(e.tbl_show=0),e}),re()},{immediate:!1});const _={};_._TimeZoneOffset=new Date().getTimezoneOffset(),_.sort="tanggal:desc";const oe=r({}),E=r({from:"",to:""}),w=dt("token"),{data:ce}=([F,ae]=it(async()=>vt(async()=>{u().loading_full=!0;let t=[];const[e,d]=await Promise.all([O("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{filter_status:g},retry:0})]);return e.status.value!=="error"&&(t=z(e.data.value.data)),e.status.value==="error"?(A().trigger(e.error),{trx_trps:t}):(u().loading_full=!1,{trx_trps:t})},"$pFLmKcrKj9")),F=await F,ae(),F),n=r(ce.value.trx_trps||[]),ne=r([]),D=r(!1),fe=async()=>{u().loading_full=!0;const{data:t,error:e,status:d}=await O("/trx_load_cost_center",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{online_status:D.value},retry:0});if(u().loading_full=!1,d.value==="error"){A().trigger(e);return}ne.value=t.value.list_cost_center},v=r(""),H=r({field:"tanggal",by:"desc"}),a=r(-1),c=j(()=>n.value[a.value]),y=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),me=()=>{_.like="",v.value!=""&&(_.like=`id:%${v.value}%,xto:%${v.value}%,jenis:%${v.value}%,pv_no:%${v.value}%,ticket_a_no:%${v.value}%,ticket_b_no:%${v.value}%,no_pol:%${v.value}%,supir:%${v.value}%,kernet:%${v.value}%,cost_center_code:%${v.value}%,cost_center_desc:%${v.value}%,pvr_id:%${v.value}%,pvr_no:%${v.value}%,tanggal:%${v.value}%,transition_to:%${v.value}%`),_.sort="",H.value.field&&(_.sort=H.value.field+":"+H.value.by),_.date_from=E.value.from?le(E.value.from).format("YYYY-MM-DD"):"",_.date_to=E.value.to?le(E.value.to).format("YYYY-MM-DD"):"",_.filter_model=JSON.stringify(u()._tv.filter_model)},se=async()=>{u().loading_full=!0,oe.value={},y.value.may_get_data=!1,_.page=y.value.page,_.page==1&&(n.value=[]),_.first_row&&delete _.first_row,_.page>1&&(_.first_row=JSON.stringify(n.value[0])),_.filter_status=g.value;const{data:t,error:e,status:d}=await O("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:_,retry:0});if(u().loading_full=!1,y.value.may_get_data=!0,d.value==="error"){A().trigger(e,oe);return}y.value.page==1?n.value=z(t.value.data):y.value.page>1&&(n.value=[...n.value,...z(t.value.data)]),t.value.data.length==0&&(y.value.is_last_record=!0),u()._tv.filter_box=!1},re=()=>{a.value=-1,y.value.page=1,y.value.is_last_record=!1,me(),se()},N=r(!1),L=r(0),ye=()=>{L.value=0,N.value=!0},{display:$}=ut(),be=()=>{a.value==-1?$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(L.value=n.value[a.value].id,N.value=!0)},I=r(!1),K=r(0),J=r(!1),ge=()=>{a.value==-1?$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(K.value=n.value[a.value].id,I.value=!0,J.value=!1)},xe=()=>{a.value==-1?$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(K.value=n.value[a.value].id,I.value=!0,J.value=!0)},G=r(!1),de=r(0),ke=t=>{de.value=t,G.value=!0},Z=r(!1),ie=r({}),B=r(!1),S=r(""),he=async()=>{B.value&&(B.value=!1)},we=()=>{a.value==-1?$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value="",ie.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},B.value=!0)};W(()=>S.value,t=>{t.trim().length>0?Z.value=!0:Z.value=!1},{immediate:!1});const De=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("deleted_reason",S.value),t.append("_method","DELETE");const{data:e,error:d,status:x}=await O("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,x.value==="error"){A().trigger(d);return}let s={...n.value[a.value]};s.deleted=e.value.deleted,s.deleted_user=e.value.deleted_user,s.deleted_at=e.value.deleted_at,s.deleted_by=e.value.deleted_by,s.deleted_reason=e.value.deleted_reason,s.class_h=R(s),g.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...s}),a.value=-1,B.value=!1},Q=r(!1),ue=r({}),V=r(!1),M=r(""),$e=async()=>{V.value&&(V.value=!1)},qe=()=>{a.value==-1?$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(M.value="",ue.value={id:n.value[a.value].id,"no pol":n.value[a.value].no_pol,tujuan:n.value[a.value].xto},V.value=!0)};W(()=>M.value,t=>{t.trim().length>0?Q.value=!0:Q.value=!1},{immediate:!1});const Ce=async()=>{u().loading_full=!0;const t=new FormData;t.append("id",n.value[a.value].id),t.append("req_deleted_reason",M.value),t.append("_method","DELETE");const{data:e,error:d,status:x}=await O("/trx_trp_req_delete",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,x.value==="error"){A().trigger(d);return}let s={...n.value[a.value]};s.req_deleted=e.value.req_deleted,s.req_deleted_user=e.value.req_deleted_user,s.req_deleted_by=e.value.req_deleted_by,s.req_deleted_at=e.value.req_deleted_at,s.req_deleted_reason=e.value.req_deleted_reason,s.class_h=R(s),g.value!="all"?n.value.splice(a.value,1):n.value.splice(a.value,1,{...s}),a.value=-1,V.value=!1},{printHtml:Ae}=We(),Oe=async()=>{if(a.value==-1){$({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"});return}u().loading_full=!0;const{data:t,error:e,status:d}=await O("/trx_trp_preview_file",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:n.value[a.value].id},retry:0});if(u().loading_full=!1,d.value==="error"){A().trigger(e);return}Ae(t.value.html,318)},Te=async()=>{u().loading_full=!0;const t=new FormData;t.append("online_status",D.value);const{data:e,error:d,status:x}=await O("/trx_trp_do_gen_pvr",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,x.value==="error"){A().trigger(d);return}e.value.forEach(s=>{let k=n.value.map(i=>i.id).indexOf(s.id);if(k!==-1){let i=n.value[k];i.pvr_id=s.pvr_id,i.pvr_no=s.pvr_no,i.pvr_total=s.pvr_total,i.pvr_had_detail=s.pvr_had_detail,i.updated_at=s.updated_at,n.value.splice(k,1,{...i})}}),$({show:!0,status:"Success",message:"Generate Or Update PVR Done"})},Pe=async()=>{u().loading_full=!0;const t=new FormData;t.append("online_status",D.value);const{data:e,error:d,status:x}=await O("/trx_trp_do_update_pv",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:t,retry:0});if(u().loading_full=!1,x.value==="error"){A().trigger(d);return}e.value.data.forEach(s=>{let k=n.value.map(i=>i.id).indexOf(s.id);if(k!==-1){let i=n.value[k];i.pv_id=s.pv_id,i.pv_no=s.pv_no,i.pv_total=s.pv_total,i.pv_datetime=s.pv_datetime,i.updated_at=s.updated_at,n.value.splice(k,1,{...i})}}),$({show:!0,status:"Success",message:"Update PV Done"})},_e=r([{key:"no",label:"No",isai:!0},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"absen",label:"Absen"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",type:"string",class:" justify-start",filter_on:1},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),Se=j(()=>a.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&[void 0,0].indexOf(c.value.val1)>-1&&[void 0,""].indexOf(c.value.pvr_id)>-1),Me=j(()=>a.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&[void 0,0].indexOf(c.value.val)>-1&&[void 0,""].indexOf(c.value.pvr_id)>-1),je=j(()=>a.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&[void 0,""].indexOf(c.value.pvr_id)>-1),Be=j(()=>a.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1&&c.value.pvr_id!=""),Ve=j(()=>a.value>-1&&[void 0,0].indexOf(c.value.deleted)>-1&&[void 0,0].indexOf(c.value.req_deleted)>-1);return(t,e)=>{const d=He,x=Le,s=Ke,k=Je,i=Ge,Fe=Ze,Ee=Qe,Ne=Xe,Ie=tt,U=at,Y=lt,Ue=ot,pe=nt,Ye=st,Re=rt,ze=et;return p(),q("div",mt,[m(d,{title:"List Transaction"}),f("div",yt,[f("div",bt,[f("div",gt,[f("div",xt,[X(f("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=o=>ee(g)?g.value=o:null)},ht,512),[[_t,l(g)]])]),["pv_not_done","all"].indexOf(l(g))>-1?(p(),q("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=o=>ye())},[m(x)])):C("",!0),l(Se)?(p(),q("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=o=>be())},[m(s)])):C("",!0),l(a)>-1?(p(),q("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=o=>xe())},[m(k)])):C("",!0),l(je)?(p(),q("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=o=>we())},[m(i)])):C("",!0),l(Be)?(p(),q("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=o=>qe())},[m(Fe)])):C("",!0),l(Me)?(p(),q("button",{key:5,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[6]||(e[6]=o=>ge())},[m(Ee)])):C("",!0),l(Ve)?(p(),q("button",{key:6,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[7]||(e[7]=o=>Oe())},[m(Ne)])):C("",!0)]),f("div",wt,[f("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[8]||(e[8]=o=>Te())}," Gen/Update PVR "),f("button",{type:"button",name:"button",class:"m-1 text-xs whitespace-nowrap",onClick:e[9]||(e[9]=o=>Pe())}," Update PV "),f("div",{class:"m-1 card-border cursor-pointer",onClick:e[10]||(e[10]=o=>D.value=!l(D))},[Dt,P(" : "),f("span",{class:pt(["font-bold",l(D)?"text-green-600":"text-red-600"])},te(l(D)?"ONLINE":"OFFLINE"),3)])])]),m(Ue,{thead:l(_e),selected:l(a),onSetSelected:e[11]||(e[11]=o=>a.value=o),tbody:l(n),fnCallData:se,scrolling:l(y),onSetScrollingPage:e[12]||(e[12]=o=>l(y).page=o),onDoFilter:e[13]||(e[13]=o=>re())},{absen:b(({item:o,index:T})=>[o.trx_absens&&o.trx_absens.length>0?(p(),h(Ie,{key:0,class:"cursor-pointer",onClick:Ot=>ke(T)},null,8,["onClick"])):C("",!0)]),val:b(({item:o})=>[o.val?(p(),h(Y,{key:1})):(p(),h(U,{key:0}))]),val1:b(({item:o})=>[o.val1?(p(),h(Y,{key:1})):(p(),h(U,{key:0}))]),val2:b(({item:o})=>[o.val2?(p(),h(Y,{key:1})):(p(),h(U,{key:0}))]),pvr_had_detail:b(({item:o})=>[o.pvr_had_detail?(p(),h(Y,{key:1})):(p(),h(U,{key:0}))]),deleted_by_username:b(({item:o})=>{var T;return[P(te((T=o.deleted_by)==null?void 0:T.username),1)]}),req_deleted_by_username:b(({item:o})=>{var T;return[P(te((T=o.req_deleted_by)==null?void 0:T.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),m(pe,{type:"delete",show:l(B),data:l(ie),fnClose:he,fnConfirm:De,enabledOk:l(Z)},{footer:b(()=>[P(" Masukkan Alasan Penghapusan: "),f("div",$t,[X(f("textarea",{"onUpdate:modelValue":e[14]||(e[14]=o=>ee(S)?S.value=o:null)},null,512),[[ve,l(S)]])])]),_:1},8,["show","data","enabledOk"]),m(pe,{type:"custome",show:l(V),data:l(ue),fnClose:$e,fnConfirm:Ce,enabledOk:l(Q)},{words:b(()=>[P(" Data akan diproses dan "),qt,P(", yakin untuk melanjutkan ? ")]),footer:b(()=>[P(" Masukkan Alasan Permintaan Penghapusan: "),f("div",Ct,[X(f("textarea",{"onUpdate:modelValue":e[15]||(e[15]=o=>ee(M)?M.value=o:null)},null,512),[[ve,l(M)]])])]),_:1},8,["show","data","enabledOk"]),m(Ye,{show:l(N),fnClose:()=>{N.value=!1},fnLoadDBData:fe,id:l(L),p_data:l(n),list_cost_center:l(ne),online_status:l(D)},null,8,["show","fnClose","id","p_data","list_cost_center","online_status"]),m(Re,{show:l(I),fnClose:()=>{I.value=!1},id:l(K),p_data:l(n),is_view:l(J)},null,8,["show","fnClose","id","p_data","is_view"]),m(ze,{show:l(G),fnClose:()=>{G.value=!1},index:l(de),p_data:l(n)},null,8,["show","fnClose","index","p_data"])])}}};export{Qt as default};
