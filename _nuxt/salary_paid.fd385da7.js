import{_ as G}from"./HeaderPopup.vue.4e79d294.js";import{_ as I}from"./client-only.c942ad6b.js";import{r as x,f as O,G as b,j as Y,I as H,m as K,M as L,o as i,c as d,a as e,b as k,k as a,t as s,w as J,d as g,F as D,y as Q,l as N,x as W,E as X,A as y,B as E}from"./entry.71d3ffb3.js";import{u as C}from"./useUtils.4ecc014f.js";import{u as z}from"./useMyFetch.e93b9b43.js";import"./Times.aa566d17.js";import"./_plugin-vue_export-helper.c27b6911.js";const Z={class:"box-fixed"},ee={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},te={class:"w-full flex flex-col items-center grow overflow-auto"},ae={class:"w-full flex flex-row flex-wrap"},le={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},oe=e("label",{for:""},"Period End",-1),se={key:0,class:"card-border"},ne={key:1},re={class:"text-red-500"},ie={key:0,class:"w-full flex p-1 2xl:overflow-hidden justify-between flex-wrap"},de={class:"w-full",role:"sticky"},ue={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ce=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"10",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),_e={class:"sticky top-7 !z-[2]"},pe=e("th",null,"No",-1),me=e("th",null,"Nama Pekerja",-1),fe=e("th",null,"No KTP",-1),ve=e("th",null,"No SIM",-1),he=e("th",null,"Rek No",-1),ye=e("th",null,"Rek Nama",-1),we=e("th",null,"Bank Name",-1),xe={class:"text-sm"},be={class:"text-sm"},ke={class:"text-sm"},ge={ref:"to_move"},Ne=["data-index"],Ce={class:"w-full flex items-center justify-end"},Ve={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(f){const u=f,{$moment:F}=X(),{pointFormat:p}=C(),S={id:"",period_end:new Date},t=x({...S}),B=O("token"),v=x({}),c=x([]),T=async()=>{y().loading_full=!0,v.value={};const o=new FormData;o.append("period_end",t.value.period_end?F(t.value.period_end).format("Y-MM"):"");let n="post",r=t.value.id;r==""||(o.append("id",r),o.append("_method","PUT"));const{data:_,error:w,status:l}=await z("/salary_paid",{method:n,headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:o,retry:0});if(y().loading_full=!1,l.value==="error"){E().trigger(w,v);return}if(c.value=_.value.details,r<=0)t.value.id=_.value.id,t.value.created_at=_.value.created_at,t.value.updated_at=_.value.updated_at,u.p_data.unshift(t.value);else{t.value.updated_at=_.value.updated_at;let m=u.p_data.map(h=>h.id).indexOf(r);m>=-1&&u.p_data.splice(m,1,{...t.value})}},M=b(()=>{let o=0;return c.value.forEach(n=>{o+=parseFloat(n.standby_nominal)}),o}),q=b(()=>{let o=0;return c.value.forEach(n=>{o+=parseFloat(n.salary_bonus_nominal)}),o}),R=b(()=>t.value.val&&t.value.val1||C().checkPermission("salary_paid.val")&&t.value.val||C().checkPermission("salary_paid.val1")&&t.value.val1),U=async()=>{y().loading_full=!0;const{data:o,error:n,status:r}=await z("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{id:u.id},retry:0});if(y().loading_full=!1,r.value==="error"){E().trigger(n);return}t.value=o.value.data,u.is_copy&&(t.value.val=0,t.value.val1=0),c.value=o.value.data.details};return Y(()=>u.show,(o,n)=>{o==!0&&(t.value={...S},c.value=[],v.value={},u.id!=0&&U())},{immediate:!0}),(o,n)=>{const r=G,_=H("vue-date-picker"),w=I;return K((i(),d("section",Z,[e("div",null,[k(r,{title:"Form Salary Paid",fn:f.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",ee,[e("div",te,[e("div",ae,[e("div",le,[oe,a(t).id?(i(),d("div",se,s(a(F)(a(t).period_end).format("MM-Y")),1)):(i(),d("div",ne,[k(w,null,{default:J(()=>[k(_,{modelValue:a(t).period_end,"onUpdate:modelValue":n[0]||(n[0]=l=>a(t).period_end=l),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",re,s(a(v).period_end),1)])]),a(c).length?(i(),d("div",ie,[e("div",de,[e("table",ue,[e("thead",null,[ce,e("tr",_e,[pe,me,fe,ve,he,ye,we,e("th",null,[g("Nominal Standby "),e("span",xe,"("+s(a(p)(a(M)||0))+")",1)]),e("th",null,[g("Nominal Bonus "),e("span",be,"("+s(a(p)(a(q)||0))+")",1)]),e("th",null,[g("Total "),e("span",ke,"("+s(a(p)(a(M)+a(q)||0))+")",1)])])]),e("tbody",ge,[(i(!0),d(D,null,Q(a(c),(l,m)=>{var h,A,P,V,$,j;return i(),d(D,{key:m},[l.p_status!="Remove"?(i(),d("tr",{key:0,"data-index":m},[e("td",null,s(m+1)+".",1),e("td",null,s((h=l.employee)==null?void 0:h.name),1),e("td",null,s((A=l.employee)==null?void 0:A.ktp_no),1),e("td",null,s((P=l.employee)==null?void 0:P.sim_no),1),e("td",null,s((V=l.employee)==null?void 0:V.rek_no),1),e("td",null,s(($=l.employee)==null?void 0:$.rek_name),1),e("td",null,s((j=l.employee)==null?void 0:j.bank_name),1),e("td",null,s(a(p)(l.standby_nominal)),1),e("td",null,s(a(p)(l.salary_bonus_nominal)),1),e("td",null,s(a(p)(parseFloat(l.standby_nominal)+parseFloat(l.salary_bonus_nominal))),1)],8,Ne)):N("",!0)],64)}),128))],512)])])])):N("",!0)]),e("div",Ce,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:n[1]||(n[1]=l=>f.fnClose())}," Cancel "),a(R)?N("",!0):(i(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:n[2]||(n[2]=W(l=>T(),["prevent"]))}," Generate "+s(a(t).id==""?"& Save":""),1))])])])],512)),[[L,f.show]])}}};export{Ve as default};
