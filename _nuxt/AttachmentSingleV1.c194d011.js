import P from"./PDFJsView.683d6d85.js";import{Q as S,a4 as F,M as I,r as a,g as V,a2 as $,f as L,o as c,c as p,a as h,t as q,l as f,n as m,z as A,k as B,L as O}from"./entry.c948bf9c.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";function M(i,d,l,_){let t,g=!1;S(()=>{t=new IntersectionObserver(async([k])=>{k.isIntersecting&&!g&&(g=!0,await d())},{threshold:0,rootMargin:"300px",..._}),i.value&&t.observe(i.value)}),F(()=>{t==null||t.disconnect(),l==null||l()})}const z={class:"w-full"},N={for:""},E={class:"w-full flex justify-center items-center border-[1px] border-gray-300 mb-1"},J={class:"image-box"},Q={key:0},W=["src"],G={key:1,class:"skeleton"},H=I({__name:"AttachmentSingleV1",props:{link:{type:[String,null],required:!0,default:null},label:{type:String,required:!1,default:""},can_remove:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!1}},emits:["setFile","setPreview"],setup(i,{emit:d}){const l=i;a(!1);const _=a(null);a(null),a(null);const t=a(!1),g=e=>{const o=e.target.files;if(!o||!o.length)return;t.value=!0;const r=o[0];u.value=r,s&&URL.revokeObjectURL(s),s=URL.createObjectURL(r),n.value=s,d("setPreview","exist"),d("setFile",r)},k=()=>{b(!0);const e=_.value;e&&(e.value=""),d("setFile",null),d("setPreview",null)},y=a(null),n=a(null);let s=null;const R=V("token"),{apiBase:C}=$(),u=a();L(()=>l.show,e=>{console.log("+showing",e),b(!0),n.value=null,u.value=null,v.value=!1,t.value=!1,console.log("-showing",e)},{immediate:!0,deep:!0}),L(()=>l.link,e=>{console.log("+openlink"),e&&(y.value&&w(),console.log("-openlink"))},{immediate:!0});const v=a(!1);async function w(){if(console.log("++++++trigger load"),console.log("props.link",l.link),console.log("src.value",n.value),console.log("isUserFile.value",t.value),console.log("loadedOnce.value",v.value),console.log("------trigger load"),!l.link||n.value||l.link=="exist"||t.value||v.value)return;const e=l.link.startsWith("http")?l.link:`${C}${l.link}`,o=await fetch(e,{headers:{Authorization:`Bearer ${R.value}`}});if(!o.ok){let r=_.value;r&&(r.value="");return}u.value=await o.blob(),s=URL.createObjectURL(u.value),n.value=s,v.value=!0}function b(e=!1){t.value&&e==!1||v.value&&e==!1||(s&&(URL.revokeObjectURL(s),s=null),n.value=null,u.value=null)}return M(y,w,b,{rootMargin:"300px 0px",threshold:0}),F(()=>{v.value=!1}),(e,o)=>{var x,U;const r=P;return c(),p("div",{ref_key:"wrapper",ref:y,class:"w-full flex flex-col flex-wrap p-1 justify-center items-center border-solid border-gray-300 border-[1px]"},[h("div",z,[h("label",N,q(i.label),1)]),h("div",E,[h("div",J,[f(n)?(c(),p("div",Q,[(x=f(u))!=null&&x.type.match(/image/)?(c(),p("img",{key:0,src:f(n),class:"w-full h-full object-cover"},null,8,W)):m("",!0),(U=f(u))!=null&&U.type.match(/application\/pdf/)?(c(),A(r,{key:1,pdfObjUrl:f(s)},null,8,["pdfObjUrl"])):m("",!0)])):(c(),p("div",G))])]),i.can_remove?B((c(),p("button",{key:0,type:"button",class:"bg-gray-600 w-36 text-white",onClick:o[0]||(o[0]=j=>k())},"Clear",512)),[[O,f(n)]]):m("",!0),i.can_remove?B((c(),p("input",{key:1,class:"w-full",onChange:o[1]||(o[1]=j=>g(j)),ref_key:"photo_input",ref:_,type:"file",name:"photo"},null,544)),[[O,!f(n)]]):m("",!0)],512)}}});const Y=D(H,[["__scopeId","data-v-0dff6e4d"]]);export{Y as default};
