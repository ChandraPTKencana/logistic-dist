import{_ as Y}from"./HeaderPopup.vue.25465def.js";import{_ as H}from"./client-only.e417e5c6.js";import{r as x,f as I,G as v,j as K,I as L,m as z,J as Q,o as r,c as d,a as e,b as g,k as t,t as n,w as W,q as X,d as w,F as T,y as Z,l as F,x as ee,E as te,A as b,B as U}from"./entry.2a139781.js";import{u as N}from"./useUtils.89a6adb9.js";import{u as G}from"./useMyFetch.5f3631a2.js";import"./Times.7e7c3a31.js";import"./_plugin-vue_export-helper.c27b6911.js";const ae={class:"box-fixed"},oe={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},le={class:"w-full flex flex-col items-center grow overflow-auto"},se={class:"w-full flex flex-row flex-wrap"},ne={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},re=e("label",{for:""},"Period End",-1),de={key:0,class:"card-border"},ie={key:1},ue={class:"text-red-500"},_e={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ce=e("label",{for:""},"Period Part",-1),pe={key:0,class:"card-border"},me={key:1},fe=e("option",{value:"1"},"1",-1),ve=e("option",{value:"2"},"2",-1),he=[fe,ve],ye={class:"text-red-500"},we={key:0,class:"w-full flex p-1 justify-between flex-wrap"},be={class:"w-full",role:"sticky"},ke={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},xe=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"11",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),ge={class:"sticky top-7 !z-[2]"},Fe=e("th",null,"No",-1),Ne=e("th",null,"Jabatan",-1),Be=e("th",null,"Nama Pekerja",-1),Ce=e("th",null,"No KTP",-1),Se=e("th",null,"Rek No",-1),je=e("th",null,"Rek Nama",-1),Me=e("th",null,"Bank Name",-1),Pe={class:"text-sm"},qe={class:"text-sm"},Ve={class:"text-sm"},Ae={class:"text-sm"},Ee={ref:"to_move"},$e=["data-index"],De={class:"w-full flex items-center justify-end"},Ye={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(h){const c=h,{$moment:B}=te(),{pointFormat:u}=N(),C={id:"",period_end:new Date,period_part:1},a=x({...C}),S=I("token"),f=x({}),i=x([]),R=async()=>{b().loading_full=!0,f.value={};const o=new FormData;o.append("period_end",a.value.period_end?B(a.value.period_end).format("Y-MM"):""),o.append("period_part",a.value.period_part);let l="post",_=a.value.id;_==""||(o.append("id",_),o.append("_method","PUT"));const{data:p,error:k,status:s}=await G("/salary_paid",{method:l,headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},body:o,retry:0});if(b().loading_full=!1,s.value==="error"){U().trigger(k,f);return}if(i.value=p.value.details,_<=0)a.value.id=p.value.id,a.value.created_at=p.value.created_at,a.value.updated_at=p.value.updated_at,c.p_data.unshift(a.value);else{a.value.updated_at=p.value.updated_at;let m=c.p_data.map(y=>y.id).indexOf(_);m>=-1&&c.p_data.splice(m,1,{...a.value})}};v(()=>{let o=0;return i.value.forEach(l=>{o+=parseFloat(l.standby_nominal)}),o});const j=v(()=>{let o=0;return i.value.forEach(l=>{o+=parseFloat(l.sb_gaji)}),o}),M=v(()=>{let o=0;return i.value.forEach(l=>{o+=parseFloat(l.sb_makan)}),o}),P=v(()=>{let o=0;return i.value.forEach(l=>{o+=parseFloat(l.salary_bonus_nominal)}),o}),J=v(()=>a.value.val&&a.value.val1||N().checkPermission("salary_paid.val")&&a.value.val||N().checkPermission("salary_paid.val1")&&a.value.val1),O=async()=>{b().loading_full=!0;const{data:o,error:l,status:_}=await G("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${S.value}`,Accept:"application/json"},params:{id:c.id},retry:0});if(b().loading_full=!1,_.value==="error"){U().trigger(l);return}a.value=o.value.data,c.is_copy&&(a.value.val=0,a.value.val1=0),i.value=o.value.data.details};return K(()=>c.show,(o,l)=>{o==!0&&(a.value={...C},i.value=[],f.value={},c.id!=0&&O())},{immediate:!0}),(o,l)=>{const _=Y,p=L("vue-date-picker"),k=H;return z((r(),d("section",ae,[e("div",null,[g(_,{title:"Form Salary Paid",fn:h.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",oe,[e("div",le,[e("div",se,[e("div",ne,[re,t(a).id?(r(),d("div",de,n(t(B)(t(a).period_end).format("MM-Y")),1)):(r(),d("div",ie,[g(k,null,{default:W(()=>[g(p,{modelValue:t(a).period_end,"onUpdate:modelValue":l[0]||(l[0]=s=>t(a).period_end=s),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",ue,n(t(f).period_end),1)]),e("div",_e,[ce,t(a).id?(r(),d("div",pe,n(t(a).period_part),1)):(r(),d("div",me,[z(e("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>t(a).period_part=s)},he,512),[[X,t(a).period_part]])])),e("p",ye,n(t(f).period_part),1)])]),t(i).length?(r(),d("div",we,[e("div",be,[e("table",ke,[e("thead",null,[xe,e("tr",ge,[Fe,Ne,Be,Ce,Se,je,Me,e("th",null,[w("SB.Gaji "),e("span",Pe,"("+n(t(u)(t(j)||0))+")",1)]),e("th",null,[w("SB.Makan "),e("span",qe,"("+n(t(u)(t(M)||0))+")",1)]),e("th",null,[w("Nominal Bonus "),e("span",Ve,"("+n(t(u)(t(P)||0))+")",1)]),e("th",null,[w("Total "),e("span",Ae,"("+n(t(u)(t(j)+t(M)+t(P)||0))+")",1)])])]),e("tbody",Ee,[(r(!0),d(T,null,Z(t(i),(s,m)=>{var y,q,V,A,E,$,D;return r(),d(T,{key:m},[s.p_status!="Remove"?(r(),d("tr",{key:0,"data-index":m},[e("td",null,n(m+1)+".",1),e("td",null,n((y=s.employee)==null?void 0:y.role),1),e("td",null,n((q=s.employee)==null?void 0:q.name),1),e("td",null,n((V=s.employee)==null?void 0:V.ktp_no),1),e("td",null,n((A=s.employee)==null?void 0:A.rek_no),1),e("td",null,n((E=s.employee)==null?void 0:E.rek_name),1),e("td",null,n((D=($=s.employee)==null?void 0:$.bank)==null?void 0:D.code),1),e("td",null,n(t(u)(s.sb_gaji)),1),e("td",null,n(t(u)(s.sb_makan)),1),e("td",null,n(t(u)(s.salary_bonus_nominal)),1),e("td",null,n(t(u)(parseFloat(s.sb_gaji)+parseFloat(s.sb_makan)+parseFloat(s.salary_bonus_nominal))),1)],8,$e)):F("",!0)],64)}),128))],512)])])])):F("",!0)]),e("div",De,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[2]||(l[2]=s=>h.fnClose())}," Cancel "),t(J)?F("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[3]||(l[3]=ee(s=>R(),["prevent"]))}," Generate "+n(t(a).id==""?"& Save":""),1))])])])],512)),[[Q,h.show]])}}};export{Ye as default};
