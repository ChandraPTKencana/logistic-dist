import{_ as ve}from"./HeaderPopup.vue.3ed81de8.js";import{_ as me}from"./WidthMiniList.vue.7b8d1d29.js";import fe from"./Tools.af1095e2.js";import{_ as he}from"./client-only.c6736ce6.js";import we from"./AttachmentSingle.b235eb2a.js";import xe from"./Plus.1c66f608.js";import ye from"./ToolsPopup.4f578af6.js";import{r as m,f as be,i as ke,G as te,j as se,A as g,I as ge,o as r,c as d,m as S,J as Se,a as e,b as y,k as s,v as J,F as O,y as U,t as u,q as ae,l as I,w as Ne,x as Ce,B,p as Ae,e as Oe,E as Ie}from"./entry.bfc4a585.js";import{u as Te}from"./useUtils.e5d08feb.js";import{u as M}from"./useMyFetch.f0cb27d3.js";import{_ as Ee}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.0568650d.js";import"./WidthMiniPart.vue.e64b7a82.js";import"./PDFJsView.d7228ffe.js";const i=b=>(Ae("data-v-cec19a9f"),b=b(),Oe(),b),Je={class:"box-fixed"},Ue={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Ve={class:"w-full flex flex-col items-center grow overflow-auto"},De={class:"w-full flex flex-row flex-wrap"},Pe={class:"w-full sm:w-9/12 flex px-2 py-3"},Re={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative"},$e=i(()=>e("div",{class:"absolute bg-white -top-3"}," Standby ",-1)),Fe={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},je=i(()=>e("label",{for:""},"ID",-1)),Be=["disabled"],Me={id:"standby_mst"},qe=["value"],ze={class:"text-red-500"},Ke={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},Le=i(()=>e("label",{for:""},"Name",-1)),Ye={class:"card-border disabled"},Ge={class:"w-6/12 sm:w-4/12 flex flex-col flex-wrap p-1"},He=i(()=>e("label",{for:""},"Type",-1)),We={class:"card-border disabled"},Xe={class:"w-6/12 sm:w-2/12 flex flex-col flex-wrap p-1"},Qe=i(()=>e("label",{for:""},"Amount",-1)),Ze={class:"card-border disabled"},et={class:"w-full sm:w-3/12 flex px-2 py-3"},tt={class:"w-full flex flex-wrap ring-1 ring-gray-500 p-2 relative items-end"},st=i(()=>e("div",{class:"absolute bg-white -top-3"}," Peralihan ",-1)),at={class:"w-6/12 flex flex-col flex-wrap p-1"},lt=["disabled"],ot=i(()=>e("option",{value:""},null,-1)),nt=i(()=>e("option",{value:"From"},"Dari",-1)),it=i(()=>e("option",{value:"To"},"Ke",-1)),_t=[ot,nt,it],rt={class:"text-red-500"},dt={class:"w-6/12 flex flex-col flex-wrap p-1"},ut=["disabled"],ct=i(()=>e("option",{value:""},null,-1)),pt=["value"],vt={class:"text-red-500"},mt={class:"w-full flex flex-wrap"},ft={key:0,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},ht=i(()=>e("label",{for:""},"Supir",-1)),wt={class:"text-red-500"},xt={key:1,class:"w-full sm:w-6/12 md:w-6/12 lg:w-6/12 flex flex-col flex-wrap p-1"},yt=i(()=>e("label",{for:""},"Kernet",-1)),bt={class:"text-red-500"},kt={class:"w-full flex flex-wrap"},gt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},St=i(()=>e("label",{for:""},"No Pol",-1)),Nt=["disabled"],Ct={id:"vehicle"},At=["value"],Ot={class:"text-red-500"},It={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Tt=i(()=>e("label",{for:""},"Tujuan",-1)),Et=["disabled"],Jt={id:"xto"},Ut={class:"text-red-500"},Vt={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Dt=i(()=>e("label",{for:""},"Note For Remarks",-1)),Pt=["disabled"],Rt={class:"text-red-500"},$t={class:"w-6/12 sm:w-4/12 md:w-4/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Ft=i(()=>e("label",{for:""},"Referensi",-1)),jt=["disabled"],Bt={class:"text-red-500"},Mt={class:"w-full flex grow p-1 overflow-auto 2xl:overflow-hidden justify-between flex-wrap"},qt={class:"w-full",role:"sticky"},zt={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},Kt={class:"sticky -top-1 !z-[2]"},Lt=["colspan"],Yt={class:"sticky top-7 !z-[2]"},Gt={key:0,class:"!min-w-[30px] !w-[30px] !max-w-[30px]"},Ht=i(()=>e("th",{class:"!min-w-[50px] !w-[50px] !max-w-[50px]"},"No",-1)),Wt=i(()=>e("th",{class:"!min-w-[150px] !w-[150px] !max-w-[150px]"},"Tanggal",-1)),Xt=i(()=>e("th",{class:"!min-w-[200px] !w-[200px] !max-w-[200px]"},"Foto",-1)),Qt={ref:"to_move"},Zt=["data-index"],es={key:0,class:"tools cell"},ts={class:"w-full h-full flex items-center justify-center"},ss=["onClick"],as={class:"cell"},ls={class:"w-full h-full flex items-center justify-center relative"},os={class:"cell"},ns={style:{width:"70vw"},class:"h-full flex items-center justify-center"},is={key:0},_s={class:"tools cell"},rs={class:"w-full flex items-center justify-end"},ds={__name:"standby_trx",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]}},setup(b){const x=b,{$moment:le}=Ie(),{pointFormat:q}=Te(),P={id:-1,transition_target:"",transition_type:"",standby_mst_id:"",standby_mst_:{name:"",tipe:"",amount:0,is_transition:0},supir:"",kernet:"",no_pol:"",xto:"",note_for_remarks:"",ref:"",pvr_id:"",pvr_no:"",pvr_total:0,pvr_had_detail:0,pv_id:"",pv_no:"",pv_total:0,pv_datetime:"",rv_id:"",rv_no:"",rv_total:0,rv_had_detail:"",details:[],details_count:0},_=m([]),z=m({ordinal:0,id:"",tanggal:new Date,note:"",p_status:"",attachment_1:"",attachment_1_preview:""});let R={...P};const t=m({...P}),$=be("token"),f=m({});ke();const oe=async()=>{g().loading_full=!0,f.value={};const o=new FormData;o.append("transition_target",t.value.transition_target),o.append("transition_type",t.value.transition_type),o.append("standby_mst_id",t.value.standby_mst_id),o.append("supir_id",p.value.id),o.append("kernet_id",v.value.id),o.append("no_pol",t.value.no_pol),o.append("xto",t.value.xto),o.append("note_for_remarks",t.value.note_for_remarks),o.append("ref",t.value.ref);let a=[..._.value];a=a.map((c,T)=>(c.tanggal=c.tanggal?le(c.tanggal).format("Y-MM-DD"):"",c.attachment_1_preview=c.attachment_1_preview?"Exists":null,o.append(`attachments[${T}]`,c.attachment_1),c)),o.append("details",JSON.stringify(a));let w="post",n=x.id;n==0||(o.append("id",n),o.append("_method","PUT"));const{data:C,error:k,status:j}=await M("/standby_trx",{method:w,headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},body:o,retry:0});if(g().loading_full=!1,j.value==="error"){B().trigger(k,f);return}if(t.value.details=[..._.value].map((c,T)=>(c.attachment_1_type=c.attachment_1_preview?"Exists":"",c)),t.value.details_count=_.value.length,t.value.supir=p.value.name,t.value.supir_rek_no=p.value._.rek_no.val,t.value.supir_rek_name=p.value._.rek_name.val,t.value.kernet=v.value.name,t.value.kernet_rek_no=v.value._.rek_no.val,t.value.kernet_rek_name=v.value._.rek_name.val,t.value.updated_at=C.value.updated_at,x.id<=0)t.value.id=C.value.id,t.value.created_at=C.value.created_at,x.p_data.unshift(t.value);else{let c=x.p_data.map(T=>T.id).indexOf(x.id);c>=-1&&x.p_data.splice(c,1,{...t.value})}x.fnClose()},N={_:{id:{tcon:"IconsBaselineNumbers",text:"ID",val:""},name:{tcon:"IconsPerson",text:"Nama",val:""},rek_no:{tcon:"IconsNumber",text:"No Rek",val:""},rek_name:{tcon:"IconsCreditCard",text:"Nama Rek",val:""}},id:"",name:"",title:""},p=m(JSON.parse(JSON.stringify(N))),v=m(JSON.parse(JSON.stringify(N))),K=te(()=>{let o=[];return G.value.forEach((a,w)=>{let n=JSON.parse(JSON.stringify(N));n._.id.val=a.id,n._.name.val=a.name,n._.rek_no.val=a.rek_no,n._.rek_name.val=a.rek_name,n.id=a.id,n.name=a.name,n.title=(a.rek_no||"")+" "+(a.rek_name||""),o.push(JSON.parse(JSON.stringify(n)))}),o}),E=te(()=>!1),ne=async()=>{g().loading_full=!0;const{data:o,error:a,status:w}=await M("/standby_trx",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},params:{id:x.id},retry:0});if(g().loading_full=!1,w.value==="error"){B().trigger(a);return}let n=o.value.data;t.value=n,R={...n},p.value._.id.val=n.supir_id,p.value._.name.val=n.supir,p.value._.rek_no.val=n.supir_rek_no,p.value._.rek_name.val=n.supir_rek_name,p.value.id=n.supir_id,p.value.name=n.supir,p.value.rek_no=(n.supir_rek_no||"")+" "+(n.supir_rek_name||""),v.value._.id.val=n.kernet_id,v.value._.name.val=n.kernet,v.value._.rek_no.val=n.kernet_rek_no,v.value._.rek_name.val=n.kernet_rek_name,v.value.id=n.kernet_id,v.value.name=n.kernet,v.value.rek_no=(n.kernet_rek_no||"")+" "+(n.kernet_rek_name||"");let C="Edit";_.value=o.value.data.details.map(k=>(k.p_status=C,k.key=k.ordinal,k))},F=m([]),L=m([]),Y=m([]),G=m([]),ie=async()=>{g().loading_full=!0;const{data:o,error:a,status:w}=await M("/standby_trx_load_local",{method:"get",headers:{Authorization:`Bearer ${$.value}`,Accept:"application/json"},retry:0});if(g().loading_full=!1,w.value==="error"){B().trigger(a);return}F.value=o.value.list_standby_mst,L.value=o.value.list_xto,Y.value=o.value.list_vehicle,G.value=o.value.list_employee},h=m(-1),V=m(!1),H=m({left:0,top:0}),_e=(o,a)=>{h.value=a,V.value=!0,H.value={left:o.clientX,top:o.clientY}},re=()=>{_.value.push({...z.value,p_status:"Add"})},de=()=>{V.value=!1},ue=(o="")=>{if(o=="insert")_.value.splice(h.value,0,{...z.value,p_status:"Add"});else if(o=="delete")_.value[h.value].p_status=="Edit"?_.value[h.value].p_status="Remove":_.value.splice(h.value,1);else if(o=="move_top"){let a=_.value[h.value];_.value.splice(h.value,1),_.value.splice(h.value-1,0,{...a})}else if(o=="move_bottom"){let a=_.value[h.value];_.value.splice(h.value,1),_.value.splice(h.value+1,0,{...a})}V.value=!1};se(()=>x.show,async(o,a)=>{o==!0&&(await ie(),t.value={...P},p.value=JSON.parse(JSON.stringify(N)),v.value=JSON.parse(JSON.stringify(N)),_.value=[],f.value={},x.id!=0&&ne())},{immediate:!0});let ce={name:"",tipe:"",amount:0,is_transition:0};return se(()=>t.value.standby_mst_id,(o,a)=>{if(g().loading_full==!1&&(o==""||o!="")){let w=F.value.filter(n=>n.id==o);w.length>0?t.value.standby_mst_={...w[0]}:t.value.standby_mst_id==R.standby_mst_id?t.value.standby_mst_={...R.standby_mst_}:t.value.standby_mst_={...ce},t.value.standby_mst_.is_transition||(t.value.transition_target="",t.value.transition_type="")}},{}),(o,a)=>{var W,X,Q,Z,ee;const w=ve,n=me,C=fe,k=ge("vue-date-picker"),j=he,c=we,T=xe,pe=ye;return r(),d(O,null,[S(e("section",Je,[e("div",null,[y(w,{title:"Form Transaction",fn:b.fnClose,class:"w-full flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Ue,[e("div",Ve,[e("div",De,[e("div",Pe,[e("div",Re,[$e,e("div",Fe,[je,S(e("input",{type:"text",list:"standby_mst","onUpdate:modelValue":a[0]||(a[0]=l=>s(t).standby_mst_id=l),disabled:s(t).pvr_no!=""},null,8,Be),[[J,s(t).standby_mst_id]]),e("datalist",Me,[(r(!0),d(O,null,U(s(F),l=>(r(),d("option",{value:l.id},u(l.name+"-"+l.tipe+"-"+s(q)(l.amount||0)),9,qe))),256))]),e("p",ze,u(s(f).standby_mst_id),1)]),e("div",Ke,[Le,e("div",Ye,u((W=s(t).standby_mst_)==null?void 0:W.name),1)]),e("div",Ge,[He,e("div",We,u((X=s(t).standby_mst_)==null?void 0:X.tipe),1)]),e("div",Xe,[Qe,e("div",Ze,u(s(q)((Q=s(t).standby_mst_)==null?void 0:Q.amount)),1)])])]),e("div",et,[e("div",tt,[st,e("div",at,[S(e("select",{"onUpdate:modelValue":a[1]||(a[1]=l=>s(t).transition_type=l),disabled:((Z=s(t).standby_mst_)==null?void 0:Z.is_transition)==0},_t,8,lt),[[ae,s(t).transition_type]]),e("p",rt,u(s(f).transition_type),1)]),e("div",dt,[S(e("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>s(t).transition_target=l),disabled:((ee=s(t).standby_mst_)==null?void 0:ee.is_transition)==0},[ct,(r(!0),d(O,null,U(s(g)().list_pabrik,l=>(r(),d("option",{value:l},u(l),9,pt))),256))],8,ut),[[ae,s(t).transition_target]]),e("p",vt,u(s(f).transition_target),1)])])]),e("div",mt,[["SUPIR","SUPIR KERNET"].indexOf(s(t).standby_mst_.driver_asst_opt)>-1?(r(),d("div",ft,[ht,y(n,{arr:s(K),selected:s(p),pure:N,onSetSelected:a[3]||(a[3]=l=>p.value=l)},null,8,["arr","selected"]),e("p",wt,u(s(f).supir_id),1)])):I("",!0),["KERNET","SUPIR KERNET"].indexOf(s(t).standby_mst_.driver_asst_opt)>-1?(r(),d("div",xt,[yt,y(n,{arr:s(K),selected:s(v),pure:N,onSetSelected:a[4]||(a[4]=l=>v.value=l)},null,8,["arr","selected"]),e("p",bt,u(s(f).kernet_id),1)])):I("",!0)]),e("div",kt,[e("div",gt,[St,S(e("input",{type:"text",list:"vehicle","onUpdate:modelValue":a[5]||(a[5]=l=>s(t).no_pol=l),disabled:s(t).pvr_no!=""},null,8,Nt),[[J,s(t).no_pol]]),e("datalist",Ct,[(r(!0),d(O,null,U(s(Y),l=>(r(),d("option",{value:l.no_pol},u(l.no_pol),9,At))),256))]),e("p",Ot,u(s(f).no_pol),1)]),e("div",It,[Tt,S(e("input",{type:"text",list:"xto","onUpdate:modelValue":a[6]||(a[6]=l=>s(t).xto=l),disabled:s(t).pvr_no!=""},null,8,Et),[[J,s(t).xto]]),e("datalist",Jt,[(r(!0),d(O,null,U(s(L),l=>(r(),d("option",null,u(l),1))),256))]),e("p",Ut,u(s(f).xto),1)]),e("div",Vt,[Dt,S(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=l=>s(t).note_for_remarks=l),disabled:s(t).pvr_no!=""}," ",8,Pt),[[J,s(t).note_for_remarks]]),e("p",Rt,u(s(f).note_for_remarks),1)]),e("div",$t,[Ft,S(e("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=l=>s(t).ref=l),disabled:s(t).pvr_no!=""},null,8,jt),[[J,s(t).ref]]),e("p",Bt,u(s(f).ref),1)])]),e("div",Mt,[e("div",qt,[e("table",zt,[e("thead",null,[e("tr",Kt,[e("td",{colspan:s(E)?3:4,class:"!bg-slate-800 text-white font-bold"}," Detail Transaction ",8,Lt)]),e("tr",Yt,[s(E)?I("",!0):(r(),d("th",Gt)),Ht,Wt,Xt])]),e("tbody",Qt,[(r(!0),d(O,null,U(s(_),(l,D)=>(r(),d(O,{key:D},[l.p_status!="Remove"?(r(),d("tr",{key:0,"data-index":D},[s(E)?I("",!0):(r(),d("td",es,[e("div",ts,[e("button",{type:"button",name:"button",onClick:A=>_e(A,D)},[y(C)],8,ss)])])),e("td",null,u(D+1)+".",1),e("td",as,[e("div",ls,[y(j,null,{default:Ne(()=>[y(k,{modelValue:l.tanggal,"onUpdate:modelValue":A=>l.tanggal=A,type:"datetime",format:"dd-MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),e("td",os,[e("div",ns,[y(c,{value:l.attachment_1_preview,onSetFile:A=>l.attachment_1=A,onSetPreview:A=>l.attachment_1_preview=A,can_remove:!0},null,8,["value","onSetFile","onSetPreview"])])])],8,Zt)):I("",!0)],64))),128)),s(E)?I("",!0):(r(),d("tr",is,[e("td",_s,[e("button",{type:"button",name:"button",onClick:a[9]||(a[9]=l=>re())},[y(T)])])]))],512)])])])])]),e("div",rs,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:a[10]||(a[10]=l=>b.fnClose())}," Cancel "),s(E)?I("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:a[11]||(a[11]=Ce(l=>oe(),["prevent"]))}," Save "))])])])],512),[[Se,b.show]]),y(pe,{show:s(V),coor:s(H),fn:de,data:s(_),data_index:s(h),onReplyAct:a[12]||(a[12]=l=>ue(l))},null,8,["show","coor","data","data_index"])],64)}}},Ns=Ee(ds,[["__scopeId","data-v-cec19a9f"]]);export{Ns as default};
