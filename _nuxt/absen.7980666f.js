import ue from"./Header.3de5f5a1.js";import pe from"./Edit.6b0a2be2.js";import me from"./Eyes.e8d468ca.js";import ce from"./Signature.70c36eb0.js";import fe from"./Line.ff62b9ec.js";import ve from"./Check.0bc81f14.js";import ye from"./Times.5282973f.js";import be from"./TableView.5456b612.js";import xe from"./trx_trp_absen.025a88a8.js";import ke from"./trx_trp_absen_validasi.c5861e6c.js";import ge from"./trx_absen.95240be9.js";import{r,j as he,f as we,g as De,G as $,i as Se,c as d,b as n,a as k,m as $e,q as Ae,k as l,n as Te,l as N,w as p,z as qe,A as f,B as R,o as s,D as y,d as z,t as E,H as Ce,E as Me}from"./entry.44d5fc3d.js";import{u as K}from"./useMyFetch.7cc1a605.js";import{u as Y}from"./useUtils.f69303a2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.1e7f1ac3.js";import"./Adjust.48fe1c5d.js";import"./TableHeaderEye.3b05f050.js";import"./ClearAll.f30e30c6.js";import"./client-only.7c5c3e4e.js";import"./ClearEach.e397c927.js";import"./CaretLeftDoubleBold.77b5969c.js";import"./CaretLeftBold.b6eadc7b.js";import"./CaretRightBold.035fa3cf.js";import"./CaretRightDoubleBold.98e7f494.js";import"./HeaderPopup.vue.5e43446c.js";import"./AttachmentSingle.1d4b725a.js";import"./PDFJsView.ca0c47f9.js";import"./CaretTop.08316eba.js";import"./CaretDown.592e64c0.js";import"./PopupMini.vue.07b5eefb.js";import"./Exclamation.5378bc1e.js";const Oe={class:"w-full h-full flex flex-col"},Ne={class:"w-full flex grow flex-col overflow-auto h-0"},Ye={class:"w-full flex justify-between flex-wrap"},Be={class:"grow flex"},Pe={class:"m-1"},He=Ce('<option value="Undone">Undone</option><option value="Done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Ue=[He],Ie={key:0,class:"bg-red-700 rounded-sm"},je={key:1,class:"bg-green-500 rounded-sm"},Fe={key:0,class:"bg-red-700 rounded-sm"},Je={key:1,class:"bg-green-500 rounded-sm"},Ve={key:0,class:"bg-red-700 rounded-sm"},Re={key:1,class:"bg-green-500 rounded-sm"},ze={key:0,class:"bg-red-700 rounded-sm"},Ee={key:1,class:"bg-green-500 rounded-sm"},$t={__name:"absen",async setup(Ke){let g,B;const{$moment:P}=Me(),L=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.ritase_val2==1?"!bg-blue-300":"",A=e=>(e.map(t=>{t.class_h=L(t)}),e),v=r("Undone");he(()=>v.value,e=>{V.value.map(t=>{let m=["deleted_by_username","deleted_at","deleted_reason","req_deleted_by_username","req_deleted_at","req_deleted_reason"].indexOf(t.key)>-1;return["all","deleted","req_deleted"].indexOf(e)>-1?m&&(t.tbl_show=1):m&&(t.tbl_show=0),t}),j()},{immediate:!1});const o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="tanggal:desc";const H=r({}),h=r({from:"",to:""}),U=we("token"),{data:G}=([g,B]=De(async()=>qe(async()=>{f().loading_full=!0;let e=[];const[t,m]=await Promise.all([K("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:{filter_status:v},retry:0})]);return t.status.value!=="error"&&(e=A(t.data.value.data)),t.status.value==="error"?(R().trigger(t.error),{trx_trps:e}):(f().loading_full=!1,{trx_trps:e})},"$Tkqpaz2JeJ")),g=await g,B(),g),_=r(G.value.trx_trps||[]);r([]),r(!1);const T=r({field:"tanggal",by:"desc"}),i=r(-1),b=$(()=>_.value[i.value]),u=r({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),Z=()=>{o.like="";let e=JSON.parse(JSON.stringify(f()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),o.sort="",T.value.field&&(o.sort=T.value.field+":"+T.value.by),o.date_from=h.value.from?P(h.value.from).format("YYYY-MM-DD"):"",o.date_to=h.value.to?P(h.value.to).format("YYYY-MM-DD"):"",o.filter_model=JSON.stringify(f()._tv.filter_model)},I=async()=>{f().loading_full=!0,H.value={},u.value.may_get_data=!1,o.page=u.value.page,o.page==1&&(_.value=[]),o.first_row&&delete o.first_row,o.page>1&&(o.first_row=JSON.stringify(_.value[0])),o.filter_status=v.value;const{data:e,error:t,status:m}=await K("/trx_trp/absens",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:o,retry:0});if(f().loading_full=!1,u.value.may_get_data=!0,m.value==="error"){R().trigger(t,H);return}u.value.page==1?_.value=A(e.value.data):u.value.page>1&&(_.value=[..._.value,...A(e.value.data)]),e.value.data.length==0&&(u.value.is_last_record=!0),f()._tv.filter_box=!1},j=()=>{i.value=-1,u.value.page=1,u.value.is_last_record=!1,Z(),I()},q=r(!1),F=r(0),{display:C}=Se(),Q=()=>{i.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(F.value=_.value[i.value].id,q.value=!0)},w=r(!1),D=r(0),M=r(!1),W=()=>{i.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(D.value=_.value[i.value].id,w.value=!0,M.value=!1)},X=()=>{i.value==-1?C({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(D.value=_.value[i.value].id,w.value=!0,M.value=!0)},J=r(!1),ee=r(0),V=r([{key:"no",label:"No",isai:!0},{key:"ritase_val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"ritase_val2",label:"App 3",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",freeze:1,filter_on:1,type:"string"},{key:"ritase_leave_at",label:"B"},{key:"ritase_arrive_at",label:"T"},{key:"ritase_return_at",label:"K"},{key:"ritase_till_at",label:"S"},{key:"ritase_note",label:"Note"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"deleted_by_username",label:"Deleted By",tbl_show:0},{key:"deleted_at",label:"Deleted At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"deleted_reason",label:"Deleted Reason",tbl_show:0,type:"string",filter_on:1},{key:"req_deleted_by_username",label:"Req Deleted By",tbl_show:0},{key:"req_deleted_at",label:"Req Delete At",dateformat:"DD-MM-Y HH:mm:ss",tbl_show:0,type:"datetime",filter_on:1},{key:"req_deleted_reason",label:"Req Delete Reason",tbl_show:0,type:"string",filter_on:1}]),te=$(()=>i.value>-1&&Y().checkPermission("trp_trx.absen.view")),ae=$(()=>i.value>-1&&[void 0,0].indexOf(b.value.deleted)>-1&&[void 0,0].indexOf(b.value.req_deleted)>-1&&[void 0,0].indexOf(b.value.ritase_val)>-1&&Y().checkPermission("trp_trx.absen.modify")),le=$(()=>i.value>-1&&[void 0,0].indexOf(b.value.deleted)>-1&&[void 0,0].indexOf(b.value.req_deleted)>-1&&Y().checkPermissions(["trp_trx.absen.val","trp_trx.absen.val1","trp_trx.absen.val2"]));return(e,t)=>{const m=ue,se=pe,oe=me,re=ce,O=fe,c=ve,S=ye,ne=be,ie=xe,_e=ke,de=ge;return s(),d("div",Oe,[n(m,{title:"List Transaction"}),k("div",Ne,[k("div",Ye,[k("div",Be,[k("div",Pe,[$e(k("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=a=>Te(v)?v.value=a:null)},Ue,512),[[Ae,l(v)]])]),l(ae)?(s(),d("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=a=>Q())},[n(se)])):N("",!0),l(te)?(s(),d("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=a=>X())},[n(oe)])):N("",!0),l(le)?(s(),d("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[3]||(t[3]=a=>W())},[n(re)])):N("",!0)])]),n(ne,{thead:l(V),selected:l(i),onSetSelected:t[4]||(t[4]=a=>i.value=a),tbody:l(_),fnCallData:I,scrolling:l(u),onSetScrollingPage:t[5]||(t[5]=a=>l(u).page=a),onDoFilter:t[6]||(t[6]=a=>j())},{ritase_val:p(({item:a})=>[a.ritase_val?(s(),y(c,{key:1})):(s(),y(O,{key:0}))]),ritase_val1:p(({item:a})=>[a.ritase_val1?(s(),y(c,{key:1})):(s(),y(O,{key:0}))]),ritase_val2:p(({item:a})=>[a.ritase_val2?(s(),y(c,{key:1})):(s(),y(O,{key:0}))]),ritase_leave_at:p(({item:a})=>[a.ritase_leave_at?(s(),d("div",je,[n(c,{class:"text-white text-xl font-bold"})])):(s(),d("div",Ie,[n(S,{class:"text-white text-xl font-bold"})]))]),ritase_arrive_at:p(({item:a})=>[a.ritase_arrive_at?(s(),d("div",Je,[n(c,{class:"text-white text-xl font-bold"})])):(s(),d("div",Fe,[n(S,{class:"text-white text-xl font-bold"})]))]),ritase_return_at:p(({item:a})=>[a.ritase_return_at?(s(),d("div",Re,[n(c,{class:"text-white text-xl font-bold"})])):(s(),d("div",Ve,[n(S,{class:"text-white text-xl font-bold"})]))]),ritase_till_at:p(({item:a})=>[a.ritase_till_at?(s(),d("div",Ee,[n(c,{class:"text-white text-xl font-bold"})])):(s(),d("div",ze,[n(S,{class:"text-white text-xl font-bold"})]))]),deleted_by_username:p(({item:a})=>{var x;return[z(E((x=a.deleted_by)==null?void 0:x.username),1)]}),req_deleted_by_username:p(({item:a})=>{var x;return[z(E((x=a.req_deleted_by)==null?void 0:x.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),n(ie,{show:l(q),fnClose:()=>{q.value=!1},id:l(F),p_data:l(_)},null,8,["show","fnClose","id","p_data"]),n(_e,{show:l(w),fnClose:()=>{w.value=!1},id:l(D),p_data:l(_),is_view:l(M),onSetID:t[7]||(t[7]=a=>D.value=a),onSetIndex:t[8]||(t[8]=a=>i.value=a)},null,8,["show","fnClose","id","p_data","is_view"]),n(de,{show:l(J),fnClose:()=>{J.value=!1},index:l(ee),p_data:l(_)},null,8,["show","fnClose","index","p_data"])])}}};export{$t as default};
