import{_ as O}from"./HeaderPopup.vue.eef7144c.js";import{_ as Y}from"./client-only.d142bf24.js";import{r as x,f as H,G as b,j as J,I as K,m as E,J as L,o as r,c as d,a as e,b as k,k as a,t as l,w as Q,q as W,d as g,F as z,y as X,l as N,x as Z,E as ee,A as y,B as T}from"./entry.e2a8d927.js";import{u as C}from"./useUtils.a689ea1e.js";import{u as U}from"./useMyFetch.7ab7b454.js";import"./Times.23971e09.js";import"./_plugin-vue_export-helper.c27b6911.js";const te={class:"box-fixed"},ae={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},oe={class:"w-full flex flex-col items-center grow overflow-auto"},le={class:"w-full flex flex-row flex-wrap"},se={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ne=e("label",{for:""},"Period End",-1),re={key:0,class:"card-border"},de={key:1},ie={class:"text-red-500"},ue={class:"w-full flex flex-row flex-wrap"},_e={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},ce=e("label",{for:""},"Period Part",-1),pe={key:0,class:"card-border"},me={key:1},fe=e("option",{value:"1"},"1",-1),ve=e("option",{value:"2"},"2",-1),he=[fe,ve],ye={class:"text-red-500"},we={key:0,class:"w-full flex p-1 justify-between flex-wrap"},xe={class:"w-full",role:"sticky"},be={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ke=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"10",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),ge={class:"sticky top-7 !z-[2]"},Ne=e("th",null,"No",-1),Ce=e("th",null,"Nama Pekerja",-1),Fe=e("th",null,"No KTP",-1),Se=e("th",null,"No SIM",-1),Be=e("th",null,"Rek No",-1),Me=e("th",null,"Rek Nama",-1),Pe=e("th",null,"Bank Name",-1),qe={class:"text-sm"},Ve={class:"text-sm"},Ae={class:"text-sm"},$e={ref:"to_move"},je=["data-index"],De={class:"w-full flex items-center justify-end"},Oe={__name:"salary_paid",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(v){const u=v,{$moment:F}=ee(),{pointFormat:p}=C(),S={id:"",period_end:new Date,period_part:1},t=x({...S}),B=H("token"),f=x({}),_=x([]),R=async()=>{y().loading_full=!0,f.value={};const s=new FormData;s.append("period_end",t.value.period_end?F(t.value.period_end).format("Y-MM"):""),s.append("period_part",t.value.period_part);let n="post",i=t.value.id;i==""||(s.append("id",i),s.append("_method","PUT"));const{data:c,error:w,status:o}=await U("/salary_paid",{method:n,headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},body:s,retry:0});if(y().loading_full=!1,o.value==="error"){T().trigger(w,f);return}if(_.value=c.value.details,i<=0)t.value.id=c.value.id,t.value.created_at=c.value.created_at,t.value.updated_at=c.value.updated_at,u.p_data.unshift(t.value);else{t.value.updated_at=c.value.updated_at;let m=u.p_data.map(h=>h.id).indexOf(i);m>=-1&&u.p_data.splice(m,1,{...t.value})}},M=b(()=>{let s=0;return _.value.forEach(n=>{s+=parseFloat(n.standby_nominal)}),s}),P=b(()=>{let s=0;return _.value.forEach(n=>{s+=parseFloat(n.salary_bonus_nominal)}),s}),G=b(()=>t.value.val&&t.value.val1||C().checkPermission("salary_paid.val")&&t.value.val||C().checkPermission("salary_paid.val1")&&t.value.val1),I=async()=>{y().loading_full=!0;const{data:s,error:n,status:i}=await U("/salary_paid",{method:"get",headers:{Authorization:`Bearer ${B.value}`,Accept:"application/json"},params:{id:u.id},retry:0});if(y().loading_full=!1,i.value==="error"){T().trigger(n);return}t.value=s.value.data,u.is_copy&&(t.value.val=0,t.value.val1=0),_.value=s.value.data.details};return J(()=>u.show,(s,n)=>{s==!0&&(t.value={...S},_.value=[],f.value={},u.id!=0&&I())},{immediate:!0}),(s,n)=>{const i=O,c=K("vue-date-picker"),w=Y;return E((r(),d("section",te,[e("div",null,[k(i,{title:"Form Salary Paid",fn:v.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",ae,[e("div",oe,[e("div",le,[e("div",se,[ne,a(t).id?(r(),d("div",re,l(a(F)(a(t).period_end).format("MM-Y")),1)):(r(),d("div",de,[k(w,null,{default:Q(()=>[k(c,{modelValue:a(t).period_end,"onUpdate:modelValue":n[0]||(n[0]=o=>a(t).period_end=o),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",ie,l(a(f).period_end),1)])]),e("div",ue,[e("div",_e,[ce,a(t).id?(r(),d("div",pe,l(a(t).period_part),1)):(r(),d("div",me,[E(e("select",{"onUpdate:modelValue":n[1]||(n[1]=o=>a(t).period_part=o)},he,512),[[W,a(t).period_part]])])),e("p",ye,l(a(f).period_part),1)])]),a(_).length?(r(),d("div",we,[e("div",xe,[e("table",be,[e("thead",null,[ke,e("tr",ge,[Ne,Ce,Fe,Se,Be,Me,Pe,e("th",null,[g("Nominal Standby "),e("span",qe,"("+l(a(p)(a(M)||0))+")",1)]),e("th",null,[g("Nominal Bonus "),e("span",Ve,"("+l(a(p)(a(P)||0))+")",1)]),e("th",null,[g("Total "),e("span",Ae,"("+l(a(p)(a(M)+a(P)||0))+")",1)])])]),e("tbody",$e,[(r(!0),d(z,null,X(a(_),(o,m)=>{var h,q,V,A,$,j,D;return r(),d(z,{key:m},[o.p_status!="Remove"?(r(),d("tr",{key:0,"data-index":m},[e("td",null,l(m+1)+".",1),e("td",null,l((h=o.employee)==null?void 0:h.name),1),e("td",null,l((q=o.employee)==null?void 0:q.ktp_no),1),e("td",null,l((V=o.employee)==null?void 0:V.sim_no),1),e("td",null,l((A=o.employee)==null?void 0:A.rek_no),1),e("td",null,l(($=o.employee)==null?void 0:$.rek_name),1),e("td",null,l((D=(j=o.employee)==null?void 0:j.bank)==null?void 0:D.code),1),e("td",null,l(a(p)(o.standby_nominal)),1),e("td",null,l(a(p)(o.salary_bonus_nominal)),1),e("td",null,l(a(p)(parseFloat(o.standby_nominal)+parseFloat(o.salary_bonus_nominal))),1)],8,je)):N("",!0)],64)}),128))],512)])])])):N("",!0)]),e("div",De,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:n[2]||(n[2]=o=>v.fnClose())}," Cancel "),a(G)?N("",!0):(r(),d("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:n[3]||(n[3]=Z(o=>R(),["prevent"]))}," Generate "+l(a(t).id==""?"& Save":""),1))])])])],512)),[[L,v.show]])}}};export{Oe as default};
