import pt from"./Header.637f4676.js";import dt from"./PrinterEye.027e0106.js";import ft from"./Table2Column.c3ada978.js";import bt from"./Eyes.8d12effe.js";import mt from"./Line.2431786d.js";import yt from"./Check.f62029d0.js";import kt from"./TableView.61557d6c.js";import{_ as ht}from"./PopupMini.vue.bf0f543b.js";import vt from"./Times.95294586.js";import{_ as gt}from"./HeaderPopup.vue.e7ad54cc.js";import{r as _,f as xt,g as wt,h as Dt,i as q,s as St,A as c,G as $t,c as x,b as m,a as s,d as u,w as p,k as a,l as Tt,m as Ct,J as At,t as l,F as L,y as Z,z as Pt,B as w,o as d,C as Bt,D,E as Mt}from"./entry.e0b2ce62.js";import{u as G}from"./useUtils.f8f0bb33.js";import{u as S}from"./useMyFetch.7c8e1e1f.js";import{u as Nt}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.f54c8c7d.js";import"./Adjust.522a274d.js";import"./TableHeaderEye.a012165e.js";import"./ClearAll.21b55517.js";import"./client-only.c6ee3f48.js";import"./ClearEach.bd67ccd5.js";import"./CaretLeftDoubleBold.ea998404.js";import"./CaretLeftBold.fbce2238.js";import"./CaretRightBold.2cf8304a.js";import"./CaretRightDoubleBold.5ccd78f8.js";import"./Exclamation.8afe936b.js";const Ft={class:"w-full h-full flex flex-col"},Yt={class:"w-full flex grow flex-col overflow-auto h-0"},jt={class:"w-full flex"},Ht={class:"flex flex-wrap p-1"},Rt=s("span",{class:"text-xs ml-1"}," SUSUT ",-1),Ut=s("span",{class:"text-xs ml-1"}," SUSUT ",-1),zt={class:"flex flex-wrap p-1"},Ot=s("span",{class:"text-xs ml-1"}," PV ",-1),Vt=s("span",{class:"text-xs ml-1"}," PV ",-1),Et={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},It={class:"relative",style:{width:"95%",height:"90%"}},Jt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Kt=["src"],qt={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},Lt={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},Zt={class:"p-1 flex flex-wrap overflow-auto items-start"},Gt={class:"w-full sm:w-1/2 flex flex-wrap"},Qt={class:"flex flex-col m-2"},Wt=s("span",{class:"text-xs"}," To ",-1),Xt={class:""},te={class:"flex flex-col m-2"},ee=s("span",{class:"text-xs"}," Tipe ",-1),se={class:""},oe={class:"flex flex-col m-2"},ae=s("span",{class:"text-xs"}," Jenis ",-1),le={class:""},re={class:"flex flex-col m-2"},ne=s("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),ie={class:""},_e={class:"w-full sm:w-1/2 text-sm flex justify-center"},ce={class:"border border-collapse border-black"},ue=s("tr",null,[s("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),pe={class:"p-1"},de={class:"p-1"},fe=s("td",{class:"p-1"},"= Rp.",-1),be={class:"text-right p-1"},me={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ye=s("th",{colspan:"2",class:"text-right"},"Total",-1),ke=s("th",{class:"p-1 text-right"},"Rp.",-1),he={class:"p-1 text-right"},ve={class:"w-full mt-2 text-sm flex justify-center"},ge={class:"border border-collapse border-black"},xe=s("tr",null,[s("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),we={class:"p-1"},De={class:"p-1"},Se={class:"p-1"},$e=s("td",{class:"p-1"},"= Rp.",-1),Te={class:"text-right p-1"},Ce={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},Ae=s("th",{colspan:"2",class:"text-right"},"Total",-1),Pe=s("th",{class:"p-1 text-right"},"Rp.",-1),Be={class:"p-1 text-right"},Me={class:"flex p-1 justify-end flex-wrap"},is={__name:"index",async setup(Ne){let $,z;const{$moment:O}=Mt(),{pointFormat:i}=G(),r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const B=_({}),v=xt("token"),T=_({from:"",to:""}),{data:Q}=([$,z]=wt(async()=>Pt(async()=>{c().loading_full=!0;let e=[];const[o,n]=await Promise.all([S("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},retry:0})]);return o.status.value!=="error"&&(e=o.data.value.data),o.status.value==="error"?(w().trigger(o.error),{trx_trps:e}):(c().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),$=await $,z(),$),y=_(Q.value.trx_trps||[]),M=_({field:"tanggal",by:"desc"}),h=_(-1),b=_({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),N=()=>{r.like="";let e=JSON.parse(JSON.stringify(c()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),r.sort="",M.value.field&&(r.sort=M.value.field+":"+M.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=T.value.from?O(T.value.from).format("YYYY-MM-DD"):"",r.date_to=T.value.to?O(T.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(c()._tv.filter_model)},V=_(null),E=async()=>{c().loading_full=!0,B.value={},b.value.may_get_data=!1,r.page=b.value.page,r.page==1&&(y.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(y.value[0]));const{data:e,error:o,status:n}=await S("/trx_trps",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,b.value.may_get_data=!0,n.value==="error"){w().trigger(o,B);return}b.value.page==1?(y.value=e.value.data,V.value&&(V.value.scrollTop=0)):b.value.page>1&&(y.value=[...y.value,...e.value.data]),e.value.data.length==0&&(b.value.is_last_record=!0),c()._tv.filter_box=!1},W=()=>{b.value.page=1,b.value.is_last_record=!1,N(),E()};Dt(),_(!1),_(0);const{display:X}=q();St(q());const tt=_({}),C=_(!1),et=async()=>{C.value&&(C.value=!1)},st=async()=>{c().loading_full=!0;const e=new FormData;e.append("id",y.value[h.value].id),e.append("_method","DELETE");const{data:o,error:n,status:f}=await S("/trx_trp",{method:"post",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},body:e,retry:0});if(c().loading_full=!1,f.value==="error"){w().trigger(n);return}y.value.splice(h.value,1),h.value=-1,C.value=!1},{downloadFile:I,viewFile:Fe}=Nt(),A=_(!1),F=_(""),Y=async(e="")=>{if(A.value==!0){A.value=!1;return}N(),c().loading_full=!0;const{data:o,error:n,status:f}=await S("/trx_trps/"+e,{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,f.value==="error"){w().trigger(n);return}F.value=o.value,A.value=!0},J=async(e="")=>{N(),c().loading_full=!0;const{data:o,error:n,status:f}=await S("/trx_trps/"+e,{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:r,retry:0});if(c().loading_full=!1,f.value==="error"){w().trigger(n);return}I(o.value)},ot=()=>{I(F.value)},K=e=>e.pv_id<=0||["CPO","PK"].indexOf(e.jenis)>-1&&(e.ticket_a_id<=0||e.ticket_b_bruto<=0||e.ticket_b_tara<=0||e.ticket_b_netto<=0||e.ticket_b_in_at==""||e.ticket_b_out_at=="")||e.jenis=="TBS"&&(e.ticket_a_id<=0||e.ticket_b_id<=0)||e.jenis=="TBSK"&&e.ticket_b_id<=0?0:1,at=_([{key:"status",label:"Status",filter_on:1,sort_off:1,type:"select",select_item:["Undone","Done"]},{key:"val",label:"App 1",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"val1",label:"App 2",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition_target",label:"Peralihan",filter_on:1,type:"select",select_item:c().list_pabrik},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),j=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e),f=n>0?o:e;if(f==0)return 0;let g=G().round(n/f*100,2);return g<0?"("+Math.abs(g*100)/100+")":g},H=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e);return n<0?"("+i(Math.abs(n))+")":i(n)},P=_(!1),k=_({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),lt=async()=>{h.value==-1&&X({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}),c().loading_full=!0;const{data:e,error:o,status:n}=await S("/ujalan_",{method:"get",headers:{Authorization:`Bearer ${v.value}`,Accept:"application/json"},params:{id:y.value[h.value].id_uj},retry:0});if(c().loading_full=!1,n.value==="error"){w().trigger(o,B);return}k.value=e.value.data,P.value=!0},rt=$t(()=>{let e=0;return k.value.details2.forEach(o=>{o.p_status!="Remove"&&(e+=o.qty*o.amount)}),e});return(e,o)=>{const n=pt,f=dt,g=ft,nt=bt,R=mt,U=yt,it=kt,_t=ht,ct=vt,ut=gt;return d(),x("div",Ft,[m(n,{title:"Report Transaction"}),s("div",Yt,[s("div",jt,[s("div",Ht,[s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[0]||(o[0]=t=>Y("reportSusutPDF"))},[m(f),u(),Rt]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[1]||(o[1]=t=>J("reportSusutExcel"))},[m(g),u(),Ut])]),s("div",zt,[s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[2]||(o[2]=t=>Y("reportPVPDF"))},[m(f),u(),Ot]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[3]||(o[3]=t=>J("reportPVExcel"))},[m(g),u(),Vt])]),s("button",{type:"button",name:"button",class:"m-1 text-2xl",onClick:o[4]||(o[4]=t=>lt())},[m(nt)])]),m(it,{thead:a(at),selected:a(h),onSetSelected:o[5]||(o[5]=t=>h.value=t),tbody:a(y),fnCallData:E,scrolling:a(b),onSetScrollingPage:o[6]||(o[6]=t=>a(b).page=t),onDoFilter:o[7]||(o[7]=t=>W())},{status:p(({item:t})=>[s("div",{class:Bt(["text-white text-xs px-2 py-1 rounded-lg",K(t)?"bg-green-600":"bg-red-600"])},l(K(t)?"Done":"Not Done"),3)]),val:p(({item:t})=>[t.val?(d(),D(U,{key:1})):(d(),D(R,{key:0}))]),val1:p(({item:t})=>[t.val1?(d(),D(U,{key:1})):(d(),D(R,{key:0}))]),pvr_had_detail:p(({item:t})=>[t.pvr_had_detail?(d(),D(U,{key:1})):(d(),D(R,{key:0}))]),susut_bruto_a:p(({item:t})=>[u(l(a(i)(t.ticket_a_bruto)),1)]),susut_tara_a:p(({item:t})=>[u(l(a(i)(t.ticket_a_tara)),1)]),susut_netto_a:p(({item:t})=>[u(l(a(i)(t.ticket_a_netto)),1)]),susut_bruto_b:p(({item:t})=>[u(l(a(i)(t.ticket_b_bruto)),1)]),susut_tara_b:p(({item:t})=>[u(l(a(i)(t.ticket_b_tara)),1)]),susut_netto_b:p(({item:t})=>[u(l(a(i)(t.ticket_b_netto)),1)]),susut_bruto_b_a:p(({item:t})=>[u(l(H(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:p(({item:t})=>[u(l(H(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:p(({item:t})=>[u(l(H(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:p(({item:t})=>[u(l(j(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:p(({item:t})=>[u(l(j(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:p(({item:t})=>[u(l(j(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),m(_t,{type:"delete",show:a(C),data:a(tt),fnClose:et,fnConfirm:st},null,8,["show","data"]),a(A)?(d(),x("div",Et,[s("div",It,[s("div",Jt,[m(ct,{style:{color:"black",cursor:"pointer"},onClick:o[8]||(o[8]=t=>Y())})]),s("iframe",{ref:"iframe",width:"100%",height:"100%",src:a(F).dataBase64},null,8,Kt),s("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[9]||(o[9]=t=>ot())})])])):Tt("",!0),Ct(s("div",qt,[s("div",Lt,[m(ut,{title:"Detail Information",fn:()=>{P.value=!1,e.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("div",Zt,[s("div",Gt,[s("div",Qt,[Wt,s("div",Xt,l(a(k).xto)+" ",1)]),s("div",te,[ee,s("div",se,l(a(k).tipe),1)]),s("div",oe,[ae,s("div",le,l(a(k).jenis),1)]),s("div",re,[ne,s("div",ie,l(a(k).note_for_remarks),1)])]),s("div",_e,[s("table",ce,[ue,(d(!0),x(L,null,Z(a(k).details,t=>(d(),x("tr",null,[s("td",pe,l(t.ordinal)+". ",1),s("td",de,l(t.xdesc)+" "+l(t.qty<=1?"":a(i)(t.qty||0)+" x Rp."+a(i)(t.harga||0)),1),fe,s("td",be,l(a(i)(t.qty*t.harga)),1)]))),256)),s("tr",me,[ye,ke,s("th",he,l(a(i)(a(k).harga)),1)])])]),s("div",ve,[s("table",ge,[xe,(d(!0),x(L,null,Z(a(k).details2,t=>(d(),x("tr",null,[s("td",we,l(t.ordinal)+". ",1),s("td",De,l(t.ac_account_code),1),s("td",Se,l(t.description)+" "+l(t.qty<=1?"":a(i)(t.qty||0)+" x Rp."+a(i)(t.amount||0)),1),$e,s("td",Te,l(a(i)(t.qty*t.amount)),1)]))),256)),s("tr",Ce,[Ae,Pe,s("th",Be,l(a(i)(a(rt))),1)])])])]),s("div",Me,[s("button",{class:"rounded m-1",onClick:o[10]||(o[10]=t=>P.value=!1)}," Cancel ")])])],512),[[At,a(P)]])])}}};export{is as default};
