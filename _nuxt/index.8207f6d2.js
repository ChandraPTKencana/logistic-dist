import rt from"./Header.ae8a5925.js";import it from"./PrinterEye.db82c5f6.js";import nt from"./Table2Column.0af02c5d.js";import _t from"./Line.7905d8d1.js";import ct from"./Check.023c019e.js";import ut from"./TableView.ef3fc45a.js";import dt from"./Times.decf023a.js";import{_ as pt}from"./HeaderPopup.vue.e254f2d7.js";import{r as u,j as ft,f as bt,g as mt,A as d,G as yt,c as k,b as h,a as s,m as L,q as kt,k as l,n as ht,d as c,w as _,l as gt,J as vt,t as a,F as Z,y as G,z as xt,B as $,o as f,C as wt,D as S,H as Dt,E as Tt}from"./entry.6bd5fcb6.js";import{u as Q}from"./useUtils.b118eb2a.js";import{u as C}from"./useMyFetch.f13003ce.js";import{u as $t}from"./useDownload.174f4da2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.c80bbbaa.js";import"./Adjust.3254af0e.js";import"./TableHeaderEye.d95c4b17.js";import"./ClearAll.abf457d3.js";import"./client-only.8f4e12a5.js";import"./ClearEach.9f6cc876.js";import"./CaretLeftDoubleBold.9b1c5598.js";import"./CaretLeftBold.066a7183.js";import"./CaretRightBold.0fc41c70.js";import"./CaretRightDoubleBold.21514bce.js";const St={class:"w-full h-full flex flex-col"},Ct={class:"w-full flex grow flex-col overflow-auto h-0"},Mt={class:"w-full flex"},At={class:"m-1"},Bt=Dt('<option value="ticket_not_done">Undone</option><option value="ticket_done">Done</option><option value="deleted">Trash</option><option value="all">All</option><option value="req_deleted">Req Delete</option>',5),Nt=[Bt],Pt=s("span",{class:"text-xs ml-1"}," PDF ",-1),Ft=s("span",{class:"text-xs ml-1"}," Excel ",-1),Ht={key:0,class:"w-full h-full flex items-center justify-center fixed top-0 left-0 z-20 p-3",style:{"background-color":"rgba(255,255,255,0.9)"}},Yt={class:"relative",style:{width:"95%",height:"90%"}},Rt={class:"absolute -top-7 right-0 bg-white",style:{position:"absolute",padding:"5px 10px",border:"solid 1px #ccc","border-bottom":"none","border-top-right-radius":"5px","border-top-left-radius":"5px"}},Ot=["src"],jt={class:"w-full h-full fixed top-0 left-0 bg-gray-100 bg-opacity-80 flex items-center justify-center z-10"},qt={class:"w-full sm:w-10/12 md:w-8/12 lg:w-6/12 bg-white flex flex-col border-solid border-gray-200 max-w-full max-h-full",style:{"border-width":"1px"}},zt={class:"p-1 flex flex-wrap overflow-auto items-start"},Vt={class:"w-full sm:w-1/2 flex flex-wrap"},Jt={class:"flex flex-col m-2"},Kt=s("span",{class:"text-xs"}," To ",-1),It={class:""},Ut={class:"flex flex-col m-2"},Et=s("span",{class:"text-xs"}," Tipe ",-1),Lt={class:""},Zt={class:"flex flex-col m-2"},Gt=s("span",{class:"text-xs"}," Jenis ",-1),Qt={class:""},Wt={class:"flex flex-col m-2"},Xt=s("span",{class:"text-xs"}," Ket. Untuk Remarks ",-1),te={class:""},ee={class:"w-full sm:w-1/2 text-sm flex justify-center"},se={class:"border border-collapse border-black"},oe=s("tr",null,[s("th",{colspan:"4",class:"bg-blue-400"}," List Uang Jalan ")],-1),le={class:"p-1"},ae={class:"p-1"},re=s("td",{class:"p-1"},"= Rp.",-1),ie={class:"text-right p-1"},ne={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},_e=s("th",{colspan:"2",class:"text-right"},"Total",-1),ce=s("th",{class:"p-1 text-right"},"Rp.",-1),ue={class:"p-1 text-right"},de={class:"w-full mt-2 text-sm flex justify-center"},pe={class:"border border-collapse border-black"},fe=s("tr",null,[s("th",{colspan:"5",class:"bg-blue-400"}," List PVR ")],-1),be={class:"p-1"},me={class:"p-1"},ye={class:"p-1"},ke=s("td",{class:"p-1"},"= Rp.",-1),he={class:"text-right p-1"},ge={class:"border-t-black border-dashed",style:{"border-top-width":"1px"}},ve=s("th",{colspan:"2",class:"text-right"},"Total",-1),xe=s("th",{class:"p-1 text-right"},"Rp.",-1),we={class:"p-1 text-right"},De={class:"flex p-1 justify-end flex-wrap"},Qe={__name:"index",async setup(Te){let v,R;const{$moment:O}=Tt(),{pointFormat:i}=Q(),M=e=>e.deleted==1?"!bg-red-400":e.req_deleted==1?"!bg-yellow-300":e.val_ticket==1&&(["CPO","PK"].indexOf(e.jenis)>-1&&e.ticket_a_id!=""&&e.ticket_b_bruto!=""&&e.ticket_b_tara!=""&&e.ticket_b_netto!=""&&e.ticket_b_in_at!=""&&e.ticket_b_out_at!=""||e.jenis=="TBS"&&e.ticket_a_id!=""&&e.ticket_b_id!=""||e.jenis=="TBSK"&&e.ticket_b_id!="")?"!bg-blue-300":"",A=e=>(e.map(o=>{o.class_h=M(o)}),e),m=u("ticket_not_done");ft(()=>m.value,e=>{J()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="tanggal:desc";const j=u({}),x=bt("token"),w=u({from:"",to:""}),{data:W}=([v,R]=mt(async()=>xt(async()=>{d().loading_full=!0;let e=[];const[o,n]=await Promise.all([C("/trx_trp_susuts/data",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:{filter_status:m},retry:0})]);return o.status.value!=="error"&&(e=A(o.data.value.data)),o.status.value==="error"?($().trigger(o.error),{trx_trps:e}):(d().loading_full=!1,{trx_trps:e})},"$8KmJHfPiB5")),v=await v,R(),v),y=u(W.value.trx_trps||[]),B=u({field:"tanggal",by:"desc"}),q=u(-1),p=u({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),N=()=>{r.like="";let e=JSON.parse(JSON.stringify(d()._tv.global_keyword));e!=""&&(r.like=`id:%${e}%,xto:%${e}%,jenis:%${e}%,pv_no:%${e}%,ticket_a_no:%${e}%,ticket_b_no:%${e}%,no_pol:%${e}%,supir:%${e}%,kernet:%${e}%,cost_center_code:%${e}%,cost_center_desc:%${e}%,pvr_no:%${e}%,tanggal:%${e}%,transition_target:%${e}%`),r.sort="",B.value.field&&(r.sort=B.value.field+":"+B.value.by),r._TimeZoneOffset=new Date().getTimezoneOffset(),r.date_from=w.value.from?O(w.value.from).format("YYYY-MM-DD"):"",r.date_to=w.value.to?O(w.value.to).format("YYYY-MM-DD"):"",r.filter_model=JSON.stringify(d()._tv.filter_model),r.filter_status=m.value},z=u(null),V=async()=>{d().loading_full=!0,j.value={},p.value.may_get_data=!1,r.page=p.value.page,r.page==1&&(y.value=[]),r.first_row&&delete r.first_row,r.page>1&&(r.first_row=JSON.stringify(y.value[0])),r.filter_status=m.value;const{data:e,error:o,status:n}=await C("/trx_trp_susuts/data",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:r,retry:0});if(d().loading_full=!1,p.value.may_get_data=!0,n.value==="error"){$().trigger(o,j);return}p.value.page==1?(y.value=A(e.value.data),z.value&&(z.value.scrollTop=0)):p.value.page>1&&(y.value=[...y.value,...A(e.value.data)]),e.value.data.length==0&&(p.value.is_last_record=!0),d()._tv.filter_box=!1},J=()=>{p.value.page=1,p.value.is_last_record=!1,N(),V()},{downloadFile:K,viewFile:$e}=$t(),D=u(!1),P=u(""),I=async()=>{if(D.value==!0){D.value=!1;return}N(),d().loading_full=!0;const{data:e,error:o,status:n}=await C("/trx_trp_susuts/report_PDF",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:r,retry:0});if(d().loading_full=!1,n.value==="error"){$().trigger(o);return}P.value=e.value,D.value=!0},X=async()=>{N(),d().loading_full=!0;const{data:e,error:o,status:n}=await C("/trx_trp_susuts/report_Excel",{method:"get",headers:{Authorization:`Bearer ${x.value}`,Accept:"application/json"},params:r,retry:0});if(d().loading_full=!1,n.value==="error"){$().trigger(o);return}K(e.value)},tt=()=>{K(P.value)},et=u([{key:"no",label:"No",isai:!0},{key:"val_ticket",label:"App",filter_on:1,type:"select",select_item:[{k:"1",v:"Approve"},{k:"0",v:"Unapprove"}]},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"tanggal",label:"U.Jalan Per",type:"date",dateformat:"DD-MM-Y",filter_on:1,sort:{priority:1,type:"desc"}},{key:"no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"xto",label:"Tujuan",filter_on:1,type:"string"},{key:"tipe",label:"Tipe",filter_on:1,type:"string"},{key:"jenis",label:"Jenis",filter_on:1,type:"select",select_item:["TBS","TBSK","CPO","PK"]},{key:"amount",label:"Amount",class:" justify-end",filter_on:1,type:"number"},{key:"cost_center",label:"Cost Center",childs:[{key:"cost_center_code",label:"Code",class:" justify-start",filter_on:1,type:"string"},{key:"cost_center_desc",label:"Desc",filter_on:1,type:"string"}]},{key:"pvr",label:"PVR",childs:[{key:"pvr_no",label:"No",filter_on:1,type:"string"},{key:"pvr_total",label:"Total",filter_on:1,type:"number"},{key:"pvr_had_detail",label:"Completed",filter_on:1,type:"select",select_item:[{k:"1",v:"Completed"},{k:"0",v:"Uncompleted"}]}]},{key:"pv",label:"PV",childs:[{key:"pv_datetime",label:"Date",type:"date",dateformat:"DD-MM-Y",filter_on:1},{key:"pv_no",label:"No",filter_on:1,type:"string"},{key:"pv_total",label:"Total",filter_on:1,type:"number"}]},{key:"transition",label:"Peralihan",childs:[{key:"transition_type",label:"Type",type:"select",filter_on:1,select_item:["To","From"]},{key:"transition_target",label:"Target",type:"select",filter_on:1,select_item:d().list_pabrik}]},{key:"ticket_a",label:"Ticket A",childs:[{key:"ticket_a_no",label:"No",filter_on:1,type:"string"},{key:"ticket_a_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_a_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_a_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_a_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_a_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_a_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_a_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"ticket_b",label:"Ticket B",childs:[{key:"ticket_b_no",label:"No",filter_on:1,type:"string"},{key:"ticket_b_bruto",label:"Bruto",filter_on:1,type:"number"},{key:"ticket_b_tara",label:"Tara",filter_on:1,type:"number"},{key:"ticket_b_netto",label:"Netto",filter_on:1,type:"number"},{key:"ticket_b_supir",label:"Supir",filter_on:1,type:"string"},{key:"ticket_b_no_pol",label:"No Pol",filter_on:1,type:"string"},{key:"ticket_b_in_at",label:"In At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"ticket_b_out_at",label:"Out At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]},{key:"susut",label:"Susut",childs:[{key:"susut_bruto",label:"Bruto",childs:[{key:"susut_bruto_a",label:"Berangkat"},{key:"susut_bruto_b",label:"Kembali"},{key:"susut_bruto_b_a",label:"Selisih"},{key:"susut_bruto_b_a_persen",label:"%"}]},{key:"susut_tara",label:"Tara",childs:[{key:"susut_tara_a",label:"Berangkat"},{key:"susut_tara_b",label:"Kembali"},{key:"susut_tara_b_a",label:"Selisih"},{key:"susut_tara_b_a_persen",label:"%"}]},{key:"susut_netto",label:"Netto",childs:[{key:"susut_netto_a",label:"Berangkat"},{key:"susut_netto_b",label:"Kembali"},{key:"susut_netto_b_a",label:"Selisih"},{key:"susut_netto_b_a_persen",label:"%"}]}]},{key:"supir",label:"Supir",filter_on:1,type:"string"},{key:"kernet",label:"Kernet",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]),F=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e),T=n>0?o:e;if(T==0)return 0;let g=Q().round(n/T*100,2);return g<0?"("+Math.abs(g*100)/100+")":g},H=(e,o)=>{e=parseFloat(e)||0,o=parseFloat(o)||0;let n=parseFloat(o-e);return n<0?"("+i(Math.abs(n))+")":i(n)},Y=u(!1),b=u({...{id:-1,xto:"",tipe:"",jenis:"",harga:0,note_for_remarks:"",details:[],details2:[]}}),st=yt(()=>{let e=0;return b.value.details2.forEach(o=>{o.p_status!="Remove"&&(e+=o.qty*o.amount)}),e});return(e,o)=>{const n=rt,T=it,g=nt,U=_t,E=ct,ot=ut,lt=dt,at=pt;return f(),k("div",St,[h(n,{title:"Report Transaction"}),s("div",Ct,[s("div",Mt,[s("div",At,[L(s("select",{class:"","onUpdate:modelValue":o[0]||(o[0]=t=>ht(m)?m.value=t:null)},Nt,512),[[kt,l(m)]])]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[1]||(o[1]=t=>I())},[h(T),c(),Pt]),s("button",{type:"button",name:"button",class:"m-1 text-2xl flex items-center",onClick:o[2]||(o[2]=t=>X())},[h(g),c(),Ft])]),h(ot,{thead:l(et),selected:l(q),onSetSelected:o[3]||(o[3]=t=>q.value=t),tbody:l(y),fnCallData:V,scrolling:l(p),onSetScrollingPage:o[4]||(o[4]=t=>l(p).page=t),onDoFilter:o[5]||(o[5]=t=>J())},{status:_(({item:t})=>[s("div",{class:wt(["text-white text-xs px-2 py-1 rounded-lg",M(t)?"bg-green-600":"bg-red-600"])},a(M(t)?"Done":"Not Done"),3)]),val_ticket:_(({item:t})=>[t.val_ticket?(f(),S(E,{key:1})):(f(),S(U,{key:0}))]),pvr_had_detail:_(({item:t})=>[t.pvr_had_detail?(f(),S(E,{key:1})):(f(),S(U,{key:0}))]),susut_bruto_a:_(({item:t})=>[c(a(l(i)(t.ticket_a_bruto)),1)]),susut_tara_a:_(({item:t})=>[c(a(l(i)(t.ticket_a_tara)),1)]),susut_netto_a:_(({item:t})=>[c(a(l(i)(t.ticket_a_netto)),1)]),susut_bruto_b:_(({item:t})=>[c(a(l(i)(t.ticket_b_bruto)),1)]),susut_tara_b:_(({item:t})=>[c(a(l(i)(t.ticket_b_tara)),1)]),susut_netto_b:_(({item:t})=>[c(a(l(i)(t.ticket_b_netto)),1)]),susut_bruto_b_a:_(({item:t})=>[c(a(H(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a:_(({item:t})=>[c(a(H(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a:_(({item:t})=>[c(a(H(t.ticket_a_netto,t.ticket_b_netto)),1)]),susut_bruto_b_a_persen:_(({item:t})=>[c(a(F(t.ticket_a_bruto,t.ticket_b_bruto)),1)]),susut_tara_b_a_persen:_(({item:t})=>[c(a(F(t.ticket_a_tara,t.ticket_b_tara)),1)]),susut_netto_b_a_persen:_(({item:t})=>[c(a(F(t.ticket_a_netto,t.ticket_b_netto)),1)]),_:2},1032,["thead","selected","tbody","scrolling"])]),l(D)?(f(),k("div",Ht,[s("div",Yt,[s("div",Rt,[h(lt,{style:{color:"black",cursor:"pointer"},onClick:o[6]||(o[6]=t=>I())})]),s("iframe",{ref:"iframe",width:"100%",height:"100%",src:l(P).dataBase64},null,8,Ot),s("div",{style:{position:"absolute",top:"12px",right:"88px","background-color":"rgba(255,255,255,0)",width:"37px",height:"36px","z-index":"1",cursor:"pointer"},onClick:o[7]||(o[7]=t=>tt())})])])):gt("",!0),L(s("div",jt,[s("div",qt,[h(at,{title:"Detail Information",fn:()=>{Y.value=!1,e.show_confirm=!1},class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),s("div",zt,[s("div",Vt,[s("div",Jt,[Kt,s("div",It,a(l(b).xto)+" ",1)]),s("div",Ut,[Et,s("div",Lt,a(l(b).tipe),1)]),s("div",Zt,[Gt,s("div",Qt,a(l(b).jenis),1)]),s("div",Wt,[Xt,s("div",te,a(l(b).note_for_remarks),1)])]),s("div",ee,[s("table",se,[oe,(f(!0),k(Z,null,G(l(b).details,t=>(f(),k("tr",null,[s("td",le,a(t.ordinal)+". ",1),s("td",ae,a(t.xdesc)+" "+a(t.qty<=1?"":l(i)(t.qty||0)+" x Rp."+l(i)(t.harga||0)),1),re,s("td",ie,a(l(i)(t.qty*t.harga)),1)]))),256)),s("tr",ne,[_e,ce,s("th",ue,a(l(i)(l(b).harga)),1)])])]),s("div",de,[s("table",pe,[fe,(f(!0),k(Z,null,G(l(b).details2,t=>(f(),k("tr",null,[s("td",be,a(t.ordinal)+". ",1),s("td",me,a(t.ac_account_code),1),s("td",ye,a(t.description)+" "+a(t.qty<=1?"":l(i)(t.qty||0)+" x Rp."+l(i)(t.amount||0)),1),ke,s("td",he,a(l(i)(t.qty*t.amount)),1)]))),256)),s("tr",ge,[ve,xe,s("th",we,a(l(i)(l(st))),1)])])])]),s("div",De,[s("button",{class:"rounded m-1",onClick:o[8]||(o[8]=t=>Y.value=!1)}," Cancel ")])])],512),[[vt,l(Y)]])])}}};export{Qe as default};
