import{_ as G}from"./HeaderPopup.vue.f106b55c.js";import{_ as J}from"./client-only.869db181.js";import{r as M,f as Y,G as d,j as K,I as L,m as I,J as O,o as c,c as p,a as e,b as S,k as t,t as o,w as R,d as u,F as P,y as H,l as C,x as Q,E as W,A as b,B as q}from"./entry.3e021263.js";import{u as N}from"./useUtils.2a3dce74.js";import{u as T}from"./useMyFetch.1f7b438a.js";import"./Times.c99f77ef.js";import"./_plugin-vue_export-helper.c27b6911.js";const X={class:"box-fixed"},Z={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},ee={class:"w-full flex flex-col items-center grow overflow-auto"},te={class:"w-full flex flex-row flex-wrap"},ae={class:"w-1/2 sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},se=e("label",{for:""},"Period End",-1),oe={key:0,class:"card-border"},le={key:1},ne={class:"text-red-500"},re={key:0,class:"w-full flex p-1 justify-between flex-wrap"},_e={class:"w-full",role:"sticky"},ue={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ie=e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"19",class:"!bg-slate-800 text-white font-bold"}," Detail ")],-1),de={class:"sticky top-7 !z-[2]"},ce=e("th",{rowspan:"2"},"No",-1),pe=e("th",{rowspan:"2"},"ID",-1),me=e("th",{rowspan:"2"},"Nama Pekerja",-1),he=e("th",{rowspan:"2"},"Jabatan",-1),fe=e("th",{rowspan:"2"},"Tmpt Lahir",-1),ve=e("th",{rowspan:"2"},"Tgl Lahir",-1),ye=e("th",{rowspan:"2"},"TMK",-1),we=e("th",{rowspan:"2"},"No KTP",-1),be=e("th",{rowspan:"2"},"Alamat",-1),ke=e("th",{rowspan:"2"},"Status",-1),xe=e("th",{rowspan:"2"},"No Rek",-1),ge=e("th",{rowspan:"2"},"Nama Bank",-1),je={colspan:"2"},Fe={class:"text-sm"},Me={colspan:"2"},Se={class:"text-sm"},Ce={rowspan:"2"},Ne={class:"text-sm"},Be={rowspan:"2"},De={class:"text-sm"},Ee={rowspan:"2"},Ae={class:"text-sm"},Pe={class:"sticky top-[60px] !z-[2]"},qe={class:"text-sm"},Te={class:"text-sm"},Ve={class:"text-sm"},$e={class:"text-sm"},Ue={ref:"to_move"},ze=["data-index"],Ge={class:"w-full flex items-center justify-end"},He={__name:"rpt_salary",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(v){const m=v,{$moment:y}=W(),{pointFormat:r}=N(),B={id:"",period_end:new Date},n=M({...B}),D=Y("token"),w=M({}),_=M([]),V=async()=>{b().loading_full=!0,w.value={};const s=new FormData;s.append("period_end",n.value.period_end?y(n.value.period_end).format("Y-MM"):"");let l="post",i=n.value.id;i==""||(s.append("id",i),s.append("_method","PUT"));const{data:h,error:F,status:a}=await T("/rpt_salary",{method:l,headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},body:s,retry:0});if(b().loading_full=!1,a.value==="error"){q().trigger(F,w);return}if(_.value=h.value.details,i<=0)n.value.id=h.value.id,n.value.created_at=h.value.created_at,n.value.updated_at=h.value.updated_at,m.p_data.unshift(n.value);else{n.value.updated_at=h.value.updated_at;let f=m.p_data.map(z=>z.id).indexOf(i);f>=-1&&m.p_data.splice(f,1,{...n.value})}};d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.standby_nominal)}),s});const k=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.sb_gaji)}),s}),x=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.sb_makan)}),s}),g=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.uj_gaji)}),s}),j=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.uj_makan)}),s}),E=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.nominal_cut)}),s}),A=d(()=>{let s=0;return _.value.forEach(l=>{s+=parseFloat(l.salary_bonus_nominal)}),s}),$=d(()=>n.value.val&&n.value.val1||N().checkPermission("rpt_salary.val")&&n.value.val||N().checkPermission("rpt_salary.val1")&&n.value.val1),U=async()=>{b().loading_full=!0;const{data:s,error:l,status:i}=await T("/rpt_salary",{method:"get",headers:{Authorization:`Bearer ${D.value}`,Accept:"application/json"},params:{id:m.id},retry:0});if(b().loading_full=!1,i.value==="error"){q().trigger(l);return}n.value=s.value.data,m.is_copy&&(n.value.val=0,n.value.val1=0),_.value=s.value.data.details};return K(()=>m.show,(s,l)=>{s==!0&&(n.value={...B},_.value=[],w.value={},m.id!=0&&U())},{immediate:!0}),(s,l)=>{const i=G,h=L("vue-date-picker"),F=J;return I((c(),p("section",X,[e("div",null,[S(i,{title:"Form Salary Paid",fn:v.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",Z,[e("div",ee,[e("div",te,[e("div",ae,[se,t(n).id?(c(),p("div",oe,o(t(y)(t(n).period_end).format("MM-Y")),1)):(c(),p("div",le,[S(F,null,{default:R(()=>[S(h,{modelValue:t(n).period_end,"onUpdate:modelValue":l[0]||(l[0]=a=>t(n).period_end=a),format:"MM-yyyy","enable-time-picker":!1,"text-input":"","teleport-center":"","month-picker":""},null,8,["modelValue"])]),_:1})])),e("p",ne,o(t(w).period_end),1)])]),t(_).length?(c(),p("div",re,[e("div",_e,[e("table",ue,[e("thead",null,[ie,e("tr",de,[ce,pe,me,he,fe,ve,ye,we,be,ke,xe,ge,e("th",je,[u("Standby "),e("span",Fe,"("+o(t(r)(t(k)+t(x)||0))+")",1)]),e("th",Me,[u("Trip "),e("span",Se,"("+o(t(r)(t(g)+t(j)||0))+")",1)]),e("th",Ce,[u("Potongan "),e("span",Ne,"("+o(t(r)(t(E)||0))+")",1)]),e("th",Be,[u("U.Kerajinan "),e("span",De,"("+o(t(r)(t(A)||0))+")",1)]),e("th",Ee,[u("Grand Total "),e("span",Ae,"("+o(t(r)(t(k)+t(x)+t(g)+t(j)-t(E)+t(A)||0))+")",1)])]),e("tr",Pe,[e("th",null,[u("SB.Gaji "),e("span",qe,"("+o(t(r)(t(k)||0))+")",1)]),e("th",null,[u("SB.Makan "),e("span",Te,"("+o(t(r)(t(x)||0))+")",1)]),e("th",null,[u("UJ.Gaji "),e("span",Ve,"("+o(t(r)(t(g)||0))+")",1)]),e("th",null,[u("UJ.Makan "),e("span",$e,"("+o(t(r)(t(j)||0))+")",1)])])]),e("tbody",Ue,[(c(!0),p(P,null,H(t(_),(a,f)=>(c(),p(P,{key:f},[a.p_status!="Remove"?(c(),p("tr",{key:0,"data-index":f},[e("td",null,o(f+1)+".",1),e("td",null,o(a.employee_id),1),e("td",null,o(a.employee_name),1),e("td",null,o(a.employee_role),1),e("td",null,o(a.employee_birth_place),1),e("td",null,o(a.employee_birth_date?t(y)(a.employee_birth_date).format("DD-MM-Y"):""),1),e("td",null,o(a.employee_tmk?t(y)(a.employee_tmk).format("DD-MM-Y"):""),1),e("td",null,o(a.employee_ktp_no),1),e("td",null,o(a.employee_address),1),e("td",null,o(a.employee_status),1),e("td",null,o(a.employee_rek_no),1),e("td",null,o(a.employee_bank_name),1),e("td",null,o(t(r)(a.sb_gaji)),1),e("td",null,o(t(r)(a.sb_makan)),1),e("td",null,o(t(r)(a.uj_gaji)),1),e("td",null,o(t(r)(a.uj_makan)),1),e("td",null,o(t(r)(a.nominal_cut)),1),e("td",null,o(t(r)(a.salary_bonus_nominal)),1),e("td",null,o(t(r)(parseFloat(a.sb_gaji)+parseFloat(a.sb_makan)+parseFloat(a.uj_gaji)+parseFloat(a.uj_makan)-parseFloat(a.nominal_cut)+parseFloat(a.salary_bonus_nominal))),1)],8,ze)):C("",!0)],64))),128))],512)])])])):C("",!0)]),e("div",Ge,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:l[1]||(l[1]=a=>v.fnClose())}," Cancel "),t($)?C("",!0):(c(),p("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:l[2]||(l[2]=Q(a=>V(),["prevent"]))}," Generate "+o(t(n).id==""?"& Save":""),1))])])])],512)),[[O,v.show]])}}};export{He as default};
